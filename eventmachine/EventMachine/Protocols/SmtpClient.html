<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: EventMachine::Protocols::SmtpClient &mdash; EventMachine master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "EventMachine::Protocols::SmtpClient",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>EventMachine master</a> &raquo; 
      <a href='../../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../../EventMachine.html" title="EventMachine (module)">EventMachine</a> &raquo; 
        <a href="../Protocols.html" title="EventMachine::Protocols (module)">Protocols</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>SmtpClient&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: EventMachine::Protocols::SmtpClient</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="LineText2.html" title="EventMachine::Protocols::LineText2 (module)"><code>LineText2</code></a>,
          <a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a>,
          <a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Connection.html" title="EventMachine::Connection (class)">EventMachine::Connection</a></span>
        <ul class='fullTree'>
          <li><a href="../../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="../Connection.html" title="EventMachine::Connection (class)">EventMachine::Connection</a></li>
          <li class='next'>EventMachine::Protocols::SmtpClient</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L67'>lib/em/protocols/smtpclient.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p>Simple SMTP client</p>

<p>Sending generated emails (using Mail)</p>

<p>mail = Mail.new do
    from    &#39;<a href="mailto:alice@example.com">alice@example.com</a>&#39;
    to      &#39;<a href="mailto:bob@example.com">bob@example.com</a>&#39;
    subject &#39;This is a test email&#39;
    body    &#39;Hello, world!&#39;
  end</p>

<p>email = EM::P::SmtpClient.send(
    :domain=&gt;&#39;example.com&#39;,
    :from=&gt;mail.from.first,
    :to=&gt;mail.to,
    :message=&gt;mail.to_s
  )</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code "#{object.source_type}"'><code><span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='const'><a href="../../top-level-namespace.html#EM-constant" title="EM (constant)">EM</a></span><span class='op'>::</span><span class='const'><a href="../Protocols.html" title="EventMachine::Protocols (module)">Protocols</a></span><span class='op'>::</span><span class='const'>SmtpClient</span>.<span class='id identifier rubyid_send'><a href="#send-class_method" title="EventMachine::Protocols::SmtpClient.send (method)">send</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_domain'>domain</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span><span class='op'>=&gt;</span><span class='int'>25</span><span class='comma'>,</span> <span class='comment'># optional, defaults 25
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_starttls'>starttls</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='comma'>,</span> <span class='comment'># use ssl
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sender@example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span><span class='op'>=&gt;</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_1@example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_2@example.com</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_header'>header</span><span class='op'>=&gt;</span> {<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Subject</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is a subject line</span><span class='tstring_end'>&quot;</span></span>}<span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is the body of the email</span><span class='tstring_end'>&quot;</span></span>
)
<span class='id identifier rubyid_email'>email</span>.<span class='id identifier rubyid_callback'>callback</span>{
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Email sent!</span><span class='tstring_end'>&#39;</span></span>
}
<span class='id identifier rubyid_email'>email</span>.<span class='id identifier rubyid_errback'>errback</span>{ <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Email failed!</span><span class='tstring_end'>&#39;</span></span>
}</code></pre>
  </div>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../Deferrable.html#Pool-constant" title="EventMachine::Deferrable::Pool (constant)">Pool</a>
  </p>
  <h3 class='inherited'><a href="LineText2.html" title="EventMachine::Protocols::LineText2 (module)"><code>LineText2</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="LineText2.html#MaxBinaryLength-constant" title="EventMachine::Protocols::LineText2::MaxBinaryLength (constant)">MaxBinaryLength</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; SmtpClient </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send-class_method" title=".send (class method)">.<strong>send</strong>(args = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p><code>:host</code> =&gt; required String.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Connection.html#new-class_method" title="EventMachine::Connection.new (method)">.new</a></td>
      <td><div class='inline'><p>Override .new so subclasses don&#39;t have to call super and can ignore connection-specific arguments.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature wo'>
      <a href="#args=-instance_method" title="#args= (instance method)">#<strong>args=</strong>(value)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
  </li>
</ul>

<h3 class='inherited'><a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#comm_inactivity_timeout-instance_method" title="EventMachine::Connection#comm_inactivity_timeout (method)">#comm_inactivity_timeout</a></td>
      <td><div class='inline'><p>comm_inactivity_timeout returns the current value (float in seconds) of the inactivity-timeout property of network-connection and datagram-socket objects.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#comm_inactivity_timeout=-instance_method" title="EventMachine::Connection#comm_inactivity_timeout= (method)">#comm_inactivity_timeout=</a></td>
      <td><div class='inline'><p>Allows you to set the inactivity-timeout property for a network connection or datagram socket.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="../Connection.html#error%3F-instance_method" title="EventMachine::Connection#error? (method)">#error?</a></td>
      <td><div class='inline'><p>Returns true if the connection is in an error state, false otherwise.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#notify_readable=-instance_method" title="EventMachine::Connection#notify_readable= (method)">#notify_readable=</a></td>
      <td><div class='inline'><p>Watches connection for readability.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m rw' href="../Connection.html#notify_readable%3F-instance_method" title="EventMachine::Connection#notify_readable? (method)">#notify_readable?</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#notify_writable=-instance_method" title="EventMachine::Connection#notify_writable= (method)">#notify_writable=</a></td>
      <td><div class='inline'><p>Watches connection for writeability.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#notify_writable%3F-instance_method" title="EventMachine::Connection#notify_writable? (method)">#notify_writable?</a></td>
      <td><div class='inline'><p>Returns true if the connection is being watched for writability.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../Connection.html#paused%3F-instance_method" title="EventMachine::Connection#paused? (method)">#paused?</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#pending_connect_timeout-instance_method" title="EventMachine::Connection#pending_connect_timeout (method)">#pending_connect_timeout</a></td>
      <td><div class='inline'><p>The duration after which a TCP connection in the connecting state will fail.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw' href="../Connection.html#pending_connect_timeout=-instance_method" title="EventMachine::Connection#pending_connect_timeout= (method)">#pending_connect_timeout=</a></td>
      <td><div class='inline'><p>Sets the duration after which a TCP connection in a connecting state will fail.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m rw nodoc' href="../Connection.html#signature-instance_method" title="EventMachine::Connection#signature (method)">#signature</a>,
        <a class='i_m ro' href="../Connection.html#watch_only%3F-instance_method" title="EventMachine::Connection#watch_only? (method)">#watch_only?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#connection_completed-instance_method" title="#connection_completed (instance method)">#<strong>connection_completed</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#post_init-instance_method" title="#post_init (instance method)">#<strong>post_init</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#receive_line-instance_method" title="#receive_line (instance method)">#<strong>receive_line</strong>(ln)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#unbind-instance_method" title="#unbind (instance method)">#<strong>unbind</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>We can get here in a variety of ways, all of them being failures unless the @succeeded flag is set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#escape_leading_dots-instance_method" title="#escape_leading_dots (instance method)">#<strong>escape_leading_dots</strong>(s)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_auth-instance_method" title="#invoke_auth (instance method)">#<strong>invoke_auth</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform an authentication.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_data-instance_method" title="#invoke_data (instance method)">#<strong>invoke_data</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_ehlo_over_tls-instance_method" title="#invoke_ehlo_over_tls (instance method)">#<strong>invoke_ehlo_over_tls</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_error-instance_method" title="#invoke_error (instance method)">#<strong>invoke_error</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>We encountered an error from the server and will close the connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_internal_error-instance_method" title="#invoke_internal_error (instance method)">#<strong>invoke_internal_error</strong>(msg = &quot;???&quot;)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>We encountered an error on our side of the protocol and will close the connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_mail_from-instance_method" title="#invoke_mail_from (instance method)">#<strong>invoke_mail_from</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_rcpt_to-instance_method" title="#invoke_rcpt_to (instance method)">#<strong>invoke_rcpt_to</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invoke_starttls-instance_method" title="#invoke_starttls (instance method)">#<strong>invoke_starttls</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_auth_response-instance_method" title="#receive_auth_response (instance method)">#<strong>receive_auth_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_data_response-instance_method" title="#receive_data_response (instance method)">#<strong>receive_data_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_ehlo_over_tls_response-instance_method" title="#receive_ehlo_over_tls_response (instance method)">#<strong>receive_ehlo_over_tls_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_ehlo_response-instance_method" title="#receive_ehlo_response (instance method)">#<strong>receive_ehlo_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_mail_from_response-instance_method" title="#receive_mail_from_response (instance method)">#<strong>receive_mail_from_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_message_response-instance_method" title="#receive_message_response (instance method)">#<strong>receive_message_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_rcpt_to_response-instance_method" title="#receive_rcpt_to_response (instance method)">#<strong>receive_rcpt_to_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_signon-instance_method" title="#receive_signon (instance method)">#<strong>receive_signon</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_starttls_response-instance_method" title="#receive_starttls_response (instance method)">#<strong>receive_starttls_response</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#send_ehlo-instance_method" title="#send_ehlo (instance method)">#<strong>send_ehlo</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="LineText2.html" title="EventMachine::Protocols::LineText2 (module)"><code>LineText2</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#receive_binary_data-instance_method" title="EventMachine::Protocols::LineText2#receive_binary_data (method)">#receive_binary_data</a></td>
      <td><div class='inline'><p>Stub.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="LineText2.html#receive_data-instance_method" title="EventMachine::Protocols::LineText2#receive_data (method)">#receive_data</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#receive_end_of_binary_data-instance_method" title="EventMachine::Protocols::LineText2#receive_end_of_binary_data (method)">#receive_end_of_binary_data</a></td>
      <td><div class='inline'><p>Stub.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#receive_line-instance_method" title="EventMachine::Protocols::LineText2#receive_line (method)">#receive_line</a></td>
      <td><div class='inline'><p>Stub.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#set_binary_mode-instance_method" title="EventMachine::Protocols::LineText2#set_binary_mode (method)">#set_binary_mode</a></td>
      <td><div class='inline'><p>Alias for #set_text_mode, added for back-compatibility with <a href="LineAndTextProtocol.html" title="EventMachine::Protocols::LineAndTextProtocol (class)"><code>LineAndTextProtocol</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#set_delimiter-instance_method" title="EventMachine::Protocols::LineText2#set_delimiter (method)">#set_delimiter</a></td>
      <td><div class='inline'><p>The line delimiter may be a regular expression or a string.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#set_line_mode-instance_method" title="EventMachine::Protocols::LineText2#set_line_mode (method)">#set_line_mode</a></td>
      <td><div class='inline'><p>Called internally but also exposed to user code, for the case in which processing of binary data creates a need to transition back to line mode.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="LineText2.html#set_text_mode-instance_method" title="EventMachine::Protocols::LineText2#set_text_mode (method)">#set_text_mode</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="LineText2.html#unbind-instance_method" title="EventMachine::Protocols::LineText2#unbind (method)">#unbind</a></td>
      <td><div class='inline'><p>In case of a dropped connection, we&#39;ll send a partial buffer to user code when in sized text mode.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#callback-instance_method" title="EventMachine::Deferrable#callback (method)">#callback</a></td>
      <td><div class='inline'><p>Specify a block to be executed if and when the <a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> object receives a status of <code>:succeeded</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#cancel_callback-instance_method" title="EventMachine::Deferrable#cancel_callback (method)">#cancel_callback</a></td>
      <td><div class='inline'><p>Cancels an outstanding callback to &amp;block if any.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#cancel_errback-instance_method" title="EventMachine::Deferrable#cancel_errback (method)">#cancel_errback</a></td>
      <td><div class='inline'><p>Cancels an outstanding errback to &amp;block if any.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#cancel_timeout-instance_method" title="EventMachine::Deferrable#cancel_timeout (method)">#cancel_timeout</a></td>
      <td><div class='inline'><p>Cancels an outstanding timeout if any.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#errback-instance_method" title="EventMachine::Deferrable#errback (method)">#errback</a></td>
      <td><div class='inline'><p>Specify a block to be executed if and when the <a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> object receives a status of <code>:failed</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#fail-instance_method" title="EventMachine::Deferrable#fail (method)">#fail</a></td>
      <td><div class='inline'><p>Sugar for set_deferred_status(:failed, ...).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#set_deferred_failure-instance_method" title="EventMachine::Deferrable#set_deferred_failure (method)">#set_deferred_failure</a></td>
      <td><div class='inline'><p>Alias for <a href="../Deferrable.html#fail-instance_method" title="EventMachine::Deferrable#fail (method)">Deferrable#fail</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#set_deferred_status-instance_method" title="EventMachine::Deferrable#set_deferred_status (method)">#set_deferred_status</a></td>
      <td><div class='inline'><p>Sets the &quot;disposition&quot; (status) of the <a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#set_deferred_success-instance_method" title="EventMachine::Deferrable#set_deferred_success (method)">#set_deferred_success</a></td>
      <td><div class='inline'><p>Alias for <a href="../Deferrable.html#succeed-instance_method" title="EventMachine::Deferrable#succeed (method)">Deferrable#succeed</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#succeed-instance_method" title="EventMachine::Deferrable#succeed (method)">#succeed</a></td>
      <td><div class='inline'><p>Sugar for set_deferred_status(:succeeded, ...).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Deferrable.html#timeout-instance_method" title="EventMachine::Deferrable#timeout (method)">#timeout</a></td>
      <td><div class='inline'><p>Setting a timeout on a <a href="../Deferrable.html" title="EventMachine::Deferrable (module)"><code>Deferrable</code></a> causes it to go into the failed state after the Timeout expires (passing no arguments to the object&#39;s errbacks).</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#associate_callback_target-instance_method" title="EventMachine::Connection#associate_callback_target (method)">#associate_callback_target</a></td>
      <td><div class='inline'><p>conn_associate_callback_target.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#close_connection-instance_method" title="EventMachine::Connection#close_connection (method)">#close_connection</a></td>
      <td><div class='inline'><p>EventMachine::Connection#close_connection is called only by user code, and never by the event loop.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#close_connection_after_writing-instance_method" title="EventMachine::Connection#close_connection_after_writing (method)">#close_connection_after_writing</a></td>
      <td><div class='inline'><p>A variant of <a href="../../EventMachine.html#close_connection-instance_method" title="EventMachine#close_connection (method)">EventMachine#close_connection</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#connection_completed-instance_method" title="EventMachine::Connection#connection_completed (method)">#connection_completed</a></td>
      <td><div class='inline'><p>Called by the event loop when a remote TCP connection attempt completes successfully.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#detach-instance_method" title="EventMachine::Connection#detach (method)">#detach</a></td>
      <td><div class='inline'><p>Removes given connection from the event loop.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#disable_keepalive-instance_method" title="EventMachine::Connection#disable_keepalive (method)">#disable_keepalive</a></td>
      <td><div class='inline'><p>t_disable_keepalive.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#enable_keepalive-instance_method" title="EventMachine::Connection#enable_keepalive (method)">#enable_keepalive</a></td>
      <td><div class='inline'><p>t_enable_keepalive.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../Connection.html#get_cipher_bits-instance_method" title="EventMachine::Connection#get_cipher_bits (method)">#get_cipher_bits</a>,
        <a class='i_m ' href="../Connection.html#get_cipher_name-instance_method" title="EventMachine::Connection#get_cipher_name (method)">#get_cipher_name</a>,
        <a class='i_m ' href="../Connection.html#get_cipher_protocol-instance_method" title="EventMachine::Connection#get_cipher_protocol (method)">#get_cipher_protocol</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_idle_time-instance_method" title="EventMachine::Connection#get_idle_time (method)">#get_idle_time</a></td>
      <td><div class='inline'><p>The number of seconds since the last send/receive activity on this connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_outbound_data_size-instance_method" title="EventMachine::Connection#get_outbound_data_size (method)">#get_outbound_data_size</a></td>
      <td><div class='inline'><p>conn_get_outbound_data_size.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_peer_cert-instance_method" title="EventMachine::Connection#get_peer_cert (method)">#get_peer_cert</a></td>
      <td><div class='inline'><p>If <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> is active on the connection, returns the remote <a href="http://en.wikipedia.org/wiki/X.509">X509 certificate</a> as a string, in the popular <a href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">PEM format</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_peername-instance_method" title="EventMachine::Connection#get_peername (method)">#get_peername</a></td>
      <td><div class='inline'><p>This method is used with stream-connections to obtain the identity of the remotely-connected peer.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_pid-instance_method" title="EventMachine::Connection#get_pid (method)">#get_pid</a></td>
      <td><div class='inline'><p>Returns the PID (kernel process identifier) of a subprocess associated with this <a href="../Connection.html" title="EventMachine::Connection (class)"><code>Connection</code></a> object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_proxied_bytes-instance_method" title="EventMachine::Connection#get_proxied_bytes (method)">#get_proxied_bytes</a></td>
      <td><div class='inline'><p>The number of bytes proxied to another connection.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../Connection.html#get_sni_hostname-instance_method" title="EventMachine::Connection#get_sni_hostname (method)">#get_sni_hostname</a>,
        <a class='i_m ' href="../Connection.html#get_sock_opt-instance_method" title="EventMachine::Connection#get_sock_opt (method)">#get_sock_opt</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_sockname-instance_method" title="EventMachine::Connection#get_sockname (method)">#get_sockname</a></td>
      <td><div class='inline'><p>Used with stream-connections to obtain the identity of the local side of the connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#get_status-instance_method" title="EventMachine::Connection#get_status (method)">#get_status</a></td>
      <td><div class='inline'><p>Returns a subprocess exit status.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Connection.html#initialize-instance_method" title="EventMachine::Connection#initialize (method)">#initialize</a></td>
      <td><div class='inline'><p>Stubbed initialize so legacy superclasses can safely call super.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../Connection.html#original_method-instance_method" title="EventMachine::Connection#original_method (method)">#original_method</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#pause-instance_method" title="EventMachine::Connection#pause (method)">#pause</a></td>
      <td><div class='inline'><p>Pause a connection so that <a href="../../EventMachine.html#send_data-instance_method" title="EventMachine#send_data (method)">EventMachine#send_data</a> and <code>#receive_data</code> events are not fired until <code>#resume</code> is called.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#post_init-instance_method" title="EventMachine::Connection#post_init (method)">#post_init</a></td>
      <td><div class='inline'><p>Called by the event loop immediately after the network connection has been established, and before resumption of the network loop.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#proxy_completed-instance_method" title="EventMachine::Connection#proxy_completed (method)">#proxy_completed</a></td>
      <td><div class='inline'><p>called when the reactor finished proxying all of the requested bytes.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#proxy_incoming_to-instance_method" title="EventMachine::Connection#proxy_incoming_to (method)">#proxy_incoming_to</a></td>
      <td><div class='inline'><p>EventMachine::Connection#proxy_incoming_to is called only by user code.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#proxy_target_unbound-instance_method" title="EventMachine::Connection#proxy_target_unbound (method)">#proxy_target_unbound</a></td>
      <td><div class='inline'><p>Called by the reactor after attempting to relay incoming data to a descriptor (set as a proxy target descriptor with <a href="../../EventMachine.html#enable_proxy-class_method" title="EventMachine.enable_proxy (method)">EventMachine.enable_proxy</a>) that has already been closed.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#receive_data-instance_method" title="EventMachine::Connection#receive_data (method)">#receive_data</a></td>
      <td><div class='inline'><p>Called by the event loop whenever data has been received by the network connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#reconnect-instance_method" title="EventMachine::Connection#reconnect (method)">#reconnect</a></td>
      <td><div class='inline'><p>Reconnect to a given host/port with the current instance.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#resume-instance_method" title="EventMachine::Connection#resume (method)">#resume</a></td>
      <td><div class='inline'><p>Resume a connection&#39;s <a href="../../EventMachine.html#send_data-instance_method" title="EventMachine#send_data (method)">EventMachine#send_data</a> and <code>#receive_data</code> events.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#send_data-instance_method" title="EventMachine::Connection#send_data (method)">#send_data</a></td>
      <td><div class='inline'><p>Call this method to send data to the remote end of the network connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#send_datagram-instance_method" title="EventMachine::Connection#send_datagram (method)">#send_datagram</a></td>
      <td><div class='inline'><p>Sends UDP messages.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#send_file_data-instance_method" title="EventMachine::Connection#send_file_data (method)">#send_file_data</a></td>
      <td><div class='inline'><p>Like <a href="../Connection.html#send_data-instance_method" title="EventMachine::Connection#send_data (method)">Connection#send_data</a>, this sends data to the remote end of the network connection.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../Connection.html#set_sock_opt-instance_method" title="EventMachine::Connection#set_sock_opt (method)">#set_sock_opt</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#ssl_handshake_completed-instance_method" title="EventMachine::Connection#ssl_handshake_completed (method)">#ssl_handshake_completed</a></td>
      <td><div class='inline'><p>Called by <a href="../../EventMachine.html" title="EventMachine (module)"><code>::EventMachine</code></a> when the SSL/TLS handshake has been completed, as a result of calling #start_tls to initiate SSL/TLS on the connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#ssl_verify_peer-instance_method" title="EventMachine::Connection#ssl_verify_peer (method)">#ssl_verify_peer</a></td>
      <td><div class='inline'><p>Called by <a href="../../EventMachine.html" title="EventMachine (module)"><code>::EventMachine</code></a> when <code>:verify_peer</code> =&gt; true has been passed to <a href="../../EventMachine.html#start_tls-instance_method" title="EventMachine#start_tls (method)">EventMachine#start_tls</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#start_tls-instance_method" title="EventMachine::Connection#start_tls (method)">#start_tls</a></td>
      <td><div class='inline'><p>Call <a href="../../EventMachine.html#start_tls-instance_method" title="EventMachine#start_tls (method)">EventMachine#start_tls</a> at any point to initiate TLS encryption on connected streams.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#stop_proxying-instance_method" title="EventMachine::Connection#stop_proxying (method)">#stop_proxying</a></td>
      <td><div class='inline'><p>A helper method for <a href="../../EventMachine.html#disable_proxy-class_method" title="EventMachine.disable_proxy (method)">EventMachine.disable_proxy</a></p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#stream_file_data-instance_method" title="EventMachine::Connection#stream_file_data (method)">#stream_file_data</a></td>
      <td><div class='inline'><p>Open a file on the filesystem and send it to the remote peer.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Connection.html#unbind-instance_method" title="EventMachine::Connection#unbind (method)">#unbind</a></td>
      <td><div class='inline'><p>called by the framework whenever a connection (either a server or client connection) is closed.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>  &#x21d2; <code>SmtpClient</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L71-L76'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='76'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@succeeded</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@code</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@msg</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="send-class_method">
  <h3 class='signature  first'>
    .<strong>send</strong>(args = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <p><code>:host</code> =&gt; required String
  a string containing the IP address or host name of the SMTP server to connect to.
<code>:port</code> =&gt; optional
  defaults to 25.
<code>:domain</code> =&gt; required String
  This is passed as the argument to the EHLO command.
<code>:starttls</code> =&gt; optional Boolean
  If it evaluates true, then the client will initiate STARTTLS with
  the server, and abort the connection if the negotiation doesn&#39;t succeed.
  TODO, need to be able to pass certificate parameters with this option.
<code>:auth</code> =&gt; optional Hash of auth parameters
  If not given, then no auth will be attempted.
  (In that case, the connection will be aborted if the server requires auth.)
  Specify the hash value :type to determine the auth type, along with additional parameters
  depending on the type.
  Currently only :type =&gt; :plain is supported. Pass additional parameters :username (String),
  and :password (either a String or a Proc that will be called at auth-time).</p>

<p>@example
    :auth =&gt; <code>:username=&gt;&quot;<a href="mailto:mickey@disney.com">mickey@disney.com</a>&quot;, :password=&gt;&quot;mouse&quot;</code></p>

<p><code>:from</code> =&gt; required String
  Specifies the sender of the message. Will be passed as the argument
  to the MAIL FROM. Do NOT enclose the argument in angle-bracket (&lt;&gt;) characters.
  The connection will abort if the server rejects the value.
<code>:to</code> =&gt; required String or Array of Strings
  The recipient(s) of the message. Do NOT enclose
  any of the values in angle-brackets (&lt;&gt;) characters. It&#39;s NOT a fatal error if one or more
  recipients are rejected by the server. (Of course, if ALL of them are, the server will most
  likely trigger an error when we try to send data.) An array of codes containing the status
  of each requested recipient is available after the call completes. TODO, we should define
  an overridable stub that will be called on rejection of a recipient or a sender, giving
  user code the chance to try again or abort the connection.</p>

<p>One of either <code>:message</code>, <code>:content</code>, or <code>:header</code> and <code>:body</code> is required:</p>

<p><code>:message</code> =&gt; String
  A valid RFC2822 Internet Message.
<code>:content</code> =&gt; String
  Raw data which MUST be in correct SMTP body format, with escaped leading dots and a trailing
  dot line.
<code>:header</code> =&gt; String or Hash of values to be transmitted in the header of the message.
  The hash keys are the names of the headers (do NOT append a trailing colon), and the values
  are strings containing the header values. TODO, support Arrays of header values, which would
  cause us to send that specific header line more than once.</p>

<p>@example
    :header =&gt; <code>=&gt; &quot;Bogus&quot;, &quot;CC&quot; =&gt; &quot;<a href="mailto:myboss@example.com">myboss@example.com</a>&quot;</code></p>

<p><code>:body</code> =&gt; Optional String or Array of Strings, defaults blank.
  This will be passed as the body of the email message.
  TODO, this needs to be significantly beefed up. As currently written, this requires the caller
  to properly format the input into CRLF-delimited lines of 7-bit characters in the standard
  SMTP transmission format. We need to be able to automatically convert binary data, and add
  correct line-breaks to text data.</p>

<p><code>:verbose</code> =&gt; Optional.
  If true, will cause a lot of information (including the server-side of the
  conversation) to be dumped to $&gt;.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L138-L167'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='138' data-end='167'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 138</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_args'>args</span><span class='op'>=</span>{}
  <span class='id identifier rubyid_args'>args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span>] <span class='op'>||=</span> <span class='int'>25</span>
  <span class='id identifier rubyid_args'>args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>] <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

<span class='embdoc_beg'>=begin
</span><span class='embdoc'>(I don&#39;t think it&#39;s possible for EM#connect to throw an exception under normal
</span><span class='embdoc'>circumstances, so this original code is stubbed out. A connect-failure will result
</span><span class='embdoc'>in the #unbind method being called without calling #connection_completed.)
</span><span class='embdoc'>begin
</span><span class='embdoc'>  EventMachine.connect( args[:host], args[:port], self) {|c|
</span><span class='embdoc'>    # According to the EM docs, we will get here AFTER post_init is called.
</span><span class='embdoc'>    c.args = args
</span><span class='embdoc'>    c.set_comm_inactivity_timeout 60
</span><span class='embdoc'>  }
</span><span class='embdoc'>rescue
</span><span class='embdoc'>  # We&#39;ll get here on a connect error. This code mimics the effect
</span><span class='embdoc'>  # of a call to invoke_internal_error. Would be great to DRY this up.
</span><span class='embdoc'>  # (Actually, it may be that we never get here, if EM#connect catches
</span><span class='embdoc'>  # its errors internally.)
</span><span class='embdoc'>  d = EM::DefaultDeferrable.new
</span><span class='embdoc'>  d.set_deferred_status(:failed, {:error=&gt;[:connect, 500, &quot;unable to connect to server&quot;]})
</span><span class='embdoc'>  d
</span><span class='embdoc'>end
</span><span class='embdoc_end'>=end
</span>  <span class='const'><a href="../../EventMachine.html" title="EventMachine (module)">EventMachine</a></span>.<span class='id identifier rubyid_connect'><a href="../../EventMachine.html#connect-class_method" title="EventMachine.connect (method)">connect</a></span>( <span class='id identifier rubyid_args'>args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span>]<span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span>]<span class='comma'>,</span> <span class='kw'>self</span>) {<span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='comment'># According to the EM docs, we will get here AFTER post_init is called.
</span>    <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
    <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_set_comm_inactivity_timeout'><a href="../../EventMachine.html#set_comm_inactivity_timeout-class_method" title="EventMachine.set_comm_inactivity_timeout (method)">set_comm_inactivity_timeout</a></span> <span class='int'>60</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="args=-instance_method">
  <h3 class='signature wo first'>
    #<strong>args=</strong>(value)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L169-L169'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='169' data-end='169'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 169</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span> <span class='symbeg'>:</span><span class='id identifier rubyid_args'>args</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="connection_completed-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>connection_completed</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L178-L181'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='178' data-end='181'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 178</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connection_completed'>connection_completed</span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_signon'><a href="#receive_signon-instance_method" title="EventMachine::Protocols::SmtpClient#receive_signon (method)">receive_signon</a></span>
  <span class='ivar'>@msg</span> <span class='op'>=</span> []
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="escape_leading_dots-instance_method">
  <h3 class='signature priv'>
    #<strong>escape_leading_dots</strong>(s)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L335-L337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='335' data-end='337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 335</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_escape_leading_dots'>escape_leading_dots</span>(<span class='id identifier rubyid_s'>s</span>)
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\.</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>..</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_auth-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_auth</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <p>Perform an authentication. If the caller didn&#39;t request one, then fall through
to the mail-from state.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L282-L299'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='282' data-end='299'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 282</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_auth'>invoke_auth</span>
  <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span>]
    <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span>] <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_plain'>plain</span>
      <span class='id identifier rubyid_psw'>psw</span> <span class='op'>=</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_password'>password</span>]
      <span class='kw'>if</span> <span class='id identifier rubyid_psw'>psw</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)
        <span class='id identifier rubyid_psw'>psw</span> <span class='op'>=</span> <span class='id identifier rubyid_psw'>psw</span>.<span class='id identifier rubyid_call'>call</span>
      <span class='kw'>end</span>
      <span class='comment'>#str = Base64::encode64(&quot;\0#{@args[:auth][:username]}\0#{psw}&quot;).chomp
</span>      <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='embexpr_beg'>#{</span><span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>\0</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_psw'>psw</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AUTH PLAIN </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_auth_response'><a href="#receive_auth_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_auth_response (method)">receive_auth_response</a></span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_invoke_internal_error'><a href="#invoke_internal_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_internal_error (method)">invoke_internal_error</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unsupported auth type</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_invoke_mail_from'><a href="#invoke_mail_from-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_mail_from (method)">invoke_mail_from</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_data-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_data</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L339-L342'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='339' data-end='342'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 339</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_data'>invoke_data</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_data_response'><a href="#receive_data_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_data_response (method)">receive_data_response</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_ehlo_over_tls-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_ehlo_over_tls</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L271-L274'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='271' data-end='274'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 271</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_ehlo_over_tls'>invoke_ehlo_over_tls</span>
  <span class='id identifier rubyid_send_ehlo'><a href="#send_ehlo-instance_method" title="EventMachine::Protocols::SmtpClient#send_ehlo (method)">send_ehlo</a></span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_ehlo_over_tls_response'><a href="#receive_ehlo_over_tls_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_ehlo_over_tls_response (method)">receive_ehlo_over_tls_response</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_error-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_error</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <p>We encountered an error from the server and will close the connection.
Use the error and message the server returned.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L217-L225'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='217' data-end='225'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 217</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_error'>invoke_error</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_elapsed_time'>elapsed_time</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_start_time'>start_time</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_responder'>responder</span> <span class='op'>=</span> <span class='ivar'>@responder</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='ivar'>@code</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='ivar'>@msg</span>
  <span class='id identifier rubyid_set_deferred_status'>set_deferred_status</span> <span class='symbeg'>:</span><span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='ivar'>@return_values</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QUIT\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_close_connection_after_writing'>close_connection_after_writing</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_internal_error-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_internal_error</strong>(msg = &quot;???&quot;)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <p>We encountered an error on our side of the protocol and will close the connection.
Use an extra-protocol error code (900) and use the message from the caller.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L230-L238'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='230' data-end='238'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 230</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_internal_error'>invoke_internal_error</span> <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>???</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_elapsed_time'>elapsed_time</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_start_time'>start_time</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_responder'>responder</span> <span class='op'>=</span> <span class='ivar'>@responder</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='int'>900</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_msg'>msg</span>
  <span class='id identifier rubyid_set_deferred_status'>set_deferred_status</span> <span class='symbeg'>:</span><span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='ivar'>@return_values</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QUIT\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_close_connection_after_writing'>close_connection_after_writing</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_mail_from-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_mail_from</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L305-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='305' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 305</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_mail_from'>invoke_mail_from</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAIL FROM: &lt;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>&gt;\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_mail_from_response'><a href="#receive_mail_from_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_mail_from_response (method)">receive_mail_from_response</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_rcpt_to-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_rcpt_to</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L314-L329'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='314' data-end='329'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 314</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_rcpt_to'>invoke_rcpt_to</span>
  <span class='ivar'>@rcpt_responses</span> <span class='op'>||=</span> []
  <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='ivar'>@rcpt_responses</span>.<span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_to'>to</span> <span class='op'>=</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>) <span class='op'>?</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span>] <span class='op'>:</span> [<span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span>].<span class='id identifier rubyid_to_s'>to_s</span>]
  <span class='kw'>if</span> <span class='id identifier rubyid_l'>l</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_to'>to</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RCPT TO: &lt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to'>to</span>[<span class='id identifier rubyid_l'>l</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>&gt;\r\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_rcpt_to_response'><a href="#receive_rcpt_to_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_rcpt_to_response (method)">receive_rcpt_to_response</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='ivar'>@rcpt_responses</span>.<span class='id identifier rubyid_select'>select</span> {<span class='op'>|</span><span class='id identifier rubyid_rr'>rr</span><span class='op'>|</span> <span class='id identifier rubyid_rr'>rr</span>.<span class='id identifier rubyid_last'>last</span> <span class='op'>==</span> <span class='int'>2</span>}
    <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span> <span class='kw'>and</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_invoke_data'><a href="#invoke_data-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_data (method)">invoke_data</a></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invoke_starttls-instance_method">
  <h3 class='signature priv'>
    #<strong>invoke_starttls</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L255-L264'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='255' data-end='264'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invoke_starttls'>invoke_starttls</span>
  <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_starttls'>starttls</span>]
    <span class='comment'># It would be more sociable to first ask if @server_caps contains
</span>    <span class='comment'># the string &quot;STARTTLS&quot; before we invoke it, but hey, life&#39;s too short.
</span>    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>STARTTLS\r\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_starttls_response'><a href="#receive_starttls_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_starttls_response (method)">receive_starttls_response</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_invoke_auth'><a href="#invoke_auth-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_auth (method)">invoke_auth</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post_init-instance_method">
  <h3 class='signature nodoc'>
    #<strong>post_init</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L172-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='172' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 172</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_post_init'>post_init</span>
  <span class='ivar'>@return_values</span> <span class='op'>=</span> <span class='const'>OpenStruct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="EventMachine::Protocols::SmtpClient.new (method)">new</a></span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_auth_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_auth_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L300-L303'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='300' data-end='303'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 300</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_auth_response'>receive_auth_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_invoke_mail_from'><a href="#invoke_mail_from-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_mail_from (method)">invoke_mail_from</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_data_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_data_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L343-L380'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='343' data-end='380'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 343</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_data_response'>receive_data_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>3</span>

  <span class='comment'># The data to send can be given in either @args[:message], @args[:content], or the
</span>  <span class='comment'># combination of @args[:header] and @args[:body].
</span>  <span class='comment'>#
</span>  <span class='comment'>#   - @args[:message] (String) MUST be a valid RFC2822 Internet Message
</span>  <span class='comment'>#
</span>  <span class='comment'>#   - @args[:content] (String) MUST be in correct SMTP body format, with escaped
</span>  <span class='comment'>#     leading dots and a trailing dot line
</span>  <span class='comment'>#
</span>  <span class='comment'>#   - @args[:header]  (Hash or String)
</span>  <span class='comment'>#   - @args[:body]    (Array or String)
</span>  <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_message'>message</span>]
    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='id identifier rubyid_escape_leading_dots'><a href="#escape_leading_dots-instance_method" title="EventMachine::Protocols::SmtpClient#escape_leading_dots (method)">escape_leading_dots</a></span>(<span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_message'>message</span>].<span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n.\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_content'>content</span>]
    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_content'>content</span>].<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>else</span>
    <span class='comment'># The header can be a hash or an array.
</span>    <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_header'>header</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
      (<span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_header'>header</span>] <span class='op'>||</span> {}).<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='id identifier rubyid_escape_leading_dots'><a href="#escape_leading_dots-instance_method" title="EventMachine::Protocols::SmtpClient#escape_leading_dots (method)">escape_leading_dots</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>) }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='id identifier rubyid_escape_leading_dots'><a href="#escape_leading_dots-instance_method" title="EventMachine::Protocols::SmtpClient#escape_leading_dots (method)">escape_leading_dots</a></span>(<span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_header'>header</span>].<span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>

    <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>)
      <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>].<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='id identifier rubyid_escape_leading_dots'><a href="#escape_leading_dots-instance_method" title="EventMachine::Protocols::SmtpClient#escape_leading_dots (method)">escape_leading_dots</a></span>(<span class='id identifier rubyid_e'>e</span>)}
    <span class='kw'>else</span>
      <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='id identifier rubyid_escape_leading_dots'><a href="#escape_leading_dots-instance_method" title="EventMachine::Protocols::SmtpClient#escape_leading_dots (method)">escape_leading_dots</a></span>(<span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>].<span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n.\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_message_response'><a href="#receive_message_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_message_response (method)">receive_message_response</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_ehlo_over_tls_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_ehlo_over_tls_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L275-L278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='278'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_ehlo_over_tls_response'>receive_ehlo_over_tls_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_invoke_auth'><a href="#invoke_auth-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_auth (method)">invoke_auth</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_ehlo_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_ehlo_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L249-L253'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='249' data-end='253'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 249</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_ehlo_response'>receive_ehlo_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='ivar'>@server_caps</span> <span class='op'>=</span> <span class='ivar'>@msg</span>
  <span class='id identifier rubyid_invoke_starttls'><a href="#invoke_starttls-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_starttls (method)">invoke_starttls</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_line-instance_method">
  <h3 class='signature nodoc'>
    #<strong>receive_line</strong>(ln)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L200-L210'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='200' data-end='210'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 200</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_line'>receive_line</span> <span class='id identifier rubyid_ln'>ln</span>
  <span class='gvar'>$&gt;</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ln'>ln</span> <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_verbose'>verbose</span>]
  <span class='ivar'>@range</span> <span class='op'>=</span> <span class='id identifier rubyid_ln'>ln</span>[<span class='int'>0</span><span class='op'>...</span><span class='int'>1</span>].<span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_ln'>ln</span>[<span class='int'>0</span><span class='op'>...</span><span class='int'>3</span>].<span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@msg</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ln'>ln</span>[<span class='int'>4</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>]
  <span class='kw'>unless</span> <span class='id identifier rubyid_ln'>ln</span>[<span class='int'>3</span><span class='op'>...</span><span class='int'>4</span>] <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span>
    <span class='gvar'>$&gt;</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@responder</span> <span class='kw'>if</span> <span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_verbose'>verbose</span>]
    <span class='id identifier rubyid_send'><a href="#send-class_method" title="EventMachine::Protocols::SmtpClient.send (method)">send</a></span> <span class='ivar'>@responder</span>
    <span class='ivar'>@msg</span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_mail_from_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_mail_from_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L309-L312'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='309' data-end='312'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 309</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_mail_from_response'>receive_mail_from_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_invoke_rcpt_to'><a href="#invoke_rcpt_to-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_rcpt_to (method)">invoke_rcpt_to</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_message_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_message_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L381-L391'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='381' data-end='391'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 381</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_message_response'>receive_message_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>QUIT\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_close_connection_after_writing'>close_connection_after_writing</span>
  <span class='ivar'>@succeeded</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_elapsed_time'>elapsed_time</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_start_time'>start_time</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_responder'>responder</span> <span class='op'>=</span> <span class='ivar'>@responder</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='ivar'>@code</span>
  <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='ivar'>@msg</span>
  <span class='id identifier rubyid_set_deferred_status'>set_deferred_status</span> <span class='symbeg'>:</span><span class='id identifier rubyid_succeeded'>succeeded</span><span class='comma'>,</span> <span class='ivar'>@return_values</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_rcpt_to_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_rcpt_to_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L330-L333'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='330' data-end='333'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 330</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_rcpt_to_response'>receive_rcpt_to_response</span>
  <span class='ivar'>@rcpt_responses</span> <span class='op'>&lt;&lt;</span> [<span class='ivar'>@code</span><span class='comma'>,</span> <span class='ivar'>@msg</span><span class='comma'>,</span> <span class='ivar'>@range</span>]
  <span class='id identifier rubyid_invoke_rcpt_to'><a href="#invoke_rcpt_to-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_rcpt_to (method)">invoke_rcpt_to</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_signon-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_signon</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L244-L248'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='244' data-end='248'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_signon'>receive_signon</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_send_ehlo'><a href="#send_ehlo-instance_method" title="EventMachine::Protocols::SmtpClient#send_ehlo (method)">send_ehlo</a></span>
  <span class='ivar'>@responder</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_receive_ehlo_response'><a href="#receive_ehlo_response-instance_method" title="EventMachine::Protocols::SmtpClient#receive_ehlo_response (method)">receive_ehlo_response</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_starttls_response-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_starttls_response</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L265-L269'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='265' data-end='269'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 265</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_receive_starttls_response'>receive_starttls_response</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_invoke_error'><a href="#invoke_error-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_error (method)">invoke_error</a></span> <span class='kw'>unless</span> <span class='ivar'>@range</span> <span class='op'>==</span> <span class='int'>2</span>
  <span class='id identifier rubyid_start_tls'><a href="../../EventMachine.html#start_tls-class_method" title="EventMachine.start_tls (method)">start_tls</a></span>
  <span class='id identifier rubyid_invoke_ehlo_over_tls'><a href="#invoke_ehlo_over_tls-instance_method" title="EventMachine::Protocols::SmtpClient#invoke_ehlo_over_tls (method)">invoke_ehlo_over_tls</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_ehlo-instance_method">
  <h3 class='signature priv'>
    #<strong>send_ehlo</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L240-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='240' data-end='242'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 240</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_ehlo'>send_ehlo</span>
  <span class='id identifier rubyid_send_data'><a href="../../EventMachine.html#send_data-class_method" title="EventMachine.send_data (method)">send_data</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EHLO </span><span class='embexpr_beg'>#{</span><span class='ivar'>@args</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_domain'>domain</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unbind-instance_method">
  <h3 class='signature nodoc'>
    #<strong>unbind</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    <p>We can get here in a variety of ways, all of them being failures unless
the @succeeded flag is set. If a protocol success was recorded, then don&#39;t
set a deferred success because the caller will already have done it
(no need to wait until the connection closes to invoke the callbacks).</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L189-L197'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='189' data-end='197'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/em/protocols/smtpclient.rb', line 189</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unbind'>unbind</span>
  <span class='kw'>unless</span> <span class='ivar'>@succeeded</span>
    <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_elapsed_time'>elapsed_time</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_start_time'>start_time</span>
    <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_responder'>responder</span> <span class='op'>=</span> <span class='ivar'>@responder</span>
    <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='ivar'>@code</span>
    <span class='ivar'>@return_values</span>.<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='ivar'>@msg</span>
    <span class='id identifier rubyid_set_deferred_status'>set_deferred_status</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_failed'>failed</span><span class='comma'>,</span> <span class='ivar'>@return_values</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>