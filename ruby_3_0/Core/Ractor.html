<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Ractor &mdash; Core Ruby-3.0.6 pp216</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Ractor",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.0.6</a> &raquo; 
      <a href='.'>Core</a> &raquo; 
      <a href='_index.html#alpha_R'>Index (R)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Ractor&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Ractor</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Ractor/MovedObject.html" title="Ractor::MovedObject (class)"><code>MovedObject</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>ClosedError</code></a>,
        <a href="Ractor/Error.html" title="Ractor::Error (class)"><code>Error</code></a>,
        <a href="Ractor/IsolationError.html" title="Ractor::IsolationError (class)"><code>IsolationError</code></a>,
        <a href="Ractor/MovedError.html" title="Ractor::MovedError (class)"><code>MovedError</code></a>,
        <a href="Ractor/RemoteError.html" title="Ractor::RemoteError (class)"><code>RemoteError</code></a>,
        <a href="Ractor/UnsafeError.html" title="Ractor::UnsafeError (class)"><code>UnsafeError</code></a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L228'>ractor.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.c#L2085'>ractor.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>Ractor</code> is a Actor-model abstraction for Ruby that provides thread-safe parallel execution.</p>

<p><a href="#new-class_method" title="Ractor.new (method)">.new</a> can make new <code>Ractor</code> and it will run in parallel.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># The simplest ractor
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor!</span><span class='tstring_end'>&quot;</span></span>}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span> <span class='comment'># wait it to finish
</span><span class='comment'># here &quot;I am in Ractor!&quot; would be printed</span></code></pre>

<p>Ractors do not share usual objects, so the some kind of thread-safety concerns such as data-race, race-conditions are not available on multi-ractor programming.</p>

<p>To achieve this, ractors severely limit object sharing between different ractors. For example, unlike threads, ractors can’t access each other’s objects, nor any objects through variables of the outer scope.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor! a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a'>a</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
<span class='comment'># fails immediately with
</span><span class='comment'># ArgumentError (can not isolate a Proc because it accesses outer variables (a).)</span></code></pre>

<p>On CRuby (the default implementation), Global Virtual Machine Lock (GVL) is held per ractor, so ractors are performed in parallel without locking each other.</p>

<p>Instead of accessing the shared state, the objects should be passed to and from ractors via sending and receiving objects as messages.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_a_in_ractor'>a_in_ractor</span> <span class='op'>=</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> <span class='comment'># receive blocks till somebody will pass message
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor! a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a_in_ractor'>a_in_ractor</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_a'>a</span>)  <span class='comment'># pass it
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># here &quot;I am in Ractor! a=1&quot; would be printed</span></code></pre>

<p>There are two pairs of methods for sending/receiving messages:</p>
<ul><li>
<p><a href="#send-instance_method" title="Ractor#send (method)">#send</a> and <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a> for when the <em>sender</em> knows the receiver (push);</p>
</li><li>
<p><a href="#yield-class_method" title="Ractor.yield (method)">.yield</a> and <a href="#take-instance_method" title="Ractor#take (method)">#take</a> for when the <em>receiver</em> knows the sender (pull);</p>
</li></ul>

<p>In addition to that, an argument to <a href="#new-class_method" title="Ractor.new (method)">.new</a> would be passed to block and available there as if received by <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>, and the last block value would be sent outside of the ractor as if sent by <a href="#yield-class_method" title="Ractor.yield (method)">.yield</a>.</p>

<p>A little demonstration on a classic ping-pong:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server starts: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server sends: ping</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ping</span><span class='tstring_end'>&#39;</span></span>                       <span class='comment'># The server doesn&#39;t know the receiver and sends to whoever interested
</span>  <span class='id identifier rubyid_received'>received</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>                 <span class='comment'># The server doesn&#39;t know the sender and receives from whoever sent
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received'>received</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='id identifier rubyid_server'>server</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_srv'>srv</span><span class='op'>|</span>        <span class='comment'># The server is sent inside client, and available as srv
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Client starts: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_received'>received</span> <span class='op'>=</span> <span class='id identifier rubyid_srv'>srv</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>                       <span class='comment'># The Client takes a message specifically from the server
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Client received from </span><span class='tstring_end'>&quot;</span></span> \
       <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_srv'>srv</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received'>received</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Client sends to </span><span class='tstring_end'>&quot;</span></span> \
       <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_srv'>srv</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>: pong</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_srv'>srv</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pong</span><span class='tstring_end'>&#39;</span></span>                           <span class='comment'># The client sends a message specifically to the server
</span><span class='kw'>end</span>

[<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span>].<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>)               <span class='comment'># Wait till they both finish</span></code></pre>

<p>This will output:</p>

<pre class="code ruby"><code class="ruby">Server starts: #&lt;Ractor:#2 test.rb:1 running&gt;
Server sends: ping
Client starts: #&lt;Ractor:#3 test.rb:8 running&gt;
Client received from #&lt;Ractor:#2 rac.rb:1 blocking&gt;: ping
Client sends to #&lt;Ractor:#2 rac.rb:1 blocking&gt;: pong
Server received: pong</code></pre>

<p>It is said that <code>Ractor</code> receives messages via the <em>incoming port</em>, and sends them to the <em>outgoing port</em>. Either one can be disabled with <a href="#close_incoming-instance_method" title="Ractor#close_incoming (method)">#close_incoming</a> and <a href="#close_outgoing-instance_method" title="Ractor#close_outgoing (method)">#close_outgoing</a> respectively. If a ractor terminated, its ports will be closed automatically.</p>

<h3 id="label-Shareable+and+unshareable+objects">Shareable and unshareable objects</h3>

<p>When the object is sent to and from the ractor, it is important to understand whether the object is shareable or unshareable. Most of objects are unshareable objects.</p>

<p>Shareable objects are basically those which can be used by several threads without compromising thread-safety; e.g. immutable ones. <a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">.shareable?</a> allows to check this, and <a href="#make_shareable-class_method" title="Ractor.make_shareable (method)">.make_shareable</a> tries to make object shareable if it is not.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='int'>1</span>)            <span class='comment'>#=&gt; true -- numbers and other immutable basic values are
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>)        <span class='comment'>#=&gt; false, unless the string is frozen due to # freeze_string_literals: true
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>) <span class='comment'>#=&gt; true
</span>
<span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                 <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; false
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'><a href="#make_shareable-class_method" title="Ractor.make_shareable (method)">make_shareable</a></span>(<span class='id identifier rubyid_ary'>ary</span>)
<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                 <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>1</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; true</span></code></pre>

<p>When a shareable object is sent (via <a href="#send-instance_method" title="Ractor#send (method)">#send</a> or <a href="#yield-class_method" title="Ractor.yield (method)">.yield</a>), no additional processing happens, and it just becomes usable by both ractors. When an unshareable object is sent, it can be either <em>copied</em> or <em>moved</em>. The first is the default, and it makes the object’s full copy by deep cloning of non-shareable parts of its structure.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>]
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_data2'>data2</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In ractor: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>[<span class='int'>1</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_data'>data</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside  : </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>[<span class='int'>1</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will output:</p>

<pre class="code ruby"><code class="ruby">In ractor: 340, 360, 320
Outside  : 380, 400, 320</code></pre>

<p>(Note that object id of both array and non-frozen string inside array have changed inside the ractor, showing it is different objects. But the second array’s element, which is a shareable frozen string, has the same object_id.)</p>

<p>Deep cloning of the objects may be slow, and sometimes impossible. Alternatively, <code>move: true</code> may be used on sending. This will <em>move</em> the object to the receiving ractor, making it inaccessible for a sending ractor.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In ractor: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside: moved? </span><span class='embexpr_beg'>#{</span><span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/MovedObject.html" title="Ractor::MovedObject (class)">MovedObject</a></span> <span class='op'>===</span> <span class='id identifier rubyid_data'>data</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will output:</p>

<pre class="code ruby"><code class="ruby">In ractor: 100, 120
Outside: moved? true
test.rb:9:in `method_missing&#39;: can not send any methods to a moved object (Ractor::MovedError)</code></pre>

<p>Notice that even <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a> (and more basic methods like <code>__id__</code>) is inaccessible on a moved object.</p>

<p>Besides frozen objects, there are shareable objects. <a href="Class.html" title="Class (class)"><code>::Class</code></a> and <a href="Module.html" title="Module (class)"><code>::Module</code></a> objects are shareable so the Class/Module definitons are shared between ractors. <code>Ractor</code> objects are also shareable objects. All operations for the shareable mutable objects are thread-safe, so the thread-safety property will be kept. We can not define mutable shareable objects in Ruby, but C extensions can introduce them.</p>

<p>It is prohibited to access instance variables of mutable shareable objects (especially Modules and classes) from ractors other than main:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>C</span>
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tricky'>tricky</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>C</span>.<span class='id identifier rubyid_tricky'>tricky</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='const'>C</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cls'>cls</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I see </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cls'>cls</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I can&#39;t see </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_tricky'>tricky</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># I see C
</span><span class='comment'># can not access instance variables of classes/modules from non-main Ractors (RuntimeError)</span></code></pre>

<p>Ractors can access constants if they are shareable. The main <code>Ractor</code> is the only one that can access non-shareable constants.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>GOOD</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>good</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>
<span class='const'>BAD</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bad</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GOOD=</span><span class='embexpr_beg'>#{</span><span class='const'>GOOD</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAD=</span><span class='embexpr_beg'>#{</span><span class='const'>BAD</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># GOOD=good
</span><span class='comment'># can not access non-shareable objects in constant Object::BAD by non-main Ractor. (NameError)
</span>
<span class='comment'># Consider the same C class from above
</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I see </span><span class='embexpr_beg'>#{</span><span class='const'>C</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I can&#39;t see </span><span class='embexpr_beg'>#{</span><span class='const'>C</span>.<span class='id identifier rubyid_tricky'>tricky</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># I see C
</span><span class='comment'># can not access instance variables of classes/modules from non-main Ractors (RuntimeError)</span></code></pre>

<p>See also the description of <code># shareable_constant_value</code> pragma in <code>Comments syntax</code> explanation.</p>

<h3 id="label-Ractors+vs+threads">Ractors vs threads</h3>

<p>Each ractor creates its own thread. New threads can be created from inside ractor (and, on CRuby, sharing GVL with other threads of this ractor).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='const'><a href="Thread.html" title="Thread (class)">Thread</a></span>.<span class='id identifier rubyid_new'><a href="Thread.html#new-class_method" title="Thread.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thread in ractor: a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a'>a</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Here &quot;Thread in ractor: a=1&quot; will be printed</span></code></pre>

<h3 id="label-Note+on+code+examples">Note on code examples</h3>

<p>In examples below, sometimes we use the following method to wait till ractors that are not currently blocked will finish (or process till next blocking) method.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_wait'>wait</span>
  <span class='id identifier rubyid_sleep'>sleep</span>(<span class='float'>0.1</span>)
<span class='kw'>end</span></code></pre>

<p>It is **only for demonstration purposes** and shouldn’t be used in a real code. Most of the times, just <a href="#take-instance_method" title="Ractor#take (method)">#take</a> is used to wait till ractor will finish.</p>

<h3 id="label-Reference">Reference</h3>

<p>See <code> desgin doc</code> for more details.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#count-class_method" title=".count (class method)">.<strong>count</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns total count of Ractors currently running.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#current-class_method" title=".current (class method)">.<strong>current</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the currently executing <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#main-class_method" title=".main (class method)">.<strong>main</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>returns main ractor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#make_shareable-class_method" title="make_shareable (class method)">.<strong>make_shareable</strong>(obj, copy: false)  &#x21d2; shareable_obj </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Make <code>obj</code> shareable between ractors.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(*args, name: nil) {|*args| ... } &#x21d2; Ractor </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new <code>Ractor</code> with args and a block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#receive-class_method" title="receive (class method)">.<strong>receive</strong>  &#x21d2; msg </a>
      (also: .recv)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Receive an incoming message from the current Ractor’s incoming port’s queue, which was sent there by <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#receive_if-class_method" title="receive_if (class method)">.<strong>receive_if</strong> {|msg| ... } &#x21d2; msg </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Receive only a specific message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv-class_method" title=".recv (class method)">.<strong>recv</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#select-class_method" title="select (class method)">.<strong>select</strong>(*ractors, [yield_value:, move: false])  &#x21d2; Ractor, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits for the first ractor to have something in its outgoing port, reads from this ractor, and returns that ractor and the object received.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shareable%3F-class_method" title="shareable? (class method)">.<strong>shareable?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the object is shareable by ractors.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#yield-class_method" title="yield (class method)">.<strong>yield</strong>(msg, move: false)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Send a message to the current ractor’s outgoing port to be consumed by <a href="#take-instance_method" title="Ractor#take (method)">#take</a>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#<<-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>(obj, move: false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(sym)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>get a value from ractor-local storage.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(sym, val)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>set a value in ractor-local storage.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close_incoming-instance_method" title="#close_incoming (instance method)">#<strong>close_incoming</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes the incoming port and returns its previous state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close_outgoing-instance_method" title="#close_outgoing (instance method)">#<strong>close_outgoing</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes the outgoing port and returns its previous state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
      (also: #to_s)
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The name set in <a href="#new-class_method" title="Ractor.new (method)">.new</a>, or <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv-instance_method" title="#recv (instance method)">#<strong>recv</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#receive-instance_method" title="Ractor#receive (method)">#receive</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(msg, move: false)  &#x21d2; self </a>
      (also: #&lt;&lt;)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Send a message to a Ractor’s incoming queue to be consumed by <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#take-instance_method" title="#take (instance method)">#<strong>take</strong>  &#x21d2; msg </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Take a message from ractor’s outgoing port, which was put there by <a href="#yield-class_method" title="Ractor.yield (method)">.yield</a> or at ractor’s finalization.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive-instance_method" title="#receive (instance method)">#<strong>receive</strong>  </a>
      (also: #recv)
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>same as <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive_if-instance_method" title="#receive_if (instance method)">#<strong>receive_if</strong>(&amp;b)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(*args, name: nil) {|*args| ... } &#x21d2; <code>Ractor</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new <code>Ractor</code> with args and a block.</p>

<p>A block (Proc) will be isolated (can’t access to outer variables). <code>self</code> inside the block will refer to the current <code>Ractor</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hi, I am </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Prints &quot;Hi, I am #&lt;Ractor:#2 test.rb:1 running&gt;&quot;</span></code></pre>

<p><code>args</code> passed to the method would be propagated to block args by the same rules as objects passed through #send/Ractor.receive: if <code>args</code> are not shareable, they will be copied (via deep cloning, which might be inefficient).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>]
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passing: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span><span class='embexpr_end'>}</span><span class='tstring_content'> (#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_arg'>arg</span>) {<span class='op'>|</span><span class='id identifier rubyid_received_arg'>received_arg</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received_arg'>received_arg</span><span class='embexpr_end'>}</span><span class='tstring_content'> (#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received_arg'>received_arg</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Prints:
</span><span class='comment'>#   Passing: [1, 2, 3] (#280)
</span><span class='comment'>#   Received: [1, 2, 3] (#300)</span></code></pre>

<p>Ractor’s <a href="#name-instance_method" title="Ractor#name (method)">#name</a> can be set for debugging purposes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my ractor</span><span class='tstring_end'>&#39;</span></span>) {}
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_r'>r</span>
<span class='comment'>#=&gt; #&lt;Ractor:#3 my ractor test.rb:1 terminated&gt;</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L262-L268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='262' data-end='268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 262</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_new'>new</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span> <span class='comment'># TODO: builtin bug
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>must be called with a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_loc'>loc</span> <span class='op'>=</span> <span class='id identifier rubyid_caller_locations'>caller_locations</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_loc'>loc</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span>.<span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span>.<span class='id identifier rubyid_lineno'>lineno</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid___builtin_ractor_create'>__builtin_ractor_create</span>(<span class='id identifier rubyid_loc'>loc</span><span class='comma'>,</span> <span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="count-class_method">
  <h3 class='signature  first'>
    .<strong>count</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns total count of Ractors currently running.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 1
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example</span><span class='tstring_end'>&#39;</span></span>) { <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span>(<span class='int'>1</span>) }
<span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 2 (main + example ractor)
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>                         <span class='comment'># wait for Ractor.yield(1)
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>                         <span class='comment'># wait till r will finish
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 1</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L287-L291'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='287' data-end='291'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ULONG2NUM(GET_VM()-&gt;ractor.cnt);
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="current-class_method">
  <h3 class='signature '>
    .<strong>current</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the currently executing <code>Ractor</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_current'>current</span> <span class='comment'>#=&gt; #&lt;Ractor:#1 running&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L273-L277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='273' data-end='277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 273</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_current'>current</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_ractor_self(rb_ec_ractor_ptr(ec));
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="main-class_method">
  <h3 class='signature '>
    .<strong>main</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>returns main ractor</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L833-L837'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='833' data-end='837'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 833</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_main'>main</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_ractor_self(GET_VM()-&gt;ractor.main_ractor);
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="make_shareable-class_method">
  <h3 class='signature '>
    .<strong>make_shareable</strong>(obj, copy: false)  &#x21d2; <code>shareable_obj</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Make <code>obj</code> shareable between ractors.</p>

<p><code>obj</code> and all the objects it refers to will be frozen, unless they are already shareable.</p>

<p>If <code>copy</code> keyword is <code>true</code>, the method will copy objects before freezing them This is safer option but it can take be slower.</p>

<p>Note that the specification and implementation of this method are not mature and may be changed in the future.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='id identifier rubyid_obj'>obj</span>)     <span class='comment'>#=&gt; false
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='comment'>#=&gt; [&quot;test&quot;]
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='id identifier rubyid_obj'>obj</span>)     <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj'>obj</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>             <span class='comment'>#=&gt; true
</span>
<span class='comment'># Copy vs non-copy versions:
</span><span class='id identifier rubyid_obj1'>obj1</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_obj1s'>obj1s</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj1'>obj1</span>)
<span class='id identifier rubyid_obj1'>obj1</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                        <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj1s'>obj1s</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj1'>obj1</span>.<span class='id identifier rubyid_object_id'>object_id</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj2'>obj2</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_obj2s'>obj2s</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj2'>obj2</span><span class='comma'>,</span> <span class='label'>copy:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_obj2'>obj2</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                        <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_obj2s'>obj2s</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                       <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj2s'>obj2s</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj2'>obj2</span>.<span class='id identifier rubyid_object_id'>object_id</span>   <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_obj2s'>obj2s</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj2'>obj2</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span> <span class='comment'>#=&gt; false</span></code></pre>

<p>See also the “Shareable and unshareable objects” section in the <code>Ractor</code> class docs.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L810-L820'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='810' data-end='820'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 810</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='label'>copy:</span> <span class='kw'>false</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_copy'>copy</span>
    <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
      rb_ractor_make_shareable_copy(obj);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
      rb_ractor_make_shareable(obj);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive-class_method">
  <h3 class='signature '>
    .<strong>receive</strong>  &#x21d2; <code>msg</code>     <span class='aliases'>Also known as: <span class='names'>.recv</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Receive an incoming message from the current Ractor’s incoming port’s queue, which was sent there by <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_v1'>v1</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v1'>v1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message1</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Here will be printed: &quot;Received: message1&quot;</span></code></pre>

<p>Alternatively, private instance method <code>receive</code> may be used:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_v1'>v1</span> <span class='op'>=</span> <span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v1'>v1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message1</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Here will be printed: &quot;Received: message1&quot;</span></code></pre>

<p>The method blocks if the queue is empty.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Before first receive</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_v1'>v1</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v1'>v1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_v2'>v2</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v2'>v2</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_wait'>wait</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Still not received</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message1</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_wait'>wait</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Still received only one</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message2</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby">Before first receive
Still not received
Received: message1
Still received only one
Received: message2</code></pre>

<p>If close_incoming was called on the ractor, the method raises <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a> if there are no more messages in incoming queue:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_close_incoming'><a href="#close_incoming-instance_method" title="Ractor#close_incoming (method)">close_incoming</a></span>
  <span class='id identifier rubyid_receive'>receive</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_wait'>wait</span>
<span class='comment'># in `receive&#39;: The incoming port is already closed =&gt; #&lt;Ractor:#2 test.rb:1 running&gt; (Ractor::ClosedError)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L415-L419'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='415' data-end='419'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 415</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_receive(ec, rb_ec_ractor_ptr(ec))
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_if-class_method">
  <h3 class='signature '>
    .<strong>receive_if</strong> {|msg| ... } &#x21d2; <code>msg</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Receive only a specific message.</p>

<p>Instead of <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>, <code>receive_if</code> can provide a pattern by a block and you can choose the receiving message.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_p'>p</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive_if'>receive_if</span>{<span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='id identifier rubyid_msg'>msg</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>foo</span><span class='regexp_end'>/</span></span>)} <span class='comment'>#=&gt; &quot;foo3&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive_if'>receive_if</span>{<span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='id identifier rubyid_msg'>msg</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>bar</span><span class='regexp_end'>/</span></span>)} <span class='comment'>#=&gt; &quot;bar1&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive_if'>receive_if</span>{<span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='id identifier rubyid_msg'>msg</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>baz</span><span class='regexp_end'>/</span></span>)} <span class='comment'>#=&gt; &quot;baz2&quot;
</span><span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar1</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz2</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo3</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span></code></pre>

<p>This will output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_foo3'>foo3</span>
<span class='id identifier rubyid_bar1'>bar1</span>
<span class='id identifier rubyid_baz2'>baz2</span></code></pre>

<p>If the block returns a truthy value, the message will be removed from the incoming queue and returned. Otherwise, the messsage remains in the incoming queue and the following received messages are checked by the given block.</p>

<p>If there are no messages left in the incoming queue, the method will block until new messages arrive.</p>

<p>If the block is escaped by break/return/exception/throw, the message is removed from the incoming queue as if a truthy value had been returned.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive_if'>receive_if</span>{<span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='id identifier rubyid_msg'>msg</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Array.html" title="Array (class)">Array</a></span>)}
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received successfully: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='int'>1</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_wait'>wait</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2 non-matching sent, nothing received</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>([<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>])
<span class='id identifier rubyid_wait'>wait</span></code></pre>

<p>Prints:</p>

<pre class="code ruby"><code class="ruby">2 non-matching sent, nothing received
Received successfully: [1, 2, 3]</code></pre>

<p>Note that you can not call receive/receive_if in the given block recursively. It means that you should not do any tasks in the block.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span> <span class='op'>&lt;&lt;</span> <span class='kw'>true</span>
<span class='const'>Ractor</span>.<span class='id identifier rubyid_receive_if'>receive_if</span>{<span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>}
<span class='comment'>#=&gt; `receive&#39;: can not call receive/receive_if recursively (Ractor::Error)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L493-L495'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='493' data-end='495'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 493</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_receive_if'>receive_if</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_receive_if'>ractor_receive_if</span> <span class='id identifier rubyid_b'>b</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv-class_method">
  <h3 class='signature '>
    .<strong>recv</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L422-L422'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='422' data-end='422'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 422</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_recv'>recv</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select-class_method">
  <h3 class='signature '>
    .<strong>select</strong>(*ractors, [yield_value:, move: false])  &#x21d2; <code>Ractor</code>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits for the first ractor to have something in its outgoing port, reads from this ractor, and returns that ractor and the object received.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r1'>r1</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>from 1</span><span class='tstring_end'>&#39;</span></span>}
<span class='id identifier rubyid_r2'>r2</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>from 2</span><span class='tstring_end'>&#39;</span></span>}

<span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_select'>select</span>(<span class='id identifier rubyid_r1'>r1</span><span class='comma'>,</span> <span class='id identifier rubyid_r2'>r2</span>)

<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>received </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># Prints: received &quot;from 1&quot; from #&lt;Ractor:#2 test.rb:1 running&gt;</span></code></pre>

<p>If one of the given ractors is the current ractor, and it would be selected, <code>r</code> will contain <code>:receive</code> symbol instead of the ractor object.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r1'>r1</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_main'><a href="#main-class_method" title="Ractor.main (method)">main</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_main'><a href="#main-class_method" title="Ractor.main (method)">main</a></span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>to main</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>from 1</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r2'>r2</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>from 2</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_select'>select</span>(<span class='id identifier rubyid_r1'>r1</span><span class='comma'>,</span> <span class='id identifier rubyid_r2'>r2</span><span class='comma'>,</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>received </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># Prints: received &quot;to main&quot; from :receive</span></code></pre>

<p>If <code>yield_value</code> is provided, that value may be yielded if another <code>Ractor</code> is calling <a href="#take-instance_method" title="Ractor#take (method)">#take</a>. In this case, the pair <code>[:yield, nil]</code> would be returned:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r1'>r1</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_main'><a href="#main-class_method" title="Ractor.main (method)">main</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received from main: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_main'><a href="#main-class_method" title="Ractor.main (method)">main</a></span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to select</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_select'>select</span>(<span class='id identifier rubyid_r1'>r1</span><span class='comma'>,</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span><span class='comma'>,</span> <span class='label'>yield_value:</span> <span class='int'>123</span>)
<span class='id identifier rubyid_wait'>wait</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will print:</p>

<pre class="code ruby"><code class="ruby">Trying to select
Received from main: 123
Received nil from :yield</code></pre>

<p><code>move</code> boolean flag defines whether yielded value should be copied (default) or moved.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L342-L353'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='342' data-end='353'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 342</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>*</span><span class='id identifier rubyid_ractors'>ractors</span><span class='comma'>,</span> <span class='label'>yield_value:</span> <span class='id identifier rubyid_yield_unspecified'>yield_unspecified</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>specify at least one ractor or `yield_value`</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_yield_unspecified'>yield_unspecified</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ractors'>ractors</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid___builtin_cstmt!'>__builtin_cstmt!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    const VALUE *rs = RARRAY_CONST_PTR_TRANSIENT(ractors);
    VALUE rv;
    VALUE v = ractor_select(ec, rs, RARRAY_LENINT(ractors),
                            yield_unspecified == Qtrue ? Qundef : yield_value,
                            (bool)RTEST(move) ? true : false, &amp;rv);
    return rb_ary_new_from_args(2, rv, v);
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shareable?-class_method">
  <h3 class='signature '>
    .<strong>shareable?</strong>(obj)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the object is shareable by ractors.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='int'>1</span>)            <span class='comment'>#=&gt; true -- numbers and other immutable basic values are frozen
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>)        <span class='comment'>#=&gt; false, unless the string is frozen due to # freeze_string_literals: true
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>) <span class='comment'>#=&gt; true</span></code></pre>

<p>See also the “Shareable and unshareable objects” section in the <code>Ractor</code> class docs.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L769-L773'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='769' data-end='773'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 769</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_shareable?'>shareable?</span> <span class='id identifier rubyid_obj'>obj</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_ractor_shareable_p(obj) ? Qtrue : Qfalse;
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="yield-class_method">
  <h3 class='signature '>
    .<strong>yield</strong>(msg, move: false)  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Send a message to the current ractor’s outgoing port to be consumed by <a href="#take-instance_method" title="Ractor#take (method)">#take</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'>yield</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello from ractor</span><span class='tstring_end'>&#39;</span></span>}
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Prints: &quot;Hello from ractor&quot;</span></code></pre>

<p>The method is blocking, and will return only when somebody consumes the sent message.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'>yield</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello from ractor</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ractor: after yield</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_wait'>wait</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Still not taken</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span></code></pre>

<p>This will print:</p>

<pre class="code ruby"><code class="ruby">Still not taken
Hello from ractor
Ractor: after yield</code></pre>

<p>If the outgoing port was closed with <a href="#close_outgoing-instance_method" title="Ractor#close_outgoing (method)">#close_outgoing</a>, the method will raise:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_close_outgoing'><a href="#close_outgoing-instance_method" title="Ractor#close_outgoing (method)">close_outgoing</a></span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'>yield</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello from ractor</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_wait'>wait</span>
<span class='comment'># `yield&#39;: The outgoing-port is already closed (Ractor::ClosedError)</span></code></pre>

<p>The meaning of <code>move</code> argument is the same as for <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L626-L630'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='626' data-end='630'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 626</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='kw'>yield</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_yield(ec, rb_ec_ractor_ptr(ec), obj, move)
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="<<-instance_method">
  <h3 class='signature  first'>
    #<strong>&lt;&lt;</strong>(obj, move: false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L587-L587'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='587' data-end='587'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 587</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]-instance_method">
  <h3 class='signature '>
    #<strong>[]</strong>(sym)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>get a value from ractor-local storage</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L823-L825'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='823' data-end='825'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 823</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span>(<span class='id identifier rubyid_sym'>sym</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value'>ractor_local_value</span>(<span class='id identifier rubyid_sym'>sym</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(sym, val)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>set a value in ractor-local storage</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L828-L830'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='828' data-end='830'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 828</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]=</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value_set'>ractor_local_value_set</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_incoming-instance_method">
  <h3 class='signature '>
    #<strong>close_incoming</strong>  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Closes the incoming port and returns its previous state. All further attempts to <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a> in the ractor, and <a href="#send-instance_method" title="Ractor#send (method)">#send</a> to the ractor will fail with <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>500</span>)}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_incoming'>close_incoming</span>  <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_incoming'>close_incoming</span>  <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># Ractor::ClosedError (The incoming-port is already closed)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L733-L737'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='733' data-end='737'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 733</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close_incoming'>close_incoming</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_close_incoming(ec, RACTOR_PTR(self));
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_outgoing-instance_method">
  <h3 class='signature '>
    #<strong>close_outgoing</strong>  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Closes the outgoing port and returns its previous state. All further attempts to <a href="#yield-class_method" title="Ractor.yield (method)">.yield</a> in the ractor, and <a href="#take-instance_method" title="Ractor#take (method)">#take</a> from the ractor will fail with <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>500</span>)}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_outgoing'>close_outgoing</span>  <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_outgoing'>close_outgoing</span>  <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='comment'># Ractor::ClosedError (The outgoing-port is already closed)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L752-L756'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='752' data-end='756'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 752</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close_outgoing'>close_outgoing</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_close_outgoing(ec, RACTOR_PTR(self));
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
    <span class='aliases'>Also known as: <span class='names'>#to_s</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L699-L707'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='699' data-end='707'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 699</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_loc'>loc</span>  <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> RACTOR_PTR(self)-&gt;loc </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> RACTOR_PTR(self)-&gt;name </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_id'>id</span>   <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> INT2FIX(rb_ractor_id(RACTOR_PTR(self))) </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_str_new2(ractor_status_str(RACTOR_PTR(self)-&gt;status_))
  </span><span class='tstring_end'>}</span></span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Ractor:#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='op'>+</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_loc'>loc</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name-instance_method">
  <h3 class='signature '>
    #<strong>name</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The name set in <a href="#new-class_method" title="Ractor.new (method)">.new</a>, or <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L712-L714'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='712' data-end='714'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 712</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>RACTOR_PTR(self)-&gt;name</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive-instance_method">
  <h3 class='signature priv'>
    #<strong>receive</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#recv</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>same as <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L426-L430'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='426' data-end='430'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 426</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_receive(ec, rb_ec_ractor_ptr(ec))
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive_if-instance_method">
  <h3 class='signature priv'>
    #<strong>receive_if</strong>(&amp;b)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L497-L499'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='497' data-end='499'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 497</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_receive_if'>receive_if</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_receive_if'>ractor_receive_if</span> <span class='id identifier rubyid_b'>b</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv-instance_method">
  <h3 class='signature '>
    #<strong>recv</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#receive-instance_method" title="Ractor#receive (method)">#receive</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L431-L431'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='431' data-end='431'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 431</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_recv'>recv</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send-instance_method">
  <h3 class='signature '>
    #<strong>send</strong>(msg, move: false)  &#x21d2; <code>self</code>     <span class='aliases'>Also known as: <span class='names'>#&lt;&lt;</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Send a message to a Ractor’s incoming queue to be consumed by <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message</span><span class='tstring_end'>&#39;</span></span>
<span class='comment'># Prints: &quot;Received: message&quot;</span></code></pre>

<p>The method is non-blocking (will return immediately even if the ractor is not ready to receive anything):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>5</span>)}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sent successfully</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># Prints: &quot;Sent successfully&quot; immediately</span></code></pre>

<p>Attempt to send to ractor which already finished its execution will raise <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_r'>r</span>
<span class='comment'># &quot;#&lt;Ractor:#6 (irb):23 terminated&gt;&quot;
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># Ractor::ClosedError (The incoming-port is already closed)</span></code></pre>

<p>If close_incoming was called on the ractor, the method also raises <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span>  <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>500</span>)
  <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_incoming'><a href="#close_incoming-instance_method" title="Ractor#close_incoming (method)">close_incoming</a></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># Ractor::ClosedError (The incoming-port is already closed)
</span><span class='comment'># The error would be raised immediately, not when ractor will try to receive</span></code></pre>

<p>If the <code>obj</code> is unshareable, by default it would be copied into ractor by deep cloning. If the <code>move: true</code> is passed, object is <em>moved</em> into ractor and becomes inaccessible to sender.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
<span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'><a href="#take-instance_method" title="Ractor#take (method)">take</a></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_msg'>msg</span></code></pre>

<p>This prints:</p>

<pre class="code ruby"><code class="ruby">Received: message
in `p&#39;: undefined method `inspect&#39; for #&lt;Ractor::MovedObject:0x000055c99b9b69b8&gt;</code></pre>

<p>All references to the object and its parts will become invalid in sender.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> [<span class='id identifier rubyid_s'>s</span>]
<span class='id identifier rubyid_copy'>copy</span> <span class='op'>=</span> <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_dup'>dup</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_ary'>ary</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>true</span>)

<span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span>
<span class='comment'># Ractor::MovedError (can not send any methods to a moved object)
</span><span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_class'>class</span>
<span class='comment'># Ractor::MovedError (can not send any methods to a moved object)
</span><span class='id identifier rubyid_copy'>copy</span>.<span class='id identifier rubyid_class'>class</span>
<span class='comment'># =&gt; Array, it is different object
</span><span class='id identifier rubyid_copy'>copy</span>[<span class='int'>0</span>].<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span>
<span class='comment'># Ractor::MovedError (can not send any methods to a moved object)
</span><span class='comment'># ...but its item was still a reference to `s`, which was moved</span></code></pre>

<p>If the object was shareable, <code>move: true</code> has no effect on it:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span> <span class='comment'>#=&gt; &quot;message&quot;, still available</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L582-L586'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='582' data-end='586'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 582</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_send(ec, RACTOR_PTR(self), obj, move)
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="take-instance_method">
  <h3 class='signature '>
    #<strong>take</strong>  &#x21d2; <code>msg</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Take a message from ractor’s outgoing port, which was put there by <a href="#yield-class_method" title="Ractor.yield (method)">.yield</a> or at ractor’s finalization.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>explicit yield</span><span class='tstring_end'>&#39;</span></span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>last value</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span> <span class='comment'>#=&gt; &#39;explicit yield&#39;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span> <span class='comment'>#=&gt; &#39;last value&#39;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span> <span class='comment'># Ractor::ClosedError (The outgoing-port is already closed)</span></code></pre>

<p>The fact that the last value is also put to outgoing port means that <code>take</code> can be used as some analog of <a href="Thread.html#join-instance_method" title="Thread#join (method)">Thread#join</a> (“just wait till ractor finishes”), but don’t forget it will raise if somebody had already consumed everything ractor have produced.</p>

<p>If the outgoing port was closed with <a href="#close_outgoing-instance_method" title="Ractor#close_outgoing (method)">#close_outgoing</a>, the method will raise <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>500</span>)
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello from ractor</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_close_outgoing'><a href="#close_outgoing-instance_method" title="Ractor#close_outgoing (method)">close_outgoing</a></span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span>
<span class='comment'># Ractor::ClosedError (The outgoing-port is already closed)
</span><span class='comment'># The error would be raised immediately, not when ractor will try to receive</span></code></pre>

<p>If an uncaught exception is raised in the <code>Ractor</code>, it is propagated on take as a <a href="Ractor/RemoteError.html" title="Ractor::RemoteError (class)"><code>::Ractor::RemoteError</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Something weird happened</span><span class='tstring_end'>&quot;</span></span>}

<span class='kw'>begin</span>
  <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span>              <span class='comment'>#  =&gt; #&lt;Ractor::RemoteError: thrown by remote Ractor.&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_ractor'>ractor</span> <span class='op'>==</span> <span class='id identifier rubyid_r'>r</span>  <span class='comment'># =&gt; true
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_cause'>cause</span>        <span class='comment'># =&gt; #&lt;RuntimeError: Something weird happened&gt;
</span><span class='kw'>end</span></code></pre>

<p><a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>::Ractor::ClosedError</code></a> is a descendant of <a href="StopIteration.html" title="StopIteration (class)"><code>::StopIteration</code></a>, so the closing of the ractor will break the loops without propagating the error:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='int'>3</span>.<span class='id identifier rubyid_times'>times</span> {<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_yield'><a href="#yield-class_method" title="Ractor.yield (method)">yield</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>finishing</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_loop'>loop</span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_take'>take</span>}
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Continue successfully</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will print:</p>

<pre class="code ruby"><code class="ruby">Received: message 0
Received: message 1
Received: message 2
Received: finishing
Continue successfully</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L693-L697'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='693' data-end='697'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 693</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_take'>take</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_take(ec, RACTOR_PTR(self))
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ractor.rb#L709-L709'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='709' data-end='709'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 709</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_to_s'>to_s</span> <span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>