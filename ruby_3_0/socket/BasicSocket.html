<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: BasicSocket &mdash; socket</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "BasicSocket",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.0.6</a> &raquo; 
      <a href='.'>socket</a> &raquo; 
      <a href='_index.html#alpha_B'>Index (B)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>BasicSocket&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: BasicSocket</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="IPSocket.html" title="IPSocket (class)">IPSocket</a>, <a href="SOCKSSocket.html" title="SOCKSSocket (class)">SOCKSSocket</a>, <a href="Socket.html" title="Socket (class)">Socket</a>, <a href="TCPServer.html" title="TCPServer (class)">TCPServer</a>, <a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a>, <a href="UDPSocket.html" title="UDPSocket (class)">UDPSocket</a>, <a href="UNIXServer.html" title="UNIXServer (class)">UNIXServer</a>, <a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="IO.html" title="IO (class)"><code>::IO</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="IO.html" title="IO (class)"><code>::IO</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="IO.html" title="IO (class)">IO</a></span>
        <ul class='fullTree'>
          <li><a href="Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="IO.html" title="IO (class)">IO</a></li>
          <li class='next'>BasicSocket</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L711'>ext/socket/basicsocket.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/ancdata.c#L1306'>ext/socket/ancdata.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/init.c#L322'>ext/socket/init.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L231'>ext/socket/lib/socket.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>BasicSocket</code> is the super class for all the <a href="Socket.html" title="Socket (class)"><code>::Socket</code></a> classes.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#do_not_reverse_lookup-class_method" title="do_not_reverse_lookup (class method)">.<strong>do_not_reverse_lookup</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets the global do_not_reverse_lookup flag.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#do_not_reverse_lookup=-class_method" title="do_not_reverse_lookup= (class method)">.<strong>do_not_reverse_lookup=</strong>(bool)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the global do_not_reverse_lookup flag.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#for_fd-class_method" title="for_fd (class method)">.<strong>for_fd</strong>(fd)  &#x21d2; BasicSocket </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a socket object which contains the file descriptor, <em>fd</em>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#do_not_reverse_lookup-instance_method" title="#do_not_reverse_lookup (instance method)">#<strong>do_not_reverse_lookup</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#do_not_reverse_lookup=-instance_method" title="#do_not_reverse_lookup= (instance method)">#<strong>do_not_reverse_lookup=</strong>(bool)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#close_read-instance_method" title="#close_read (instance method)">#<strong>close_read</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disallows further read using shutdown system call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close_write-instance_method" title="#close_write (instance method)">#<strong>close_write</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disallows further write using shutdown system call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#connect_address-instance_method" title="#connect_address (instance method)">#<strong>connect_address</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an address of the socket suitable for connect in the local machine.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#getpeereid-instance_method" title="#getpeereid (instance method)">#<strong>getpeereid</strong>  &#x21d2; Array, egid </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the user and group on the peer of the UNIX socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#getpeername-instance_method" title="#getpeername (instance method)">#<strong>getpeername</strong>  &#x21d2; sockaddr </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the remote address of the socket as a sockaddr string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#getsockname-instance_method" title="#getsockname (instance method)">#<strong>getsockname</strong>  &#x21d2; sockaddr </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the local address of the socket as a sockaddr string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#getsockopt-instance_method" title="#getsockopt (instance method)">#<strong>getsockopt</strong>(level, optname)  &#x21d2; socketoption </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets a socket option.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#local_address-instance_method" title="#local_address (instance method)">#<strong>local_address</strong>  &#x21d2; addrinfo </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an <a href="Addrinfo.html" title="Addrinfo (class)"><code>::Addrinfo</code></a> object for local address obtained by getsockname.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv-instance_method" title="#recv (instance method)">#<strong>recv</strong>(maxlen[, flags[, outbuf]])  &#x21d2; mesg </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Receives a message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv_nonblock-instance_method" title="#recv_nonblock (instance method)">#<strong>recv_nonblock</strong>(maxlen [, flags [, buf [, options ]]])  &#x21d2; mesg </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recvmsg-instance_method" title="#recvmsg (instance method)">#<strong>recvmsg</strong>(maxmesglen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; Array, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>recvmsg receives a message using recvmsg(2) system call in blocking manner.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recvmsg_nonblock-instance_method" title="#recvmsg_nonblock (instance method)">#<strong>recvmsg_nonblock</strong>(maxdatalen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; Array, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>recvmsg receives a message using recvmsg(2) system call in non-blocking manner.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#remote_address-instance_method" title="#remote_address (instance method)">#<strong>remote_address</strong>  &#x21d2; addrinfo </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an <a href="Addrinfo.html" title="Addrinfo (class)"><code>::Addrinfo</code></a> object for remote address obtained by getpeername.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(mesg, flags [, dest_sockaddr])  &#x21d2; numbytes_sent </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>send <em>mesg</em> via <em>basicsocket</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sendmsg-instance_method" title="#sendmsg (instance method)">#<strong>sendmsg</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls)  &#x21d2; numbytes_sent </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>sendmsg sends a message using sendmsg(2) system call in blocking manner.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sendmsg_nonblock-instance_method" title="#sendmsg_nonblock (instance method)">#<strong>sendmsg_nonblock</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls, opts = {})  &#x21d2; numbytes_sent </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>sendmsg_nonblock sends a message using sendmsg(2) system call in non-blocking manner.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#setsockopt-instance_method" title="#setsockopt (instance method)">#<strong>setsockopt</strong>(level, optname, optval)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets a socket option.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>([how])  &#x21d2; 0 </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Calls shutdown(2) system call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#__recvmsg-instance_method" title="#__recvmsg (instance method)">#<strong>__recvmsg</strong>(dlen, flags, clen, scm_rights)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#__recvmsg_nonblock-instance_method" title="#__recvmsg_nonblock (instance method)">#<strong>__recvmsg_nonblock</strong>(dlen, flags, clen, scm_rights, ex)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#__sendmsg-instance_method" title="#__sendmsg (instance method)">#<strong>__sendmsg</strong>(data, flags, dest_sockaddr, controls)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#__sendmsg_nonblock-instance_method" title="#__sendmsg_nonblock (instance method)">#<strong>__sendmsg_nonblock</strong>(data, flags, dest_sockaddr, controls, ex)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#read_nonblock-instance_method" title="#read_nonblock (instance method)">#<strong>read_nonblock</strong>(len, str = nil, exception: true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#write_nonblock-instance_method" title="#write_nonblock (instance method)">#<strong>write_nonblock</strong>(buf, exception: true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#__read_nonblock-instance_method" title="#__read_nonblock (instance method)">#<strong>__read_nonblock</strong>(length, buf, ex)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#__recv_nonblock-instance_method" title="#__recv_nonblock (instance method)">#<strong>__recv_nonblock</strong>(len, flg, str, ex)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#__write_nonblock-instance_method" title="#__write_nonblock (instance method)">#<strong>__write_nonblock</strong>(str, ex)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="do_not_reverse_lookup-class_method">
  <h3 class='signature rw first'>
    .<strong>do_not_reverse_lookup</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets the global do_not_reverse_lookup flag.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>BasicSocket</span>.<span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>  <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L674-L678'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='674' data-end='678'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 674</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_rev_lookup(VALUE _)
{
    return rsock_do_not_reverse_lookup?Qtrue:Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_not_reverse_lookup=-class_method">
  <h3 class='signature rw'>
    .<strong>do_not_reverse_lookup=</strong>(bool)   <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the global do_not_reverse_lookup flag.</p>

<p>The flag is used for initial value of do_not_reverse_lookup for each socket.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span>                 <span class='comment'>#=&gt; true
</span><span class='const'>BasicSocket</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span>                 <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span>                 <span class='comment'>#=&gt; true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L696-L701'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='696' data-end='701'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 696</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_rev_lookup_set(VALUE self, VALUE val)
{
    rsock_do_not_reverse_lookup = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="for_fd-class_method">
  <h3 class='signature  first'>
    .<strong>for_fd</strong>(fd)  &#x21d2; <code>BasicSocket</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a socket object which contains the file descriptor, <em>fd</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># If invoked by inetd, STDIN/STDOUT/STDERR is a socket.
</span><span class='const'>STDIN_SOCK</span> <span class='op'>=</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span>.<span class='id identifier rubyid_for_fd'>for_fd</span>(<span class='const'>STDIN</span>.<span class='id identifier rubyid_fileno'>fileno</span>)
<span class='id identifier rubyid_p'>p</span> <span class='const'>STDIN_SOCK</span>.<span class='id identifier rubyid_remote_address'><a href="#remote_address-instance_method" title="BasicSocket#remote_address (method)">remote_address</a></span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L24-L33'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='24' data-end='33'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 24</span></pre>
<pre class='code cpp'>

static VALUE
bsock_s_for_fd(VALUE klass, VALUE fd)
{
    rb_io_t *fptr;
    VALUE sock = rsock_init_sock(rb_obj_alloc(klass), NUM2INT(fd));

    GetOpenFile(sock, fptr);

    return sock;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="do_not_reverse_lookup-instance_method">
  <h3 class='signature rw first'>
    #<strong>do_not_reverse_lookup</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>BasicSocket</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>      <span class='comment'>#=&gt; false
</span>}
<span class='const'>BasicSocket</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>      <span class='comment'>#=&gt; true
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L594-L601'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='594' data-end='601'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 594</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_reverse_lookup(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    return (fptr-&gt;mode &amp; FMODE_NOREVLOOKUP) ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_not_reverse_lookup=-instance_method">
  <h3 class='signature rw'>
    #<strong>do_not_reverse_lookup=</strong>(bool)   <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span>       <span class='comment'>#=&gt; true
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_peeraddr'>peeraddr</span>                    <span class='comment'>#=&gt; [&quot;AF_INET&quot;, 80, &quot;221.186.184.68&quot;, &quot;221.186.184.68&quot;]
</span>  <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_peeraddr'>peeraddr</span>                    <span class='comment'>#=&gt; [&quot;AF_INET&quot;, 80, &quot;carbon.ruby-lang.org&quot;, &quot;54.163.249.195&quot;]
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L617-L630'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='617' data-end='630'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 617</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_reverse_lookup_set(VALUE sock, VALUE state)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (RTEST(state)) {
	fptr-&gt;mode |= FMODE_NOREVLOOKUP;
    }
    else {
	fptr-&gt;mode &amp;= ~FMODE_NOREVLOOKUP;
    }
    return sock;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="__read_nonblock-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>__read_nonblock</strong>(length, buf, ex)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/init.c#L322-L362'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='322' data-end='362'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/init.c', line 322</span></pre>
<pre class='code cpp'>

VALUE
rsock_read_nonblock(VALUE sock, VALUE length, VALUE buf, VALUE ex)
{
    rb_io_t *fptr;
    long n;
    long len = NUM2LONG(length);
    VALUE str = rsock_strbuf(buf, len);
    char *ptr;

    GetOpenFile(sock, fptr);

    if (len == 0) {
	rb_str_set_len(str, 0);
	return str;
    }

    ptr = RSTRING_PTR(str);
    n = read_buffered_data(ptr, len, fptr);
    if (n &lt;= 0) {
	n = (long)recv(fptr-&gt;fd, ptr, len, MSG_DONTWAIT);
	if (n &lt; 0) {
	    int e = errno;
	    if ((e == EWOULDBLOCK || e == EAGAIN)) {
		if (ex == Qfalse) return sym_wait_readable;
		rb_readwrite_syserr_fail(RB_IO_WAIT_READABLE,
					 e, &quot;read would block&quot;);
	    }
	    rb_syserr_fail_path(e, fptr-&gt;pathv);
	}
    }
    if (n != RSTRING_LEN(str)) {
	rb_str_modify(str);
	rb_str_set_len(str, n);
    }
    if (n == 0) {
	if (ex == Qfalse) return Qnil;
	rb_eof_error();
    }

    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__recv_nonblock-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>__recv_nonblock</strong>(len, flg, str, ex)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L660-L664'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='660' data-end='664'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 660</span></pre>
<pre class='code cpp'>

static VALUE
bsock_recv_nonblock(VALUE sock, VALUE len, VALUE flg, VALUE str, VALUE ex)
{
    return rsock_s_recvfrom_nonblock(sock, len, flg, str, ex, RECV_RECV);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__recvmsg-instance_method">
  <h3 class='signature priv'>
    #<strong>__recvmsg</strong>(dlen, flags, clen, scm_rights)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/ancdata.c#L1674-L1680'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1674' data-end='1680'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1674</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_recvmsg(VALUE sock, VALUE dlen, VALUE flags, VALUE clen,
		    VALUE scm_rights)
{
    VALUE ex = Qtrue;
    return bsock_recvmsg_internal(sock, dlen, flags, clen, scm_rights, ex, 0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__recvmsg_nonblock-instance_method">
  <h3 class='signature priv'>
    #<strong>__recvmsg_nonblock</strong>(dlen, flags, clen, scm_rights, ex)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/ancdata.c#L1684-L1689'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1684' data-end='1689'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1684</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_recvmsg_nonblock(VALUE sock, VALUE dlen, VALUE flags, VALUE clen,
			     VALUE scm_rights, VALUE ex)
{
    return bsock_recvmsg_internal(sock, dlen, flags, clen, scm_rights, ex, 1);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__sendmsg-instance_method">
  <h3 class='signature priv'>
    #<strong>__sendmsg</strong>(data, flags, dest_sockaddr, controls)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/ancdata.c#L1306-L1312'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1306' data-end='1312'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1306</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_sendmsg(VALUE sock, VALUE data, VALUE flags, VALUE dest_sockaddr,
		    VALUE controls)
{
    return bsock_sendmsg_internal(sock, data, flags, dest_sockaddr, controls,
				  Qtrue, 0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__sendmsg_nonblock-instance_method">
  <h3 class='signature priv'>
    #<strong>__sendmsg_nonblock</strong>(data, flags, dest_sockaddr, controls, ex)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/ancdata.c#L1316-L1322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1316' data-end='1322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1316</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_sendmsg_nonblock(VALUE sock, VALUE data, VALUE flags,
			     VALUE dest_sockaddr, VALUE controls, VALUE ex)
{
    return bsock_sendmsg_internal(sock, data, flags, dest_sockaddr,
				  controls, ex, 1);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__write_nonblock-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>__write_nonblock</strong>(str, ex)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/init.c#L365-L408'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='365' data-end='408'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/init.c', line 365</span></pre>
<pre class='code cpp'>

VALUE
rsock_write_nonblock(VALUE sock, VALUE str, VALUE ex)
{
    rb_io_t *fptr;
    long n;

    if (!RB_TYPE_P(str, T_STRING))
	str = rb_obj_as_string(str);

    sock = rb_io_get_write_io(sock);
    GetOpenFile(sock, fptr);
    rb_io_check_writable(fptr);

    /*
     * As with IO#write_nonblock, we may block if somebody is relying on
     * buffered I/O; but nobody actually hits this because pipes and sockets
     * are not userspace-buffered in Ruby by default.
     */
    if (fptr-&gt;wbuf.len &gt; 0) {
	rb_io_flush(sock);
    }

#ifdef __APPLE__
  again:
#endif
    n = (long)send(fptr-&gt;fd, RSTRING_PTR(str), RSTRING_LEN(str), MSG_DONTWAIT);
    if (n &lt; 0) {
	int e = errno;

#ifdef __APPLE__
	if (e == EPROTOTYPE) {
	    goto again;
	}
#endif
	if (e == EWOULDBLOCK || e == EAGAIN) {
	    if (ex == Qfalse) return sym_wait_writable;
	    rb_readwrite_syserr_fail(RB_IO_WAIT_WRITABLE, e,
				    &quot;write would block&quot;);
	}
	rb_syserr_fail_path(e, fptr-&gt;pathv);
    }

    return LONG2FIX(n);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_read-instance_method">
  <h3 class='signature '>
    #<strong>close_read</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disallows further read using shutdown system call.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span>.<span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span>
<span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_close_read'>close_read</span>
<span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='comment'>#=&gt; Broken pipe (Errno::EPIPE)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L95-L108'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='95' data-end='108'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 95</span></pre>
<pre class='code cpp'>

static VALUE
bsock_close_read(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    shutdown(fptr-&gt;fd, 0);
    if (!(fptr-&gt;mode &amp; FMODE_WRITABLE)) {
	return rb_io_close(sock);
    }
    fptr-&gt;mode &amp;= ~FMODE_READABLE;

    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_write-instance_method">
  <h3 class='signature '>
    #<strong>close_write</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disallows further write using shutdown system call.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span>.<span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span> {<span class='op'>|</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='op'>|</span>
  <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ping</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_close_write'>close_write</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_read'>read</span>        <span class='comment'>#=&gt; &quot;ping&quot;
</span>  <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pong</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_read'>read</span>        <span class='comment'>#=&gt; &quot;pong&quot;
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L125-L138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='125' data-end='138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 125</span></pre>
<pre class='code cpp'>

static VALUE
bsock_close_write(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (!(fptr-&gt;mode &amp; FMODE_READABLE)) {
	return rb_io_close(sock);
    }
    shutdown(fptr-&gt;fd, 1);
    fptr-&gt;mode &amp;= ~FMODE_WRITABLE;

    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connect_address-instance_method">
  <h3 class='signature '>
    #<strong>connect_address</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an address of the socket suitable for connect in the local machine.</p>

<p>This method returns <em>self</em>.local_address, except following condition.</p>
<ul><li>
<p>IPv4 unspecified address (0.0.0.0) is replaced by IPv4 loopback address (127.0.0.1).</p>
</li><li>
<p>IPv6 unspecified address (::) is replaced by IPv6 loopback address (::1).</p>
</li></ul>

<p>If the local address is not suitable for connect, <a href="SocketError.html" title="SocketError (class)"><code>::SocketError</code></a> is raised. IPv4 and IPv6 address which port is 0 is not suitable for connect. Unix domain socket which has no path is not suitable for connect.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span>.<span class='id identifier rubyid_tcp'><a href="Addrinfo.html#tcp-class_method" title="Addrinfo.tcp (method)">tcp</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_listen'><a href="Addrinfo.html#listen-instance_method" title="Addrinfo#listen (method)">listen</a></span> {<span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_connect_address'>connect_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:53660 TCP&gt;
</span>  <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_connect_address'>connect_address</span>.<span class='id identifier rubyid_connect'>connect</span> {<span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_accept'>accept</span>
    <span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span>] <span class='comment'>#=&gt; [#&lt;Socket:fd 4&gt;, #&lt;Socket:fd 6&gt;]
</span>  }
}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L251-L272'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='251' data-end='272'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 251</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_address'>connect_address</span>
  <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_local_address'><a href="#local_address-instance_method" title="BasicSocket#local_address (method)">local_address</a></span>
  <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>=</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_afamily'>afamily</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_INET-constant" title="Socket::AF_INET (constant)">AF_INET</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound IPv4 socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span>.<span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_protocol'>protocol</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='kw'>defined?</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_INET6-constant" title="Socket::AF_INET6 (constant)">AF_INET6</a></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_INET6-constant" title="Socket::AF_INET6 (constant)">AF_INET6</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound IPv6 socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span>.<span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_protocol'>protocol</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># MacOS X 10.4 returns &quot;a.b.c.d&quot; for IPv4-mapped IPv6 address.
</span>      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span>.<span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_protocol'>protocol</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::ffff:0.0.0.0</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># MacOS X 10.6 returns &quot;::ffff:a.b.c.d&quot; for IPv4-mapped IPv6 address.
</span>      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span>.<span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_protocol'>protocol</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='kw'>defined?</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_UNIX-constant" title="Socket::AF_UNIX (constant)">AF_UNIX</a></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_UNIX-constant" title="Socket::AF_UNIX (constant)">AF_UNIX</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound Unix socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>.<span class='id identifier rubyid_unix_path'>unix_path</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_addr'>addr</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getpeereid-instance_method">
  <h3 class='signature '>
    #<strong>getpeereid</strong>  &#x21d2; <code>Array</code>, <code>egid</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the user and group on the peer of the UNIX socket. The result is a two element array which contains the effective uid and the effective gid.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span>.<span class='id identifier rubyid_unix_server_loop'><a href="Socket.html#unix_server_loop-class_method" title="Socket.unix_server_loop (method)">unix_server_loop</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span>) {<span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_euid'>euid</span><span class='comma'>,</span> <span class='id identifier rubyid_egid'>egid</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_getpeereid'>getpeereid</span>

    <span class='comment'># Check the connected client is myself or not.
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_euid'>euid</span> <span class='op'>!=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_uid'>uid</span>

    <span class='comment'># do something about my resource.
</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L421-L451'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='421' data-end='451'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 421</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getpeereid(VALUE self)
{
#if defined(HAVE_GETPEEREID)
    rb_io_t *fptr;
    uid_t euid;
    gid_t egid;
    GetOpenFile(self, fptr);
    if (getpeereid(fptr-&gt;fd, &amp;euid, &amp;egid) == -1)
	rb_sys_fail(&quot;getpeereid(3)&quot;);
    return rb_assoc_new(UIDT2NUM(euid), GIDT2NUM(egid));
#elif defined(SO_PEERCRED) /* GNU/Linux */
    rb_io_t *fptr;
    struct ucred cred;
    socklen_t len = sizeof(cred);
    GetOpenFile(self, fptr);
    if (getsockopt(fptr-&gt;fd, SOL_SOCKET, SO_PEERCRED, &amp;cred, &amp;len) == -1)
	rb_sys_fail(&quot;getsockopt(SO_PEERCRED)&quot;);
    return rb_assoc_new(UIDT2NUM(cred.uid), GIDT2NUM(cred.gid));
#elif defined(HAVE_GETPEERUCRED) /* Solaris */
    rb_io_t *fptr;
    ucred_t *uc = NULL;
    VALUE ret;
    GetOpenFile(self, fptr);
    if (getpeerucred(fptr-&gt;fd, &amp;uc) == -1)
	rb_sys_fail(&quot;getpeerucred(3C)&quot;);
    ret = rb_assoc_new(UIDT2NUM(ucred_geteuid(uc)), GIDT2NUM(ucred_getegid(uc)));
    ucred_free(uc);
    return ret;
#endif
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getpeername-instance_method">
  <h3 class='signature '>
    #<strong>getpeername</strong>  &#x21d2; <code>sockaddr</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the remote address of the socket as a sockaddr string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1440</span>) {<span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1440</span>)
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_accept'>accept</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_getpeername'>getpeername</span> <span class='comment'>#=&gt; &quot;\x02\x00\x82u\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span>}</code></pre>

<p>If Addrinfo object is preferred over the binary string, use <a href="#remote_address-instance_method" title="BasicSocket#remote_address (method)">#remote_address</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L383-L396'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='383' data-end='396'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 383</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getpeername(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getpeername(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getpeername(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rb_str_new((char*)&amp;buf, len);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getsockname-instance_method">
  <h3 class='signature '>
    #<strong>getsockname</strong>  &#x21d2; <code>sockaddr</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the local address of the socket as a sockaddr string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>15120</span>) {<span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_getsockname'>getsockname</span> <span class='comment'>#=&gt; &quot;\x02\x00;\x10\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span>}</code></pre>

<p>If Addrinfo object is preferred over the binary string, use <a href="#local_address-instance_method" title="BasicSocket#local_address (method)">#local_address</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L352-L365'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='352' data-end='365'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 352</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getsockname(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getsockname(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getsockname(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rb_str_new((char*)&amp;buf, len);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getsockopt-instance_method">
  <h3 class='signature '>
    #<strong>getsockopt</strong>(level, optname)  &#x21d2; <code>socketoption</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets a socket option. These are protocol and system specific, see your local system documentation for details. The option is returned as a <a href="Socket/Option.html" title="Socket::Option (class)"><code>::Socket::Option</code></a> object.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>level</code> is an integer, usually one of the SOL_ constants such as Socket::SOL_SOCKET, or a protocol level. A string or symbol of the name, possibly without prefix, is also accepted.</p>
</li><li>
<p><code>optname</code> is an integer, usually one of the SO_ constants, such as Socket::SO_REUSEADDR. A string or symbol of the name, possibly without prefix, is also accepted.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<p>Some socket options are integers with boolean values, in this case <code>#getsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_reuseaddr'>reuseaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>REUSEADDR</span>).<span class='id identifier rubyid_bool'>bool</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SOL_SOCKET-constant" title="Socket::SOL_SOCKET (constant)">SOL_SOCKET</a></span><span class='comma'>,</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SO_REUSEADDR-constant" title="Socket::SO_REUSEADDR (constant)">SO_REUSEADDR</a></span>)
<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span>.<span class='id identifier rubyid_unpack'>unpack</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_reuseaddr'>reuseaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span>[<span class='int'>0</span>] <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='kw'>true</span></code></pre>

<p>Some socket options are integers with numeric values, in this case <code>#getsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ipttl'>ipttl</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='symbeg'>:</span><span class='const'>IP</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TTL</span>).<span class='id identifier rubyid_int'>int</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IPPROTO_IP-constant" title="Socket::IPPROTO_IP (constant)">IPPROTO_IP</a></span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IP_TTL-constant" title="Socket::IP_TTL (constant)">IP_TTL</a></span>)
<span class='id identifier rubyid_ipttl'>ipttl</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i</span><span class='tstring_end'>&quot;</span></span>)[<span class='int'>0</span>]</code></pre>

<p>Option values may be structs. Decoding them can be complex as it involves examining your system headers to determine the correct definition. An example is a <tt>struct linger</tt>, which may be defined in your system headers as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_struct'>struct</span> <span class='id identifier rubyid_linger'>linger</span> {
  <span class='id identifier rubyid_int'>int</span> <span class='id identifier rubyid_l_onoff'>l_onoff</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_int'>int</span> <span class='id identifier rubyid_l_linger'>l_linger</span><span class='semicolon'>;</span>
}<span class='semicolon'>;</span></code></pre>

<p>In this case <code>#getsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Socket::Option knows linger structure.
</span><span class='id identifier rubyid_onoff'>onoff</span><span class='comma'>,</span> <span class='id identifier rubyid_linger'>linger</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>LINGER</span>).<span class='id identifier rubyid_linger'>linger</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span>  <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SOL_SOCKET-constant" title="Socket::SOL_SOCKET (constant)">SOL_SOCKET</a></span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SO_LINGER-constant" title="Socket::SO_LINGER (constant)">SO_LINGER</a></span>)
<span class='id identifier rubyid_onoff'>onoff</span><span class='comma'>,</span> <span class='id identifier rubyid_linger'>linger</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span>.<span class='id identifier rubyid_unpack'>unpack</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ii</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_onoff'>onoff</span> <span class='op'>=</span> <span class='id identifier rubyid_onoff'>onoff</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='kw'>true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L303-L337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='303' data-end='337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 303</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getsockopt(VALUE sock, VALUE lev, VALUE optname)
{
    int level, option;
    socklen_t len;
    char *buf;
    rb_io_t *fptr;
    int family;

    GetOpenFile(sock, fptr);
    family = rsock_getfamily(fptr);
    level = rsock_level_arg(family, lev);
    option = rsock_optname_arg(family, level, optname);
    len = 256;
#ifdef _AIX
    switch (option) {
      case SO_DEBUG:
      case SO_REUSEADDR:
      case SO_KEEPALIVE:
      case SO_DONTROUTE:
      case SO_BROADCAST:
      case SO_OOBINLINE:
        /* AIX doesn&#39;t set len for boolean options */
        len = sizeof(int);
    }
#endif
    buf = ALLOCA_N(char,len);

    rb_io_check_closed(fptr);

    if (getsockopt(fptr-&gt;fd, level, option, buf, &amp;len) &lt; 0)
	rsock_sys_fail_path(&quot;getsockopt(2)&quot;, fptr-&gt;pathv);

    return rsock_sockopt_new(family, level, option, rb_str_new(buf, len));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="local_address-instance_method">
  <h3 class='signature '>
    #<strong>local_address</strong>  &#x21d2; <code>addrinfo</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an <a href="Addrinfo.html" title="Addrinfo (class)"><code>::Addrinfo</code></a> object for local address obtained by getsockname.</p>

<p>Note that addrinfo.protocol is filled by 0.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_local_address'>local_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 192.168.0.129:36873 TCP&gt;
</span>}

<span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1512</span>) {<span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_local_address'>local_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:1512 TCP&gt;
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L473-L486'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='473' data-end='486'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 473</span></pre>
<pre class='code cpp'>

static VALUE
bsock_local_address(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getsockname(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getsockname(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rsock_fd_socket_addrinfo(fptr-&gt;fd, &amp;buf.addr, len);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_nonblock-instance_method">
  <h3 class='signature nodoc'>
    #<strong>read_nonblock</strong>(len, str = nil, exception: true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L451-L453'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='451' data-end='453'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 451</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_nonblock'>read_nonblock</span>(<span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid___read_nonblock'><a href="#__read_nonblock-instance_method" title="BasicSocket#__read_nonblock (method)">__read_nonblock</a></span>(<span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv-instance_method">
  <h3 class='signature '>
    #<strong>recv</strong>(maxlen[, flags[, outbuf]])  &#x21d2; <code>mesg</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Receives a message.</p>

<p><em>maxlen</em> is the maximum number of bytes to receive.</p>

<p><em>flags</em> should be a bitwise OR of Socket::MSG_* constants.</p>

<p><em>outbuf</em> will contain only the received data after the method call even if it is not empty at the beginning.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span>.<span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span> {<span class='op'>|</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='op'>|</span>
  <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_recv'>recv</span>(<span class='int'>4</span>)                     <span class='comment'>#=&gt; &quot;Hell&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_recv'>recv</span>(<span class='int'>4</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#MSG_PEEK-constant" title="Socket::MSG_PEEK (constant)">MSG_PEEK</a></span>)   <span class='comment'>#=&gt; &quot;o Wo&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_recv'>recv</span>(<span class='int'>4</span>)                     <span class='comment'>#=&gt; &quot;o Wo&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_recv'>recv</span>(<span class='int'>10</span>)                    <span class='comment'>#=&gt; &quot;rld\n&quot;
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L653-L657'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='653' data-end='657'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 653</span></pre>
<pre class='code cpp'>

static VALUE
bsock_recv(int argc, VALUE *argv, VALUE sock)
{
    return rsock_s_recvfrom(sock, argc, argv, RECV_RECV);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv_nonblock-instance_method">
  <h3 class='signature '>
    #<strong>recv_nonblock</strong>(maxlen [, flags [, buf [, options ]]])  &#x21d2; <code>mesg</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor. <em>flags</em> is zero or more of the <code>MSG_</code> options. The result, <em>mesg</em>, is the data received.</p>

<p>When recvfrom(2) returns 0, <code>Socket#recv_nonblock</code> returns an empty string as data. The meaning depends on the socket: EOF on TCP, empty packet on UDP, etc.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>maxlen</code> - the number of bytes to receive from the socket</p>
</li><li>
<p><code>flags</code> - zero or more of the <code>MSG_</code> options</p>
</li><li>
<p><code>buf</code> - destination String buffer</p>
</li><li>
<p><code>options</code> - keyword hash, supporting <code>exception: false</code></p>
</li></ul>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_serv'>serv</span> <span class='op'>=</span> <span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span>.<span class='id identifier rubyid_new'><a href="TCPServer.html#new-class_method" title="TCPServer.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)
<span class='id identifier rubyid_af'>af</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_addr'>addr</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span>(<span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span>)
<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_accept'>accept</span>
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="BasicSocket#send (method)">send</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
<span class='kw'>begin</span> <span class='comment'># emulate blocking recv.
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_recv_nonblock'>recv_nonblock</span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;aaa&quot;
</span><span class='kw'>rescue</span> <span class='const'><a href="IO.html" title="IO (class)">IO</a></span><span class='op'>::</span><span class='const'>WaitReadable</span>
  <span class='const'><a href="IO.html" title="IO (class)">IO</a></span>.<span class='id identifier rubyid_select'>select</span>([<span class='id identifier rubyid_s'>s</span>])
  <span class='kw'>retry</span>
<span class='kw'>end</span></code></pre>

<p>Refer to <a href="Socket.html#recvfrom-instance_method" title="Socket#recvfrom (method)">Socket#recvfrom</a> for the exceptions that may be thrown if the call to <em>recv_nonblock</em> fails.</p>

<p><code>recv_nonblock</code> may raise any error corresponding to recvfrom(2) failure, including <code>Errno::EWOULDBLOCK</code>.</p>

<p>If the exception is <code>Errno::EWOULDBLOCK</code> or <code>Errno::EAGAIN</code>, it is extended by <code>IO::WaitReadable</code>. So <code>IO::WaitReadable</code> can be used to rescue the exceptions for retrying recv_nonblock.</p>

<p>By specifying a keyword argument <em>exception</em> to <code>false</code>, you can indicate that recv_nonblock should not raise an <code>IO::WaitReadable</code> exception, but return the symbol <code>:wait_readable</code> instead.</p>

<h4 id="label-See">See</h4>
<ul><li>
<p><a href="Socket.html#recvfrom-instance_method" title="Socket#recvfrom (method)">Socket#recvfrom</a></p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L371-L373'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='371' data-end='373'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 371</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recv_nonblock'>recv_nonblock</span>(<span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid___recv_nonblock'><a href="#__recv_nonblock-instance_method" title="BasicSocket#__recv_nonblock (method)">__recv_nonblock</a></span>(<span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recvmsg-instance_method">
  <h3 class='signature '>
    #<strong>recvmsg</strong>(maxmesglen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; <code>Array</code>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>recvmsg receives a message using recvmsg(2) system call in blocking manner.</p>

<p><em>maxmesglen</em> is the maximum length of mesg to receive.</p>

<p><em>flags</em> is bitwise OR of MSG_* constants such as <a href="Socket.html#MSG_PEEK-constant" title="Socket::MSG_PEEK (constant)">Socket::MSG_PEEK</a>.</p>

<p><em>maxcontrollen</em> is the maximum length of controls (ancillary data) to receive.</p>

<p><em>opts</em> is option hash. Currently :scm_rights=&gt;bool is the only option.</p>

<p><code>:scm_rights</code> option specifies that application expects SCM_RIGHTS control message. If the value is nil or false, application don’t expects SCM_RIGHTS control message. In this case, recvmsg closes the passed file descriptors immediately. This is the default behavior.</p>

<p>If <code>:scm_rights</code> value is neither nil nor false, application expects SCM_RIGHTS control message. In this case, recvmsg creates <a href="IO.html" title="IO (class)"><code>::IO</code></a> objects for each file descriptors for <a href="Socket/AncillaryData.html#unix_rights-instance_method" title="Socket::AncillaryData#unix_rights (method)">Socket::AncillaryData#unix_rights</a> method.</p>

<p>The return value is 4-elements array.</p>

<p><em>mesg</em> is a string of the received message.</p>

<p><em>sender_addrinfo</em> is a sender socket address for connection-less socket. It is an <a href="Addrinfo.html" title="Addrinfo (class)"><code>::Addrinfo</code></a> object. For connection-oriented socket such as TCP, sender_addrinfo is platform dependent.</p>

<p><em>rflags</em> is a flags on the received message which is bitwise OR of MSG_* constants such as <a href="Socket.html#MSG_TRUNC-constant" title="Socket::MSG_TRUNC (constant)">Socket::MSG_TRUNC</a>. It will be nil if the system uses 4.3BSD style old recvmsg system call.</p>

<p><em>controls</em> is ancillary data which is an array of <a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)"><code>::Socket::AncillaryData</code></a> objects such as:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Socket::AncillaryData: AF_UNIX SOCKET RIGHTS 7&gt;</span></code></pre>

<p><em>maxmesglen</em> and <em>maxcontrollen</em> can be nil. In that case, the buffer will be grown until the message is not truncated. Internally, MSG_PEEK is used. Buffer full and MSG_CTRUNC are checked for truncation.</p>

<p>recvmsg can be used to implement recv_io as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_sender_sockaddr'>sender_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_rflags'>rflags</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_recvmsg'>recvmsg</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_scm_rights'>scm_rights</span><span class='op'>=&gt;</span><span class='kw'>true</span>)
<span class='id identifier rubyid_controls'>controls</span>.<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_ancdata'>ancdata</span><span class='op'>|</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ancdata'>ancdata</span>.<span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span>(<span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>RIGHTS</span>)
    <span class='kw'>return</span> <span class='id identifier rubyid_ancdata'>ancdata</span>.<span class='id identifier rubyid_unix_rights'>unix_rights</span>[<span class='int'>0</span>]
  <span class='kw'>end</span>
}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L426-L428'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='426' data-end='428'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 426</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recvmsg'>recvmsg</span>(<span class='id identifier rubyid_dlen'>dlen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>scm_rights:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid___recvmsg'><a href="#__recvmsg-instance_method" title="BasicSocket#__recvmsg (method)">__recvmsg</a></span>(<span class='id identifier rubyid_dlen'>dlen</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span><span class='comma'>,</span> <span class='id identifier rubyid_scm_rights'>scm_rights</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recvmsg_nonblock-instance_method">
  <h3 class='signature '>
    #<strong>recvmsg_nonblock</strong>(maxdatalen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; <code>Array</code>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>recvmsg receives a message using recvmsg(2) system call in non-blocking manner.</p>

<p>It is similar to <a href="#recvmsg-instance_method" title="BasicSocket#recvmsg (method)">#recvmsg</a> but non-blocking flag is set before the system call and it doesn’t retry the system call.</p>

<p>By specifying a keyword argument <em>exception</em> to <code>false</code>, you can indicate that recvmsg_nonblock should not raise an <code>IO::WaitReadable</code> exception, but return the symbol <code>:wait_readable</code> instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L442-L445'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='442' data-end='445'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 442</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recvmsg_nonblock'>recvmsg_nonblock</span>(<span class='id identifier rubyid_dlen'>dlen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span>
                     <span class='label'>scm_rights:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid___recvmsg_nonblock'><a href="#__recvmsg_nonblock-instance_method" title="BasicSocket#__recvmsg_nonblock (method)">__recvmsg_nonblock</a></span>(<span class='id identifier rubyid_dlen'>dlen</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span><span class='comma'>,</span> <span class='id identifier rubyid_scm_rights'>scm_rights</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remote_address-instance_method">
  <h3 class='signature '>
    #<strong>remote_address</strong>  &#x21d2; <code>addrinfo</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an <a href="Addrinfo.html" title="Addrinfo (class)"><code>::Addrinfo</code></a> object for remote address obtained by getpeername.</p>

<p>Note that addrinfo.protocol is filled by 0.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_remote_address'>remote_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 221.186.184.68:80 TCP&gt;
</span>}

<span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1728</span>) {<span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1728</span>)
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span>.<span class='id identifier rubyid_accept'>accept</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_remote_address'>remote_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:36504 TCP&gt;
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L507-L520'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='507' data-end='520'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 507</span></pre>
<pre class='code cpp'>

static VALUE
bsock_remote_address(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getpeername(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getpeername(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rsock_fd_socket_addrinfo(fptr-&gt;fd, &amp;buf.addr, len);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send-instance_method">
  <h3 class='signature '>
    #<strong>send</strong>(mesg, flags [, dest_sockaddr])  &#x21d2; <code>numbytes_sent</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>send <em>mesg</em> via <em>basicsocket</em>.</p>

<p><em>mesg</em> should be a string.</p>

<p><em>flags</em> should be a bitwise OR of Socket::MSG_* constants.</p>

<p><em>dest_sockaddr</em> should be a packed sockaddr string or an addrinfo.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span>.<span class='id identifier rubyid_open'>open</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span>) {<span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\n\r\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_read'>read</span>
}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L539-L575'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='539' data-end='575'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 539</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_send(int argc, VALUE *argv, VALUE sock)
{
    struct rsock_send_arg arg;
    VALUE flags, to;
    rb_io_t *fptr;
    ssize_t n;
    rb_blocking_function_t *func;
    const char *funcname;

    rb_scan_args(argc, argv, &quot;21&quot;, &amp;arg.mesg, &amp;flags, &amp;to);

    StringValue(arg.mesg);
    if (!NIL_P(to)) {
	SockAddrStringValue(to);
	to = rb_str_new4(to);
	arg.to = (struct sockaddr *)RSTRING_PTR(to);
	arg.tolen = RSTRING_SOCKLEN(to);
	func = rsock_sendto_blocking;
	funcname = &quot;sendto(2)&quot;;
    }
    else {
	func = rsock_send_blocking;
	funcname = &quot;send(2)&quot;;
    }
    GetOpenFile(sock, fptr);
    arg.fd = fptr-&gt;fd;
    arg.flags = NUM2INT(flags);
    while (rsock_maybe_fd_writable(arg.fd),
	   (n = (ssize_t)BLOCKING_REGION_FD(func, &amp;arg)) &lt; 0) {
	if (rb_io_wait_writable(arg.fd)) {
	    continue;
	}
	rb_sys_fail(funcname);
    }
    return SSIZET2NUM(n);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sendmsg-instance_method">
  <h3 class='signature '>
    #<strong>sendmsg</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls)  &#x21d2; <code>numbytes_sent</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>sendmsg sends a message using sendmsg(2) system call in blocking manner.</p>

<p><em>mesg</em> is a string to send.</p>

<p><em>flags</em> is bitwise OR of MSG_* constants such as <a href="Socket.html#MSG_OOB-constant" title="Socket::MSG_OOB (constant)">Socket::MSG_OOB</a>.</p>

<p><em>dest_sockaddr</em> is a destination socket address for connection-less socket. It should be a sockaddr such as a result of <a href="Socket.html#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">Socket.sockaddr_in</a>. An Addrinfo object can be used too.</p>

<p><em>controls</em> is a list of ancillary data. The element of <em>controls</em> should be <a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)"><code>::Socket::AncillaryData</code></a> or 3-elements array. The 3-element array should contains cmsg_level, cmsg_type and data.</p>

<p>The return value, <em>numbytes_sent</em> is an integer which is the number of bytes sent.</p>

<p>sendmsg can be used to implement send_io as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># use Socket::AncillaryData.
</span><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">AncillaryData</a></span>.<span class='id identifier rubyid_int'><a href="Socket/AncillaryData.html#int-class_method" title="Socket::AncillaryData.int (method)">int</a></span>(<span class='symbeg'>:</span><span class='const'>UNIX</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>RIGHTS</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_fileno'>fileno</span>)
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_sendmsg'>sendmsg</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_ancdata'>ancdata</span>)

<span class='comment'># use 3-element array.
</span><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>RIGHTS</span><span class='comma'>,</span> [<span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_fileno'>fileno</span>].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i!</span><span class='tstring_end'>&quot;</span></span>)]
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_sendmsg'>sendmsg</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_ancdata'>ancdata</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L303-L305'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='303' data-end='305'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 303</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sendmsg'>sendmsg</span>(<span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span>)
  <span class='id identifier rubyid___sendmsg'><a href="#__sendmsg-instance_method" title="BasicSocket#__sendmsg (method)">__sendmsg</a></span>(<span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_controls'>controls</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sendmsg_nonblock-instance_method">
  <h3 class='signature '>
    #<strong>sendmsg_nonblock</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls, opts = {})  &#x21d2; <code>numbytes_sent</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>sendmsg_nonblock sends a message using sendmsg(2) system call in non-blocking manner.</p>

<p>It is similar to <a href="#sendmsg-instance_method" title="BasicSocket#sendmsg (method)">#sendmsg</a> but the non-blocking flag is set before the system call and it doesn’t retry the system call.</p>

<p>By specifying a keyword argument <em>exception</em> to <code>false</code>, you can indicate that sendmsg_nonblock should not raise an <code>IO::WaitWritable</code> exception, but return the symbol <code>:wait_writable</code> instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L319-L322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='319' data-end='322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 319</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sendmsg_nonblock'>sendmsg_nonblock</span>(<span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span><span class='comma'>,</span>
                     <span class='label'>exception:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid___sendmsg_nonblock'><a href="#__sendmsg_nonblock-instance_method" title="BasicSocket#__sendmsg_nonblock (method)">__sendmsg_nonblock</a></span>(<span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_controls'>controls</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setsockopt-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>setsockopt</strong>(level, optname, optval)  </span>
      <span class='overload'>#<strong>setsockopt</strong>(socketoption)  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets a socket option. These are protocol and system specific, see your local system documentation for details.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>level</code> is an integer, usually one of the SOL_ constants such as Socket::SOL_SOCKET, or a protocol level. A string or symbol of the name, possibly without prefix, is also accepted.</p>
</li><li>
<p><code>optname</code> is an integer, usually one of the SO_ constants, such as Socket::SO_REUSEADDR. A string or symbol of the name, possibly without prefix, is also accepted.</p>
</li><li>
<p><code>optval</code> is the value of the option, it is passed to the underlying setsockopt() as a pointer to a certain number of bytes. How this is done depends on the type:</p>
<ul><li>
<p>Integer: value is assigned to an int, and a pointer to the int is passed, with length of sizeof(int).</p>
</li><li>
<p>true or false: 1 or 0 (respectively) is assigned to an int, and the int is passed as for an Integer. Note that <code>false</code> must be passed, not <code>nil</code>.</p>
</li><li>
<p>String: the string’s data and length is passed to the socket.</p>
</li></ul>
</li><li>
<p><code>socketoption</code> is an instance of <a href="Socket/Option.html" title="Socket::Option (class)"><code>::Socket::Option</code></a></p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<p>Some socket options are integers with boolean values, in this case <code>#setsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SOL_SOCKET-constant" title="Socket::SOL_SOCKET (constant)">SOL_SOCKET</a></span><span class='comma'>,</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#SO_REUSEADDR-constant" title="Socket::SO_REUSEADDR (constant)">SO_REUSEADDR</a></span><span class='comma'>,</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/Option.html" title="Socket::Option (class)">Option</a></span>.<span class='id identifier rubyid_bool'><a href="Socket/Option.html#bool-class_method" title="Socket::Option.bool (method)">bool</a></span>(<span class='symbeg'>:</span><span class='const'>INET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>SOCKET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span>))</code></pre>

<p>Some socket options are integers with numeric values, in this case <code>#setsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='symbeg'>:</span><span class='const'>IP</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TTL</span><span class='comma'>,</span> <span class='int'>255</span>)
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IPPROTO_IP-constant" title="Socket::IPPROTO_IP (constant)">IPPROTO_IP</a></span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IP_TTL-constant" title="Socket::IP_TTL (constant)">IP_TTL</a></span><span class='comma'>,</span> <span class='int'>255</span>)
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/Option.html" title="Socket::Option (class)">Option</a></span>.<span class='id identifier rubyid_int'><a href="Socket/Option.html#int-class_method" title="Socket::Option.int (method)">int</a></span>(<span class='symbeg'>:</span><span class='const'>INET</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>IP</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TTL</span><span class='comma'>,</span> <span class='int'>255</span>))</code></pre>

<p>Option values may be structs. Passing them can be complex as it involves examining your system headers to determine the correct definition. An example is an <code>ip_mreq</code>, which may be defined in your system headers as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_struct'>struct</span> <span class='id identifier rubyid_ip_mreq'>ip_mreq</span> {
  <span class='id identifier rubyid_struct'>struct</span>  <span class='id identifier rubyid_in_addr'>in_addr</span> <span class='id identifier rubyid_imr_multiaddr'>imr_multiaddr</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_struct'>struct</span>  <span class='id identifier rubyid_in_addr'>in_addr</span> <span class='id identifier rubyid_imr_interface'>imr_interface</span><span class='semicolon'>;</span>
}<span class='semicolon'>;</span></code></pre>

<p>In this case <code>#setsockopt</code> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='const'>IPAddr</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>224.0.0.251</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_hton'>hton</span> <span class='op'>+</span>
         <span class='const'>IPAddr</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#INADDR_ANY-constant" title="Socket::INADDR_ANY (constant)">INADDR_ANY</a></span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#AF_INET-constant" title="Socket::AF_INET (constant)">AF_INET</a></span>).<span class='id identifier rubyid_hton'>hton</span>
<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IPPROTO_IP-constant" title="Socket::IPPROTO_IP (constant)">IPPROTO_IP</a></span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket.html#IP_ADD_MEMBERSHIP-constant" title="Socket::IP_ADD_MEMBERSHIP (constant)">IP_ADD_MEMBERSHIP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_optval'>optval</span>)</code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L197-L245'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='197' data-end='245'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 197</span></pre>
<pre class='code cpp'>

static VALUE
bsock_setsockopt(int argc, VALUE *argv, VALUE sock)
{
    VALUE lev, optname, val;
    int family, level, option;
    rb_io_t *fptr;
    int i;
    char *v;
    int vlen;

    if (argc == 1) {
        lev = rb_funcall(argv[0], rb_intern(&quot;level&quot;), 0);
        optname = rb_funcall(argv[0], rb_intern(&quot;optname&quot;), 0);
        val = rb_funcall(argv[0], rb_intern(&quot;data&quot;), 0);
    }
    else {
        rb_scan_args(argc, argv, &quot;30&quot;, &amp;lev, &amp;optname, &amp;val);
    }

    GetOpenFile(sock, fptr);
    family = rsock_getfamily(fptr);
    level = rsock_level_arg(family, lev);
    option = rsock_optname_arg(family, level, optname);

    switch (TYPE(val)) {
      case T_FIXNUM:
	i = FIX2INT(val);
	goto numval;
      case T_FALSE:
	i = 0;
	goto numval;
      case T_TRUE:
	i = 1;
      numval:
	v = (char*)&amp;i; vlen = (int)sizeof(i);
	break;
      default:
	StringValue(val);
	v = RSTRING_PTR(val);
	vlen = RSTRING_SOCKLEN(val);
	break;
    }

    rb_io_check_closed(fptr);
    if (setsockopt(fptr-&gt;fd, level, option, v, vlen) &lt; 0)
        rsock_sys_fail_path(&quot;setsockopt(2)&quot;, fptr-&gt;pathv);

    return INT2FIX(0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shutdown-instance_method">
  <h3 class='signature '>
    #<strong>shutdown</strong>([how])  &#x21d2; <code>0</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Calls shutdown(2) system call.</p>

<p>s.shutdown(Socket::SHUT_RD) disallows further read.</p>

<p>s.shutdown(Socket::SHUT_WR) disallows further write.</p>

<p>s.shutdown(Socket::SHUT_RDWR) disallows further read and write.</p>

<p><em>how</em> can be symbol or string:</p>
<ul><li>
<p><code>:RD</code>, <code>:SHUT_RD</code>, “RD” and “SHUT_RD” are accepted as <a href="Socket.html#SHUT_RD-constant" title="Socket::SHUT_RD (constant)">Socket::SHUT_RD</a>.</p>
</li><li>
<p><code>:WR</code>, <code>:SHUT_WR</code>, “WR” and “SHUT_WR” are accepted as <a href="Socket.html#SHUT_WR-constant" title="Socket::SHUT_WR (constant)">Socket::SHUT_WR</a>.</p>
</li><li>
<p><code>:RDWR</code>, <code>:SHUT_RDWR</code>, “RDWR” and “SHUT_RDWR” are accepted as <a href="Socket.html#SHUT_RDWR-constant" title="Socket::SHUT_RDWR (constant)">Socket::SHUT_RDWR</a>.</p>

<p>UNIXSocket.pair {|s1, s2|</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ping</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_shutdown'>shutdown</span>(<span class='symbeg'>:</span><span class='const'>WR</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_read'>read</span>          <span class='comment'>#=&gt; &quot;ping\n&quot;
</span><span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pong</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_read'>read</span>          <span class='comment'>#=&gt; &quot;pong\n&quot;</span></code></pre>

<p>}</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/basicsocket.c#L62-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='62' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 62</span></pre>
<pre class='code cpp'>

static VALUE
bsock_shutdown(int argc, VALUE *argv, VALUE sock)
{
    VALUE howto;
    int how;
    rb_io_t *fptr;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;howto);
    if (howto == Qnil)
	how = SHUT_RDWR;
    else {
	how = rsock_shutdown_how_arg(howto);
        if (how != SHUT_WR &amp;&amp; how != SHUT_RD &amp;&amp; how != SHUT_RDWR) {
	    rb_raise(rb_eArgError, &quot;`how&#39; should be either :SHUT_RD, :SHUT_WR, :SHUT_RDWR&quot;);
	}
    }
    GetOpenFile(sock, fptr);
    if (shutdown(fptr-&gt;fd, how) == -1)
	rb_sys_fail(&quot;shutdown(2)&quot;);

    return INT2FIX(0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_nonblock-instance_method">
  <h3 class='signature nodoc'>
    #<strong>write_nonblock</strong>(buf, exception: true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/socket/lib/socket.rb#L455-L457'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='455' data-end='457'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 455</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_nonblock'>write_nonblock</span>(<span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid___write_nonblock'><a href="#__write_nonblock-instance_method" title="BasicSocket#__write_nonblock (method)">__write_nonblock</a></span>(<span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>