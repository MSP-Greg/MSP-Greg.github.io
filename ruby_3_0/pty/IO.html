<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: IO &mdash; pty</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "IO",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.0.6</a> &raquo; 
      <a href='.'>pty</a> &raquo; 
      <a href='_index.html#alpha_I'>Index (I)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>IO&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: IO</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/pty/lib/expect.rb#L12'>ext/pty/lib/expect.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect library adds the <code>IO</code> instance method <a href="#expect-instance_method" title="IO#expect (method)">#expect</a>, which does similar act to tclâ€™s expect extension.</p>

<p>In order to use this method, you must require expect:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expect</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>Please see <a href="#expect-instance_method" title="IO#expect (method)">#expect</a> for usage.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#expect-instance_method" title="#expect (instance method)">#<strong>expect</strong>(pattern, timeout = 9999999)  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reads from the <code>IO</code> until the given <code>pattern</code> matches or the <code>timeout</code> is over.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="expect-instance_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>#<strong>expect</strong>(pattern, timeout = 9999999)  &#x21d2; <code>Array</code> </span>
      <span class='overload'>#<strong>expect</strong>(pattern, timeout = 9999999) {|result| ... } &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reads from the <code>IO</code> until the given <code>pattern</code> matches or the <code>timeout</code> is over.</p>

<p>It returns an array with the read buffer, followed by the matches. If a block is given, the result is yielded to the block and returns nil.</p>

<p>When called without a block, it waits until the input that matches the given <code>pattern</code> is obtained from the <code>IO</code> or the time specified as the timeout passes. An array is returned when the pattern is obtained from the <code>IO</code>. The first element of the array is the entire string obtained from the <code>IO</code> until the pattern matches, followed by elements indicating which the pattern which matched to the anchor in the regular expression.</p>

<p>The optional timeout parameter defines, in seconds, the total time to wait for the pattern.  If the timeout expires or eof is found, nil is returned or yielded.  However, the buffer in a timeout session is kept for the next expect call.  The default timeout is 9999999 seconds.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_0_6/ext/pty/lib/expect.rb#L33-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='33' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/pty/lib/expect.rb', line 33</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expect'>expect</span>(<span class='id identifier rubyid_pat'>pat</span><span class='comma'>,</span><span class='id identifier rubyid_timeout'>timeout</span><span class='op'>=</span><span class='int'>9999999</span>)
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_pat'>pat</span>
  <span class='kw'>when</span> <span class='const'>String</span>
    <span class='id identifier rubyid_e_pat'>e_pat</span> <span class='op'>=</span> <span class='const'>Regexp</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>Regexp</span>.<span class='id identifier rubyid_quote'>quote</span>(<span class='id identifier rubyid_pat'>pat</span>))
  <span class='kw'>when</span> <span class='const'>Regexp</span>
    <span class='id identifier rubyid_e_pat'>e_pat</span> <span class='op'>=</span> <span class='id identifier rubyid_pat'>pat</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unsupported pattern class: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pat'>pat</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@unusedBuf</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='ivar'>@unusedBuf</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@unusedBuf</span>.<span class='id identifier rubyid_slice!'>slice!</span>(<span class='int'>0</span>)
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='const'>IO</span>.<span class='id identifier rubyid_select'>select</span>([<span class='kw'>self</span>]<span class='comma'>,</span><span class='kw'>nil</span><span class='comma'>,</span><span class='kw'>nil</span><span class='comma'>,</span><span class='id identifier rubyid_timeout'>timeout</span>) <span class='kw'>or</span> <span class='id identifier rubyid_eof?'>eof?</span> <span class='kw'>then</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='ivar'>@unusedBuf</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span>
      <span class='kw'>break</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_getc'>getc</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_c'>c</span>
    <span class='kw'>if</span> <span class='gvar'>$expect_verbose</span>
      <span class='const'>STDOUT</span>.<span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_c'>c</span>
      <span class='const'>STDOUT</span>.<span class='id identifier rubyid_flush'>flush</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_mat'>mat</span><span class='op'>=</span><span class='id identifier rubyid_e_pat'>e_pat</span>.<span class='id identifier rubyid_match'>match</span>(<span class='id identifier rubyid_buf'>buf</span>) <span class='kw'>then</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> [<span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span><span class='op'>*</span><span class='id identifier rubyid_mat'>mat</span>.<span class='id identifier rubyid_captures'>captures</span>]
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span> <span class='kw'>then</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>