<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongoid::PersistenceContext &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::PersistenceContext",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongoid master</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>PersistenceContext&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongoid::PersistenceContext</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L8'>lib/mongoid/persistence_context.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Object encapsulating logic for setting/getting a collection and database name and a client with particular options to use when persisting models.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='EXTRA_OPTIONS-constant' class='summary_signature'>EXTRA_OPTIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Extra options in addition to driver client options that determine the persistence context.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Array.html" title="Array (class)">Array</a>&lt;<a href="../Symbol.html" title="Symbol (class)">Symbol</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The list of extra options besides client options that determine the persistence context.</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L27-L29'># File 'lib/mongoid/persistence_context.rb', line 27</a>    <pre class='code ruby'>[ <span class='symbeg'>:</span><span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_collection'><a href="#collection-instance_method" title="Mongoid::PersistenceContext#collection (method)">collection</a></span>
].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='PERSISTENCE_CONTEXT_KEY-constant' class='summary_signature nodoc'>PERSISTENCE_CONTEXT_KEY =</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Key to store persistence contexts in the thread local storage.</p>

  </div>
</div>
<div class='tags'>
  
</div>
    <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L282-L282'># File 'lib/mongoid/persistence_context.rb', line 282</a>    <pre class='code ruby'><span class='symbeg'>:&quot;</span><span class='tstring_content'>[mongoid]:persistence_context</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='VALID_OPTIONS-constant' class='summary_signature'>VALID_OPTIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The full list of valid persistence context options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Array.html" title="Array (class)">Array</a>&lt;<a href="../Symbol.html" title="Symbol (class)">Symbol</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The full list of options defining the persistence context.</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L35-L35'># File 'lib/mongoid/persistence_context.rb', line 35</a>    <pre class='code ruby'>( <span class='const'>Mongo</span><span class='op'>::</span><span class='const'>Client</span><span class='op'>::</span><span class='const'><a href="#VALID_OPTIONS-constant" title="Mongoid::PersistenceContext::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span> <span class='op'>+</span> <span class='const'><a href="#EXTRA_OPTIONS-constant" title="Mongoid::PersistenceContext::EXTRA_OPTIONS (constant)">EXTRA_OPTIONS</a></span> ).<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#clear-class_method" title=".clear (class method)">.<strong>clear</strong>(object, cluster = nil, original_context = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Clear the persistence context for a particular class or model instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#get-class_method" title=".get (class method)">.<strong>get</strong>(object)  &#x21d2; Mongoid::PersistenceContext </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the persistence context for a particular class or model instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(object, opts = {})  &#x21d2; PersistenceContext </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Initialize the persistence context object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set-class_method" title=".set (class method)">.<strong>set</strong>(object, options_or_context)  &#x21d2; Mongoid::PersistenceContext </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../Set.html" title="Set (class)"><code>::Set</code></a> the persistence context for a particular class or model instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#get_context-class_method" title=".get_context (class method)">.<strong>get_context</strong>(object)  &#x21d2; Mongoid::PersistenceContext | nil </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the persistence context for a given object from the thread local.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#store_context-class_method" title=".store_context (class method)">.<strong>store_context</strong>(object, context)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Store persistence context for a given object in the thread local.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The options defining this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#reusable_client%3F-instance_method" title="#reusable_client? (instance method)">#<strong>reusable_client?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the client of the context can be reused later, and therefore should not be closed.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; true | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if this persistence context is equal to another.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#client-instance_method" title="#client (instance method)">#<strong>client</strong>  &#x21d2; Mongo::Client </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the client for this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#client_name-instance_method" title="#client_name (instance method)">#<strong>client_name</strong>  &#x21d2; Symbol </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the client name for this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#collection-instance_method" title="#collection (instance method)">#<strong>collection</strong>(parent = nil)  &#x21d2; Mongo::Collection </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the collection for this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#collection_name-instance_method" title="#collection_name (instance method)">#<strong>collection_name</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the collection name for this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#database_name-instance_method" title="#database_name (instance method)">#<strong>database_name</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the database name for this persistence context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#for_child-instance_method" title="#for_child (instance method)">#<strong>for_child</strong>(document)  &#x21d2; PersistenceContext </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a new persistence context that is consistent with the given child document, inheriting most appropriate settings.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#requested_storage_options-instance_method" title="#requested_storage_options (instance method)">#<strong>requested_storage_options</strong>  &#x21d2; Hash | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>The subset of provided options that may be used as storage options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#__evaluate__-instance_method" title="#__evaluate__ (instance method)">#<strong>__evaluate__</strong>(name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#client_options-instance_method" title="#client_options (instance method)">#<strong>client_options</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#database_name_option-instance_method" title="#database_name_option (instance method)">#<strong>database_name_option</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#set_options!-instance_method" title="#set_options! (instance method)">#<strong>set_options!</strong>(opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(object, opts = {})  &#x21d2; <code>PersistenceContext</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initialize the persistence context object.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create a new persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>other</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The class or model instance for which a persistence context should be created.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The persistence context options.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L45-L48'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='45' data-end='48'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 45</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='ivar'>@object</span> <span class='op'>=</span> <span class='id identifier rubyid_object'>object</span>
  <span class='id identifier rubyid_set_options!'><a href="#set_options!-instance_method" title="Mongoid::PersistenceContext#set_options! (method)">set_options!</a></span>(<span class='id identifier rubyid_opts'>opts</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="clear-class_method">
  <h3 class='signature  first'>
    .<strong>clear</strong>(object, cluster = nil, original_context = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clear the persistence context for a particular class or model instance.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Clear the persistence context for a class or model instance.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_clear'>clear</span>(<span class='id identifier rubyid_model'>model</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Class</code> | <code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The class or model instance.</p>
</div>
  </li>
  <li>
    <span class='name'>cluster</span>
    <span class='type'>(<code>Mongo::Cluster</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The original cluster before this context was used.</p>
</div>
  </li>
  <li>
    <span class='name'>original_context</span>
    <span class='type'>(<code>PersistenceContext</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The original persistence context that was set before this context was used.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L267-L275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_original_context'>original_context</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_get'><a href="#get-class_method" title="Mongoid::PersistenceContext.get (method)">get</a></span>(<span class='id identifier rubyid_object'>object</span>)
    <span class='kw'>unless</span> <span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_equal?'>equal?</span>(<span class='id identifier rubyid_cluster'>cluster</span>)
      <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>unless</span> <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_reusable_client?'><a href="#reusable_client%3F-instance_method" title="Mongoid::PersistenceContext#reusable_client? (method)">reusable_client?</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_store_context'><a href="#store_context-class_method" title="Mongoid::PersistenceContext.store_context (method)">store_context</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_original_context'>original_context</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get-class_method">
  <h3 class='signature '>
    .<strong>get</strong>(object)  &#x21d2; <code>PersistenceContext</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the persistence context for a particular class or model instance.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the persistence context for a class or model instance.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_get'>get</span>(<span class='id identifier rubyid_model'>model</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The class or model instance.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>PersistenceContext</code>)</span>
&mdash;    <div class='inline'>
<p>The persistence context for the object.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L254-L256'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='254' data-end='256'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 254</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get'>get</span>(<span class='id identifier rubyid_object'>object</span>)
  <span class='id identifier rubyid_get_context'><a href="#get_context-class_method" title="Mongoid::PersistenceContext.get_context (method)">get_context</a></span>(<span class='id identifier rubyid_object'>object</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_context-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>get_context</strong>(object)  &#x21d2; <code>PersistenceContext</code> | <code>nil</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the persistence context for a given object from the thread local</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_storage'>storage</span>.</code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>Object to get the persistance context for.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>PersistenceContext</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The persistence context for the object if previously stored, otherwise nil.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L293-L296'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='293' data-end='296'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 293</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_context'>get_context</span>(<span class='id identifier rubyid_object'>object</span>)
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#PERSISTENCE_CONTEXT_KEY-constant" title="Mongoid::PersistenceContext::PERSISTENCE_CONTEXT_KEY (constant)">PERSISTENCE_CONTEXT_KEY</a></span>] <span class='op'>||=</span> {}
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#PERSISTENCE_CONTEXT_KEY-constant" title="Mongoid::PersistenceContext::PERSISTENCE_CONTEXT_KEY (constant)">PERSISTENCE_CONTEXT_KEY</a></span>][<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_object_id'>object_id</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set-class_method">
  <h3 class='signature '>
    .<strong>set</strong>(object, options_or_context)  &#x21d2; <code>PersistenceContext</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../Set.html" title="Set (class)"><code>::Set</code></a> the persistence context for a particular class or model instance.</p>

<p>If there already is a persistence context set, options in the existing context are combined with options given to the set call.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../Set.html" title="Set (class)"><code>::Set</code></a> the persistence context for a class or model instance.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_set'>set</span>(<span class='id identifier rubyid_model'>model</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The class or model instance.</p>
</div>
  </li>
  <li>
    <span class='name'>options_or_context</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a> | <code>PersistenceContext</code>)</span>
&mdash;    <div class='inline'>
<p>The persistence options or a persistence context object.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>PersistenceContext</code>)</span>
&mdash;    <div class='inline'>
<p>The persistence context for the object.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L231-L244'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='231' data-end='244'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 231</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set'>set</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_options_or_context'>options_or_context</span>)
  <span class='id identifier rubyid_existing_context'>existing_context</span> <span class='op'>=</span> <span class='id identifier rubyid_get_context'><a href="#get_context-class_method" title="Mongoid::PersistenceContext.get_context (method)">get_context</a></span>(<span class='id identifier rubyid_object'>object</span>)
  <span class='id identifier rubyid_existing_options'>existing_options</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_existing_context'>existing_context</span>
    <span class='id identifier rubyid_existing_context'>existing_context</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>
  <span class='kw'>else</span>
    {}
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options_or_context'>options_or_context</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>PersistenceContext</span>)
    <span class='id identifier rubyid_options_or_context'>options_or_context</span> <span class='op'>=</span> <span class='id identifier rubyid_options_or_context'>options_or_context</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_options'>existing_options</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_options_or_context'>options_or_context</span>)
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongoid::PersistenceContext.new (method)">new</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_new_options'>new_options</span>)
  <span class='id identifier rubyid_store_context'><a href="#store_context-class_method" title="Mongoid::PersistenceContext.store_context (method)">store_context</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="store_context-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>store_context</strong>(object, context)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Store persistence context for a given object in the thread local</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_storage'>storage</span>.</code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>Object to store the persistance context for.</p>
</div>
  </li>
  <li>
    <span class='name'>context</span>
    <span class='type'>(<code>PersistenceContext</code>)</span>
&mdash;    <div class='inline'>
<p>Context to store</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L305-L312'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='305' data-end='312'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 305</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_store_context'>store_context</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#PERSISTENCE_CONTEXT_KEY-constant" title="Mongoid::PersistenceContext::PERSISTENCE_CONTEXT_KEY (constant)">PERSISTENCE_CONTEXT_KEY</a></span>]<span class='op'>&amp;.</span><span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_object_id'>object_id</span>)
  <span class='kw'>else</span>
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#PERSISTENCE_CONTEXT_KEY-constant" title="Mongoid::PersistenceContext::PERSISTENCE_CONTEXT_KEY (constant)">PERSISTENCE_CONTEXT_KEY</a></span>] <span class='op'>||=</span> {}
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#PERSISTENCE_CONTEXT_KEY-constant" title="Mongoid::PersistenceContext::PERSISTENCE_CONTEXT_KEY (constant)">PERSISTENCE_CONTEXT_KEY</a></span>][<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_object_id'>object_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="options-instance_method">
  <h3 class='signature ro first'>
    #<strong>options</strong>  &#x21d2; <a href="../Hash.html" title="Hash (class)">Hash</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The options defining this persistence context.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The persistence context options.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L20-L20'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='20' data-end='20'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 20</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reusable_client?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>reusable_client?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the client of the context can be reused later, and therefore should not be closed.</p>

<p>If the persistence context is requested with <code>:client</code> option only, it means that the context should use a client configured in mongoid.yml. Such clients should not be closed when the context is cleared since they will be reused later.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>True if client can be reused, otherwise false.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L166-L168'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='166' data-end='168'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 166</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reusable_client?'>reusable_client?</span>
  <span class='ivar'>@options</span>.<span class='id identifier rubyid_keys'>keys</span> <span class='op'>==</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>(other)  &#x21d2; <code>true</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if this persistence context is equal to another.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Compare two persistence contexts.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span> <span class='op'>==</span> <span class='id identifier rubyid_other_context'>other_context</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>other</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The object to be compared with this one.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether the two persistence contexts are equal.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L150-L153'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='153'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>==</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>PersistenceContext</span>)
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__evaluate__-instance_method">
  <h3 class='signature priv'>
    #<strong>__evaluate__</strong>(name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L193-L196'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='193' data-end='196'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 193</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid___evaluate__'>__evaluate__</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>) <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_call'>call</span>.<span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>:</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client-instance_method">
  <h3 class='signature '>
    #<strong>client</strong>  &#x21d2; <code>Mongo::Client</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the client for this persistence context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the client for this persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_client'>client</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Mongo::Client</code>)</span>
&mdash;    <div class='inline'>
<p>The client for this persistence context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L116-L127'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='116' data-end='127'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 116</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client'>client</span>
  <span class='ivar'>@client</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Clients.html" title="Mongoid::Clients (module)">Clients</a></span>.<span class='id identifier rubyid_with_name'><a href="Clients.html#with_name-class_method" title="Mongoid::Clients.with_name (method)">with_name</a></span>(<span class='id identifier rubyid_client_name'><a href="#client_name-instance_method" title="Mongoid::PersistenceContext#client_name (method)">client_name</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_database_name_option'><a href="#database_name_option-instance_method" title="Mongoid::PersistenceContext#database_name_option (method)">database_name_option</a></span>
      <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_use'>use</span>(<span class='id identifier rubyid_database_name'><a href="#database_name-instance_method" title="Mongoid::PersistenceContext#database_name (method)">database_name</a></span>)
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_client_options'><a href="#client_options-instance_method" title="Mongoid::PersistenceContext#client_options (method)">client_options</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_with'>with</span>(<span class='id identifier rubyid_client_options'><a href="#client_options-instance_method" title="Mongoid::PersistenceContext#client_options (method)">client_options</a></span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_client'>client</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client_name-instance_method">
  <h3 class='signature '>
    #<strong>client_name</strong>  &#x21d2; <a href="../Symbol.html" title="Symbol (class)">Symbol</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the client name for this persistence context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the client name for this persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_client_name'>client_name</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The client name for this persistence context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L136-L140'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='136' data-end='140'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 136</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client_name'>client_name</span>
  <span class='ivar'>@client_name</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>] <span class='op'>||</span>
                     <span class='const'><a href="Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_client_override'><a href="Threaded.html#client_override-instance_method" title="Mongoid::Threaded#client_override (method)">client_override</a></span> <span class='op'>||</span>
                     <span class='id identifier rubyid___evaluate__'><a href="#__evaluate__-instance_method" title="Mongoid::PersistenceContext#__evaluate__ (method)">__evaluate__</a></span>(<span class='id identifier rubyid_storage_options'><a href="../Mongoid.html#storage_options-instance_method" title="Mongoid#storage_options (method)">storage_options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client_options-instance_method">
  <h3 class='signature priv'>
    #<strong>client_options</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L198-L208'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='198' data-end='208'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 198</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client_options'>client_options</span>
  <span class='ivar'>@client_options</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>.<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
                          <span class='const'>Mongo</span><span class='op'>::</span><span class='const'>Client</span><span class='op'>::</span><span class='const'><a href="#VALID_OPTIONS-constant" title="Mongoid::PersistenceContext::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
                        <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>)
      <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>] <span class='op'>=</span> {<span class='label'>mode:</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>]}
    <span class='kw'>end</span>
    <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="collection-instance_method">
  <h3 class='signature '>
    #<strong>collection</strong>(parent = nil)  &#x21d2; <code>Mongo::Collection</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the collection for this persistence context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the collection for this persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_collection'>collection</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>parent</span>
    <span class='type'>(<code>Object</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The parent object whose collection name is used instead of this persistence context’s collection name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Mongo::Collection</code>)</span>
&mdash;    <div class='inline'>
<p>The collection for this persistence context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L80-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='80' data-end='84'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_collection'>collection</span>(<span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_parent'>parent</span> <span class='op'>?</span>
    <span class='id identifier rubyid_parent'>parent</span>.<span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_with'>with</span>(<span class='id identifier rubyid_client_options'><a href="#client_options-instance_method" title="Mongoid::PersistenceContext#client_options (method)">client_options</a></span>.<span class='id identifier rubyid_except'>except</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>database</span><span class='tstring_end'>&quot;</span></span>)) <span class='op'>:</span>
    <span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>[<span class='id identifier rubyid_collection_name'><a href="#collection_name-instance_method" title="Mongoid::PersistenceContext#collection_name (method)">collection_name</a></span>.<span class='id identifier rubyid_to_sym'>to_sym</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="collection_name-instance_method">
  <h3 class='signature '>
    #<strong>collection_name</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the collection name for this persistence context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the collection name for this persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_collection_name'>collection_name</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The collection name for this persistence context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L93-L96'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='96'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_collection_name'>collection_name</span>
  <span class='ivar'>@collection_name</span> <span class='op'>||=</span> (<span class='id identifier rubyid___evaluate__'><a href="#__evaluate__-instance_method" title="Mongoid::PersistenceContext#__evaluate__ (method)">__evaluate__</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_collection'><a href="#collection-instance_method" title="Mongoid::PersistenceContext#collection (method)">collection</a></span>] <span class='op'>||</span>
                         <span class='id identifier rubyid_storage_options'><a href="../Mongoid.html#storage_options-instance_method" title="Mongoid#storage_options (method)">storage_options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_collection'><a href="#collection-instance_method" title="Mongoid::PersistenceContext#collection (method)">collection</a></span>]))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database_name-instance_method">
  <h3 class='signature '>
    #<strong>database_name</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the database name for this persistence context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the database name for this persistence context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_database_name'>database_name</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The database name for this persistence context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L105-L107'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='105' data-end='107'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 105</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_database_name'>database_name</span>
  <span class='id identifier rubyid___evaluate__'><a href="#__evaluate__-instance_method" title="Mongoid::PersistenceContext#__evaluate__ (method)">__evaluate__</a></span>(<span class='id identifier rubyid_database_name_option'><a href="#database_name_option-instance_method" title="Mongoid::PersistenceContext#database_name_option (method)">database_name_option</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_client'><a href="#client-instance_method" title="Mongoid::PersistenceContext#client (method)">client</a></span>.<span class='id identifier rubyid_database'>database</span>.<span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database_name_option-instance_method">
  <h3 class='signature priv'>
    #<strong>database_name_option</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L210-L214'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='210' data-end='214'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 210</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_database_name_option'>database_name_option</span>
  <span class='ivar'>@database_name_option</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span>] <span class='op'>||</span>
                              <span class='const'><a href="Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_database_override'><a href="Threaded.html#database_override-instance_method" title="Mongoid::Threaded#database_override (method)">database_override</a></span> <span class='op'>||</span>
                              <span class='id identifier rubyid_storage_options'><a href="../Mongoid.html#storage_options-instance_method" title="Mongoid#storage_options (method)">storage_options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="for_child-instance_method">
  <h3 class='signature nodoc'>
    #<strong>for_child</strong>(document)  &#x21d2; <code>PersistenceContext</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a new persistence context that is consistent with the given child document, inheriting most appropriate settings.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>document</span>
    <span class='type'>(<a href="Document.html" title="Mongoid::Document (module)">Mongoid::Document</a> | <code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>the child document</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>PersistenceContext</code>)</span>
&mdash;    <div class='inline'>
<p>the new persistence context</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L58-L68'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='58' data-end='68'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 58</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_for_child'>for_child</span>(<span class='id identifier rubyid_document'>document</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Class</span>)
    <span class='kw'>return</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span> <span class='op'>==</span> (<span class='ivar'>@object</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Class</span>) <span class='op'>?</span> <span class='ivar'>@object</span> <span class='op'>:</span> <span class='ivar'>@object</span>.<span class='id identifier rubyid_class'>class</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="Document.html" title="Mongoid::Document (module)">Document</a></span>)
    <span class='kw'>return</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> (<span class='ivar'>@object</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Class</span>) <span class='op'>?</span> <span class='ivar'>@object</span> <span class='op'>:</span> <span class='ivar'>@object</span>.<span class='id identifier rubyid_class'>class</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>must specify a class or a document instance</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='const'>PersistenceContext</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongoid::PersistenceContext.new (method)">new</a></span>(<span class='id identifier rubyid_document'>document</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongoid::PersistenceContext#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_storage_options'><a href="../Mongoid.html#storage_options-instance_method" title="Mongoid#storage_options (method)">storage_options</a></span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="requested_storage_options-instance_method">
  <h3 class='signature nodoc'>
    #<strong>requested_storage_options</strong>  &#x21d2; <a href="../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>The subset of provided options that may be used as storage options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the requested storage options, or nil if none were specified.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L177-L180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='177' data-end='180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 177</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_requested_storage_options'>requested_storage_options</span>
  <span class='id identifier rubyid_slice'>slice</span> <span class='op'>=</span> <span class='ivar'>@options</span>.<span class='id identifier rubyid_slice'>slice</span>(<span class='op'>*</span><span class='const'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="Clients.html" title="Mongoid::Clients (module)">Clients</a></span><span class='op'>::</span><span class='const'><a href="Clients/Validators.html" title="Mongoid::Clients::Validators (module)">Validators</a></span><span class='op'>::</span><span class='const'><a href="Clients/Validators/Storage.html" title="Mongoid::Clients::Validators::Storage (module)">Storage</a></span><span class='op'>::</span><span class='const'><a href="Clients/Validators/Storage.html#VALID_OPTIONS-constant" title="Mongoid::Clients::Validators::Storage::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span>)
  <span class='id identifier rubyid_slice'>slice</span>.<span class='id identifier rubyid_any?'>any?</span> <span class='op'>?</span> <span class='id identifier rubyid_slice'>slice</span> <span class='op'>:</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_options!-instance_method">
  <h3 class='signature priv'>
    #<strong>set_options!</strong>(opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistence_context.rb#L184-L191'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='184' data-end='191'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistence_context.rb', line 184</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_options!'>set_options!</span>(<span class='id identifier rubyid_opts'>opts</span>)
  <span class='ivar'>@options</span> <span class='op'>||=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_each'>each</span>.<span class='id identifier rubyid_reduce'>reduce</span>({}) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__options'>_options</span><span class='comma'>,</span> (<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)<span class='op'>|</span>
                 <span class='kw'>unless</span> <span class='const'><a href="#VALID_OPTIONS-constant" title="Mongoid::PersistenceContext::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
                   <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/InvalidPersistenceOption.html" title="Mongoid::Errors::InvalidPersistenceOption (class)">InvalidPersistenceOption</a></span>.<span class='id identifier rubyid_new'><a href="Errors/InvalidPersistenceOption.html#new-class_method" title="Mongoid::Errors::InvalidPersistenceOption.new (method)">new</a></span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='const'><a href="#VALID_OPTIONS-constant" title="Mongoid::PersistenceContext::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span>)
                 <span class='kw'>end</span>
                 <span class='id identifier rubyid_value'>value</span> <span class='op'>?</span> <span class='id identifier rubyid__options'>_options</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='id identifier rubyid_key'>key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span>) <span class='op'>:</span> <span class='id identifier rubyid__options'>_options</span>
               <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>