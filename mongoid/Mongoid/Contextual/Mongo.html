<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongoid::Contextual::Mongo &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Contextual::Mongo",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongoid master</a> &raquo; 
      <a href='../../_index.html#alpha_M'>Index (M)</a> &raquo; 
        <a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
        <a href="../Contextual.html" title="Mongoid::Contextual (module)">Contextual</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Mongo&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongoid::Contextual::Mongo</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Mongo/DocumentsLoader.html" title="Mongoid::Contextual::Mongo::DocumentsLoader (class)"><code>DocumentsLoader</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Queryable.html" title="Mongoid::Contextual::Queryable (module)"><code>Queryable</code></a>,
          <a href="../Association/EagerLoadable.html" title="Mongoid::Association::EagerLoadable (module)"><code>::Mongoid::Association::EagerLoadable</code></a>,
          <a href="../Atomic.html" title="Mongoid::Atomic (module)"><code>::Mongoid::Atomic</code></a>,
          <a href="Aggregable/Mongo.html" title="Mongoid::Contextual::Aggregable::Mongo (module)"><code>Aggregable::Mongo</code></a>,
          Enumerable
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L18'>lib/mongoid/contextual/mongo.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo/documents_loader.rb#L6'>lib/mongoid/contextual/mongo/documents_loader.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Context object used for performing bulk query and persistence operations on documents which are persisted in the database and have not been loaded into application memory.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='OPTIONS-constant' class='summary_signature'>OPTIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Options constant.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L27-L39'># File 'lib/mongoid/contextual/mongo.rb', line 27</a>    <pre class='code ruby'>[ <span class='symbeg'>:</span><span class='id identifier rubyid_hint'>hint</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_skip'><a href="#skip-instance_method" title="Mongoid::Contextual::Mongo#skip (method)">skip</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_batch_size'>batch_size</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_scan'>max_scan</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_time_ms'>max_time_ms</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_snapshot'>snapshot</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_cursor_type'>cursor_type</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_collation'>collation</span>
].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="../Atomic.html" title="Mongoid::Atomic (module)"><code>::Mongoid::Atomic</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../Atomic.html#UPDATES-constant" title="Mongoid::Atomic::UPDATES (constant)">UPDATES</a>
  </p>
</div>

<h2 class='h2_sum'><a href="../Atomic.html" title="Mongoid::Atomic (module)"><code>::Mongoid::Atomic</code></a> - Attributes &amp; Methods</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#_index-instance_method" title="#_index (instance method)">#<strong>_index</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When MongoDB finally fully implements the positional operator, we can get rid of all indexing related code in <a href="../../Mongoid.html" title="Mongoid (module)"><code>::Mongoid</code></a>.</p></div>
    </div>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(criteria)  &#x21d2; Mongo </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create the new <code>Mongo</code> context.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#documents_loader-instance_method" title="#documents_loader (instance method)">#<strong>documents_loader</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#view-instance_method" title="#view (instance method)">#<strong>view</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Run an explain on the criteria.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#view+The+Mongo+collection+view%2E-instance_method" title="#view The Mongo collection view. (instance method)">#<strong>view The Mongo collection view.</strong>(The Mongo collection view.)  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#acknowledged_write%3F-instance_method" title="#acknowledged_write? (instance method)">#<strong>acknowledged_write?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Queryable.html" title="Mongoid::Contextual::Queryable (module)"><code>Queryable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="Queryable.html#blank%3F-instance_method" title="Mongoid::Contextual::Queryable#blank? (method)">#blank?</a></td>
      <td><div class='inline'><p>Is the enumerable of matching documents empty?</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Queryable.html#collection-instance_method" title="Mongoid::Contextual::Queryable#collection (method)">#collection</a>,
        <a class='i_m ro' href="Queryable.html#collection+The+collection+to+query+against%2E-instance_method" title="Mongoid::Contextual::Queryable#collection The collection to query against. (method)">#collection The collection to query against.</a>,
        <a class='i_m ro' href="Queryable.html#criteria-instance_method" title="Mongoid::Contextual::Queryable#criteria (method)">#criteria</a>,
        <a class='i_m ro' href="Queryable.html#criteria+The+criteria+for+the+context%2E-instance_method" title="Mongoid::Contextual::Queryable#criteria The criteria for the context. (method)">#criteria The criteria for the context.</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="Queryable.html#empty%3F-instance_method" title="Mongoid::Contextual::Queryable#empty? (method)">#empty?</a></td>
      <td><div class='inline'><p>Alias for <a href="Queryable.html#blank%3F-instance_method" title="Mongoid::Contextual::Queryable#blank? (method)">Queryable#blank?</a>.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Queryable.html#klass-instance_method" title="Mongoid::Contextual::Queryable#klass (method)">#klass</a>,
        <a class='i_m ro' href="Queryable.html#klass+The+klass+for+the+criteria%2E-instance_method" title="Mongoid::Contextual::Queryable#klass The klass for the criteria. (method)">#klass The klass for the criteria.</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Association/EagerLoadable.html" title="Mongoid::Association::EagerLoadable (module)"><code>::Mongoid::Association::EagerLoadable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="../Association/EagerLoadable.html#eager_loadable%3F-instance_method" title="Mongoid::Association::EagerLoadable#eager_loadable? (method)">#eager_loadable?</a></td>
      <td><div class='inline'><p>Indicates whether the criteria has association inclusions which should be eager loaded.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#count-instance_method" title="#count (instance method)">#<strong>count</strong>(options = {}, &amp;block)  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the number of documents matching the query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>  &#x21d2; nil </a>
      (also: #delete_all)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Delete all documents in the database that match the selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete_all-instance_method" title="#delete_all (instance method)">#<strong>delete_all</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#delete-instance_method" title="Mongoid::Contextual::Mongo#delete (method)">#delete</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  &#x21d2; nil </a>
      (also: #destroy_all)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Destroy all documents in the database that match the selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy_all-instance_method" title="#destroy_all (instance method)">#<strong>destroy_all</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#destroy-instance_method" title="Mongoid::Contextual::Mongo#destroy (method)">#destroy</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#distinct-instance_method" title="#distinct (instance method)">#<strong>distinct</strong>(field)  &#x21d2; Array&lt;Object&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the distinct values in the db for the provided field.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>(&amp;block)  &#x21d2; Enumerator </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Iterate over the context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#estimated_count-instance_method" title="#estimated_count (instance method)">#<strong>estimated_count</strong>(options = {})  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the estimated number of documents matching the query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exists%3F-instance_method" title="#exists? (instance method)">#<strong>exists?</strong>(id_or_conditions = :none)  &#x21d2; true | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Do any documents exist for the context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fifth-instance_method" title="#fifth (instance method)">#<strong>fifth</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the fifth document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fifth!-instance_method" title="#fifth! (instance method)">#<strong>fifth!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the fifth document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#find_first-instance_method" title="#find_first (instance method)">#<strong>find_first</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the first result without applying sort.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_one_and_delete-instance_method" title="#find_one_and_delete (instance method)">#<strong>find_one_and_delete</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute the find and modify command, used for MongoDB’s $findAndModify.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_one_and_replace-instance_method" title="#find_one_and_replace (instance method)">#<strong>find_one_and_replace</strong>(replacement, options = {})  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute the find and modify command, used for MongoDB’s $findAndModify.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_one_and_update-instance_method" title="#find_one_and_update (instance method)">#<strong>find_one_and_update</strong>(update, options = {})  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute the find and modify command, used for MongoDB’s $findAndModify.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#first-instance_method" title="#first (instance method)">#<strong>first</strong>(limit = nil)  &#x21d2; Document | nil </a>
      (also: #one)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the first document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#first!-instance_method" title="#first! (instance method)">#<strong>first!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the first document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fourth-instance_method" title="#fourth (instance method)">#<strong>fourth</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the fourth document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fourth!-instance_method" title="#fourth! (instance method)">#<strong>fourth!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the fourth document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#last-instance_method" title="#last (instance method)">#<strong>last</strong>(limit = nil)  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the last document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#last!-instance_method" title="#last! (instance method)">#<strong>last!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the last document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#length-instance_method" title="#length (instance method)">#<strong>length</strong>  &#x21d2; Integer </a>
      (also: #size)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the number of documents in the database matching the query selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#limit-instance_method" title="#limit (instance method)">#<strong>limit</strong>(value)  &#x21d2; Mongo </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Limits the number of documents that are returned from the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#load_async-instance_method" title="#load_async (instance method)">#<strong>load_async</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Schedule a task to load documents for the context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#map_reduce-instance_method" title="#map_reduce (instance method)">#<strong>map_reduce</strong>(map, reduce)  &#x21d2; MapReduce </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Initiate a map/reduce operation from the context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#one-instance_method" title="#one (instance method)">#<strong>one</strong>(limit = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">#first</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pick-instance_method" title="#pick (instance method)">#<strong>pick</strong>(*fields)  &#x21d2; Object | Array&lt;Object&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Pick the single field values from the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pluck-instance_method" title="#pluck (instance method)">#<strong>pluck</strong>(*fields)  &#x21d2; Array&lt;Object&gt; | Array&lt;Array&lt;Object&gt;&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Pluck the field value(s) from the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#second-instance_method" title="#second (instance method)">#<strong>second</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the second document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#second!-instance_method" title="#second! (instance method)">#<strong>second!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the second document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#second_to_last-instance_method" title="#second_to_last (instance method)">#<strong>second_to_last</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the second to last document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#second_to_last!-instance_method" title="#second_to_last! (instance method)">#<strong>second_to_last!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the second to last document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#length-instance_method" title="Mongoid::Contextual::Mongo#length (method)">#length</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#skip-instance_method" title="#skip (instance method)">#<strong>skip</strong>(value)  &#x21d2; Mongo </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Skips the provided number of documents.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sort-instance_method" title="#sort (instance method)">#<strong>sort</strong>(values = nil, &amp;block)  &#x21d2; Mongo </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sorts the documents by the provided spec.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#take-instance_method" title="#take (instance method)">#<strong>take</strong>(limit = nil)  &#x21d2; Document | Array&lt;Document&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Take the given number of documents from the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#take!-instance_method" title="#take! (instance method)">#<strong>take!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Take one document from the database and raise an error if there are none.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#tally-instance_method" title="#tally (instance method)">#<strong>tally</strong>(field)  &#x21d2; Hash </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get a hash of counts for the values of a single field.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#third-instance_method" title="#third (instance method)">#<strong>third</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the third document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#third!-instance_method" title="#third! (instance method)">#<strong>third!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the third document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#third_to_last-instance_method" title="#third_to_last (instance method)">#<strong>third_to_last</strong>  &#x21d2; Document | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the third to last document in the database for the criteria’s selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#third_to_last!-instance_method" title="#third_to_last! (instance method)">#<strong>third_to_last!</strong>  &#x21d2; Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the third to last document in the database for the criteria’s selector or raise an error if none is found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(attributes = nil, opts = {})  &#x21d2; nil | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Update the first matching document atomically.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_all-instance_method" title="#update_all (instance method)">#<strong>update_all</strong>(attributes = nil, opts = {})  &#x21d2; nil | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Update all the matching documents atomically.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_session-instance_method" title="#_session (instance method)">#<strong>_session</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#apply_fields-instance_method" title="#apply_fields (instance method)">#<strong>apply_fields</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Apply the field limitations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#apply_option-instance_method" title="#apply_option (instance method)">#<strong>apply_option</strong>(name)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Apply an option.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#apply_options-instance_method" title="#apply_options (instance method)">#<strong>apply_options</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Apply the options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#demongoize_hash-instance_method" title="#demongoize_hash (instance method)">#<strong>demongoize_hash</strong>(klass, hash)  &#x21d2; Hash | nil </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Demongoizes (converts from database to Ruby representation) the values of the given hash as if it were the raw representation of a document of the given klass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#demongoize_with_field-instance_method" title="#demongoize_with_field (instance method)">#<strong>demongoize_with_field</strong>(field, value, is_translation)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Demongoize the value for the given field.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#documents_for_iteration-instance_method" title="#documents_for_iteration (instance method)">#<strong>documents_for_iteration</strong>  &#x21d2; Array&lt;Document&gt; | Mongo::Collection::View </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the documents the context should iterate.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#extract_value-instance_method" title="#extract_value (instance method)">#<strong>extract_value</strong>(attrs, field_name)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Extracts the value for the given field name from the given attribute hash.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#fetch_and_demongoize-instance_method" title="#fetch_and_demongoize (instance method)">#<strong>fetch_and_demongoize</strong>(obj, meth, field)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Fetch the element from the given hash and demongoize it using the given field.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#inverse_sorting-instance_method" title="#inverse_sorting (instance method)">#<strong>inverse_sorting</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Map the inverse sort symbols to the correct MongoDB values.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_raw_docs-instance_method" title="#process_raw_docs (instance method)">#<strong>process_raw_docs</strong>(raw_docs, limit)  &#x21d2; Array&lt;Document&gt; | Document </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Process the raw documents retrieved for #first/#last.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#raise_document_not_found_error-instance_method" title="#raise_document_not_found_error (instance method)">#<strong>raise_document_not_found_error</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#recursive_demongoize-instance_method" title="#recursive_demongoize (instance method)">#<strong>recursive_demongoize</strong>(field_name, value, is_translation)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Recursively demongoize the given value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#retrieve_nth-instance_method" title="#retrieve_nth (instance method)">#<strong>retrieve_nth</strong>(n)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#retrieve_nth_to_last-instance_method" title="#retrieve_nth_to_last (instance method)">#<strong>retrieve_nth_to_last</strong>(n)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#retrieve_nth_to_last_with_limit-instance_method" title="#retrieve_nth_to_last_with_limit (instance method)">#<strong>retrieve_nth_to_last_with_limit</strong>(n, limit)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#retrieve_nth_with_limit-instance_method" title="#retrieve_nth_with_limit (instance method)">#<strong>retrieve_nth_with_limit</strong>(n, limit)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#update_documents-instance_method" title="#update_documents (instance method)">#<strong>update_documents</strong>(attributes, method = :update_one, opts = {})  &#x21d2; true | false </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Update the documents for the provided method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_for_count_documents%3F-instance_method" title="#valid_for_count_documents? (instance method)">#<strong>valid_for_count_documents?</strong>(hash = view.filter)  &#x21d2; true | false </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Queries whether the current context is valid for use with the #count_documents? predicate.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#yield_document-instance_method" title="#yield_document (instance method)">#<strong>yield_document</strong>(document) {|doc| ... } </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Yield to the document.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../Association/EagerLoadable.html" title="Mongoid::Association::EagerLoadable (module)"><code>::Mongoid::Association::EagerLoadable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Association/EagerLoadable.html#eager_load-instance_method" title="Mongoid::Association::EagerLoadable#eager_load (method)">#eager_load</a></td>
      <td><div class='inline'><p>Load the associations for the given documents.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Association/EagerLoadable.html#preload-instance_method" title="Mongoid::Association::EagerLoadable#preload (method)">#preload</a></td>
      <td><div class='inline'><p>Load the associations for the given documents.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Atomic.html" title="Mongoid::Atomic (module)"><code>::Mongoid::Atomic</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#_updates-instance_method" title="Mongoid::Atomic#_updates (method)">#_updates</a></td>
      <td><div class='inline'><p>Alias for <a href="../Atomic.html#atomic_updates-instance_method" title="Mongoid::Atomic#atomic_updates (method)">Atomic#atomic_updates</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#add_atomic_pull-instance_method" title="Mongoid::Atomic#add_atomic_pull (method)">#add_atomic_pull</a></td>
      <td><div class='inline'><p>Add the document as an atomic pull.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#add_atomic_unset-instance_method" title="Mongoid::Atomic#add_atomic_unset (method)">#add_atomic_unset</a></td>
      <td><div class='inline'><p>Add an atomic unset for the document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_array_add_to_sets-instance_method" title="Mongoid::Atomic#atomic_array_add_to_sets (method)">#atomic_array_add_to_sets</a></td>
      <td><div class='inline'><p>For array fields these are the unique adds that need to happen.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_array_pulls-instance_method" title="Mongoid::Atomic#atomic_array_pulls (method)">#atomic_array_pulls</a></td>
      <td><div class='inline'><p>For array fields these are the pulls that need to happen.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_array_pushes-instance_method" title="Mongoid::Atomic#atomic_array_pushes (method)">#atomic_array_pushes</a></td>
      <td><div class='inline'><p>For array fields these are the pushes that need to happen.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_attribute_name-instance_method" title="Mongoid::Atomic#atomic_attribute_name (method)">#atomic_attribute_name</a></td>
      <td><div class='inline'><p>Returns path of the attribute for modification.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_delete_modifier-instance_method" title="Mongoid::Atomic#atomic_delete_modifier (method)">#atomic_delete_modifier</a></td>
      <td><div class='inline'><p>Get the removal modifier for the document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_insert_modifier-instance_method" title="Mongoid::Atomic#atomic_insert_modifier (method)">#atomic_insert_modifier</a></td>
      <td><div class='inline'><p>Get the insertion modifier for the document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_path-instance_method" title="Mongoid::Atomic#atomic_path (method)">#atomic_path</a></td>
      <td><div class='inline'><p>Return the path to this <a href="../Document.html" title="Mongoid::Document (module)"><code>::Mongoid::Document</code></a> in JSON notation, used for atomic updates via $set in MongoDB.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_paths-instance_method" title="Mongoid::Atomic#atomic_paths (method)">#atomic_paths</a></td>
      <td><div class='inline'><p>Get the atomic paths utility for this document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_position-instance_method" title="Mongoid::Atomic#atomic_position (method)">#atomic_position</a></td>
      <td><div class='inline'><p>Returns the positional operator of this document for modification.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_pulls-instance_method" title="Mongoid::Atomic#atomic_pulls (method)">#atomic_pulls</a></td>
      <td><div class='inline'><p>Get all the attributes that need to be pulled.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_pushes-instance_method" title="Mongoid::Atomic#atomic_pushes (method)">#atomic_pushes</a></td>
      <td><div class='inline'><p>Get all the push attributes that need to occur.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_sets-instance_method" title="Mongoid::Atomic#atomic_sets (method)">#atomic_sets</a></td>
      <td><div class='inline'><p>Get all the attributes that need to be set.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_unsets-instance_method" title="Mongoid::Atomic#atomic_unsets (method)">#atomic_unsets</a></td>
      <td><div class='inline'><p>Get all the attributes that need to be unset.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#atomic_updates-instance_method" title="Mongoid::Atomic#atomic_updates (method)">#atomic_updates</a></td>
      <td><div class='inline'><p>Get all the atomic updates that need to happen for the current <a href="../Document.html" title="Mongoid::Document (module)"><code>::Mongoid::Document</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#delayed_atomic_pulls-instance_method" title="Mongoid::Atomic#delayed_atomic_pulls (method)">#delayed_atomic_pulls</a></td>
      <td><div class='inline'><p>Get a hash of atomic pulls that are pending.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#delayed_atomic_sets-instance_method" title="Mongoid::Atomic#delayed_atomic_sets (method)">#delayed_atomic_sets</a></td>
      <td><div class='inline'><p>Get all the atomic sets that have had their saves delayed.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#delayed_atomic_unsets-instance_method" title="Mongoid::Atomic#delayed_atomic_unsets (method)">#delayed_atomic_unsets</a></td>
      <td><div class='inline'><p>Get the delayed atomic unsets.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#flag_as_destroyed-instance_method" title="Mongoid::Atomic#flag_as_destroyed (method)">#flag_as_destroyed</a></td>
      <td><div class='inline'><p>Flag the document as destroyed and return the atomic path.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#flagged_destroys-instance_method" title="Mongoid::Atomic#flagged_destroys (method)">#flagged_destroys</a></td>
      <td><div class='inline'><p>Get the flagged destroys.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Atomic.html#process_flagged_destroys-instance_method" title="Mongoid::Atomic#process_flagged_destroys (method)">#process_flagged_destroys</a></td>
      <td><div class='inline'><p>Process all the pending flagged destroys from nested attributes.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../Atomic.html#generate_atomic_updates-instance_method" title="Mongoid::Atomic#generate_atomic_updates (method)">#generate_atomic_updates</a></td>
      <td><div class='inline'><p>Generates the atomic updates in the correct order.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../Atomic.html#reset_atomic_updates!-instance_method" title="Mongoid::Atomic#reset_atomic_updates! (method)">#reset_atomic_updates!</a></td>
      <td><div class='inline'><p>Clears all pending atomic updates.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Aggregable/Mongo.html" title="Mongoid::Contextual::Aggregable::Mongo (module)"><code>Aggregable::Mongo</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Aggregable/Mongo.html#aggregates-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#aggregates (method)">#aggregates</a></td>
      <td><div class='inline'><p>Get all the aggregate values for the provided field.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Aggregable/Mongo.html#avg-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#avg (method)">#avg</a></td>
      <td><div class='inline'><p>Get the average value of the provided field.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Aggregable/Mongo.html#max-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#max (method)">#max</a></td>
      <td><div class='inline'><p>Get the max value of the provided field.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Aggregable/Mongo.html#min-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#min (method)">#min</a></td>
      <td><div class='inline'><p>Get the min value of the provided field.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Aggregable/Mongo.html#sum-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#sum (method)">#sum</a></td>
      <td><div class='inline'><p>Get the sum value of the provided field.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Aggregable/Mongo.html#pipeline-instance_method" title="Mongoid::Contextual::Aggregable::Mongo#pipeline (method)">#pipeline</a></td>
      <td><div class='inline'><p>Get the aggregation pipeline for provided field.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(criteria)  &#x21d2; <code>Mongo</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create the new <code>Mongo</code> context. This delegates operations to the underlying driver.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create the new context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Mongo</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_criteria'>criteria</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>criteria</span>
    <span class='type'>(<a href="../Criteria.html" title="Mongoid::Criteria (class)">Criteria</a>)</span>
&mdash;    <div class='inline'>
<p>The criteria.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L270-L276'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='270' data-end='276'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 270</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_criteria'>criteria</span>)
  <span class='ivar'>@criteria</span><span class='comma'>,</span> <span class='ivar'>@klass</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_klass'>klass</span>
  <span class='ivar'>@collection</span> <span class='op'>=</span> <span class='ivar'>@klass</span>.<span class='id identifier rubyid_collection'>collection</span>
  <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_merge_type_selection'>merge_type_selection</span>)
  <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_selector'>selector</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid__session'><a href="#_session-instance_method" title="Mongoid::Contextual::Mongo#_session (method)">_session</a></span>)
  <span class='id identifier rubyid_apply_options'><a href="#apply_options-instance_method" title="Mongoid::Contextual::Mongo#apply_options (method)">apply_options</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="_index-instance_method">
  <h3 class='signature rw first'>
    #<strong>_index</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When MongoDB finally fully implements the positional operator, we can get rid of all indexing related code in <a href="../../Mongoid.html" title="Mongoid (module)"><code>::Mongoid</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/atomic.rb#L25-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='25' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/atomic.rb', line 25</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid__index'>_index</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="acknowledged_write?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>acknowledged_write?</strong>  &#x21d2; <a href="../Boolean.html" title="Mongoid::Boolean (class)">Boolean</a>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L902-L904'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='902' data-end='904'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 902</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_acknowledged_write?'>acknowledged_write?</span>
  <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_write_concern'>write_concern</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_write_concern'>write_concern</span>.<span class='id identifier rubyid_acknowledged?'>acknowledged?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="documents_loader-instance_method">
  <h3 class='signature ro'>
    #<strong>documents_loader</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L54-L54'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='54' data-end='54'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 54</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_documents_loader'>documents_loader</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="view-instance_method">
  <h3 class='signature ro'>
    #<strong>view</strong>  &#x21d2; <a href="../../Hash.html" title="Hash (class)">Hash</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Run an explain on the criteria.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Explain the criteria.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Band</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Depeche Mode</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_explain'>explain</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>customizable options (See Mongo::Collection::View::Explainable)</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The explain result.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L42-L42'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='42'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_view'>view</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="view The Mongo collection view.-instance_method">
  <h3 class='signature ro'>
    #<strong>view The Mongo collection view.</strong>(The Mongo collection view.)   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L42-L42'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='42'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_session-instance_method">
  <h3 class='signature priv first'>
    #<strong>_session</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L898-L900'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='898' data-end='900'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 898</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__session'>_session</span>
  <span class='ivar'>@criteria</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid__session'>_session</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="apply_fields-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>apply_fields</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Apply the field limitations.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Apply the field limitations.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_apply_fields'>apply_fields</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L805-L809'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='805' data-end='809'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 805</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_fields'>apply_fields</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_fields'>fields</span>]
    <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_projection'>projection</span>(<span class='id identifier rubyid_spec'>spec</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="apply_option-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>apply_option</strong>(name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Apply an option.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Apply the skip option.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_apply_option'>apply_option</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_skip'><a href="#skip-instance_method" title="Mongoid::Contextual::Mongo#skip (method)">skip</a></span>)</code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L833-L837'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='833' data-end='837'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 833</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_option'>apply_option</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_options'>options</span>[<span class='id identifier rubyid_name'>name</span>]
    <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_spec'>spec</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="apply_options-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>apply_options</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Apply the options.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Apply all options.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_apply_options'>apply_options</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L817-L825'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='817' data-end='825'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 817</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_options'>apply_options</span>
  <span class='id identifier rubyid_apply_fields'><a href="#apply_fields-instance_method" title="Mongoid::Contextual::Mongo#apply_fields (method)">apply_fields</a></span>
  <span class='const'><a href="#OPTIONS-constant" title="Mongoid::Contextual::Mongo::OPTIONS (constant)">OPTIONS</a></span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Mongoid::Contextual::Mongo#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='id identifier rubyid_apply_option'><a href="#apply_option-instance_method" title="Mongoid::Contextual::Mongo#apply_option (method)">apply_option</a></span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_timeout'>timeout</span>] <span class='op'>==</span> <span class='kw'>false</span>
    <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_no_cursor_timeout'>no_cursor_timeout</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="count-instance_method">
  <h3 class='signature '>
    #<strong>count</strong>(options = {}, &amp;block)  &#x21d2; <a href="../../Integer.html" title="Integer (class)">Integer</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the number of documents matching the query.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the number of matching documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_count'>count</span></code></pre>
        <p class='example_title'><div class='inline'>
<p>Get the count of documents with the provided options.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_count'>count</span>(<span class='label'>limit:</span> <span class='int'>1</span>)</code></pre>
        <p class='example_title'><div class='inline'>
<p>Get the count for where the provided block is true.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_count'>count</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
  <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_likes'>likes</span> <span class='op'>&gt;</span> <span class='int'>1</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options, such as skip and limit to be factored into the count.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The number of matches.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L73-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='73' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_count'>count</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>return</span> <span class='kw'>super</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_valid_for_count_documents?'><a href="#valid_for_count_documents%3F-instance_method" title="Mongoid::Contextual::Mongo#valid_for_count_documents? (method)">valid_for_count_documents?</a></span>
    <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_count_documents'>count_documents</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='kw'>else</span>
    <span class='comment'># TODO: Remove this when we remove the deprecated for_js API.
</span>    <span class='comment'># https://jira.mongodb.org/browse/MONGOID-5681
</span>    <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_count'>count</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>  &#x21d2; <code>nil</code> 
    <span class='aliases'>Also known as: <span class='names'>#delete_all</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Delete all documents in the database that match the selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Delete all the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_delete'>delete</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Nil.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L114-L116'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='114' data-end='116'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 114</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_delete_many'>delete_many</span>.<span class='id identifier rubyid_deleted_count'>deleted_count</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_all-instance_method">
  <h3 class='signature '>
    #<strong>delete_all</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#delete-instance_method" title="Mongoid::Contextual::Mongo#delete (method)">#delete</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L117-L117'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='117' data-end='117'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 117</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete_all'>delete_all</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="Mongoid::Contextual::Mongo#delete (method)">delete</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="demongoize_hash-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>demongoize_hash</strong>(klass, hash)  &#x21d2; <a href="../../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>this method will modify the given hash, in-place, for performance</p>
</div>
  </div>


<p>Demongoizes (converts from database to Ruby representation) the values of the given hash as if it were the raw representation of a document of the given klass.</p>

<p>reasons. If you wish to preserve the original hash, duplicate it before passing it to this method.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>klass</span>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>the <a href="../Document.html" title="Mongoid::Document (module)"><code>::Mongoid::Document</code></a> class that the given hash ought to represent</p>
</div>
  </li>
  <li>
    <span class='name'>hash</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> instance containing the values to demongoize.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the demongoized result (nil if the input <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> was nil)</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1009-L1032'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1009' data-end='1032'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1009</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_demongoize_hash'>demongoize_hash</span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span>)
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hash'>hash</span>

  <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_each_key'>each_key</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>]

    <span class='comment'># does the key represent a declared field on the document?
</span>    <span class='kw'>if</span> (<span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_fields'>fields</span>[<span class='id identifier rubyid_key'>key</span>])
      <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>)
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='comment'># does the key represent an embedded relation on the document?
</span>    <span class='id identifier rubyid_aliased_name'>aliased_name</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_aliased_associations'>aliased_associations</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>||</span> <span class='id identifier rubyid_key'>key</span>
    <span class='kw'>if</span> (<span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_relations'>relations</span>[<span class='id identifier rubyid_aliased_name'>aliased_name</span>])
      <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Mongoid::Contextual::Mongo#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_demongoize_hash'>demongoize_hash</span>(<span class='id identifier rubyid_assoc'>assoc</span>.<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span>) }
      <span class='kw'>when</span> <span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_demongoize_hash'>demongoize_hash</span>(<span class='id identifier rubyid_assoc'>assoc</span>.<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="demongoize_with_field-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>demongoize_with_field</strong>(field, value, is_translation)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Demongoize the value for the given field. If the field is nil or the field is a translations field, the value is demongoized using its class.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<code>Field</code>)</span>
&mdash;    <div class='inline'>
<p>The field to use to demongoize.</p>
</div>
  </li>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The value to demongoize.</p>
</div>
  </li>
  <li>
    <span class='name'>is_translation</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>The field we are retrieving is an _translations field.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The demongoized value.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1045-L1061'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1045' data-end='1061'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1045</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_demongoize_with_field'>demongoize_with_field</span>(<span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span>
    <span class='comment'># If it&#39;s a localized field that&#39;s not a hash, don&#39;t demongoize
</span>    <span class='comment'># again, we already have the translation. If it&#39;s an _translations
</span>    <span class='comment'># field, don&#39;t demongoize, we want the full hash not just a
</span>    <span class='comment'># specific translation.
</span>    <span class='comment'># If it is a hash, and it&#39;s not a translations field, we need to
</span>    <span class='comment'># demongoize to get the correct translation.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_localized?'>localized?</span> <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
      <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature '>
    #<strong>destroy</strong>  &#x21d2; <code>nil</code> 
    <span class='aliases'>Also known as: <span class='names'>#destroy_all</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Destroy all documents in the database that match the selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Destroy all the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_destroy'>destroy</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Nil.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L125-L131'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='125' data-end='131'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 125</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='id identifier rubyid_each'><a href="#each-instance_method" title="Mongoid::Contextual::Mongo#each (method)">each</a></span>.<span class='id identifier rubyid_inject'>inject</span>(<span class='int'>0</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_count'><a href="#count-instance_method" title="Mongoid::Contextual::Mongo#count (method)">count</a></span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_destroy'>destroy</span>
    <span class='id identifier rubyid_count'><a href="#count-instance_method" title="Mongoid::Contextual::Mongo#count (method)">count</a></span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_acknowledged_write?'><a href="#acknowledged_write%3F-instance_method" title="Mongoid::Contextual::Mongo#acknowledged_write? (method)">acknowledged_write?</a></span>
    <span class='id identifier rubyid_count'><a href="#count-instance_method" title="Mongoid::Contextual::Mongo#count (method)">count</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_all-instance_method">
  <h3 class='signature '>
    #<strong>destroy_all</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#destroy-instance_method" title="Mongoid::Contextual::Mongo#destroy (method)">#destroy</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L132-L132'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='132'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_all'>destroy_all</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'><a href="#destroy-instance_method" title="Mongoid::Contextual::Mongo#destroy (method)">destroy</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="distinct-instance_method">
  <h3 class='signature '>
    #<strong>distinct</strong>(field)  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the distinct values in the db for the provided field.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the distinct values.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_distinct'>distinct</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the field.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The distinct values for the field.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L142-L149'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='142' data-end='149'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 142</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_distinct'>distinct</span>(<span class='id identifier rubyid_field'>field</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_cleanse_localized_field_names'>cleanse_localized_field_names</span>(<span class='id identifier rubyid_field'>field</span>)

  <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_distinct'>distinct</span>(<span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_translations</span><span class='tstring_end'>&quot;</span></span> <span class='op'>==</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_recursive_demongoize'><a href="#recursive_demongoize-instance_method" title="Mongoid::Contextual::Mongo#recursive_demongoize (method)">recursive_demongoize</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="documents_for_iteration-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>documents_for_iteration</strong>  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <code>Mongo::Collection::View</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the documents the context should iterate.</p>

<p>If the documents have been already preloaded by <code>Document::Loader</code> instance, they will be used.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <code>Mongo::Collection::View</code>)</span>
&mdash;    <div class='inline'>
<p>The docs to iterate.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L855-L870'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='855' data-end='870'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 855</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_documents_for_iteration'>documents_for_iteration</span>
  <span class='kw'>if</span> <span class='ivar'>@documents_loader</span>
    <span class='kw'>if</span> <span class='ivar'>@documents_loader</span>.<span class='id identifier rubyid_started?'>started?</span>
      <span class='ivar'>@documents_loader</span>.<span class='id identifier rubyid_value!'>value!</span>
    <span class='kw'>else</span>
      <span class='ivar'>@documents_loader</span>.<span class='id identifier rubyid_unschedule'>unschedule</span>
      <span class='ivar'>@documents_loader</span>.<span class='id identifier rubyid_execute'>execute</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_eager_loadable?'>eager_loadable?</span>
    <span class='id identifier rubyid_docs'>docs</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
      <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_eager_load'>eager_load</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each-instance_method">
  <h3 class='signature '>
    #<strong>each</strong>(&amp;block)  &#x21d2; <code>Enumerator</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Iterate over the context. If provided a block, yield to a <a href="../../Mongoid.html" title="Mongoid (module)"><code>::Mongoid</code></a> document for each, otherwise return an enum.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Iterate over the context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Enumerator</code>)</span>
&mdash;    <div class='inline'>
<p>The enumerator.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L160-L169'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='160' data-end='169'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 160</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_documents_for_iteration'><a href="#documents_for_iteration-instance_method" title="Mongoid::Contextual::Mongo#documents_for_iteration (method)">documents_for_iteration</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
      <span class='id identifier rubyid_yield_document'><a href="#yield_document-instance_method" title="Mongoid::Contextual::Mongo#yield_document (method)">yield_document</a></span>(<span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_to_enum'>to_enum</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="estimated_count-instance_method">
  <h3 class='signature '>
    #<strong>estimated_count</strong>(options = {})  &#x21d2; <a href="../../Integer.html" title="Integer (class)">Integer</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the estimated number of documents matching the query.</p>

<p>Unlike count, estimated_count does not take a block because it is not traditionally defined (with a block) on Enumerable like count is.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the estimated number of matching documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_estimated_count'>estimated_count</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options, such as maxTimeMS to be factored into the count.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The number of matches.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L97-L106'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='97' data-end='106'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 97</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_estimated_count'>estimated_count</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='kw'>unless</span> <span class='kw'>self</span>.<span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_selector'>selector</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_default_scoping?'>default_scoping?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="../Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="../Errors/InvalidEstimatedCountScoping.html" title="Mongoid::Errors::InvalidEstimatedCountScoping (class)">InvalidEstimatedCountScoping</a></span>.<span class='id identifier rubyid_new'><a href="../Errors/InvalidEstimatedCountScoping.html#new-class_method" title="Mongoid::Errors::InvalidEstimatedCountScoping.new (method)">new</a></span>(<span class='kw'>self</span>.<span class='id identifier rubyid_klass'>klass</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="../Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="../Errors/InvalidEstimatedCountCriteria.html" title="Mongoid::Errors::InvalidEstimatedCountCriteria (class)">InvalidEstimatedCountCriteria</a></span>.<span class='id identifier rubyid_new'><a href="../Errors/InvalidEstimatedCountCriteria.html#new-class_method" title="Mongoid::Errors::InvalidEstimatedCountCriteria.new (method)">new</a></span>(<span class='kw'>self</span>.<span class='id identifier rubyid_klass'>klass</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_estimated_document_count'>estimated_document_count</span>(<span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exists?-instance_method">
  <h3 class='signature '>
    #<strong>exists?</strong>(id_or_conditions = :none)  &#x21d2; <code>true</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>We don’t use count here since <code>Mongo</code> does not use counted b-tree indexes.</p>
</div>
  </div>


<p>Do any documents exist for the context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Do any documents exist for the context.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_exists?'>exists?</span></code></pre>
        <p class='example_title'><div class='inline'>
<p>Do any documents exist for given _id.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_exists?'>exists?</span>(<span class='const'><a href="../../BSON.html" title="BSON (module)">BSON</a></span><span class='op'>::</span><span class='const'><a href="../../BSON/ObjectId.html" title="BSON::ObjectId (class)">ObjectId</a></span>(<span class='op'>...</span>))</code></pre>
        <p class='example_title'><div class='inline'>
<p>Do any documents exist for given conditions.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_exists?'>exists?</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>id_or_conditions</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a> | <code>Object</code> | <code>false</code>)</span>
    <em class='default'>(defaults to: <tt>:none</tt>)</em>
&mdash;    <div class='inline'>
<p>an _id to search for, a hash of conditions, nil or false.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the count is more than zero. Always false if passed nil or false.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L190-L198'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='190' data-end='198'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 190</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exists?'>exists?</span>(<span class='id identifier rubyid_id_or_conditions'>id_or_conditions</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_id_or_conditions'>id_or_conditions</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span> <span class='kw'>then</span> <span class='op'>!</span><span class='op'>!</span>(<span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_projection'>projection</span>(<span class='label'>_id:</span> <span class='int'>1</span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='int'>1</span>).<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>)
  <span class='kw'>when</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>false</span> <span class='kw'>then</span> <span class='kw'>false</span>
  <span class='kw'>when</span> <span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span> <span class='kw'>then</span> <span class='const'>Mongo</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongoid::Contextual::Mongo.new (method)">new</a></span>(<span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_id_or_conditions'>id_or_conditions</span>)).<span class='id identifier rubyid_exists?'>exists?</span>
  <span class='kw'>else</span> <span class='const'>Mongo</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongoid::Contextual::Mongo.new (method)">new</a></span>(<span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>_id:</span> <span class='id identifier rubyid_id_or_conditions'>id_or_conditions</span>)).<span class='id identifier rubyid_exists?'>exists?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_value-instance_method">
  <h3 class='signature priv'>
    #<strong>extract_value</strong>(attrs, field_name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Extracts the value for the given field name from the given attribute hash.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>attrs</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The attributes hash.</p>
</div>
  </li>
  <li>
    <span class='name'>field_name</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the field to extract.</p>
</div>
  </li>
  <li>
    <span class='name'>The</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>value for the given field name</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L933-L976'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='933' data-end='976'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 933</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_value'>extract_value</span>(<span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_field_name'>field_name</span>)
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_num_meths'>num_meths</span> <span class='op'>=</span> <span class='id identifier rubyid_field_name'>field_name</span>.<span class='id identifier rubyid_count'><a href="#count-instance_method" title="Mongoid::Contextual::Mongo#count (method)">count</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_curr'>curr</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span>.<span class='id identifier rubyid_dup'>dup</span>

  <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_traverse_association_tree'>traverse_association_tree</span>(<span class='id identifier rubyid_field_name'>field_name</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_is_field'>is_field</span><span class='op'>|</span>
    <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span> <span class='kw'>if</span> <span class='id identifier rubyid_is_field'>is_field</span>
    <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='comment'># If no association or field was found, check if the meth is an
</span>    <span class='comment'># _translations field.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>=</span> <span class='id identifier rubyid_meth'>meth</span>.<span class='id identifier rubyid_match'>match</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(.*)_translations\z</span><span class='regexp_end'>/</span></span>)<span class='op'>&amp;.</span><span class='id identifier rubyid_captures'>captures</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
      <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_meth'>meth</span> <span class='op'>=</span> <span class='id identifier rubyid_tr'>tr</span>
    <span class='kw'>end</span>

    <span class='comment'># 1. If curr is an array fetch from all elements in the array.
</span>    <span class='comment'># 2. If the field is localized, and is not an _translations field
</span>    <span class='comment'>#    (_translations fields don&#39;t show up in the fields hash).
</span>    <span class='comment'>#    - If this is the end of the methods, return the translation for
</span>    <span class='comment'>#      the current locale.
</span>    <span class='comment'>#    - Otherwise, return the whole translations hash so the next method
</span>    <span class='comment'>#      can select the language it wants.
</span>    <span class='comment'># 3. If the meth is an _translations field, do not demongoize the
</span>    <span class='comment'>#    value so the full hash is returned.
</span>    <span class='comment'># 4. Otherwise, fetch and demongoize the value for the key meth.
</span>    <span class='id identifier rubyid_curr'>curr</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_curr'>curr</span>.<span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>
      <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Contextual::Mongo#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_curr'>curr</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
      <span class='id identifier rubyid_res'>res</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_res'>res</span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_field'>field</span><span class='op'>&amp;.</span><span class='id identifier rubyid_localized?'>localized?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_num_meths'>num_meths</span>
        <span class='id identifier rubyid_curr'>curr</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='kw'>nil</span>)
      <span class='kw'>else</span>
        <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Contextual::Mongo#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_curr'>curr</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_is_translation'>is_translation</span>
      <span class='id identifier rubyid_curr'>curr</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='kw'>nil</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Contextual::Mongo#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_curr'>curr</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_curr'>curr</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch_and_demongoize-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>fetch_and_demongoize</strong>(obj, meth, field)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Fetch the element from the given hash and demongoize it using the given field. If the obj is an array, map over it and call this method on all of its elements.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>obj</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The hash or array of hashes to fetch from.</p>
</div>
  </li>
  <li>
    <span class='name'>meth</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The key to fetch from the hash.</p>
</div>
  </li>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<code>Field</code>)</span>
&mdash;    <div class='inline'>
<p>The field to use for demongoization.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The demongoized value.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L917-L924'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='917' data-end='924'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 917</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_and_demongoize'>fetch_and_demongoize</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='id identifier rubyid_fetch_and_demongoize'>fetch_and_demongoize</span>(<span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='kw'>nil</span>)
    <span class='id identifier rubyid_field'>field</span> <span class='op'>?</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_res'>res</span>) <span class='op'>:</span> <span class='id identifier rubyid_res'>res</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_res'>res</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fifth-instance_method">
  <h3 class='signature '>
    #<strong>fifth</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the fifth document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the fifth document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_fifth'>fifth</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The fifth document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L699-L701'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='699' data-end='701'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 699</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fifth'>fifth</span>
  <span class='id identifier rubyid_retrieve_nth'><a href="#retrieve_nth-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth (method)">retrieve_nth</a></span>(<span class='int'>4</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fifth!-instance_method">
  <h3 class='signature '>
    #<strong>fifth!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the fifth document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the fifth document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_fifth!'>fifth!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The fifth document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L713-L715'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='713' data-end='715'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 713</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fifth!'>fifth!</span>
  <span class='id identifier rubyid_fifth'><a href="#fifth-instance_method" title="Mongoid::Contextual::Mongo#fifth (method)">fifth</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_first-instance_method">
  <h3 class='signature nodoc'>
    #<strong>find_first</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the first result without applying sort</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L256-L261'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='256' data-end='261'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 256</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_first'>find_first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_raw_doc'>raw_doc</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
    <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_doc'>raw_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>)
    <span class='id identifier rubyid_eager_load'>eager_load</span>([<span class='id identifier rubyid_doc'>doc</span>]).<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_one_and_delete-instance_method">
  <h3 class='signature '>
    #<strong>find_one_and_delete</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute the find and modify command, used for MongoDB’s $findAndModify. This deletes the found document.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute the command.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_find_one_and_delete'>find_one_and_delete</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The result of the command.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L247-L251'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='247' data-end='251'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 247</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_delete'>find_one_and_delete</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_find_one_and_delete'>find_one_and_delete</span>
    <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_one_and_replace-instance_method">
  <h3 class='signature '>
    #<strong>find_one_and_replace</strong>(replacement, options = {})  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute the find and modify command, used for MongoDB’s $findAndModify.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute the command.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_find_one_and_update'><a href="#find_one_and_update-instance_method" title="Mongoid::Contextual::Mongo#find_one_and_update (method)">find_one_and_update</a></span>({ <span class='label'>likes:</span> <span class='int'>1</span> })</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>replacement</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The replacement.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The command options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:return_document</span>
          <span class='type'>(<code>:before</code> | <code>:after</code>)</span>
            &mdash; <div class='inline'>
<p>Return the updated document from before or after update.</p>
</div>        </li>
        <li>
          <span class='name'>:upsert</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Create the document if it doesn’t exist.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The result of the command.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L234-L238'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='234' data-end='238'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 234</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_replace'>find_one_and_replace</span>(<span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='kw'>if</span> <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_find_one_and_replace'>find_one_and_replace</span>(<span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
    <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_one_and_update-instance_method">
  <h3 class='signature '>
    #<strong>find_one_and_update</strong>(update, options = {})  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute the find and modify command, used for MongoDB’s $findAndModify.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute the command.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span>({ <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$inc</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='label'>likes:</span> <span class='int'>1</span> }})</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>update</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The updates.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The command options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:return_document</span>
          <span class='type'>(<code>:before</code> | <code>:after</code>)</span>
            &mdash; <div class='inline'>
<p>Return the updated document from before or after update.</p>
</div>        </li>
        <li>
          <span class='name'>:upsert</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Create the document if it doesn’t exist.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The result of the command.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L214-L218'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='218'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span>(<span class='id identifier rubyid_update'><a href="#update-instance_method" title="Mongoid::Contextual::Mongo#update (method)">update</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='kw'>if</span> <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span>(<span class='id identifier rubyid_update'><a href="#update-instance_method" title="Mongoid::Contextual::Mongo#update (method)">update</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
    <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="first-instance_method">
  <h3 class='signature '>
    #<strong>first</strong>(limit = nil)  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
    <span class='aliases'>Also known as: <span class='names'>#one</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Automatically adding a sort on _id when no other sort is defined on the criteria has the potential to cause bad performance issues. If you experience unexpected poor performance when using #first or #last and have no sort defined on the criteria, use #take instead. Be aware that #take won’t guarantee order.</p>
</div>
  </div>


<p>Get the first document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the first document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_first'>first</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>limit</span>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The number of documents to return.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The first document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L550-L556'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='550' data-end='556'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 550</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_first'>first</span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_retrieve_nth'><a href="#retrieve_nth-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth (method)">retrieve_nth</a></span>(<span class='int'>0</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_retrieve_nth_with_limit'><a href="#retrieve_nth_with_limit-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_with_limit (method)">retrieve_nth_with_limit</a></span>(<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="first!-instance_method">
  <h3 class='signature '>
    #<strong>first!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Automatically adding a sort on _id when no other sort is defined on the criteria has the potential to cause bad performance issues. If you experience unexpected poor performance when using #first! or #last! and have no sort defined on the criteria, use #take! instead. Be aware that #take! won’t guarantee order.</p>
</div>
  </div>


<p>Get the first document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the first document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_first!'>first!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The first document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L575-L577'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='575' data-end='577'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 575</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_first!'>first!</span>
  <span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fourth-instance_method">
  <h3 class='signature '>
    #<strong>fourth</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the fourth document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the fourth document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_fourth'>fourth</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The fourth document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L675-L677'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='675' data-end='677'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 675</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fourth'>fourth</span>
  <span class='id identifier rubyid_retrieve_nth'><a href="#retrieve_nth-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth (method)">retrieve_nth</a></span>(<span class='int'>3</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fourth!-instance_method">
  <h3 class='signature '>
    #<strong>fourth!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the fourth document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the fourth document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_fourth!'>fourth!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The fourth document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L689-L691'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='689' data-end='691'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 689</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fourth!'>fourth!</span>
  <span class='id identifier rubyid_fourth'><a href="#fourth-instance_method" title="Mongoid::Contextual::Mongo#fourth (method)">fourth</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inverse_sorting-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>inverse_sorting</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Map the inverse sort symbols to the correct MongoDB values.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L842-L845'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='842' data-end='845'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 842</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inverse_sorting'>inverse_sorting</span>
  <span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span> <span class='op'>||</span> { <span class='label'>_id:</span> <span class='int'>1</span> }
  <span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>[<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span>.<span class='id identifier rubyid_map'>map</span>{<span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> [<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='op'>*</span><span class='id identifier rubyid_v'>v</span>]}]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="last-instance_method">
  <h3 class='signature '>
    #<strong>last</strong>(limit = nil)  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Automatically adding a sort on _id when no other sort is defined on the criteria has the potential to cause bad performance issues. If you experience unexpected poor performance when using #first or #last and have no sort defined on the criteria, use #take instead. Be aware that #take won’t guarantee order.</p>
</div>
  </div>


<p>Get the last document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_last'>last</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>limit</span>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The number of documents to return.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The last document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L593-L599'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='593' data-end='599'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 593</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_last'>last</span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_retrieve_nth_to_last'><a href="#retrieve_nth_to_last-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_to_last (method)">retrieve_nth_to_last</a></span>(<span class='int'>0</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_retrieve_nth_to_last_with_limit'><a href="#retrieve_nth_to_last_with_limit-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_to_last_with_limit (method)">retrieve_nth_to_last_with_limit</a></span>(<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="last!-instance_method">
  <h3 class='signature '>
    #<strong>last!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Automatically adding a sort on _id when no other sort is defined on the criteria has the potential to cause bad performance issues. If you experience unexpected poor performance when using #first! or #last! and have no sort defined on the criteria, use #take! instead. Be aware that #take! won’t guarantee order.</p>
</div>
  </div>


<p>Get the last document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_last!'>last!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The last document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L617-L619'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='617' data-end='619'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 617</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_last!'>last!</span>
  <span class='id identifier rubyid_last'><a href="#last-instance_method" title="Mongoid::Contextual::Mongo#last (method)">last</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="length-instance_method">
  <h3 class='signature '>
    #<strong>length</strong>  &#x21d2; <a href="../../Integer.html" title="Integer (class)">Integer</a> 
    <span class='aliases'>Also known as: <span class='names'>#size</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the number of documents in the database matching the query selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the length.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_length'>length</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The number of documents.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L287-L289'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='287' data-end='289'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_count'><a href="#count-instance_method" title="Mongoid::Contextual::Mongo#count (method)">count</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="limit-instance_method">
  <h3 class='signature '>
    #<strong>limit</strong>(value)  &#x21d2; <code>Mongo</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Limits the number of documents that are returned from the database.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Limit the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>20</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The number of documents to return.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Mongo</code>)</span>
&mdash;    <div class='inline'>
<p>The context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L300-L302'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='300' data-end='302'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 300</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_limit'>limit</span>(<span class='id identifier rubyid_value'>value</span>) <span class='kw'>and</span> <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_async-instance_method">
  <h3 class='signature nodoc'>
    #<strong>load_async</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Schedule a task to load documents for the context.</p>

<p>Depending on the <a href="../../Mongoid.html" title="Mongoid (module)"><code>::Mongoid</code></a> configuration, the scheduled task can be executed immediately on the caller’s thread, or can be scheduled for an asynchronous execution.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L776-L778'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='776' data-end='778'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 776</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_async'>load_async</span>
  <span class='ivar'>@documents_loader</span> <span class='op'>||=</span> <span class='const'><a href="Mongo/DocumentsLoader.html" title="Mongoid::Contextual::Mongo::DocumentsLoader (class)">DocumentsLoader</a></span>.<span class='id identifier rubyid_new'><a href="Mongo/DocumentsLoader.html#new-class_method" title="Mongoid::Contextual::Mongo::DocumentsLoader.new (method)">new</a></span>(<span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span><span class='comma'>,</span> <span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="map_reduce-instance_method">
  <h3 class='signature '>
    #<strong>map_reduce</strong>(map, reduce)  &#x21d2; <a href="MapReduce.html" title="Mongoid::Contextual::MapReduce (class)">MapReduce</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initiate a map/reduce operation from the context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Initiate a map/reduce.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_map_reduce'>map_reduce</span>(<span class='id identifier rubyid_map'>map</span><span class='comma'>,</span> <span class='id identifier rubyid_reduce'>reduce</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>map</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The map js function.</p>
</div>
  </li>
  <li>
    <span class='name'>reduce</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The reduce js function.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="MapReduce.html" title="Mongoid::Contextual::MapReduce (class)">MapReduce</a>)</span>
&mdash;    <div class='inline'>
<p>The map/reduce lazy wrapper.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L313-L315'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='313' data-end='315'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 313</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_map_reduce'>map_reduce</span>(<span class='id identifier rubyid_map'>map</span><span class='comma'>,</span> <span class='id identifier rubyid_reduce'>reduce</span>)
  <span class='const'><a href="MapReduce.html" title="Mongoid::Contextual::MapReduce (class)">MapReduce</a></span>.<span class='id identifier rubyid_new'><a href="MapReduce.html#new-class_method" title="Mongoid::Contextual::MapReduce.new (method)">new</a></span>(<span class='id identifier rubyid_collection'>collection</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span><span class='comma'>,</span> <span class='id identifier rubyid_map'>map</span><span class='comma'>,</span> <span class='id identifier rubyid_reduce'>reduce</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="one-instance_method">
  <h3 class='signature '>
    #<strong>one</strong>(limit = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">#first</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L557-L557'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='557' data-end='557'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 557</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_one'>one</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pick-instance_method">
  <h3 class='signature '>
    #<strong>pick</strong>(*fields)  &#x21d2; <code>Object</code> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pick the single field values from the database.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Pick a field.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_pick'>pick</span>(<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>*fields</span>
    <span class='type'>([ <a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a> ]...)</span>
&mdash;    <div class='inline'>
<p>Field(s) to pick.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The picked values.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L361-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='361' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 361</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pick'>pick</span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>)
  <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='int'>1</span>).<span class='id identifier rubyid_pluck'><a href="#pluck-instance_method" title="Mongoid::Contextual::Mongo#pluck (method)">pluck</a></span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>).<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pluck-instance_method">
  <h3 class='signature '>
    #<strong>pluck</strong>(*fields)  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt; | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt;&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pluck the field value(s) from the database. Returns one result for each document found in the database for the context. The results are normalized according to their <a href="../../Mongoid.html" title="Mongoid (module)"><code>::Mongoid</code></a> field types. Note that the results may include duplicates and nil values.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Pluck a field.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_pluck'>pluck</span>(<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>*fields</span>
    <span class='type'>([ <a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a> ]...)</span>
&mdash;    <div class='inline'>
<p>Field(s) to pluck, which may include nested fields using dot-notation.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt; | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Array.html" title="Array (class)">Array</a>&lt;<code>Object</code>&gt;&gt;)</span>
&mdash;    <div class='inline'>
<p>The plucked values. If the *fields arg contains a single value, each result in the array will be a single value. Otherwise, each result in the array will be an array of values.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L333-L351'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='333' data-end='351'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 333</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pluck'>pluck</span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>)
  <span class='comment'># Multiple fields can map to the same field name. For example, plucking
</span>  <span class='comment'># a field and its _translations field map to the same field in the database.
</span>  <span class='comment'># because of this, we need to keep track of the fields requested.
</span>  <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_normalized_select'>normalized_select</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span>.<span class='id identifier rubyid_inject'>inject</span>({}) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='id identifier rubyid_db_fn'>db_fn</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_f'>f</span>)
    <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span>.<span class='id identifier rubyid_push'>push</span>(<span class='id identifier rubyid_db_fn'>db_fn</span>)
    <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_cleanse_localized_field_names'>cleanse_localized_field_names</span>(<span class='id identifier rubyid_f'>f</span>)] <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_hash'>hash</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_projection'>projection</span>(<span class='id identifier rubyid_normalized_select'>normalized_select</span>).<span class='id identifier rubyid_reduce'>reduce</span>([]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plucked'>plucked</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
      <span class='id identifier rubyid_extract_value'><a href="#extract_value-instance_method" title="Mongoid::Contextual::Mongo#extract_value (method)">extract_value</a></span>(<span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_plucked'>plucked</span> <span class='op'>&lt;&lt;</span> (<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="Mongoid::Contextual::Mongo#size (method)">size</a></span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span> <span class='op'>:</span> <span class='id identifier rubyid_values'>values</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_raw_docs-instance_method">
  <h3 class='signature priv'>
    #<strong>process_raw_docs</strong>(raw_docs, limit)  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <a href="../Document.html" title="Mongoid::Document (module)">Document</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Process the raw documents retrieved for #first/#last.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The list of documents or a single document.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1067-L1080'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1067' data-end='1080'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1067</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_raw_docs'>process_raw_docs</span>(<span class='id identifier rubyid_raw_docs'>raw_docs</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='id identifier rubyid_docs'>docs</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_raw_results?'>raw_results?</span>
           <span class='kw'>if</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_typecast_results?'>typecast_results?</span>
             <span class='id identifier rubyid_raw_docs'>raw_docs</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='id identifier rubyid_demongoize_hash'><a href="#demongoize_hash-instance_method" title="Mongoid::Contextual::Mongo#demongoize_hash (method)">demongoize_hash</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>) }
           <span class='kw'>else</span>
             <span class='id identifier rubyid_raw_docs'>raw_docs</span>
           <span class='kw'>end</span>
         <span class='kw'>else</span>
           <span class='id identifier rubyid_mapped'>mapped</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_docs'>raw_docs</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>) }
           <span class='id identifier rubyid_eager_load'>eager_load</span>(<span class='id identifier rubyid_mapped'>mapped</span>)
         <span class='kw'>end</span>

  <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>?</span> <span class='id identifier rubyid_docs'>docs</span> <span class='op'>:</span> <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_document_not_found_error-instance_method">
  <h3 class='signature priv'>
    #<strong>raise_document_not_found_error</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Errors::DocumentNotFound</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1103-L1105'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1103' data-end='1105'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1103</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_raise_document_not_found_error'>raise_document_not_found_error</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">DocumentNotFound</a></span>.<span class='id identifier rubyid_new'><a href="../Errors/DocumentNotFound.html#new-class_method" title="Mongoid::Errors::DocumentNotFound.new (method)">new</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recursive_demongoize-instance_method">
  <h3 class='signature priv'>
    #<strong>recursive_demongoize</strong>(field_name, value, is_translation)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Recursively demongoize the given value. This method recursively traverses the class tree to find the correct field to use to demongoize the value.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>field_name</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the field to demongoize.</p>
</div>
  </li>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The value to demongoize.</p>
</div>
  </li>
  <li>
    <span class='name'>is_translation</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>The field we are retrieving is an _translations field.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The demongoized value.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L987-L990'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='987' data-end='990'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 987</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recursive_demongoize'>recursive_demongoize</span>(<span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_traverse_association_tree'>traverse_association_tree</span>(<span class='id identifier rubyid_field_name'>field_name</span>)
  <span class='id identifier rubyid_demongoize_with_field'><a href="#demongoize_with_field-instance_method" title="Mongoid::Contextual::Mongo#demongoize_with_field (method)">demongoize_with_field</a></span>(<span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="retrieve_nth-instance_method">
  <h3 class='signature priv'>
    #<strong>retrieve_nth</strong>(n)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1107-L1109'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1107' data-end='1109'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1107</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_retrieve_nth'>retrieve_nth</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_retrieve_nth_with_limit'><a href="#retrieve_nth_with_limit-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_with_limit (method)">retrieve_nth_with_limit</a></span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="retrieve_nth_to_last-instance_method">
  <h3 class='signature priv'>
    #<strong>retrieve_nth_to_last</strong>(n)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1120-L1122'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1120' data-end='1122'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1120</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_retrieve_nth_to_last'>retrieve_nth_to_last</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_retrieve_nth_to_last_with_limit'><a href="#retrieve_nth_to_last_with_limit-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_to_last_with_limit (method)">retrieve_nth_to_last_with_limit</a></span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="retrieve_nth_to_last_with_limit-instance_method">
  <h3 class='signature priv'>
    #<strong>retrieve_nth_to_last_with_limit</strong>(n, limit)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1124-L1129'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1124' data-end='1129'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1124</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_retrieve_nth_to_last_with_limit'>retrieve_nth_to_last_with_limit</span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span>(<span class='id identifier rubyid_inverse_sorting'><a href="#inverse_sorting-instance_method" title="Mongoid::Contextual::Mongo#inverse_sorting (method)">inverse_sorting</a></span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>||</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_skip'><a href="#skip-instance_method" title="Mongoid::Contextual::Mongo#skip (method)">skip</a></span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='id identifier rubyid_raw_docs'>raw_docs</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_reverse'>reverse</span>
  <span class='id identifier rubyid_process_raw_docs'><a href="#process_raw_docs-instance_method" title="Mongoid::Contextual::Mongo#process_raw_docs (method)">process_raw_docs</a></span>(<span class='id identifier rubyid_raw_docs'>raw_docs</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="retrieve_nth_with_limit-instance_method">
  <h3 class='signature priv'>
    #<strong>retrieve_nth_with_limit</strong>(n, limit)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1111-L1118'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1111' data-end='1118'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_retrieve_nth_with_limit'>retrieve_nth_with_limit</span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span> <span class='op'>||</span> { <span class='label'>_id:</span> <span class='int'>1</span> }
  <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span>(<span class='id identifier rubyid_sort'><a href="#sort-instance_method" title="Mongoid::Contextual::Mongo#sort (method)">sort</a></span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>||</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_skip'><a href="#skip-instance_method" title="Mongoid::Contextual::Mongo#skip (method)">skip</a></span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_raw_docs'>raw_docs</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_to_a'>to_a</span>
    <span class='id identifier rubyid_process_raw_docs'><a href="#process_raw_docs-instance_method" title="Mongoid::Contextual::Mongo#process_raw_docs (method)">process_raw_docs</a></span>(<span class='id identifier rubyid_raw_docs'>raw_docs</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="second-instance_method">
  <h3 class='signature '>
    #<strong>second</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the second document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the second document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_second'>second</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The second document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L627-L629'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='627' data-end='629'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 627</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_second'>second</span>
  <span class='id identifier rubyid_retrieve_nth'><a href="#retrieve_nth-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth (method)">retrieve_nth</a></span>(<span class='int'>1</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="second!-instance_method">
  <h3 class='signature '>
    #<strong>second!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the second document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the second document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_second!'>second!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The second document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L641-L643'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='641' data-end='643'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 641</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_second!'>second!</span>
  <span class='id identifier rubyid_second'><a href="#second-instance_method" title="Mongoid::Contextual::Mongo#second (method)">second</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="second_to_last-instance_method">
  <h3 class='signature '>
    #<strong>second_to_last</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the second to last document in the database for the criteria’s selector.</p>

<p>is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the second to last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_second_to_last'>second_to_last</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The second to last document or nil if none</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L725-L727'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='725' data-end='727'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 725</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_second_to_last'>second_to_last</span>
  <span class='id identifier rubyid_retrieve_nth_to_last'><a href="#retrieve_nth_to_last-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_to_last (method)">retrieve_nth_to_last</a></span>(<span class='int'>1</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="second_to_last!-instance_method">
  <h3 class='signature '>
    #<strong>second_to_last!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the second to last document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the second to last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_second_to_last!'>second_to_last!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The second to last document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L739-L741'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='739' data-end='741'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 739</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_second_to_last!'>second_to_last!</span>
  <span class='id identifier rubyid_second_to_last'><a href="#second_to_last-instance_method" title="Mongoid::Contextual::Mongo#second_to_last (method)">second_to_last</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="size-instance_method">
  <h3 class='signature '>
    #<strong>size</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#length-instance_method" title="Mongoid::Contextual::Mongo#length (method)">#length</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L290-L290'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='290' data-end='290'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 290</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_size'>size</span> <span class='symbeg'>:</span><span class='id identifier rubyid_length'><a href="#length-instance_method" title="Mongoid::Contextual::Mongo#length (method)">length</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip-instance_method">
  <h3 class='signature '>
    #<strong>skip</strong>(value)  &#x21d2; <code>Mongo</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Skips the provided number of documents.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Skip the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_skip'>skip</span>(<span class='int'>20</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The number of documents to skip.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Mongo</code>)</span>
&mdash;    <div class='inline'>
<p>The context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L480-L482'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='480' data-end='482'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 480</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skip'>skip</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_skip'>skip</span>(<span class='id identifier rubyid_value'>value</span>) <span class='kw'>and</span> <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sort-instance_method">
  <h3 class='signature '>
    #<strong>sort</strong>(values = nil, &amp;block)  &#x21d2; <code>Mongo</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sorts the documents by the provided spec.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Sort the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_sort'>sort</span>(<span class='label'>name:</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='int'>1</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>values</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The sorting values as field/direction(1/-1) pairs.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Mongo</code>)</span>
&mdash;    <div class='inline'>
<p>The context.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L493-L502'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='493' data-end='502'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 493</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sort'>sort</span>(<span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>super</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='comment'># update the criteria
</span>    <span class='ivar'>@criteria</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_order_by'>order_by</span>(<span class='id identifier rubyid_values'>values</span>)
    <span class='id identifier rubyid_apply_option'><a href="#apply_option-instance_method" title="Mongoid::Contextual::Mongo#apply_option (method)">apply_option</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sort'>sort</span>)
    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="take-instance_method">
  <h3 class='signature '>
    #<strong>take</strong>(limit = nil)  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Take the given number of documents from the database.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Take 10 documents</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_take'>take</span>(<span class='int'>10</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>limit</span>
    <span class='type'>(<a href="../../Integer.html" title="Integer (class)">Integer</a> | <code>nil</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The number of documents to return or nil.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The list of documents, or one document if no value was given.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L374-L382'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='374' data-end='382'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_take'>take</span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>
    <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>).<span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>else</span>
    <span class='comment'># Do to_a first so that the Mongo#first method is not used and the
</span>    <span class='comment'># result is not sorted.
</span>    <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='int'>1</span>).<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="take!-instance_method">
  <h3 class='signature '>
    #<strong>take!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Take one document from the database and raise an error if there are none.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Take a document</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_take!'>take!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents to take.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L393-L401'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='393' data-end='401'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 393</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_take!'>take!</span>
  <span class='comment'># Do to_a first so that the Mongo#first method is not used and the
</span>  <span class='comment'># result is not sorted.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_fst'>fst</span> <span class='op'>=</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongoid::Contextual::Mongo#limit (method)">limit</a></span>(<span class='int'>1</span>).<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_first'><a href="#first-instance_method" title="Mongoid::Contextual::Mongo#first (method)">first</a></span>
    <span class='id identifier rubyid_fst'>fst</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">DocumentNotFound</a></span>.<span class='id identifier rubyid_new'><a href="../Errors/DocumentNotFound.html#new-class_method" title="Mongoid::Errors::DocumentNotFound.new (method)">new</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tally-instance_method">
  <h3 class='signature '>
    #<strong>tally</strong>(field)  &#x21d2; <a href="../../Hash.html" title="Hash (class)">Hash</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get a hash of counts for the values of a single field. For example, if the following documents were in the database:</p>

<pre class="code ruby"><code class="ruby">{ <span class='label'>_id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>21</span> }
{ <span class='label'>_id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>21</span> }
{ <span class='label'>_id:</span> <span class='int'>3</span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>22</span> }

<span class='const'>Model</span>.<span class='id identifier rubyid_tally'>tally</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>would yield the following result:</p>

<pre class="code ruby"><code class="ruby">{ <span class='int'>21</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>22</span> <span class='op'>=&gt;</span> <span class='int'>1</span> }</code></pre>

<p>When tallying a field inside an array or embeds_many association:</p>

<pre class="code ruby"><code class="ruby">{ <span class='label'>_id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>array:</span> [ { <span class='label'>x:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>x:</span> <span class='int'>2</span> } ] }
{ <span class='label'>_id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>array:</span> [ { <span class='label'>x:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>x:</span> <span class='int'>2</span> } ] }
{ <span class='label'>_id:</span> <span class='int'>3</span><span class='comma'>,</span> <span class='label'>array:</span> [ { <span class='label'>x:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>x:</span> <span class='int'>3</span> } ] }

<span class='const'>Model</span>.<span class='id identifier rubyid_tally'>tally</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>array.x</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>The keys of the resulting hash are arrays:</p>

<pre class="code ruby"><code class="ruby">{ [ <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span> ] <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span> [ <span class='int'>1</span><span class='comma'>,</span> <span class='int'>3</span> ] <span class='op'>=&gt;</span> <span class='int'>1</span> }</code></pre>

<p>Note that if tallying an element in an array of hashes, and the key doesn’t exist in some of the hashes, tally will not include those nil keys in the resulting hash:</p>

<pre class="code ruby"><code class="ruby">{ <span class='label'>_id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>array:</span> [ { <span class='label'>x:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>x:</span> <span class='int'>2</span> }<span class='comma'>,</span> { <span class='label'>y:</span> <span class='int'>3</span> } ] }

<span class='const'>Model</span>.<span class='id identifier rubyid_tally'>tally</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>array.x</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; { [ 1, 2 ] =&gt; 1 }</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The field name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The hash of counts.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L440-L470'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='440' data-end='470'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 440</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_tally'>tally</span>(<span class='id identifier rubyid_field'>field</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_cleanse_localized_field_names'>cleanse_localized_field_names</span>(<span class='id identifier rubyid_field'>field</span>)

  <span class='id identifier rubyid_fld'>fld</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_traverse_association_tree'>traverse_association_tree</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> [ { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$group</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='label'>_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>counts:</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$sum</span><span class='label_end'>&quot;:</span> <span class='int'>1</span> } } } ]
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_unshift'>unshift</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$match</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_filter'>filter</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_filter'>filter</span>.<span class='id identifier rubyid_blank?'>blank?</span>

  <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_aggregate'>aggregate</span>(<span class='id identifier rubyid_pipeline'>pipeline</span>).<span class='id identifier rubyid_reduce'>reduce</span>({}) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tallies'>tallies</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_translations</span><span class='tstring_end'>&quot;</span></span> <span class='op'>==</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span>]

    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
      <span class='id identifier rubyid_val'>val</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
        <span class='id identifier rubyid_demongoize_with_field'><a href="#demongoize_with_field-instance_method" title="Mongoid::Contextual::Mongo#demongoize_with_field (method)">demongoize_with_field</a></span>(<span class='id identifier rubyid_fld'>fld</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_demongoize_with_field'><a href="#demongoize_with_field-instance_method" title="Mongoid::Contextual::Mongo#demongoize_with_field (method)">demongoize_with_field</a></span>(<span class='id identifier rubyid_fld'>fld</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
    <span class='kw'>end</span>

    <span class='comment'># The only time where a key will already exist in the tallies hash
</span>    <span class='comment'># is when the values are stored differently in the database, but
</span>    <span class='comment'># demongoize to the same value. A good example of when this happens
</span>    <span class='comment'># is when using localized fields. While the server query won&#39;t group
</span>    <span class='comment'># together hashes that have other values in different languages, the
</span>    <span class='comment'># demongoized value is just the translation in the current locale,
</span>    <span class='comment'># which can be the same across multiple of those unequal hashes.
</span>    <span class='id identifier rubyid_tallies'>tallies</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>||=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_tallies'>tallies</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>+=</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>counts</span><span class='tstring_end'>&quot;</span></span>]
    <span class='id identifier rubyid_tallies'>tallies</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="third-instance_method">
  <h3 class='signature '>
    #<strong>third</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the third document in the database for the criteria’s selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the third document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_third'>third</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The third document or nil if none is found.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L651-L653'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='651' data-end='653'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 651</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_third'>third</span>
  <span class='id identifier rubyid_retrieve_nth'><a href="#retrieve_nth-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth (method)">retrieve_nth</a></span>(<span class='int'>2</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="third!-instance_method">
  <h3 class='signature '>
    #<strong>third!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the third document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the third document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_third!'>third!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The third document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L665-L667'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='665' data-end='667'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 665</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_third!'>third!</span>
  <span class='id identifier rubyid_third'><a href="#third-instance_method" title="Mongoid::Contextual::Mongo#third (method)">third</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="third_to_last-instance_method">
  <h3 class='signature '>
    #<strong>third_to_last</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the third to last document in the database for the criteria’s selector.</p>

<p>is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the third to last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_third_to_last'>third_to_last</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The third to last document or nil if none</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L751-L753'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='751' data-end='753'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 751</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_third_to_last'>third_to_last</span>
  <span class='id identifier rubyid_retrieve_nth_to_last'><a href="#retrieve_nth_to_last-instance_method" title="Mongoid::Contextual::Mongo#retrieve_nth_to_last (method)">retrieve_nth_to_last</a></span>(<span class='int'>2</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="third_to_last!-instance_method">
  <h3 class='signature '>
    #<strong>third_to_last!</strong>  &#x21d2; <a href="../Document.html" title="Mongoid::Document (module)">Document</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the third to last document in the database for the criteria’s selector or raise an error if none is found.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the third to last document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_third_to_last!'>third_to_last!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The third to last document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Errors/DocumentNotFound.html" title="Mongoid::Errors::DocumentNotFound (class)">Mongoid::Errors::DocumentNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>raises when there are no documents available.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L765-L767'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='765' data-end='767'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 765</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_third_to_last!'>third_to_last!</span>
  <span class='id identifier rubyid_third_to_last'><a href="#third_to_last-instance_method" title="Mongoid::Contextual::Mongo#third_to_last (method)">third_to_last</a></span> <span class='op'>||</span> <span class='id identifier rubyid_raise_document_not_found_error'><a href="#raise_document_not_found_error-instance_method" title="Mongoid::Contextual::Mongo#raise_document_not_found_error (method)">raise_document_not_found_error</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update-instance_method">
  <h3 class='signature '>
    #<strong>update</strong>(attributes = nil, opts = {})  &#x21d2; <code>nil</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Update the first matching document atomically.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Update the first matching document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_update'>update</span>({ <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Smiths</span><span class='tstring_end'>&quot;</span></span> }})</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>attributes</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The new attributes for the document.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The update operation options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:array_filters</span>
          <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>)</span>
            &mdash; <div class='inline'>
<p>A set of filters specifying to which array elements an update should apply.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>False if no attributes were provided.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L516-L518'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='516' data-end='518'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 516</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_update_documents'><a href="#update_documents-instance_method" title="Mongoid::Contextual::Mongo#update_documents (method)">update_documents</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update_one'>update_one</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_all-instance_method">
  <h3 class='signature '>
    #<strong>update_all</strong>(attributes = nil, opts = {})  &#x21d2; <code>nil</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Update all the matching documents atomically.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Update all the matching documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_update_all'>update_all</span>({ <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Smiths</span><span class='tstring_end'>&quot;</span></span> }})</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>attributes</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The new attributes for each document.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The update operation options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:array_filters</span>
          <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>)</span>
            &mdash; <div class='inline'>
<p>A set of filters specifying to which array elements an update should apply.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>False if no attributes were provided.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L532-L534'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='532' data-end='534'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 532</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_all'>update_all</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_update_documents'><a href="#update_documents-instance_method" title="Mongoid::Contextual::Mongo#update_documents (method)">update_documents</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update_many'>update_many</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_documents-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>update_documents</strong>(attributes, method = :update_one, opts = {})  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Update the documents for the provided method.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Update the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_update_documents'>update_documents</span>(<span class='id identifier rubyid_attrs'>attrs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>attributes</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The updates.</p>
</div>
  </li>
  <li>
    <span class='name'>method</span>
    <span class='type'>(<a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
    <em class='default'>(defaults to: <tt>:update_one</tt>)</em>
&mdash;    <div class='inline'>
<p>The method to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the update succeeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L793-L797'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='793' data-end='797'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 793</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_documents'>update_documents</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update_one'>update_one</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_attributes'>attributes</span>

  <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='const'><a href="../AtomicUpdatePreparer.html" title="Mongoid::AtomicUpdatePreparer (class)">AtomicUpdatePreparer</a></span>.<span class='id identifier rubyid_prepare'><a href="../AtomicUpdatePreparer.html#prepare-class_method" title="Mongoid::AtomicUpdatePreparer.prepare (method)">prepare</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_klass'>klass</span>)<span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_for_count_documents?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_for_count_documents?</strong>(hash = view.filter)  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Queries whether the current context is valid for use with the #count_documents? predicate. A context is valid if it does not include a <code>$where</code> operator.</p>

<p>TODO: Remove this method when we remove the deprecated for_js API. <a href="https://jira.mongodb.org/browse/MONGOID-5681">jira.mongodb.org/browse/MONGOID-5681</a></p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>whether or not the current context excludes a <code>$where</code> operator.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L1091-L1101'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1091' data-end='1101'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 1091</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_for_count_documents?'>valid_for_count_documents?</span>(<span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongoid::Contextual::Mongo#view (method)">view</a></span>.<span class='id identifier rubyid_filter'>filter</span>)
  <span class='comment'># Note that `view.filter` is a BSON::Document, and all keys in a
</span>  <span class='comment'># BSON::Document are strings; we don&#39;t need to worry about symbol
</span>  <span class='comment'># representations of `$where`.
</span>  <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Mongoid::Contextual::Mongo#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$where</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_valid_for_count_documents?'>valid_for_count_documents?</span>(<span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>])
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="yield_document-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>yield_document</strong>(document) {|doc| ... }  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Yield to the document.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Yield the document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_context'><a href="../Contextual.html#context-instance_method" title="Mongoid::Contextual#context (method)">context</a></span>.<span class='id identifier rubyid_yield_document'>yield_document</span>(<span class='id identifier rubyid_doc'>doc</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>document</span>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a>)</span>
&mdash;    <div class='inline'>
<p>The document to yield to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>doc</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/contextual/mongo.rb#L882-L896'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='882' data-end='896'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/contextual/mongo.rb', line 882</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_yield_document'>yield_document</span>(<span class='id identifier rubyid_document'>document</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>)
          <span class='id identifier rubyid_document'>document</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_raw_results?'>raw_results?</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_typecast_results?'>typecast_results?</span>
            <span class='id identifier rubyid_demongoize_hash'><a href="#demongoize_hash-instance_method" title="Mongoid::Contextual::Mongo#demongoize_hash (method)">demongoize_hash</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_document'>document</span>)
          <span class='kw'>else</span>
            <span class='id identifier rubyid_document'>document</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_from_db'><a href="../Factory.html#from_db-instance_method" title="Mongoid::Factory#from_db (method)">from_db</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_document'>document</span><span class='comma'>,</span> <span class='id identifier rubyid_criteria'>criteria</span>)
        <span class='kw'>end</span>

  <span class='kw'>yield</span>(<span class='id identifier rubyid_doc'>doc</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>