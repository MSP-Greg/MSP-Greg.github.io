<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Mongoid::Association::Embedded::Batchable &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Association::Embedded::Batchable",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Mongoid master</a> &raquo; 
      <a href='../../../_index.html#alpha_B'>Index (B)</a> &raquo; 
        <a href="../../../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
        <a href="../../Association.html" title="Mongoid::Association (module)">Association</a> &raquo; 
        <a href="../Embedded.html" title="Mongoid::Association::Embedded (module)">Embedded</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Batchable&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Mongoid::Association::Embedded::Batchable</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="EmbedsMany/Proxy.html" title="Mongoid::Association::Embedded::EmbedsMany::Proxy (class)"><code>EmbedsMany::Proxy</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../../Positional.html" title="Mongoid::Positional (module)"><code>::Mongoid::Positional</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L10'>lib/mongoid/association/embedded/batchable.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Contains behavior for executing operations in batch on embedded documents.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#insertable%3F-instance_method" title="#insertable? (instance method)">#<strong>insertable?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Are we in a state to be able to batch insert?</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw priv nodoc'>
      <a href="#inserts_valid-instance_method" title="#inserts_valid (instance method)">#<strong>inserts_valid</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Are the inserts currently valid?</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw priv nodoc'>
      <a href="#inserts_valid=-instance_method" title="#inserts_valid= (instance method)">#<strong>inserts_valid=</strong>(value)  &#x21d2; true | false </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the inserts valid flag.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw priv nodoc'>
      <a href="#path-instance_method" title="#path (instance method)">#<strong>path</strong>  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the atomic path.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw priv nodoc'>
      <a href="#path=-instance_method" title="#path= (instance method)">#<strong>path=</strong>(value)  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the atomic path.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#batch_clear-instance_method" title="#batch_clear (instance method)">#<strong>batch_clear</strong>(docs)  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Clear all of the docs out of the association in a single swipe.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#batch_insert-instance_method" title="#batch_insert (instance method)">#<strong>batch_insert</strong>(docs)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Insert new documents as a batch push ($push with $each).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#batch_remove-instance_method" title="#batch_remove (instance method)">#<strong>batch_remove</strong>(docs, method = :delete)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Batch remove the provided documents as a $pullAll or $pull.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#batch_replace-instance_method" title="#batch_replace (instance method)">#<strong>batch_replace</strong>(docs)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Batch replace the provided documents as a $set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#add_atomic_sets-instance_method" title="#add_atomic_sets (instance method)">#<strong>add_atomic_sets</strong>(sets)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Add the atomic sets to the base document.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#clear_atomic_path_cache-instance_method" title="#clear_atomic_path_cache (instance method)">#<strong>clear_atomic_path_cache</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Clear the cache for path and atomic_paths.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#execute_batch_push-instance_method" title="#execute_batch_push (instance method)">#<strong>execute_batch_push</strong>(docs)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform a batch persist of the provided documents with $push and $each.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#execute_batch_set-instance_method" title="#execute_batch_set (instance method)">#<strong>execute_batch_set</strong>(docs)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform a batch persist of the provided documents with a $set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#normalize_docs-instance_method" title="#normalize_docs (instance method)">#<strong>normalize_docs</strong>(docs)  &#x21d2; Array&lt;Document&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Normalize the documents, in case they were provided as an array of hashes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#post_process_batch_insert-instance_method" title="#post_process_batch_insert (instance method)">#<strong>post_process_batch_insert</strong>(docs)  &#x21d2; Enumerable </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Post process the documents after batch insert.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#post_process_batch_remove-instance_method" title="#post_process_batch_remove (instance method)">#<strong>post_process_batch_remove</strong>(docs, method)  &#x21d2; Array&lt;Document&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Post process the batch removal.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#pre_process_batch_insert-instance_method" title="#pre_process_batch_insert (instance method)">#<strong>pre_process_batch_insert</strong>(docs)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Pre processes the batch insert for the provided documents.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#pre_process_batch_remove-instance_method" title="#pre_process_batch_remove (instance method)">#<strong>pre_process_batch_remove</strong>(docs, method)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Pre process the batch removal.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#selector-instance_method" title="#selector (instance method)">#<strong>selector</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the selector for executing atomic operations on the collection.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../../Positional.html" title="Mongoid::Positional (module)"><code>::Mongoid::Positional</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Positional.html#positionally-instance_method" title="Mongoid::Positional#positionally (method)">#positionally</a></td>
      <td><div class='inline'><p>Takes the provided selector and atomic operations and replaces the indexes of the embedded documents with the positional operator when needed.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../../Positional.html#process_operations-instance_method" title="Mongoid::Positional#process_operations (method)">#process_operations</a>,
        <a class='i_m priv' href="../../Positional.html#process_updates-instance_method" title="Mongoid::Positional#process_updates (method)">#process_updates</a>,
        <a class='i_m priv' href="../../Positional.html#replace_index-instance_method" title="Mongoid::Positional#replace_index (method)">#replace_index</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="insertable?-instance_method">
  <h3 class='signature ro priv  nodoc first'>
    #<strong>insertable?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Are we in a state to be able to batch insert?</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Can inserts be performed?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_insertable?'>insertable?</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If inserts can be performed.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L199-L201'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='199' data-end='201'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 199</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insertable?'>insertable?</span>
  <span class='id identifier rubyid_persistable?'>persistable?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid__assigning?'>_assigning?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_inserts_valid'><a href="#inserts_valid-instance_method" title="Mongoid::Association::Embedded::Batchable#inserts_valid (method)">inserts_valid</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inserts_valid-instance_method">
  <h3 class='signature rw priv  nodoc'>
    #<strong>inserts_valid</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='rw'>rw</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Are the inserts currently valid?</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Are the inserts currently valid.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_inserts_valid'>inserts_valid</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If inserts are currently valid.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L211-L213'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='213'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inserts_valid'>inserts_valid</span>
  <span class='ivar'>@inserts_valid</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inserts_valid=-instance_method">
  <h3 class='signature rw priv  nodoc'>
    #<strong>inserts_valid=</strong>(value)  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='rw'>rw</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the inserts valid flag.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the flag.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_inserts_valid'><a href="#inserts_valid-instance_method" title="Mongoid::Association::Embedded::Batchable#inserts_valid (method)">inserts_valid</a></span> <span class='op'>=</span> <span class='kw'>true</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>The flag.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>The flag.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L225-L227'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='225' data-end='227'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 225</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inserts_valid='>inserts_valid=</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='ivar'>@inserts_valid</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="path-instance_method">
  <h3 class='signature rw priv  nodoc'>
    #<strong>path</strong>  &#x21d2; <a href="../../../String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the atomic path.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the atomic path.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_path'>path</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The atomic path.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L260-L266'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='260' data-end='266'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_path'>path</span>
  <span class='ivar'>@path</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid__unscoped'>_unscoped</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'><a href="../../../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="../../Atomic.html" title="Mongoid::Atomic (module)">Atomic</a></span><span class='op'>::</span><span class='const'><a href="../../Atomic/Paths.html" title="Mongoid::Atomic::Paths (module)">Paths</a></span><span class='op'>::</span><span class='const'><a href="../../Atomic/Paths/Embedded.html" title="Mongoid::Atomic::Paths::Embedded (module)">Embedded</a></span><span class='op'>::</span><span class='const'><a href="../../Atomic/Paths/Embedded/Many.html" title="Mongoid::Atomic::Paths::Embedded::Many (class)">Many</a></span>.<span class='id identifier rubyid_position_without_document'><a href="../../Atomic/Paths/Embedded/Many.html#position_without_document-class_method" title="Mongoid::Atomic::Paths::Embedded::Many.position_without_document (method)">position_without_document</a></span>(<span class='id identifier rubyid__base'>_base</span><span class='comma'>,</span> <span class='id identifier rubyid__association'><a href="../../Association.html#_association-instance_method" title="Mongoid::Association#_association (method)">_association</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid__unscoped'>_unscoped</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_atomic_path'>atomic_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="path=-instance_method">
  <h3 class='signature rw priv  nodoc'>
    #<strong>path=</strong>(value)  &#x21d2; <a href="../../../String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the atomic path.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../../Set.html" title="Set (class)"><code>::Set</code></a> the atomic path.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addresses</span><span class='tstring_end'>&quot;</span></span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The path.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The path.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L289-L291'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='289' data-end='291'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 289</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_path='>path=</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='ivar'>@path</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="add_atomic_sets-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>add_atomic_sets</strong>(sets)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add the atomic sets to the base document.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Add the atomic sets.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_add_atomic_sets'>add_atomic_sets</span>([{ <span class='label'>field:</span> <span class='id identifier rubyid_value'>value</span> }])</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>sets</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The atomic sets.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L135-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_atomic_sets'>add_atomic_sets</span>(<span class='id identifier rubyid_sets'>sets</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid__assigning?'>_assigning?</span>
    <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_delayed_atomic_sets'>delayed_atomic_sets</span>[<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>].<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_clear'>clear</span>)
    <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_collect_children'>collect_children</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
      <span class='id identifier rubyid_child'>child</span>.<span class='id identifier rubyid_delayed_atomic_sets'>delayed_atomic_sets</span>.<span class='id identifier rubyid_clear'>clear</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_delayed_atomic_sets'>delayed_atomic_sets</span>[<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_sets'>sets</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="batch_clear-instance_method">
  <h3 class='signature '>
    #<strong>batch_clear</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clear all of the docs out of the association in a single swipe.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Clear all docs.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_batch_clear'>batch_clear</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to clear.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>)</span>
&mdash;    <div class='inline'>
<p>The empty array.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L35-L50'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='35' data-end='50'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 35</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_clear'>batch_clear</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='id identifier rubyid_pre_process_batch_remove'><a href="#pre_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#pre_process_batch_remove (method)">pre_process_batch_remove</a></span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
      <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$unset</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> <span class='kw'>true</span> })<span class='comma'>,</span>
      <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
    )
    <span class='comment'># This solves the case in which a user sets, clears and resets an
</span>    <span class='comment'># embedded document. Previously, since the embedded document was
</span>    <span class='comment'># already marked not a &quot;new_record&quot;, it wouldn&#39;t be persisted to
</span>    <span class='comment'># the second time. This change fixes that and allows it to be persisted.
</span>    <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_new_record'>new_record</span> <span class='op'>=</span> <span class='kw'>true</span> }
    <span class='id identifier rubyid_post_process_batch_remove'><a href="#post_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_remove (method)">post_process_batch_remove</a></span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid__unscoped'>_unscoped</span>.<span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="batch_insert-instance_method">
  <h3 class='signature '>
    #<strong>batch_insert</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Insert new documents as a batch push ($push with $each). This ensures that all callbacks are run at the appropriate time and only 1 request is made to the database.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute the batch push.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_batch_insert'>batch_insert</span>([ <span class='id identifier rubyid_doc_one'>doc_one</span><span class='comma'>,</span> <span class='id identifier rubyid_doc_two'>doc_two</span> ])</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to add.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The inserts.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L23-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='23' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 23</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_insert'>batch_insert</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='id identifier rubyid_execute_batch_push'><a href="#execute_batch_push-instance_method" title="Mongoid::Association::Embedded::Batchable#execute_batch_push (method)">execute_batch_push</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="batch_remove-instance_method">
  <h3 class='signature '>
    #<strong>batch_remove</strong>(docs, method = :delete)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Batch remove the provided documents as a $pullAll or $pull.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Batch remove the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_batch_remove'>batch_remove</span>([ <span class='id identifier rubyid_doc_one'>doc_one</span><span class='comma'>,</span> <span class='id identifier rubyid_doc_two'>doc_two</span> ])</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to remove.</p>
</div>
  </li>
  <li>
    <span class='name'>method</span>
    <span class='type'>(<a href="../../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
    <em class='default'>(defaults to: <tt>:delete</tt>)</em>
&mdash;    <div class='inline'>
<p>Delete or destroy.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L59-L92'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='59' data-end='92'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 59</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_remove'>batch_remove</span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
  <span class='comment'># If the _id is nil, we cannot use $pull and delete by searching for
</span>  <span class='comment'># the id. Therefore we have to use pullAll with the documents&#39;
</span>  <span class='comment'># attributes.
</span>  <span class='id identifier rubyid_removals'>removals</span> <span class='op'>=</span> <span class='id identifier rubyid_pre_process_batch_remove'><a href="#pre_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#pre_process_batch_remove (method)">pre_process_batch_remove</a></span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_pulls'>pulls</span><span class='comma'>,</span> <span class='id identifier rubyid_pull_alls'>pull_alls</span> <span class='op'>=</span> <span class='id identifier rubyid_removals'>removals</span>.<span class='id identifier rubyid_partition'>partition</span> { <span class='op'>|</span><span class='id identifier rubyid_o'>o</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_o'>o</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_nil?'>nil?</span> }

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_persisted?'>persisted?</span>
    <span class='id identifier rubyid_post_process_batch_remove'><a href="#post_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_remove (method)">post_process_batch_remove</a></span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_reindex'>reindex</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pulls'>pulls</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
        <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pull</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$in</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pulls'>pulls</span>.<span class='id identifier rubyid_pluck'>pluck</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span>) } } })<span class='comma'>,</span>
        <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
      )
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pull_alls'>pull_alls</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
        <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pullAll</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pull_alls'>pull_alls</span> })<span class='comma'>,</span>
        <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
      )
    <span class='kw'>end</span>
    <span class='id identifier rubyid_post_process_batch_remove'><a href="#post_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_remove (method)">post_process_batch_remove</a></span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
      <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> [] })<span class='comma'>,</span>
      <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
    )
  <span class='kw'>end</span>
  <span class='id identifier rubyid_reindex'>reindex</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="batch_replace-instance_method">
  <h3 class='signature '>
    #<strong>batch_replace</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Batch replace the provided documents as a $set.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Batch replace the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_batch_replace'>batch_replace</span>([ <span class='id identifier rubyid_doc_one'>doc_one</span><span class='comma'>,</span> <span class='id identifier rubyid_doc_two'>doc_two</span> ])</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to replace with.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The inserts.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L102-L123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_replace'>batch_replace</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid__assigning?'>_assigning?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_delayed_atomic_sets'>delayed_atomic_sets</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>)
      <span class='id identifier rubyid_clear_atomic_path_cache'><a href="#clear_atomic_path_cache-instance_method" title="Mongoid::Association::Embedded::Batchable#clear_atomic_path_cache (method)">clear_atomic_path_cache</a></span>
      <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_add_atomic_unset'>add_atomic_unset</span>(<span class='id identifier rubyid_first'>first</span>)
      <span class='id identifier rubyid_target_duplicate'>target_duplicate</span> <span class='op'>=</span> <span class='id identifier rubyid__target'>_target</span>.<span class='id identifier rubyid_dup'>dup</span>
      <span class='id identifier rubyid_pre_process_batch_remove'><a href="#pre_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#pre_process_batch_remove (method)">pre_process_batch_remove</a></span>(<span class='id identifier rubyid_target_duplicate'>target_duplicate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
      <span class='id identifier rubyid_post_process_batch_remove'><a href="#post_process_batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_remove (method)">post_process_batch_remove</a></span>(<span class='id identifier rubyid_target_duplicate'>target_duplicate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_batch_remove'><a href="#batch_remove-instance_method" title="Mongoid::Association::Embedded::Batchable#batch_remove (method)">batch_remove</a></span>(<span class='id identifier rubyid__target'>_target</span>.<span class='id identifier rubyid_dup'>dup</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid__target'>_target</span> <span class='op'>!=</span> <span class='id identifier rubyid_docs'>docs</span>
    <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_delayed_atomic_sets'>delayed_atomic_sets</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid__assigning?'>_assigning?</span>
    <span class='id identifier rubyid_docs'>docs</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_docs'><a href="#normalize_docs-instance_method" title="Mongoid::Association::Embedded::Batchable#normalize_docs (method)">normalize_docs</a></span>(<span class='id identifier rubyid_docs'>docs</span>).<span class='id identifier rubyid_compact'>compact</span>
    <span class='id identifier rubyid__target'>_target</span>.<span class='id identifier rubyid_clear'>clear</span> <span class='kw'>and</span> <span class='id identifier rubyid__unscoped'>_unscoped</span>.<span class='id identifier rubyid_clear'>clear</span>
    <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_delayed_atomic_unsets'>delayed_atomic_unsets</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>)
    <span class='id identifier rubyid_clear_atomic_path_cache'><a href="#clear_atomic_path_cache-instance_method" title="Mongoid::Association::Embedded::Batchable#clear_atomic_path_cache (method)">clear_atomic_path_cache</a></span>
    <span class='id identifier rubyid_inserts'>inserts</span> <span class='op'>=</span> <span class='id identifier rubyid_execute_batch_set'><a href="#execute_batch_set-instance_method" title="Mongoid::Association::Embedded::Batchable#execute_batch_set (method)">execute_batch_set</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
    <span class='id identifier rubyid_add_atomic_sets'><a href="#add_atomic_sets-instance_method" title="Mongoid::Association::Embedded::Batchable#add_atomic_sets (method)">add_atomic_sets</a></span>(<span class='id identifier rubyid_inserts'>inserts</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear_atomic_path_cache-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>clear_atomic_path_cache</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clear the cache for path and atomic_paths. This method is used when the path method is used, and the association has not been set on the document yet, which can cause path and atomic_paths to be calculated incorrectly later.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L274-L277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='274' data-end='277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 274</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_atomic_path_cache'>clear_atomic_path_cache</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@atomic_paths</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute_batch_push-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>execute_batch_push</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Perform a batch persist of the provided documents with $push and $each.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Perform a batch push.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_execute_batch_push'>execute_batch_push</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to persist.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The inserts.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L178-L189'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='178' data-end='189'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 178</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_batch_push'>execute_batch_push</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inserts_valid'><a href="#inserts_valid-instance_method" title="Mongoid::Association::Embedded::Batchable#inserts_valid (method)">inserts_valid</a></span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_pushes'>pushes</span> <span class='op'>=</span> <span class='id identifier rubyid_pre_process_batch_insert'><a href="#pre_process_batch_insert-instance_method" title="Mongoid::Association::Embedded::Batchable#pre_process_batch_insert (method)">pre_process_batch_insert</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_insertable?'><a href="#insertable%3F-instance_method" title="Mongoid::Association::Embedded::Batchable#insertable? (method)">insertable?</a></span>
    <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
        <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$push</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$each</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pushes'>pushes</span> } })<span class='comma'>,</span>
        <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
    )
    <span class='id identifier rubyid_post_process_batch_insert'><a href="#post_process_batch_insert-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_insert (method)">post_process_batch_insert</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_pushes'>pushes</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute_batch_set-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>execute_batch_set</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Perform a batch persist of the provided documents with a $set.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Perform a batch $set.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_execute_batch_set'>execute_batch_set</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to persist.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The inserts.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L155-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='155' data-end='166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 155</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_batch_set'>execute_batch_set</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inserts_valid'><a href="#inserts_valid-instance_method" title="Mongoid::Association::Embedded::Batchable#inserts_valid (method)">inserts_valid</a></span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_inserts'>inserts</span> <span class='op'>=</span> <span class='id identifier rubyid_pre_process_batch_insert'><a href="#pre_process_batch_insert-instance_method" title="Mongoid::Association::Embedded::Batchable#pre_process_batch_insert (method)">pre_process_batch_insert</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_insertable?'><a href="#insertable%3F-instance_method" title="Mongoid::Association::Embedded::Batchable#insertable? (method)">insertable?</a></span>
    <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span>).<span class='id identifier rubyid_update_one'>update_one</span>(
        <span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'><a href="#selector-instance_method" title="Mongoid::Association::Embedded::Batchable#selector (method)">selector</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> { <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_inserts'>inserts</span> })<span class='comma'>,</span>
        <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>
    )
    <span class='id identifier rubyid_post_process_batch_insert'><a href="#post_process_batch_insert-instance_method" title="Mongoid::Association::Embedded::Batchable#post_process_batch_insert (method)">post_process_batch_insert</a></span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_inserts'>inserts</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="normalize_docs-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>normalize_docs</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Normalize the documents, in case they were provided as an array of hashes.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Normalize the docs.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_normalize_docs'>normalize_docs</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt; | <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs to normalize.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The docs.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L240-L250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='240' data-end='250'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 240</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_docs'>normalize_docs</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='op'>::</span><span class='const'><a href="../../../Hash.html" title="Hash (class)">Hash</a></span>)
    <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
      <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> { <span class='label'>_association:</span> <span class='id identifier rubyid__association'><a href="../../Association.html#_association-instance_method" title="Mongoid::Association#_association (method)">_association</a></span><span class='comma'>,</span> <span class='label'>_parent:</span> <span class='id identifier rubyid__base'>_base</span> }
      <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='id identifier rubyid_doc'>doc</span>)
      <span class='const'><a href="../../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_build'><a href="../../Factory.html#build-instance_method" title="Mongoid::Factory#build (method)">build</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_docs'>docs</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post_process_batch_insert-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>post_process_batch_insert</strong>(docs)  &#x21d2; <code>Enumerable</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Post process the documents after batch insert.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Post process the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_post_process_batch_insert'>post_process_batch_insert</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<code>Documents</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The inserted docs.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Enumerable</code>)</span>
&mdash;    <div class='inline'>
<p>The document enum.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L368-L374'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='368' data-end='374'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 368</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_post_process_batch_insert'>post_process_batch_insert</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_new_record'>new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_run_after_callbacks'>run_after_callbacks</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_save'>save</span>)
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_post_persist'>post_persist</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post_process_batch_remove-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>post_process_batch_remove</strong>(docs, method)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Post process the batch removal.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Post process the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_post_process_batch_remove'>post_process_batch_remove</span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents.</p>
</div>
  </li>
  <li>
    <span class='name'>method</span>
    <span class='type'>(<a href="../../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>Delete or destroy.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L387-L393'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='387' data-end='393'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 387</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_post_process_batch_remove'>post_process_batch_remove</span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_run_after_callbacks'>run_after_callbacks</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>) <span class='kw'>if</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_freeze'>freeze</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_destroyed'>destroyed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pre_process_batch_insert-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>pre_process_batch_insert</strong>(docs)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pre processes the batch insert for the provided documents.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Pre process the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_pre_process_batch_insert'>pre_process_batch_insert</span>(<span class='id identifier rubyid_docs'>docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents as an array of hashes.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L315-L329'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='315' data-end='329'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 315</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pre_process_batch_insert'>pre_process_batch_insert</span>(<span class='id identifier rubyid_docs'>docs</span>)
  <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_doc'>doc</span>
    <span class='id identifier rubyid_append'>append</span>(<span class='id identifier rubyid_doc'>doc</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_persistable?'>persistable?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid__assigning?'>_assigning?</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_atomic_path'>atomic_path</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_valid?'>valid?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span>)
        <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_run_before_callbacks'>run_before_callbacks</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_save'>save</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span>)
      <span class='kw'>else</span>
        <span class='kw'>self</span>.<span class='id identifier rubyid_inserts_valid'><a href="#inserts_valid-instance_method" title="Mongoid::Association::Embedded::Batchable#inserts_valid (method)">inserts_valid</a></span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as_attributes'>as_attributes</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pre_process_batch_remove-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>pre_process_batch_remove</strong>(docs, method)  &#x21d2; <a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pre process the batch removal.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Pre process the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_pre_process_batch_remove'>pre_process_batch_remove</span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents.</p>
</div>
  </li>
  <li>
    <span class='name'>method</span>
    <span class='type'>(<a href="../../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>Delete or destroy.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The documents as hashes.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L342-L356'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='342' data-end='356'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 342</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pre_process_batch_remove'>pre_process_batch_remove</span>(<span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_docs'>docs</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_atomic_path'>atomic_path</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Mongoid::Association::Embedded::Batchable#path (method)">path</a></span>
    <span class='id identifier rubyid_execute_callback'>execute_callback</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_remove'>before_remove</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid__assigning?'>_assigning?</span>
      <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_apply_destroy_dependencies!'>apply_destroy_dependencies!</span>
      <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_run_before_callbacks'>run_before_callbacks</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>) <span class='kw'>if</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid__target'>_target</span>.<span class='id identifier rubyid_delete_one'>delete_one</span>(<span class='id identifier rubyid_doc'>doc</span>)
    <span class='id identifier rubyid__unscoped'>_unscoped</span>.<span class='id identifier rubyid_delete_one'>delete_one</span>(<span class='id identifier rubyid_doc'>doc</span>)
    <span class='id identifier rubyid_unbind_one'>unbind_one</span>(<span class='id identifier rubyid_doc'>doc</span>)
    <span class='id identifier rubyid_execute_callback'>execute_callback</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_remove'>after_remove</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span>
    <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as_attributes'>as_attributes</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="selector-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>selector</strong>  &#x21d2; <a href="../../../Hash.html" title="Hash (class)">Hash</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the selector for executing atomic operations on the collection.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the selector.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_batchable'>batchable</span>.<span class='id identifier rubyid_selector'>selector</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The atomic selector.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/embedded/batchable.rb#L301-L303'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='301' data-end='303'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/embedded/batchable.rb', line 301</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_selector'>selector</span>
  <span class='ivar'>@selector</span> <span class='op'>||=</span> <span class='id identifier rubyid__base'>_base</span>.<span class='id identifier rubyid_atomic_selector'>atomic_selector</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>