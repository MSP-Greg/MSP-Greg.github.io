<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Mongoid::Association::Accessors &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Association::Accessors",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongoid master</a> &raquo; 
      <a href='../../_index.html#alpha_A'>Index (A)</a> &raquo; 
        <a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
        <a href="../Association.html" title="Mongoid::Association (module)">Association</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Accessors&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Mongoid::Association::Accessors</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="../Association.html" title="Mongoid::Association (module)"><code>::Mongoid::Association</code></a>,
          <a href="../Composable.html" title="Mongoid::Composable (module)"><code>::Mongoid::Composable</code></a>,
          <a href="../Document.html" title="Mongoid::Document (module)"><code>::Mongoid::Document</code></a>,
          <a href="../GlobalDiscriminatorKeyAssignment/InvalidFieldHost.html" title="Mongoid::GlobalDiscriminatorKeyAssignment::InvalidFieldHost (class)"><code>::Mongoid::GlobalDiscriminatorKeyAssignment::InvalidFieldHost</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          ActiveSupport::Concern
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L10'>lib/mongoid/association/accessors.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This module contains all the behavior related to accessing associations through the getters and setters, and how to delegate to builders to create new ones.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_builder!-class_method" title=".define_builder! (class method)">.<strong>define_builder!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines a builder method for an embeds_one association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_creator!-class_method" title=".define_creator! (class method)">.<strong>define_creator!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines a creator method for an embeds_one association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_existence_check!-class_method" title=".define_existence_check! (class method)">.<strong>define_existence_check!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Adds the existence check for associations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_getter!-class_method" title=".define_getter! (class method)">.<strong>define_getter!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines the getter for the association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_ids_getter!-class_method" title=".define_ids_getter! (class method)">.<strong>define_ids_getter!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines the getter for the ids of documents in the association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_ids_setter!-class_method" title=".define_ids_setter! (class method)">.<strong>define_ids_setter!</strong>(association)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines the setter method that allows you to set documents in this association by their ids.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#define_setter!-class_method" title=".define_setter! (class method)">.<strong>define_setter!</strong>(association)  &#x21d2; Class </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines the setter for the association.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#without_autobuild%3F-instance_method" title="#without_autobuild? (instance method)">#<strong>without_autobuild?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is the current code executing without autobuild functionality?</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#__build__-instance_method" title="#__build__ (instance method)">#<strong>__build__</strong>(name, object, association, selected_fields = nil)  &#x21d2; Proxy </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Builds the related document and creates the association unless the document is nil, then sets the association on this document.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_relation-instance_method" title="#create_relation (instance method)">#<strong>create_relation</strong>(object, association, selected_fields = nil)  &#x21d2; Proxy </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Create an association from an object and association metadata.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset_relation_criteria-instance_method" title="#reset_relation_criteria (instance method)">#<strong>reset_relation_criteria</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Resets the criteria inside the association proxy.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_relation-instance_method" title="#set_relation (instance method)">#<strong>set_relation</strong>(name, relation)  &#x21d2; Proxy </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> the supplied association to an instance variable on the class with the provided name.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_filter_selected_fields-instance_method" title="#_mongoid_filter_selected_fields (instance method)">#<strong>_mongoid_filter_selected_fields</strong>(assoc_key)  &#x21d2; Hash | nil </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a subset of __selected_fields attribute applicable to the (embedded) association with the given key, or nil if no projection is to be performed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#get_relation-instance_method" title="#get_relation (instance method)">#<strong>get_relation</strong>(name, association, object, reload = false)  &#x21d2; Proxy </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#needs_no_database_query%3F-instance_method" title="#needs_no_database_query? (instance method)">#<strong>needs_no_database_query?</strong>(object, association)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#parse_args-instance_method" title="#parse_args (instance method)">#<strong>parse_args</strong>(*args)  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Parse out the attributes and the options from the args passed to a build_ or create_ methods.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#without_autobuild-instance_method" title="#without_autobuild (instance method)">#<strong>without_autobuild</strong>  &#x21d2; Object </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Yield to the block with autobuild functionality turned off.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="define_builder!-class_method">
  <h3 class='signature priv first'>
    .<strong>define_builder!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines a builder method for an embeds_one association. This is defined as #build_name.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_builder!'>define_builder!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association for the association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The class being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L389-L402'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='389' data-end='402'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_builder!'>define_builder!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>build_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
      <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid__options'>_options</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_args'><a href="#parse_args-instance_method" title="Mongoid::Association::Accessors#parse_args (method)">parse_args</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
      <span class='id identifier rubyid_document'>document</span> <span class='op'>=</span> <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_build'><a href="../Factory.html#build-instance_method" title="Mongoid::Factory#build (method)">build</a></span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_relation_class'>relation_class</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
      <span class='id identifier rubyid__building'>_building</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_child'>child</span> <span class='op'>=</span> <span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_document'>document</span>)
        <span class='id identifier rubyid_child'>child</span>.<span class='id identifier rubyid_run_callbacks'>run_callbacks</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_build'>build</span>)
        <span class='id identifier rubyid_child'>child</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_creator!-class_method">
  <h3 class='signature priv'>
    .<strong>define_creator!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines a creator method for an embeds_one association. This is defined as #create_name. After the object is built it will immediately save.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_creator!'>define_creator!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association for the association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The class being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L414-L428'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='414' data-end='428'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 414</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_creator!'>define_creator!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>create_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
      <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid__options'>_options</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_args'><a href="#parse_args-instance_method" title="Mongoid::Association::Accessors#parse_args (method)">parse_args</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
      <span class='id identifier rubyid_document'>document</span> <span class='op'>=</span> <span class='const'><a href="../Factory.html" title="Mongoid::Factory (module)">Factory</a></span>.<span class='id identifier rubyid_build'><a href="../Factory.html#build-instance_method" title="Mongoid::Factory#build (method)">build</a></span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
      <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid__assigning'>_assigning</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_document'>document</span>)
      <span class='kw'>end</span>
      <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_save'>save</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_stores_foreign_key?'>stores_foreign_key?</span>
      <span class='id identifier rubyid_doc'>doc</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_existence_check!-class_method">
  <h3 class='signature priv'>
    .<strong>define_existence_check!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Adds the existence check for associations.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Add the existence check.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_existence_check!'>define_existence_check!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
        <p class='example_title'><div class='inline'>
<p>Check if an association exists.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_person'>person</span> <span class='op'>=</span> <span class='const'>Person</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_has_game?'>has_game?</span>
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_game?'>game?</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The model being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L275-L285'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='285'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_existence_check!'>define_existence_check!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_module_eval'>module_eval</span> <span class='heredoc_beg'>&lt;&lt;-END</span><span class='comma'>,</span> <span class='kw'>__FILE__</span><span class='comma'>,</span> <span class='kw'>__LINE__</span> <span class='op'>+</span> <span class='int'>1</span>
<span class='tstring_content'>        def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>?
          without_autobuild { !__send__(:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>).blank? }
        end
        alias :has_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>? :</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>?
</span><span class='heredoc_end'>    END
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_getter!-class_method">
  <h3 class='signature priv'>
    .<strong>define_getter!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines the getter for the association. Nothing too special here: just return the instance variable for the association if it exists or build the thing.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> up the getter for the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_getter!'>define_getter!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata for the association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The class being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L297-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='297' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 297</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_getter!'>define_getter!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='id identifier rubyid_name'>name</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reload'>reload</span> <span class='op'>=</span> <span class='kw'>false</span><span class='op'>|</span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_get_relation'><a href="#get_relation-instance_method" title="Mongoid::Association::Accessors#get_relation (method)">get_relation</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_reload'>reload</span>)
      <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_autobuilding?'>autobuilding?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_without_autobuild?'><a href="#without_autobuild%3F-instance_method" title="Mongoid::Association::Accessors#without_autobuild? (method)">without_autobuild?</a></span>
        <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_send'>send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>build_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>end</span>
      <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_ids_getter!-class_method">
  <h3 class='signature priv'>
    .<strong>define_ids_getter!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines the getter for the ids of documents in the association. Should be specify only for referenced many associations.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> up the ids getter for the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_ids_getter!'>define_ids_getter!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata for the association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The class being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L319-L326'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='319' data-end='326'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 319</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_ids_getter!'>define_ids_getter!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_ids_method'>ids_method</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_singularize'>singularize</span><span class='embexpr_end'>}</span><span class='tstring_content'>_ids</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='id identifier rubyid_ids_method'>ids_method</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_pluck'>pluck</span>(<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_ids_setter!-class_method">
  <h3 class='signature priv'>
    .<strong>define_ids_setter!</strong>(association)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines the setter method that allows you to set documents in this association by their ids. The defined setter, finds documents with given ids and invokes regular association setter with found documents. Ids setters should be defined only for referenced many associations.</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@param</span> [ <span class='const'><a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="../Association.html" title="Mongoid::Association (module)">Association</a></span><span class='op'>::</span><span class='const'><a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Relatable</a></span> ] <span class='id identifier rubyid_association'>association</span> <span class='const'>The</span> <span class='id identifier rubyid_association'>association</span> <span class='kw'>for</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_association'>association</span>.

<span class='ivar'>@return</span> [ <span class='const'>Class</span> ] <span class='const'>The</span> <span class='kw'>class</span> <span class='id identifier rubyid_being'>being</span> <span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_up'>up</span>.</code></pre>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> up the id_setter for the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_ids_setter!'>define_ids_setter!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L370-L378'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='370' data-end='378'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 370</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_ids_setter!'>define_ids_setter!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_ids_method'>ids_method</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_singularize'>singularize</span><span class='embexpr_end'>}</span><span class='tstring_content'>_ids=</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_aliased_associations'><a href="../Association.html#aliased_associations-class_method" title="Mongoid::Association.aliased_associations (method)">aliased_associations</a></span>[<span class='id identifier rubyid_ids_method'>ids_method</span>.<span class='id identifier rubyid_chop'>chop</span>] <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='id identifier rubyid_ids_method'>ids_method</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ids'>ids</span><span class='op'>|</span>
      <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_setter'>setter</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_relation_class'>relation_class</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_reject'>reject</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_blank?'>blank?</span>)))
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="define_setter!-class_method">
  <h3 class='signature priv'>
    .<strong>define_setter!</strong>(association)  &#x21d2; <code>Class</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines the setter for the association. This does a few things based on some conditions. If there is an existing association, a target substitution will take place, otherwise a new association will be created with the supplied target.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> up the setter for the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_define_setter!'>define_setter!</span>(<span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata for the association.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Class</code>)</span>
&mdash;    <div class='inline'>
<p>The class being set up.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L339-L356'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='339' data-end='356'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 339</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_define_setter!'>define_setter!</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_class'>inverse_class</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_re_define_method'>re_define_method</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='op'>|</span>
      <span class='id identifier rubyid_without_autobuild'><a href="#without_autobuild-instance_method" title="Mongoid::Association::Accessors#without_autobuild (method)">without_autobuild</a></span> <span class='kw'>do</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_get_relation'><a href="#get_relation-instance_method" title="Mongoid::Association::Accessors#get_relation (method)">get_relation</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span>)
          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_substitute'>substitute</span>)
            <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid___build__'><a href="#__build__-instance_method" title="Mongoid::Association::Accessors#__build__ (method)">__build__</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>) 
          <span class='kw'>end</span>

          <span class='id identifier rubyid_set_relation'><a href="#set_relation-instance_method" title="Mongoid::Association::Accessors#set_relation (method)">set_relation</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_substitute'>substitute</span>(<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_substitutable'>substitutable</span>))
        <span class='kw'>else</span>
          <span class='id identifier rubyid___build__'><a href="#__build__-instance_method" title="Mongoid::Association::Accessors#__build__ (method)">__build__</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_substitutable'>substitutable</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="without_autobuild?-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>without_autobuild?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is the current code executing without autobuild functionality?</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Is autobuild disabled?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_without_autobuild?'>without_autobuild?</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If autobuild is disabled.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L230-L232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='230' data-end='232'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 230</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_without_autobuild?'>without_autobuild?</span>
  <span class='const'><a href="../Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_executing?'><a href="../Threaded.html#executing%3F-instance_method" title="Mongoid::Threaded#executing? (method)">executing?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_without_autobuild'><a href="#without_autobuild-instance_method" title="Mongoid::Association::Accessors#without_autobuild (method)">without_autobuild</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="__build__-instance_method">
  <h3 class='signature  first'>
    #<strong>__build__</strong>(name, object, association, selected_fields = nil)  &#x21d2; <a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Builds the related document and creates the association unless the document is nil, then sets the association on this document.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Build the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid___build__'>__build__</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> { <span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=&gt;</span> <span class='int'>1</span> }<span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the association.</p>
</div>
  </li>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a> | <a href="../../BSON/ObjectId.html" title="BSON::ObjectId (class)">BSON::ObjectId</a>)</span>
&mdash;    <div class='inline'>
<p>The id or attributes to use.</p>
</div>
  </li>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata.</p>
</div>
  </li>
  <li>
    <span class='name'>selected_fields</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p><a href="../Fields.html" title="Mongoid::Fields (module)"><code>::Mongoid::Fields</code></a> which were retrieved via #only. If selected_fields is specified, fields not listed in it will not be accessible in the built document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>)</span>
&mdash;    <div class='inline'>
<p>The association.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L27-L30'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='27' data-end='30'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 27</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid___build__'>__build__</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_selected_fields'>selected_fields</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_relation'>relation</span> <span class='op'>=</span> <span class='id identifier rubyid_create_relation'><a href="#create_relation-instance_method" title="Mongoid::Association::Accessors#create_relation (method)">create_relation</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_selected_fields'>selected_fields</span>)
  <span class='id identifier rubyid_set_relation'><a href="#set_relation-instance_method" title="Mongoid::Association::Accessors#set_relation (method)">set_relation</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_relation'>relation</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_mongoid_filter_selected_fields-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>_mongoid_filter_selected_fields</strong>(assoc_key)  &#x21d2; <a href="../../Hash.html" title="Hash (class)">Hash</a> | <code>nil</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a subset of __selected_fields attribute applicable to the (embedded) association with the given key, or nil if no projection is to be performed.</p>

<p>Also returns nil if exclusionary projection was requested but it does not exclude the field of the association.</p>

<p>For example, if __selected_fields is <code>=&gt; 1, ‘b.c’ =&gt; 2, ‘b.c.f’ =&gt; 3</code>, and assoc_key is ‘b’, return value would be <code>=&gt; 2, ‘c.f’ =&gt; 3</code>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>assoc_key</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L153-L217'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='153' data-end='217'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 153</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_filter_selected_fields'>_mongoid_filter_selected_fields</span>(<span class='id identifier rubyid_assoc_key'>assoc_key</span>)
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid___selected_fields'>__selected_fields</span>

  <span class='comment'># If the list of fields was specified using #without instead of #only
</span>  <span class='comment'># and the provided list does not include the association, any of its
</span>  <span class='comment'># fields should be allowed.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid___selected_fields'>__selected_fields</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_all?'>all?</span> { <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>==</span> <span class='int'>0</span> } <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid___selected_fields'>__selected_fields</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_none?'>none?</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>2</span>).<span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_assoc_key'>assoc_key</span> }
  <span class='kw'>then</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_projecting_assoc'>projecting_assoc</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id identifier rubyid_filtered'>filtered</span> <span class='op'>=</span> {}
  <span class='id identifier rubyid___selected_fields'>__selected_fields</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_bits'>bits</span> <span class='op'>=</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)

    <span class='comment'># If we are asked to project an association, we need all of that
</span>    <span class='comment'># association&#39;s fields. However, we may be asked to project
</span>    <span class='comment'># an association *and* its fields in the same query. In this case
</span>    <span class='comment'># behavior differs according to server version:
</span>    <span class='comment'>#
</span>    <span class='comment'># 4.2 and lower take the most recent projection specification, meaning
</span>    <span class='comment'># projecting foo followed by foo.bar effectively projects foo.bar and
</span>    <span class='comment'># projecting foo.bar followed by foo effectively projects foo.
</span>    <span class='comment'># To match this behavior we need to track when we are being asked
</span>    <span class='comment'># to project the association and when we are asked to project a field,
</span>    <span class='comment'># and if we are asked to project the association last we need to
</span>    <span class='comment'># remove any field projections.
</span>    <span class='comment'>#
</span>    <span class='comment'># 4.4 (and presumably higher) do not allow projection to be on an
</span>    <span class='comment'># association and its field, so it doesn&#39;t matter what we do. Hence
</span>    <span class='comment'># we just need to handle the 4.2 and lower case correctly.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span>.<span class='id identifier rubyid_first'>first</span> <span class='op'>==</span> <span class='id identifier rubyid_assoc_key'>assoc_key</span>
      <span class='comment'># Projecting the entire association OR some of its fields
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_bits'>bits</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='comment'># Projecting a field
</span>        <span class='id identifier rubyid_bits'>bits</span>.<span class='id identifier rubyid_shift'>shift</span>
        <span class='id identifier rubyid_filtered'>filtered</span>[<span class='id identifier rubyid_bits'>bits</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
        <span class='id identifier rubyid_projecting_assoc'>projecting_assoc</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>else</span>
        <span class='comment'># Projecting the entire association
</span>        <span class='id identifier rubyid_projecting_assoc'>projecting_assoc</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_projecting_assoc'>projecting_assoc</span>
    <span class='comment'># The last projection was of the entire association; we may have
</span>    <span class='comment'># also been projecting fields, but discard the field projections
</span>    <span class='comment'># and return nil indicating we want the entire association.
</span>    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># Positional projection is specified as &quot;foo.$&quot;. In this case the
</span>  <span class='comment'># document that the $ is referring to should be retrieved with all
</span>  <span class='comment'># fields. See https://www.mongodb.com/docs/manual/reference/operator/projection/positional/
</span>  <span class='comment'># and https://jira.mongodb.org/browse/MONGOID-4769.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_filtered'>filtered</span>.<span class='id identifier rubyid_keys'>keys</span> <span class='op'>==</span> <span class='qwords'><span class='qwords_beg'>%w(</span><span class='tstring_content'>$</span><span class='tstring_end'>)</span></span>
    <span class='id identifier rubyid_filtered'>filtered</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_filtered'>filtered</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_relation-instance_method">
  <h3 class='signature '>
    #<strong>create_relation</strong>(object, association, selected_fields = nil)  &#x21d2; <a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create an association from an object and association metadata.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_create_relation'>create_relation</span>(<span class='id identifier rubyid_document'>document</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<a href="../Document.html" title="Mongoid::Document (module)">Document</a> | <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The association target.</p>
</div>
  </li>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata.</p>
</div>
  </li>
  <li>
    <span class='name'>selected_fields</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p><a href="../Fields.html" title="Mongoid::Fields (module)"><code>::Mongoid::Fields</code></a> which were retrieved via #only. If selected_fields is specified, fields not listed in it will not be accessible in the created association document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>)</span>
&mdash;    <div class='inline'>
<p>The association.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L44-L63'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='44' data-end='63'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 44</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_relation'>create_relation</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_selected_fields'>selected_fields</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='ivar'>@attributes</span>[<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_inverse_type'>inverse_type</span>]
  <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_build'>build</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_selected_fields'>selected_fields</span>)
    <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_create_relation'>create_relation</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>)
  <span class='kw'>else</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># Only need to do this on embedded associations. The pending callbacks
</span>  <span class='comment'># are only added when materializing the documents, which only happens
</span>  <span class='comment'># on embedded associations. There is no call to the database in the
</span>  <span class='comment'># construction of a referenced association.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_embedded?'><a href="../Association.html#embedded%3F-class_method" title="Mongoid::Association.embedded? (method)">embedded?</a></span>
    <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_target'>target</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
      <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_run_pending_callbacks'>run_pending_callbacks</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_target'>target</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_relation-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>get_relation</strong>(name, association, object, reload = false)  &#x21d2; <a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the association. Extracted out from the getter method to avoid infinite recursion when overriding the getter.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_get_relation'>get_relation</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the association.</p>
</div>
  </li>
  <li>
    <span class='name'>association</span>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association metadata.</p>
</div>
  </li>
  <li>
    <span class='name'>object</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The object used to build the association.</p>
</div>
  </li>
  <li>
    <span class='name'>reload</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
    <em class='default'>(defaults to: <tt>false</tt>)</em>
&mdash;    <div class='inline'>
<p>If the association is to be reloaded.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>)</span>
&mdash;    <div class='inline'>
<p>The association.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L108-L136'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='108' data-end='136'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 108</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_relation'>get_relation</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_reload'>reload</span> <span class='op'>=</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_field_name'>field_name</span> <span class='op'>=</span> <span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_name'>name</span>)

  <span class='comment'># As per the comments under MONGOID-5034, I&#39;ve decided to only raise on
</span>  <span class='comment'># embedded associations for a missing attribute. Rails does not raise
</span>  <span class='comment'># for a missing attribute on referenced associations.
</span>  <span class='comment'># We also don&#39;t want to raise if we&#39;re retrieving an association within
</span>  <span class='comment'># the codebase. This is often done when retrieving the inverse association
</span>  <span class='comment'># during binding or when cascading callbacks. Whenever we retrieve
</span>  <span class='comment'># associations within the codebase, we use without_autobuild.
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_without_autobuild?'><a href="#without_autobuild%3F-instance_method" title="Mongoid::Association::Accessors#without_autobuild? (method)">without_autobuild?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_embedded?'><a href="../Association.html#embedded%3F-class_method" title="Mongoid::Association.embedded? (method)">embedded?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_attribute_missing?'>attribute_missing?</span>(<span class='id identifier rubyid_field_name'>field_name</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a></span><span class='op'>::</span><span class='const'><a href="../Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="../Errors/AttributeNotLoaded.html" title="Mongoid::Errors::AttributeNotLoaded (class)">AttributeNotLoaded</a></span>.<span class='id identifier rubyid_new'><a href="../Errors/AttributeNotLoaded.html#new-class_method" title="Mongoid::Errors::AttributeNotLoaded.new (method)">new</a></span>(<span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span><span class='comma'>,</span> <span class='id identifier rubyid_field_name'>field_name</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_reload'>reload</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_ivar'>ivar</span>(<span class='id identifier rubyid_name'>name</span>)) <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid__building'>_building</span> <span class='kw'>do</span>
      <span class='id identifier rubyid__loading'>_loading</span> <span class='kw'>do</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_object'>object</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_needs_no_database_query?'><a href="#needs_no_database_query%3F-instance_method" title="Mongoid::Association::Accessors#needs_no_database_query? (method)">needs_no_database_query?</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)
          <span class='id identifier rubyid___build__'><a href="#__build__-instance_method" title="Mongoid::Association::Accessors#__build__ (method)">__build__</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)
        <span class='kw'>else</span>
          <span class='id identifier rubyid_selected_fields'>selected_fields</span> <span class='op'>=</span> <span class='id identifier rubyid__mongoid_filter_selected_fields'><a href="#_mongoid_filter_selected_fields-instance_method" title="Mongoid::Association::Accessors#_mongoid_filter_selected_fields (method)">_mongoid_filter_selected_fields</a></span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_key'>key</span>)
          <span class='id identifier rubyid___build__'><a href="#__build__-instance_method" title="Mongoid::Association::Accessors#__build__ (method)">__build__</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_key'>key</span>]<span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_selected_fields'>selected_fields</span>)
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="needs_no_database_query?-instance_method">
  <h3 class='signature priv'>
    #<strong>needs_no_database_query?</strong>(object, association)  &#x21d2; <a href="../Boolean.html" title="Mongoid::Boolean (class)">Boolean</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L219-L222'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='219' data-end='222'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 219</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_needs_no_database_query?'>needs_no_database_query?</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Document.html" title="Mongoid::Document (module)">Document</a></span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_embedded?'><a href="../Association.html#embedded%3F-class_method" title="Mongoid::Association.embedded? (method)">embedded?</a></span> <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid__id'>_id</span> <span class='op'>==</span> <span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_key'>key</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="parse_args-instance_method">
  <h3 class='signature priv'>
    #<strong>parse_args</strong>(*args)  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Hash.html" title="Hash (class)">Hash</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Parse out the attributes and the options from the args passed to a build_ or create_ methods.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Parse the args.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_parse_args'>parse_args</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>*args</span>
    <span class='type'>(<a href="../../Hash.html" title="Hash (class)">Hash</a>...)</span>
&mdash;    <div class='inline'>
<p>The arguments.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The attributes and options.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L258-L260'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='258' data-end='260'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 258</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_args'>parse_args</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  [<span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_args'>args</span>[<span class='int'>1</span>] <span class='op'>:</span> {}]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset_relation_criteria-instance_method">
  <h3 class='signature '>
    #<strong>reset_relation_criteria</strong>(name)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Resets the criteria inside the association proxy. Used by many-to-many associations to keep the underlying ids array in sync.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Reset the association criteria.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_reset_relation_criteria'>reset_relation_criteria</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_preferences'>preferences</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the association.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L72-L76'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='76'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_relation_criteria'>reset_relation_criteria</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_reset_unloaded'>reset_unloaded</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_relation-instance_method">
  <h3 class='signature '>
    #<strong>set_relation</strong>(name, relation)  &#x21d2; <a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> the supplied association to an instance variable on the class with the provided name. Used as a helper just for code cleanliness.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p><a href="../../Set.html" title="Set (class)"><code>::Set</code></a> the proxy on the document.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_set'>set</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_addresses'>addresses</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<a href="../../String.html" title="String (class)">String</a> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the association.</p>
</div>
  </li>
  <li>
    <span class='name'>relation</span>
    <span class='type'>(<a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>)</span>
&mdash;    <div class='inline'>
<p>The association to set.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Proxy.html" title="Mongoid::Association::Proxy (class)">Proxy</a>)</span>
&mdash;    <div class='inline'>
<p>The association.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L88-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='88' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 88</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_relation'>set_relation</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_relation'>relation</span>)
  <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_relation'>relation</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="without_autobuild-instance_method">
  <h3 class='signature ro priv'>
    #<strong>without_autobuild</strong>  &#x21d2; <code>Object</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Yield to the block with autobuild functionality turned off.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute without autobuild.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_without_autobuild'>without_autobuild</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The result of the yield.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/accessors.rb#L242-L247'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='242' data-end='247'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/accessors.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_without_autobuild'>without_autobuild</span>
  <span class='const'><a href="../Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_begin_execution'><a href="../Threaded.html#begin_execution-instance_method" title="Mongoid::Threaded#begin_execution (method)">begin_execution</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>without_autobuild</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='const'><a href="../Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_exit_execution'><a href="../Threaded.html#exit_execution-instance_method" title="Mongoid::Threaded#exit_execution (method)">exit_execution</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>without_autobuild</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>