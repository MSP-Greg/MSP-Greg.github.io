<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongoid::Association::Eager &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Association::Eager",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongoid master</a> &raquo; 
      <a href='../../_index.html#alpha_E'>Index (E)</a> &raquo; 
        <a href="../../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
        <a href="../Association.html" title="Mongoid::Association (module)">Association</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Eager&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongoid::Association::Eager</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="Embedded/Eager.html" title="Mongoid::Association::Embedded::Eager (class)">Mongoid::Association::Embedded::Eager</a>, <a href="Referenced/BelongsTo/Eager.html" title="Mongoid::Association::Referenced::BelongsTo::Eager (class)">Referenced::BelongsTo::Eager</a>, <a href="Referenced/HasAndBelongsToMany/Eager.html" title="Mongoid::Association::Referenced::HasAndBelongsToMany::Eager (class)">Referenced::HasAndBelongsToMany::Eager</a>, <a href="Referenced/HasMany/Eager.html" title="Mongoid::Association::Referenced::HasMany::Eager (class)">Referenced::HasMany::Eager</a>, <a href="Referenced/HasOne/Eager.html" title="Mongoid::Association::Referenced::HasOne::Eager (class)">Referenced::HasOne::Eager</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L8'>lib/mongoid/association/eager.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Base class for eager load preload functions.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(associations, docs, use_lookup = false, pipeline = [])  &#x21d2; Base </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Instantiate the eager load class.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Run the preloader.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#each_loaded_document_of_class-instance_method" title="#each_loaded_document_of_class (instance method)">#<strong>each_loaded_document_of_class</strong>(cls, keys)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Retrieves the documents of the specified class, that have the foreign key included in the specified list of keys.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#prepare_criteria_for_loaded_documents-instance_method" title="#prepare_criteria_for_loaded_documents (instance method)">#<strong>prepare_criteria_for_loaded_documents</strong>(cls, keys)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Prepares the criteria to retrieve the documents of the specified class, that have the foreign key included in the specified list of keys.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#shift_association-instance_method" title="#shift_association (instance method)">#<strong>shift_association</strong>  &#x21d2; Mongoid::Association::Relatable </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Shift the current association metadata.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(associations, docs, use_lookup = false, pipeline = [])  &#x21d2; <code>Base</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Instantiate the eager load class.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create the new belongs to eager load preloader.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>BelongsTo</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_docs'>parent_docs</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>associations</span>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>Associations to eager load</p>
</div>
  </li>
  <li>
    <span class='name'>docs</span>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../Document.html" title="Mongoid::Document (module)">Document</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>Documents to preload the associations</p>
</div>
  </li>
  <li>
    <span class='name'>use_lookup</span>
    <span class='type'>(<a href="../Boolean.html" title="Mongoid::Boolean (class)">Boolean</a>)</span>
    <em class='default'>(defaults to: <tt>false</tt>)</em>
&mdash;    <div class='inline'>
<p>Whether to use $lookup aggregation for eager loading. This is used in Criteria#eager_load.</p>
</div>
  </li>
  <li>
    <span class='name'>pipeline</span>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>&lt;<a href="../../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
    <em class='default'>(defaults to: <tt>[]</tt>)</em>
&mdash;    <div class='inline'>
<p>The aggregation pipeline to use when using $lookup for eager loading.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L23-L29'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='23' data-end='29'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/eager.rb', line 23</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_use_lookup'>use_lookup</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> [])
  <span class='ivar'>@associations</span> <span class='op'>=</span> <span class='id identifier rubyid_associations'>associations</span>
  <span class='ivar'>@docs</span> <span class='op'>=</span> <span class='id identifier rubyid_docs'>docs</span>
  <span class='ivar'>@grouped_docs</span> <span class='op'>=</span> {}
  <span class='ivar'>@use_lookup</span> <span class='op'>=</span> <span class='id identifier rubyid_use_lookup'>use_lookup</span>
  <span class='ivar'>@pipeline</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline'>pipeline</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="each_loaded_document_of_class-instance_method">
  <h3 class='signature priv first'>
    #<strong>each_loaded_document_of_class</strong>(cls, keys)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Retrieves the documents of the specified class, that have the foreign key included in the specified list of keys.</p>

<p>When the documents are retrieved, the set of inclusions applied is the set of inclusions applied to the host document minus the association that is being eagerly loaded.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L95-L104'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='95' data-end='104'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/eager.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_each_loaded_document_of_class'>each_loaded_document_of_class</span>(<span class='id identifier rubyid_cls'>cls</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span>)
  <span class='comment'># Note: keys should not include nil elements.
</span>  <span class='comment'># Upstream code is responsible for eliminating nils from keys.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_none'>none</span> <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_criteria'>criteria</span> <span class='op'>=</span> <span class='id identifier rubyid_prepare_criteria_for_loaded_documents'><a href="#prepare_criteria_for_loaded_documents-instance_method" title="Mongoid::Association::Eager#prepare_criteria_for_loaded_documents (method)">prepare_criteria_for_loaded_documents</a></span>(<span class='id identifier rubyid_cls'>cls</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span>)
  <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_doc'>doc</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prepare_criteria_for_loaded_documents-instance_method">
  <h3 class='signature priv'>
    #<strong>prepare_criteria_for_loaded_documents</strong>(cls, keys)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Prepares the criteria to retrieve the documents of the specified class, that have the foreign key included in the specified list of keys. When the documents are retrieved, the set of inclusions applied is the set of inclusions applied to the host document minus the association that is being eagerly loaded.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L189-L195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='189' data-end='195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/eager.rb', line 189</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare_criteria_for_loaded_documents'>prepare_criteria_for_loaded_documents</span>(<span class='id identifier rubyid_cls'>cls</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span>)
  <span class='id identifier rubyid_criteria'>criteria</span> <span class='op'>=</span> <span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_criteria'>criteria</span>
  <span class='id identifier rubyid_criteria'>criteria</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_apply_scope'>apply_scope</span>(<span class='ivar'>@association</span>.<span class='id identifier rubyid_scope'>scope</span>)
  <span class='id identifier rubyid_criteria'>criteria</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_any_in'>any_in</span>(<span class='id identifier rubyid_key'>key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_keys'>keys</span>)
  <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_inclusions'>inclusions</span> <span class='op'>=</span> <span class='id identifier rubyid_criteria'>criteria</span>.<span class='id identifier rubyid_inclusions'>inclusions</span> <span class='op'>-</span> [<span class='ivar'>@association</span>]
  <span class='id identifier rubyid_criteria'>criteria</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>  &#x21d2; <a href="../../Array.html" title="Array (class)">Array</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Run the preloader.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Preload the associations into the documents.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_loader'>loader</span>.<span class='id identifier rubyid_run'>run</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Array.html" title="Array (class)">Array</a>)</span>
&mdash;    <div class='inline'>
<p>The list of documents given.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L37-L51'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='37' data-end='51'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/eager.rb', line 37</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
  <span class='ivar'>@loaded</span> <span class='op'>=</span> []

  <span class='kw'>if</span> <span class='ivar'>@use_lookup</span>
    <span class='id identifier rubyid_preload_with_lookup'>preload_with_lookup</span>
    <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='ivar'>@docs</span>
    <span class='kw'>return</span> <span class='ivar'>@loaded</span>.<span class='id identifier rubyid_flatten'>flatten</span>
  <span class='kw'>end</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_shift_association'><a href="#shift_association-instance_method" title="Mongoid::Association::Eager#shift_association (method)">shift_association</a></span>
    <span class='id identifier rubyid_preload'>preload</span>
    <span class='ivar'>@loaded</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@docs</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_send'>send</span>(<span class='ivar'>@association</span>.<span class='id identifier rubyid_name'>name</span>) <span class='kw'>if</span> <span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='ivar'>@association</span>.<span class='id identifier rubyid_name'>name</span>) }
  <span class='kw'>end</span>
  <span class='ivar'>@loaded</span>.<span class='id identifier rubyid_flatten'>flatten</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shift_association-instance_method">
  <h3 class='signature priv'>
    #<strong>shift_association</strong>  &#x21d2; <a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Shift the current association metadata</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Shift the current association.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_loader'>loader</span>.<span class='id identifier rubyid_shift_association'>shift_association</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Relatable.html" title="Mongoid::Association::Relatable (module)">Mongoid::Association::Relatable</a>)</span>
&mdash;    <div class='inline'>
<p>The association object.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/association/eager.rb#L180-L182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='180' data-end='182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/association/eager.rb', line 180</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shift_association'>shift_association</span>
  <span class='ivar'>@association</span> <span class='op'>=</span> <span class='ivar'>@associations</span>.<span class='id identifier rubyid_shift'>shift</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>