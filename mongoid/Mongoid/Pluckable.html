<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Mongoid::Pluckable &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Pluckable",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongoid master</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Pluckable&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Mongoid::Pluckable  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This module is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Association/Referenced/HasMany/Enumerable.html" title="Mongoid::Association::Referenced::HasMany::Enumerable (class)"><code>Association::Referenced::HasMany::Enumerable</code></a>,
          <a href="Contextual/Mongo.html" title="Mongoid::Contextual::Mongo (class)"><code>Contextual::Mongo</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          ActiveSupport::Concern
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L7'>lib/mongoid/pluckable.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Provides shared behavior for any document with “pluck” functionality.</p>

  </div>
</div>
<div class='tags'>
  
</div>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#descend-instance_method" title="#descend (instance method)">#<strong>descend</strong>(part, current, method_name, field, part_count, is_translation)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Descend one level in the attribute hash.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#extract_value-instance_method" title="#extract_value (instance method)">#<strong>extract_value</strong>(attrs, field_name, document_class)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Extracts the value for the given field name from the given attribute hash.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#fetch_and_demongoize-instance_method" title="#fetch_and_demongoize (instance method)">#<strong>fetch_and_demongoize</strong>(obj, key, field)  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Fetch the element from the given hash and demongoize it using the given field.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#pluck_from_documents-instance_method" title="#pluck_from_documents (instance method)">#<strong>pluck_from_documents</strong>(documents, field_names, document_class: klass)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Plucks the given field names from the given documents.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#prepare_pluck-instance_method" title="#prepare_pluck (instance method)">#<strong>prepare_pluck</strong>(field_names, document_class: klass, prepare_projection: false)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Prepares the field names for plucking by normalizing them to their database field names.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="descend-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>descend</strong>(part, current, method_name, field, part_count, is_translation)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Descend one level in the attribute hash.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>part</span>
    <span class='type'>(<a href="../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The current part index.</p>
</div>
  </li>
  <li>
    <span class='name'>current</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a> | <a href="../Array.html" title="Array (class)">Array</a>&lt;<a href="../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The current level in the attribute hash.</p>
</div>
  </li>
  <li>
    <span class='name'>method_name</span>
    <span class='type'>(<a href="../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The method name to descend to.</p>
</div>
  </li>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<code>Field</code>|<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The field to use for demongoization.</p>
</div>
  </li>
  <li>
    <span class='name'>is_translation</span>
    <span class='type'>(<a href="Boolean.html" title="Mongoid::Boolean (class)">Boolean</a>)</span>
&mdash;    <div class='inline'>
<p>Whether the method is an _translations field.</p>
</div>
  </li>
  <li>
    <span class='name'>part_count</span>
    <span class='type'>(<a href="../Integer.html" title="Integer (class)">Integer</a>)</span>
&mdash;    <div class='inline'>
<p>The total number of parts in the field name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The value at the next level.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L104-L129'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='104' data-end='129'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/pluckable.rb', line 104</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_descend'>descend</span>(<span class='id identifier rubyid_part'>part</span><span class='comma'>,</span> <span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_part_count'>part_count</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)
  <span class='comment'># 1. If curr is an array fetch from all elements in the array.
</span>  <span class='comment'># 2. If the field is localized, and is not an _translations field
</span>  <span class='comment'>#    (_translations fields don&#39;t show up in the fields hash).
</span>  <span class='comment'>#    - If this is the end of the methods, return the translation for
</span>  <span class='comment'>#      the current locale.
</span>  <span class='comment'>#    - Otherwise, return the whole translations hash so the next method
</span>  <span class='comment'>#      can select the language it wants.
</span>  <span class='comment'># 3. If the meth is an _translations field, do not demongoize the
</span>  <span class='comment'>#    value so the full hash is returned.
</span>  <span class='comment'># 4. Otherwise, fetch and demongoize the value for the key meth.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Pluckable#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
    <span class='id identifier rubyid_res'>res</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_res'>res</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_field'>field</span><span class='op'>&amp;.</span><span class='id identifier rubyid_localized?'>localized?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_part_count'>part_count</span>
      <span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='kw'>nil</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Pluckable#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_is_translation'>is_translation</span>
    <span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='kw'>nil</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fetch_and_demongoize'><a href="#fetch_and_demongoize-instance_method" title="Mongoid::Pluckable#fetch_and_demongoize (method)">fetch_and_demongoize</a></span>(<span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_value-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>extract_value</strong>(attrs, field_name, document_class)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Extracts the value for the given field name from the given attribute hash.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>attrs</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The attributes hash.</p>
</div>
  </li>
  <li>
    <span class='name'>field_name</span>
    <span class='type'>(<a href="../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the field to extract.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The value for the given field name</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L65-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='65' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/pluckable.rb', line 65</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_value'>extract_value</span>(<span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_field_name'>field_name</span><span class='comma'>,</span> <span class='id identifier rubyid_document_class'>document_class</span>)
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_num_meths'>num_meths</span> <span class='op'>=</span> <span class='id identifier rubyid_field_name'>field_name</span>.<span class='id identifier rubyid_count'>count</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_curr'>curr</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span>.<span class='id identifier rubyid_dup'>dup</span>

  <span class='id identifier rubyid_document_class'>document_class</span>.<span class='id identifier rubyid_traverse_association_tree'>traverse_association_tree</span>(<span class='id identifier rubyid_field_name'>field_name</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_is_field'>is_field</span><span class='op'>|</span>
    <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span> <span class='kw'>if</span> <span class='id identifier rubyid_is_field'>is_field</span>

    <span class='comment'># use the correct document class to check for localized fields on
</span>    <span class='comment'># embedded documents.
</span>    <span class='id identifier rubyid_document_class'>document_class</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_klass'>klass</span> <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_klass'>klass</span>)

    <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='comment'># If no association or field was found, check if the meth is an
</span>    <span class='comment'># _translations field.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_tr'>tr</span> <span class='op'>=</span> <span class='id identifier rubyid_meth'>meth</span>.<span class='id identifier rubyid_match'>match</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(.*)_translations\z</span><span class='regexp_end'>/</span></span>)<span class='op'>&amp;.</span><span class='id identifier rubyid_captures'>captures</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>)
      <span class='id identifier rubyid_is_translation'>is_translation</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_meth'>meth</span> <span class='op'>=</span> <span class='id identifier rubyid_document_class'>document_class</span>.<span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_tr'>tr</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_curr'>curr</span> <span class='op'>=</span> <span class='id identifier rubyid_descend'><a href="#descend-instance_method" title="Mongoid::Pluckable#descend (method)">descend</a></span>(<span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_curr'>curr</span><span class='comma'>,</span> <span class='id identifier rubyid_meth'>meth</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_num_meths'>num_meths</span><span class='comma'>,</span> <span class='id identifier rubyid_is_translation'>is_translation</span>)

    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_curr'>curr</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch_and_demongoize-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>fetch_and_demongoize</strong>(obj, key, field)  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Fetch the element from the given hash and demongoize it using the given field. If the obj is an array, map over it and call this method on all of its elements.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>obj</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a> | <a href="../Array.html" title="Array (class)">Array</a>&lt;<a href="../Hash.html" title="Hash (class)">Hash</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The hash or array of hashes to fetch from.</p>
</div>
  </li>
  <li>
    <span class='name'>key</span>
    <span class='type'>(<a href="../String.html" title="String (class)">String</a>)</span>
&mdash;    <div class='inline'>
<p>The key to fetch from the hash.</p>
</div>
  </li>
  <li>
    <span class='name'>field</span>
    <span class='type'>(<code>Field</code>)</span>
&mdash;    <div class='inline'>
<p>The field to use for demongoization.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The demongoized value.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L49-L56'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='49' data-end='56'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/pluckable.rb', line 49</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_and_demongoize'>fetch_and_demongoize</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='id identifier rubyid_fetch_and_demongoize'>fetch_and_demongoize</span>(<span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='kw'>nil</span>)
    <span class='id identifier rubyid_field'>field</span> <span class='op'>?</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>) <span class='op'>:</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_demongoize'>demongoize</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pluck_from_documents-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>pluck_from_documents</strong>(documents, field_names, document_class: klass)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Plucks the given field names from the given documents.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L33-L38'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='33' data-end='38'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/pluckable.rb', line 33</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pluck_from_documents'>pluck_from_documents</span>(<span class='id identifier rubyid_documents'>documents</span><span class='comma'>,</span> <span class='id identifier rubyid_field_names'>field_names</span><span class='comma'>,</span> <span class='label'>document_class:</span> <span class='id identifier rubyid_klass'>klass</span>)
  <span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_reduce'>reduce</span>([]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plucked'>plucked</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_field_names'>field_names</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_extract_value'><a href="#extract_value-instance_method" title="Mongoid::Pluckable#extract_value (method)">extract_value</a></span>(<span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='id identifier rubyid_document_class'>document_class</span>) }
    <span class='id identifier rubyid_plucked'>plucked</span> <span class='op'>&lt;&lt;</span> ((<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>) <span class='op'>?</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_values'>values</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prepare_pluck-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>prepare_pluck</strong>(field_names, document_class: klass, prepare_projection: false)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Prepares the field names for plucking by normalizing them to their database field names. Also prepares a projection hash if requested.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/pluckable.rb#L14-L30'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='30'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/pluckable.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare_pluck'>prepare_pluck</span>(<span class='id identifier rubyid_field_names'>field_names</span><span class='comma'>,</span> <span class='label'>document_class:</span> <span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='label'>prepare_projection:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_projection'>projection</span> <span class='op'>=</span> {}

  <span class='id identifier rubyid_field_names'>field_names</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='id identifier rubyid_db_fn'>db_fn</span> <span class='op'>=</span> <span class='id identifier rubyid_document_class'>document_class</span>.<span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_f'>f</span>)
    <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span>.<span class='id identifier rubyid_push'>push</span>(<span class='id identifier rubyid_db_fn'>db_fn</span>)

    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_prepare_projection'>prepare_projection</span>

    <span class='id identifier rubyid_cleaned_name'>cleaned_name</span> <span class='op'>=</span> <span class='id identifier rubyid_document_class'>document_class</span>.<span class='id identifier rubyid_cleanse_localized_field_names'>cleanse_localized_field_names</span>(<span class='id identifier rubyid_f'>f</span>)
    <span class='id identifier rubyid_canonical_name'>canonical_name</span> <span class='op'>=</span> <span class='id identifier rubyid_document_class'>document_class</span>.<span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_cleaned_name'>cleaned_name</span>)
    <span class='id identifier rubyid_projection'>projection</span>[<span class='id identifier rubyid_canonical_name'>canonical_name</span>] <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  { <span class='label'>field_names:</span> <span class='id identifier rubyid_normalized_field_names'>normalized_field_names</span><span class='comma'>,</span> <span class='label'>projection:</span> <span class='id identifier rubyid_projection'>projection</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>