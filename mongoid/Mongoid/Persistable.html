<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Mongoid::Persistable &mdash; Mongoid master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongoid::Persistable",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongoid master</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Persistable&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Mongoid::Persistable</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)"><code>Creatable</code></a>,
        <a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)"><code>Deletable</code></a>,
        <a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)"><code>Destroyable</code></a>,
        <a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)"><code>Incrementable</code></a>,
        <a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)"><code>Logical</code></a>,
        <a href="Persistable/Maxable.html" title="Mongoid::Persistable::Maxable (module)"><code>Maxable</code></a>,
        <a href="Persistable/Minable.html" title="Mongoid::Persistable::Minable (module)"><code>Minable</code></a>,
        <a href="Persistable/Multipliable.html" title="Mongoid::Persistable::Multipliable (module)"><code>Multipliable</code></a>,
        <a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)"><code>Poppable</code></a>,
        <a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)"><code>Pullable</code></a>,
        <a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)"><code>Pushable</code></a>,
        <a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)"><code>Renamable</code></a>,
        <a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)"><code>Savable</code></a>,
        <a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)"><code>Settable</code></a>,
        <a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)"><code>Unsettable</code></a>,
        <a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)"><code>Updatable</code></a>,
        <a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)"><code>Upsertable</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Composable.html" title="Mongoid::Composable (module)"><code>Composable</code></a>,
          <a href="Document.html" title="Mongoid::Document (module)"><code>Document</code></a>,
          <a href="GlobalDiscriminatorKeyAssignment/InvalidFieldHost.html" title="Mongoid::GlobalDiscriminatorKeyAssignment::InvalidFieldHost (class)"><code>GlobalDiscriminatorKeyAssignment::InvalidFieldHost</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Persistable/Destroyable/ClassMethods.html" title="Mongoid::Persistable::Destroyable::ClassMethods (module)"><code>Persistable::Destroyable::ClassMethods</code></a>,
          <a href="Persistable/Deletable/ClassMethods.html" title="Mongoid::Persistable::Deletable::ClassMethods (module)"><code>Persistable::Deletable::ClassMethods</code></a>,
          <a href="Persistable/Creatable/ClassMethods.html" title="Mongoid::Persistable::Creatable::ClassMethods (module)"><code>Persistable::Creatable::ClassMethods</code></a>,
          ActiveSupport::Concern
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)"><code>Unsettable</code></a>,
          <a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)"><code>Upsertable</code></a>,
          <a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)"><code>Updatable</code></a>,
          <a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)"><code>Settable</code></a>,
          <a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)"><code>Savable</code></a>,
          <a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)"><code>Renamable</code></a>,
          <a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)"><code>Pushable</code></a>,
          <a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)"><code>Pullable</code></a>,
          <a href="Positional.html" title="Mongoid::Positional (module)"><code>Positional</code></a>,
          <a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)"><code>Poppable</code></a>,
          <a href="Persistable/Multipliable.html" title="Mongoid::Persistable::Multipliable (module)"><code>Multipliable</code></a>,
          <a href="Persistable/Minable.html" title="Mongoid::Persistable::Minable (module)"><code>Minable</code></a>,
          <a href="Persistable/Maxable.html" title="Mongoid::Persistable::Maxable (module)"><code>Maxable</code></a>,
          <a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)"><code>Logical</code></a>,
          <a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)"><code>Incrementable</code></a>,
          <a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)"><code>Destroyable</code></a>,
          <a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)"><code>Deletable</code></a>,
          <a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)"><code>Creatable</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L25'>lib/mongoid/persistable.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/creatable.rb#L5'>lib/mongoid/persistable/creatable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/deletable.rb#L5'>lib/mongoid/persistable/deletable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/destroyable.rb#L5'>lib/mongoid/persistable/destroyable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/incrementable.rb#L5'>lib/mongoid/persistable/incrementable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/logical.rb#L5'>lib/mongoid/persistable/logical.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/maxable.rb#L5'>lib/mongoid/persistable/maxable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/minable.rb#L5'>lib/mongoid/persistable/minable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/multipliable.rb#L5'>lib/mongoid/persistable/multipliable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/poppable.rb#L5'>lib/mongoid/persistable/poppable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/pullable.rb#L5'>lib/mongoid/persistable/pullable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/pushable.rb#L5'>lib/mongoid/persistable/pushable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/renamable.rb#L5'>lib/mongoid/persistable/renamable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/savable.rb#L5'>lib/mongoid/persistable/savable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/settable.rb#L5'>lib/mongoid/persistable/settable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/unsettable.rb#L5'>lib/mongoid/persistable/unsettable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/updatable.rb#L5'>lib/mongoid/persistable/updatable.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable/upsertable.rb#L5'>lib/mongoid/persistable/upsertable.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Contains general behavior for persistence operations.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='LIST_OPERATIONS-constant' class='summary_signature'>LIST_OPERATIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The atomic operations that deal with arrays or sets in the db.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L47-L47'># File 'lib/mongoid/persistable.rb', line 47</a>    <pre class='code ruby'>[ <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$addToSet</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$push</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pull</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pullAll</span><span class='tstring_end'>&quot;</span></span> ].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Persistable/Destroyable/ClassMethods.html" title="Mongoid::Persistable::Destroyable::ClassMethods (module)"><code>Persistable::Destroyable::ClassMethods</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Destroyable/ClassMethods.html#destroy_all-instance_method" title="Mongoid::Persistable::Destroyable::ClassMethods#destroy_all (method)">destroy_all</a></td>
      <td><div class='inline'><p>Delete all documents given the supplied conditions.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Deletable/ClassMethods.html" title="Mongoid::Persistable::Deletable::ClassMethods (module)"><code>Persistable::Deletable::ClassMethods</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Deletable/ClassMethods.html#delete_all-instance_method" title="Mongoid::Persistable::Deletable::ClassMethods#delete_all (method)">delete_all</a></td>
      <td><div class='inline'><p>Delete all documents given the supplied conditions.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Creatable/ClassMethods.html" title="Mongoid::Persistable::Creatable::ClassMethods (module)"><code>Persistable::Creatable::ClassMethods</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Creatable/ClassMethods.html#create-instance_method" title="Mongoid::Persistable::Creatable::ClassMethods#create (method)">create</a></td>
      <td><div class='inline'><p>Create a new document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Creatable/ClassMethods.html#create!-instance_method" title="Mongoid::Persistable::Creatable::ClassMethods#create! (method)">create!</a></td>
      <td><div class='inline'><p>Create a new document.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#executing_atomically%3F-instance_method" title="#executing_atomically? (instance method)">#<strong>executing_atomically?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Are we executing an atomically block on the current document?</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#atomically-instance_method" title="#atomically (instance method)">#<strong>atomically</strong>(join_context: nil)  &#x21d2; true | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute operations atomically (in a single database call) for everything that would happen inside the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fail_due_to_callback!-instance_method" title="#fail_due_to_callback! (instance method)">#<strong>fail_due_to_callback!</strong>(method)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raise an error if a callback failed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fail_due_to_validation!-instance_method" title="#fail_due_to_validation! (instance method)">#<strong>fail_due_to_validation!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raise an error if validation failed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_atomic_context_changed_fields-instance_method" title="#_mongoid_atomic_context_changed_fields (instance method)">#<strong>_mongoid_atomic_context_changed_fields</strong>  &#x21d2; Array </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the current atomic context’s changed fields.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_pop_atomic_context-instance_method" title="#_mongoid_pop_atomic_context (instance method)">#<strong>_mongoid_pop_atomic_context</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Pop an atomic context off the stack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_push_atomic_context-instance_method" title="#_mongoid_push_atomic_context (instance method)">#<strong>_mongoid_push_atomic_context</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Push a new atomic context onto the stack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_remove_atomic_context_changes-instance_method" title="#_mongoid_remove_atomic_context_changes (instance method)">#<strong>_mongoid_remove_atomic_context_changes</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove the dirty changes for all fields changed in the current atomic context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_mongoid_reset_atomic_context_changes!-instance_method" title="#_mongoid_reset_atomic_context_changes! (instance method)">#<strong>_mongoid_reset_atomic_context_changes!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Reset the attributes for all fields changed in the current atomic context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#persist_atomic_operations-instance_method" title="#persist_atomic_operations (instance method)">#<strong>persist_atomic_operations</strong>(operations)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Persist the atomic operations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#persist_or_delay_atomic_operation-instance_method" title="#persist_or_delay_atomic_operation (instance method)">#<strong>persist_or_delay_atomic_operation</strong>(operation)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>If we are in an atomically block, add the operations to the delayed group, otherwise persist immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#post_process_persist-instance_method" title="#post_process_persist (instance method)">#<strong>post_process_persist</strong>(result, options = {})  &#x21d2; true </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Post process the persistence operation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#prepare_atomic_operation-instance_method" title="#prepare_atomic_operation (instance method)">#<strong>prepare_atomic_operation</strong>  &#x21d2; Object </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Prepare an atomic persistence operation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#process_atomic_operations-instance_method" title="#process_atomic_operations (instance method)">#<strong>process_atomic_operations</strong>(operations)  &#x21d2; Hash </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Process the atomic operations - this handles the common behavior of iterating through each op, getting the aliased field name, and removing appropriate dirty changes.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)"><code>Unsettable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Unsettable.html#unset-instance_method" title="Mongoid::Persistable::Unsettable#unset (method)">#unset</a></td>
      <td><div class='inline'><p>Perform an $unset operation on the provided fields and in the values in the document in memory.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)"><code>Upsertable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Upsertable.html#upsert-instance_method" title="Mongoid::Persistable::Upsertable#upsert (method)">#upsert</a></td>
      <td><div class='inline'><p>Perform an upsert of the document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Upsertable.html#prepare_upsert-instance_method" title="Mongoid::Persistable::Upsertable#prepare_upsert (method)">#prepare_upsert</a></td>
      <td><div class='inline'><p>Prepare the upsert for execution.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)"><code>Updatable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Updatable.html#update-instance_method" title="Mongoid::Persistable::Updatable#update (method)">#update</a></td>
      <td><div class='inline'><p>Update the document attributes in the database.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Updatable.html#update!-instance_method" title="Mongoid::Persistable::Updatable#update! (method)">#update!</a></td>
      <td><div class='inline'><p>Update the document attributes in the database and raise an error if validation failed.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Updatable.html#update_attribute-instance_method" title="Mongoid::Persistable::Updatable#update_attribute (method)">#update_attribute</a></td>
      <td><div class='inline'><p>Update a single attribute and persist the entire document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Updatable.html#update_attributes-instance_method" title="Mongoid::Persistable::Updatable#update_attributes (method)">#update_attributes</a></td>
      <td><div class='inline'><p>Alias for <a href="Persistable/Updatable.html#update-instance_method" title="Mongoid::Persistable::Updatable#update (method)">Updatable#update</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Updatable.html#update_attributes!-instance_method" title="Mongoid::Persistable::Updatable#update_attributes! (method)">#update_attributes!</a></td>
      <td><div class='inline'><p>Alias for <a href="Persistable/Updatable.html#update!-instance_method" title="Mongoid::Persistable::Updatable#update! (method)">Updatable#update!</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="Persistable/Updatable.html#enforce_immutability_of_id_field!-instance_method" title="Mongoid::Persistable::Updatable#enforce_immutability_of_id_field! (method)">#enforce_immutability_of_id_field!</a></td>
      <td><div class='inline'><p>Checks to see if the _id field has been modified.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Updatable.html#init_atomic_updates-instance_method" title="Mongoid::Persistable::Updatable#init_atomic_updates (method)">#init_atomic_updates</a></td>
      <td><div class='inline'><p>Initialize the atomic updates.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Updatable.html#prepare_update-instance_method" title="Mongoid::Persistable::Updatable#prepare_update (method)">#prepare_update</a></td>
      <td><div class='inline'><p>Prepare the update for execution.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="Persistable/Updatable.html#process_touch_option-instance_method" title="Mongoid::Persistable::Updatable#process_touch_option (method)">#process_touch_option</a></td>
      <td><div class='inline'><p>If there is a touch option and it is false, this method will call the timeless method so that the updated_at attribute is not updated.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="Persistable/Updatable.html#run_all_callbacks_for_update-instance_method" title="Mongoid::Persistable::Updatable#run_all_callbacks_for_update (method)">#run_all_callbacks_for_update</a></td>
      <td><div class='inline'><p>Consolidates all the callback invocations into a single place, to avoid cluttering the logic in #prepare_update.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="Persistable/Updatable.html#update_document-instance_method" title="Mongoid::Persistable::Updatable#update_document (method)">#update_document</a></td>
      <td><div class='inline'><p>Update the document in the database.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)"><code>Settable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Settable.html#set-instance_method" title="Mongoid::Persistable::Settable#set (method)">#set</a></td>
      <td><div class='inline'><p>Perform a $set operation on the provided field/value pairs and set the values in the document in memory.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)"><code>Savable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Savable.html#save-instance_method" title="Mongoid::Persistable::Savable#save (method)">#save</a></td>
      <td><div class='inline'><p>Save the document - will perform an insert if the document is new, and update if not.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Savable.html#save!-instance_method" title="Mongoid::Persistable::Savable#save! (method)">#save!</a></td>
      <td><div class='inline'><p>Save the document - will perform an insert if the document is new, and update if not.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)"><code>Renamable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Renamable.html#rename-instance_method" title="Mongoid::Persistable::Renamable#rename (method)">#rename</a></td>
      <td><div class='inline'><p>Rename fields from one value to another via $rename.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)"><code>Pushable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Pushable.html#add_to_set-instance_method" title="Mongoid::Persistable::Pushable#add_to_set (method)">#add_to_set</a></td>
      <td><div class='inline'><p>Add the single values to the arrays only if the value does not already exist in the array.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Pushable.html#push-instance_method" title="Mongoid::Persistable::Pushable#push (method)">#push</a></td>
      <td><div class='inline'><p>Push a single value or multiple values onto arrays.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)"><code>Pullable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Pullable.html#pull-instance_method" title="Mongoid::Persistable::Pullable#pull (method)">#pull</a></td>
      <td><div class='inline'><p>Pull single values from the provided arrays.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Pullable.html#pull_all-instance_method" title="Mongoid::Persistable::Pullable#pull_all (method)">#pull_all</a></td>
      <td><div class='inline'><p>Pull multiple values from the provided array fields.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Positional.html" title="Mongoid::Positional (module)"><code>Positional</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Positional.html#positionally-instance_method" title="Mongoid::Positional#positionally (method)">#positionally</a></td>
      <td><div class='inline'><p>Takes the provided selector and atomic operations and replaces the indexes of the embedded documents with the positional operator when needed.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Positional.html#process_operations-instance_method" title="Mongoid::Positional#process_operations (method)">#process_operations</a>,
        <a class='i_m priv' href="Positional.html#process_updates-instance_method" title="Mongoid::Positional#process_updates (method)">#process_updates</a>,
        <a class='i_m priv' href="Positional.html#replace_index-instance_method" title="Mongoid::Positional#replace_index (method)">#replace_index</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)"><code>Poppable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Poppable.html#pop-instance_method" title="Mongoid::Persistable::Poppable#pop (method)">#pop</a></td>
      <td><div class='inline'><p>Pop or shift items from arrays using the $pop operator.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Multipliable.html" title="Mongoid::Persistable::Multipliable (module)"><code>Multipliable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Multipliable.html#mul-instance_method" title="Mongoid::Persistable::Multipliable#mul (method)">#mul</a></td>
      <td><div class='inline'><p>Multiply the provided fields by the corresponding values.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Minable.html" title="Mongoid::Persistable::Minable (module)"><code>Minable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Minable.html#clamp_upper_bound-instance_method" title="Mongoid::Persistable::Minable#clamp_upper_bound (method)">#clamp_upper_bound</a></td>
      <td><div class='inline'><p>Alias for <a href="Persistable/Minable.html#set_min-instance_method" title="Mongoid::Persistable::Minable#set_min (method)">Minable#set_min</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Minable.html#set_min-instance_method" title="Mongoid::Persistable::Minable#set_min (method)">#set_min</a></td>
      <td><div class='inline'><p><a href="../Set.html" title="Set (class)"><code>::Set</code></a> the given field or fields to the smaller of either it’s current value, or a given value.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Maxable.html" title="Mongoid::Persistable::Maxable (module)"><code>Maxable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Maxable.html#clamp_lower_bound-instance_method" title="Mongoid::Persistable::Maxable#clamp_lower_bound (method)">#clamp_lower_bound</a></td>
      <td><div class='inline'><p>Alias for <a href="Persistable/Maxable.html#set_max-instance_method" title="Mongoid::Persistable::Maxable#set_max (method)">Maxable#set_max</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Maxable.html#set_max-instance_method" title="Mongoid::Persistable::Maxable#set_max (method)">#set_max</a></td>
      <td><div class='inline'><p><a href="../Set.html" title="Set (class)"><code>::Set</code></a> the given field or fields to the larger of either it’s current value, or a given value.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)"><code>Logical</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Logical.html#bit-instance_method" title="Mongoid::Persistable::Logical#bit (method)">#bit</a></td>
      <td><div class='inline'><p>Performs an atomic $bit operation on the field with the provided hash of bitwise ops to execute in order.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)"><code>Incrementable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Incrementable.html#inc-instance_method" title="Mongoid::Persistable::Incrementable#inc (method)">#inc</a></td>
      <td><div class='inline'><p>Increment the provided fields by the corresponding values.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)"><code>Destroyable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Destroyable.html#destroy-instance_method" title="Mongoid::Persistable::Destroyable#destroy (method)">#destroy</a></td>
      <td><div class='inline'><p>Remove the document from the database with callbacks.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Destroyable.html#destroy!-instance_method" title="Mongoid::Persistable::Destroyable#destroy! (method)">#destroy!</a></td>
      <td><div class='inline'><p>Remove the document from the database with callbacks.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)"><code>Deletable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Deletable.html#delete-instance_method" title="Mongoid::Persistable::Deletable#delete (method)">#delete</a></td>
      <td><div class='inline'><p>Remove the document from the database.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Deletable.html#remove-instance_method" title="Mongoid::Persistable::Deletable#remove (method)">#remove</a></td>
      <td><div class='inline'><p>Alias for <a href="Persistable/Deletable.html#delete-instance_method" title="Mongoid::Persistable::Deletable#delete (method)">Deletable#delete</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Deletable.html#atomic_deletes-instance_method" title="Mongoid::Persistable::Deletable#atomic_deletes (method)">#atomic_deletes</a></td>
      <td><div class='inline'><p>Get the atomic deletes for the operation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Deletable.html#delete_as_embedded-instance_method" title="Mongoid::Persistable::Deletable#delete_as_embedded (method)">#delete_as_embedded</a></td>
      <td><div class='inline'><p>Delete the embedded document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Deletable.html#delete_as_root-instance_method" title="Mongoid::Persistable::Deletable#delete_as_root (method)">#delete_as_root</a></td>
      <td><div class='inline'><p>Delete the root document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Deletable.html#notifying_parent%3F-instance_method" title="Mongoid::Persistable::Deletable#notifying_parent? (method)">#notifying_parent?</a></td>
      <td><div class='inline'><p>Are we needing to notify the parent document of the deletion.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Deletable.html#prepare_delete-instance_method" title="Mongoid::Persistable::Deletable#prepare_delete (method)">#prepare_delete</a></td>
      <td><div class='inline'><p>Prepare the delete operation.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)"><code>Creatable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Persistable/Creatable.html#insert-instance_method" title="Mongoid::Persistable::Creatable#insert (method)">#insert</a></td>
      <td><div class='inline'><p>Insert a new document into the database.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Creatable.html#atomic_inserts-instance_method" title="Mongoid::Persistable::Creatable#atomic_inserts (method)">#atomic_inserts</a></td>
      <td><div class='inline'><p>Get the atomic insert for embedded documents, either a push or set.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Creatable.html#insert_as_embedded-instance_method" title="Mongoid::Persistable::Creatable#insert_as_embedded (method)">#insert_as_embedded</a></td>
      <td><div class='inline'><p>Insert the embedded document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Creatable.html#insert_as_root-instance_method" title="Mongoid::Persistable::Creatable#insert_as_root (method)">#insert_as_root</a></td>
      <td><div class='inline'><p>Insert the root document.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Creatable.html#post_process_insert-instance_method" title="Mongoid::Persistable::Creatable#post_process_insert (method)">#post_process_insert</a></td>
      <td><div class='inline'><p>Post process an insert, which sets the new record attribute to false and flags all the children as persisted.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Persistable/Creatable.html#prepare_insert-instance_method" title="Mongoid::Persistable::Creatable#prepare_insert (method)">#prepare_insert</a></td>
      <td><div class='inline'><p>Prepare the insert for execution.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="executing_atomically?-instance_method">
  <h3 class='signature ro priv  nodoc first'>
    #<strong>executing_atomically?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Are we executing an atomically block on the current document?</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Are we executing atomically?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_executing_atomically?'>executing_atomically?</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If we are current executing atomically.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L157-L159'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='157' data-end='159'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 157</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_executing_atomically?'>executing_atomically?</span>
  <span class='op'>!</span><span class='ivar'>@atomic_updates_to_execute_stack</span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_mongoid_atomic_context_changed_fields-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>_mongoid_atomic_context_changed_fields</strong>  &#x21d2; <a href="../Array.html" title="Array (class)">Array</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the current atomic context’s changed fields.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Return the current atomic context’s changed fields.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid__mongoid_atomic_context_changed_fields'>_mongoid_atomic_context_changed_fields</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Array.html" title="Array (class)">Array</a>)</span>
&mdash;    <div class='inline'>
<p>The changed fields.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L279-L281'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='279' data-end='281'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 279</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_atomic_context_changed_fields'>_mongoid_atomic_context_changed_fields</span>
  <span class='ivar'>@atomic_context</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_flat_map'>flat_map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_keys'>keys</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_mongoid_pop_atomic_context-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>_mongoid_pop_atomic_context</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pop an atomic context off the stack.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Pop an atomic context off the stack.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid__mongoid_pop_atomic_context'>_mongoid_pop_atomic_context</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L265-L269'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='265' data-end='269'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 265</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_pop_atomic_context'>_mongoid_pop_atomic_context</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
  <span class='ivar'>@atomic_updates_to_execute_stack</span>.<span class='id identifier rubyid_pop'>pop</span>
  <span class='ivar'>@atomic_context</span> <span class='op'>=</span> <span class='ivar'>@atomic_updates_to_execute_stack</span>.<span class='id identifier rubyid_last'>last</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_mongoid_push_atomic_context-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>_mongoid_push_atomic_context</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Push a new atomic context onto the stack.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Push a new atomic context onto the stack.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid__mongoid_push_atomic_context'>_mongoid_push_atomic_context</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L253-L257'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='253' data-end='257'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 253</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_push_atomic_context'>_mongoid_push_atomic_context</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
  <span class='ivar'>@atomic_context</span> <span class='op'>=</span> {}
  <span class='ivar'>@atomic_updates_to_execute_stack</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@atomic_context</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_mongoid_remove_atomic_context_changes-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>_mongoid_remove_atomic_context_changes</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove the dirty changes for all fields changed in the current atomic context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Remove the current atomic context’s dirty changes.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid__mongoid_remove_atomic_context_changes'>_mongoid_remove_atomic_context_changes</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L230-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='230' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 230</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_remove_atomic_context_changes'>_mongoid_remove_atomic_context_changes</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
  <span class='id identifier rubyid__mongoid_atomic_context_changed_fields'><a href="#_mongoid_atomic_context_changed_fields-instance_method" title="Mongoid::Persistable#_mongoid_atomic_context_changed_fields (method)">_mongoid_atomic_context_changed_fields</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_remove_change'>remove_change</span> <span class='id identifier rubyid_f'>f</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_mongoid_reset_atomic_context_changes!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>_mongoid_reset_atomic_context_changes!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reset the attributes for all fields changed in the current atomic context.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Reset the current atomic context’s changed attributes.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid__mongoid_reset_atomic_context_changes!'>_mongoid_reset_atomic_context_changes!</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L242-L245'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='242' data-end='245'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__mongoid_reset_atomic_context_changes!'>_mongoid_reset_atomic_context_changes!</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
  <span class='id identifier rubyid__mongoid_atomic_context_changed_fields'><a href="#_mongoid_atomic_context_changed_fields-instance_method" title="Mongoid::Persistable#_mongoid_atomic_context_changed_fields (method)">_mongoid_atomic_context_changed_fields</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_reset_attribute!'>reset_attribute!</span> <span class='id identifier rubyid_f'>f</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="atomically-instance_method">
  <h3 class='signature '>
    #<strong>atomically</strong>(join_context: nil)  &#x21d2; <code>true</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute operations atomically (in a single database call) for everything that would happen inside the block. This method supports nesting further calls to atomically, which will behave according to the options described below.</p>

<p>An option join_context can be given which, when true, will merge the operations declared by the given block with the atomically block wrapping the current invocation for the same document, if one exists. If this block or any other block sharing the same context raises before persisting, then all the operations of that context will not be persisted, and will also be reset in memory.</p>

<p>When join_context is false, the given block of operations will be persisted independently of other contexts. Failures in other contexts will not affect this one, so long as this block was able to run and persist changes.</p>

<p>The default value of join_context is set by the global configuration option join_contexts, whose own default is false.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Execute the operations atomically.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_atomically'>atomically</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_set'>set</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tool</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_inc'>inc</span>(<span class='label'>likes:</span> <span class='int'>10</span>)
<span class='kw'>end</span></code></pre>
        <p class='example_title'><div class='inline'>
<p>Execute some inner operations atomically, but independently from the outer operations.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_atomically'>atomically</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_inc'>inc</span> <span class='label'>likes:</span> <span class='int'>10</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_atomically'>atomically</span> <span class='label'>join_context:</span> <span class='kw'>false</span> <span class='kw'>do</span>
    <span class='comment'># The following is persisted to the database independently.
</span>    <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_unset'>unset</span> <span class='symbeg'>:</span><span class='id identifier rubyid_origin'>origin</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_atomically'>atomically</span> <span class='label'>join_context:</span> <span class='kw'>true</span> <span class='kw'>do</span>
    <span class='comment'># The following is persisted along with the other outer operations.
</span>    <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_inc'>inc</span> <span class='label'>member_count:</span> <span class='int'>3</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_set'>set</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tool</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>join_context</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Join the context (i.e. merge declared atomic operations) of the atomically block wrapping this one for the same document, if one exists.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the operation succeeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L94-L123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='94' data-end='123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 94</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_atomically'>atomically</span>(<span class='label'>join_context:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_join_context'>join_context</span> <span class='op'>=</span> <span class='const'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span>.<span class='id identifier rubyid_join_contexts'>join_contexts</span> <span class='kw'>if</span> <span class='id identifier rubyid_join_context'>join_context</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_call_depth'>call_depth</span> <span class='op'>=</span> <span class='ivar'>@atomic_depth</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_has_own_context'>has_own_context</span> <span class='op'>=</span> <span class='id identifier rubyid_call_depth'>call_depth</span>.<span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_join_context'>join_context</span>
  <span class='ivar'>@atomic_updates_to_execute_stack</span> <span class='op'>||=</span> []
  <span class='id identifier rubyid__mongoid_push_atomic_context'><a href="#_mongoid_push_atomic_context-instance_method" title="Mongoid::Persistable#_mongoid_push_atomic_context (method)">_mongoid_push_atomic_context</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='ivar'>@atomic_depth</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>yield</span>(<span class='kw'>self</span>)
    <span class='ivar'>@atomic_depth</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>
    <span class='id identifier rubyid_persist_atomic_operations'><a href="#persist_atomic_operations-instance_method" title="Mongoid::Persistable#persist_atomic_operations (method)">persist_atomic_operations</a></span> <span class='ivar'>@atomic_context</span>
    <span class='id identifier rubyid__mongoid_remove_atomic_context_changes'><a href="#_mongoid_remove_atomic_context_changes-instance_method" title="Mongoid::Persistable#_mongoid_remove_atomic_context_changes (method)">_mongoid_remove_atomic_context_changes</a></span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid__mongoid_reset_atomic_context_changes!'><a href="#_mongoid_reset_atomic_context_changes!-instance_method" title="Mongoid::Persistable#_mongoid_reset_atomic_context_changes! (method)">_mongoid_reset_atomic_context_changes!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid__mongoid_pop_atomic_context'><a href="#_mongoid_pop_atomic_context-instance_method" title="Mongoid::Persistable#_mongoid_pop_atomic_context (method)">_mongoid_pop_atomic_context</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_call_depth'>call_depth</span>.<span class='id identifier rubyid_zero?'>zero?</span>
    <span class='ivar'>@atomic_depth</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@atomic_updates_to_execute_stack</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fail_due_to_callback!-instance_method">
  <h3 class='signature '>
    #<strong>fail_due_to_callback!</strong>(method)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raise an error if a callback failed.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Raise the callback error.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_fail_due_to_callback!'>fail_due_to_callback!</span>(<span class='id identifier rubyid_person'>person</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create!'>create!</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>method</span>
    <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The method being called.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Errors/Callback.html" title="Mongoid::Errors::Callback (class)">Errors::Callback</a>)</span>
&mdash;    <div class='inline'>
<p>The callback error.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L143-L145'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='143' data-end='145'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 143</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_due_to_callback!'>fail_due_to_callback!</span>(<span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Callback.html" title="Mongoid::Errors::Callback (class)">Callback</a></span>.<span class='id identifier rubyid_new'><a href="Errors/Callback.html#new-class_method" title="Mongoid::Errors::Callback.new (method)">new</a></span>(<span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fail_due_to_validation!-instance_method">
  <h3 class='signature '>
    #<strong>fail_due_to_validation!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raise an error if validation failed.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Raise the validation error.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Person</span>.<span class='id identifier rubyid_fail_due_to_validation!'>fail_due_to_validation!</span>(<span class='id identifier rubyid_person'>person</span>)</code></pre>
  </div>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Errors/Validations.html" title="Mongoid::Errors::Validations (class)">Errors::Validations</a>)</span>
&mdash;    <div class='inline'>
<p>The validation error.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L131-L133'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='131' data-end='133'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 131</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_due_to_validation!'>fail_due_to_validation!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Validations.html" title="Mongoid::Errors::Validations (class)">Validations</a></span>.<span class='id identifier rubyid_new'><a href="Errors/Validations.html#new-class_method" title="Mongoid::Errors::Validations.new (method)">new</a></span>(<span class='kw'>self</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="persist_atomic_operations-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>persist_atomic_operations</strong>(operations)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Persist the atomic operations.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Persist the atomic operations.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_persist_atomic_operations'>persist_atomic_operations</span>(<span class='id identifier rubyid_ops'>ops</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>operations</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The atomic operations.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L311-L316'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='311' data-end='316'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 311</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_persist_atomic_operations'>persist_atomic_operations</span>(<span class='id identifier rubyid_operations'>operations</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_persisted?'>persisted?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_operations'>operations</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_operations'>operations</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_selector'>selector</span> <span class='op'>=</span> <span class='id identifier rubyid_atomic_selector'>atomic_selector</span>
    <span class='id identifier rubyid__root'>_root</span>.<span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'>selector</span>).<span class='id identifier rubyid_update_one'>update_one</span>(<span class='id identifier rubyid_positionally'>positionally</span>(<span class='id identifier rubyid_selector'>selector</span><span class='comma'>,</span> <span class='id identifier rubyid_operations'>operations</span>)<span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid__session'>_session</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="persist_or_delay_atomic_operation-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>persist_or_delay_atomic_operation</strong>(operation)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>If we are in an atomically block, add the operations to the delayed group, otherwise persist immediately.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Persist immediately or delay the operations.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_persist_or_delay_atomic_operation'>persist_or_delay_atomic_operation</span>(<span class='id identifier rubyid_ops'>ops</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>operation</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The operation.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L292-L301'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='292' data-end='301'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 292</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_persist_or_delay_atomic_operation'>persist_or_delay_atomic_operation</span>(<span class='id identifier rubyid_operation'>operation</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
    <span class='id identifier rubyid_operation'>operation</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span>)<span class='op'>|</span>
      <span class='ivar'>@atomic_context</span>[<span class='id identifier rubyid_name'>name</span>] <span class='op'>||=</span> {}
      <span class='ivar'>@atomic_context</span>[<span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_merge!'>merge!</span>(<span class='id identifier rubyid_hash'>hash</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_persist_atomic_operations'><a href="#persist_atomic_operations-instance_method" title="Mongoid::Persistable#persist_atomic_operations (method)">persist_atomic_operations</a></span>(<span class='id identifier rubyid_operation'>operation</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post_process_persist-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>post_process_persist</strong>(result, options = {})  &#x21d2; <code>true</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Post process the persistence operation.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Post process the persistence operation.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_post_process_persist'>post_process_persist</span>(<span class='kw'>true</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>result</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The result of the operation.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:validate</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether or not to validate.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>true.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L174-L181'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='174' data-end='181'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 174</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_post_process_persist'>post_process_persist</span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_post_persist'>post_persist</span> <span class='kw'>unless</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>==</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_clear'>clear</span> <span class='kw'>unless</span> <span class='id identifier rubyid_performing_validations?'>performing_validations?</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_in_transaction?'>in_transaction?</span>
    <span class='const'><a href="Threaded.html" title="Mongoid::Threaded (module)">Threaded</a></span>.<span class='id identifier rubyid_add_modified_document'><a href="Threaded.html#add_modified_document-instance_method" title="Mongoid::Threaded#add_modified_document (method)">add_modified_document</a></span>(<span class='id identifier rubyid__session'>_session</span><span class='comma'>,</span> <span class='kw'>self</span>)
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prepare_atomic_operation-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>prepare_atomic_operation</strong>  &#x21d2; <code>Object</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Prepare an atomic persistence operation. Yields an empty hash to be sent to the update.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Prepare the atomic operation.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_prepare_atomic_operation'>prepare_atomic_operation</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_coll'>coll</span><span class='comma'>,</span> <span class='id identifier rubyid_selector'>selector</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='op'>|</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The result of the operation.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Errors/ReadonlyDocument.html" title="Mongoid::Errors::ReadonlyDocument (class)">Errors::ReadonlyDocument</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L194-L199'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='194' data-end='199'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 194</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare_atomic_operation'>prepare_atomic_operation</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/ReadonlyDocument.html" title="Mongoid::Errors::ReadonlyDocument (class)">ReadonlyDocument</a></span>.<span class='id identifier rubyid_new'><a href="Errors/ReadonlyDocument.html#new-class_method" title="Mongoid::Errors::ReadonlyDocument.new (method)">new</a></span>(<span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>) <span class='kw'>if</span> <span class='id identifier rubyid_readonly?'>readonly?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span>.<span class='id identifier rubyid_legacy_readonly'>legacy_readonly</span>
  <span class='id identifier rubyid_operations'>operations</span> <span class='op'>=</span> <span class='kw'>yield</span>({})
  <span class='id identifier rubyid_persist_or_delay_atomic_operation'><a href="#persist_or_delay_atomic_operation-instance_method" title="Mongoid::Persistable#persist_or_delay_atomic_operation (method)">persist_or_delay_atomic_operation</a></span>(<span class='id identifier rubyid_operations'>operations</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_atomic_operations-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>process_atomic_operations</strong>(operations)  &#x21d2; <a href="../Hash.html" title="Hash (class)">Hash</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Process the atomic operations - this handles the common behavior of iterating through each op, getting the aliased field name, and removing appropriate dirty changes.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Process the atomic operations.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_document'>document</span>.<span class='id identifier rubyid_process_atomic_operations'>process_atomic_operations</span>(<span class='id identifier rubyid_pulls'>pulls</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>operations</span>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The atomic operations.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Hash.html" title="Hash (class)">Hash</a>)</span>
&mdash;    <div class='inline'>
<p>The operations.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongoid/blob/master/lib/mongoid/persistable.rb#L215-L221'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='215' data-end='221'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongoid/persistable.rb', line 215</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_atomic_operations'>process_atomic_operations</span>(<span class='id identifier rubyid_operations'>operations</span>)
  <span class='id identifier rubyid_operations'>operations</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_access'>access</span> <span class='op'>=</span> <span class='id identifier rubyid_database_field_name'>database_field_name</span>(<span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>yield</span>(<span class='id identifier rubyid_access'>access</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
    <span class='id identifier rubyid_remove_change'>remove_change</span>(<span class='id identifier rubyid_access'>access</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_executing_atomically?'><a href="#executing_atomically%3F-instance_method" title="Mongoid::Persistable#executing_atomically? (method)">executing_atomically?</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>