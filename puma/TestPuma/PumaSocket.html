<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: TestPuma::PumaSocket &mdash; Puma main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "TestPuma::PumaSocket",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Puma main</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../TestPuma.html" title="TestPuma (module)">TestPuma</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>PumaSocket&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: TestPuma::PumaSocket</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L62'>test/helpers/test_puma/puma_socket.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p>This module is included in CI test files, and provides methods to create
client sockets.  Normally, the socket parameters are defined by the code
creating the <a href="../Puma.html" title="Puma (module)"><code>::Puma</code></a> server (in-process or spawned), so they do not need to be
specified.  Regardless, many of the less frequently used parameters still
have keyword arguments and they can be set to whatever is required.</p>

<p>This module closes all sockets and performs all reads non-blocking and all
writes using syswrite.  These are helpful for reliable tests.  Please do not
use native Ruby sockets except if absolutely necessary.</p>

<h4>Methods that return a socket or sockets:</h4>

<ul>
<li><a href="#new_socket-instance_method" title="TestPuma::PumaSocket#new_socket (method)">#new_socket</a> - Opens a socket</li>
<li><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">#send_http</a> - Opens a socket and sends a request, which defaults to <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></li>
<li><a href="#send_http_array-instance_method" title="TestPuma::PumaSocket#send_http_array (method)">#send_http_array</a> - Creates an array of sockets. It opens each and sends a request on each</li>
</ul>

<p>All methods that create a socket have the following optional keyword parameters:</p>

<ul>
<li><code>host:</code> - tcp/ssl host (<code>String</code>)</li>
<li><code>port:</code> - tcp/ssl port (<code>Integer</code>, <code>String</code>)</li>
<li><code>path:</code> -  unix socket, full path (<code>String</code>)</li>
<li><code>ctx:</code> - ssl context (<code>OpenSSL::SSL::SSLContext</code>)</li>
<li><code>session:</code> - ssl session (<code>OpenSSL::SSL::Session</code>)</li>
</ul>

<h4>Methods that process the response:</h4>

<ul>
<li><a href="#send_http_read_response-instance_method" title="TestPuma::PumaSocket#send_http_read_response (method)">#send_http_read_response</a> - sends a request and returns the whole response</li>
<li><a href="#send_http_read_body-instance_method" title="TestPuma::PumaSocket#send_http_read_body (method)">#send_http_read_body</a>/<code>send_http_read_resp_body</code> - sends a request and returns the response body</li>
<li><a href="#send_http_read_headers-instance_method" title="TestPuma::PumaSocket#send_http_read_headers (method)">#send_http_read_headers</a>/<code>send_http_read_resp_headers</code> - sends a request and returns the response with the body
removed as an array of lines</li>
</ul>

<p>All methods that process the response have the following optional keyword parameters:</p>

<ul>
<li><code>timeout:</code> - total socket read timeout, defaults to <a href="#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocket::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a> (<code>Float</code>)</li>
<li><code>len:</code> - the <code>read_nonblock</code> maxlen, defaults to <a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a> (<code>Integer</code>)</li>
</ul>

<h4>Methods available on socket instances:</h4>

<ul>
<li><code>read_response</code> - reads the response and returns it</li>
<li><code>read_body</code> - reads the response and returns the body</li>
<li><code>read_all</code> - reads all available data on the socket</li>
<li><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">#send_http</a>/<code>&lt;&lt;</code>/<code>req_write</code> - writes to the socket with <code>syswrite</code>, returns the socket</li>
</ul>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='EMPTY_200-constant' class='summary_signature'>EMPTY_200 =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L72-L72'># File 'test/helpers/test_puma/puma_socket.rb', line 72</a>    <pre class='code ruby'>[<span class='int'>200</span><span class='comma'>,</span> {}<span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>]]</pre>
  </li>
  <li>
    <span id='GET_10-constant' class='summary_signature'>GET_10 =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L63-L63'># File 'test/helpers/test_puma/puma_socket.rb', line 63</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\n\r\n</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='GET_11-constant' class='summary_signature'>GET_11 =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L64-L64'># File 'test/helpers/test_puma/puma_socket.rb', line 64</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.1\r\n\r\n</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='HAS_APPEND_AS_BYTES-constant' class='summary_signature'>HAS_APPEND_AS_BYTES =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L74-L74'># File 'test/helpers/test_puma/puma_socket.rb', line 74</a>    <pre class='code ruby'><span class='op'>::</span><span class='const'>String</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_append_as_bytes'>append_as_bytes</span></pre>
  </li>
  <li>
    <span id='HELLO_11-constant' class='summary_signature'>HELLO_11 =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L66-L67'># File 'test/helpers/test_puma/puma_socket.rb', line 66</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP/1.1 200 OK\r\ncontent-type: text/plain\r\n</span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Length: 11\r\n\r\nHello World</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='NO_ENTITY_BODY-constant' class='summary_signature'>NO_ENTITY_BODY =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L71-L71'># File 'test/helpers/test_puma/puma_socket.rb', line 71</a>    <pre class='code ruby'><span class='const'><a href="PumaSocketInclude.html" title="TestPuma::PumaSocketInclude (module)">PumaSocketInclude</a></span><span class='op'>::</span><span class='const'><a href="PumaSocketInclude.html#NO_ENTITY_BODY-constant" title="TestPuma::PumaSocketInclude::NO_ENTITY_BODY (constant)">NO_ENTITY_BODY</a></span></pre>
  </li>
  <li>
    <span id='RESP_READ_LEN-constant' class='summary_signature'>RESP_READ_LEN =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L69-L69'># File 'test/helpers/test_puma/puma_socket.rb', line 69</a>    <pre class='code ruby'><span class='const'><a href="PumaSocketInclude.html" title="TestPuma::PumaSocketInclude (module)">PumaSocketInclude</a></span><span class='op'>::</span><span class='const'><a href="PumaSocketInclude.html#RESP_READ_LEN-constant" title="TestPuma::PumaSocketInclude::RESP_READ_LEN (constant)">RESP_READ_LEN</a></span></pre>
  </li>
  <li>
    <span id='RESP_READ_TIMEOUT-constant' class='summary_signature'>RESP_READ_TIMEOUT =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L70-L70'># File 'test/helpers/test_puma/puma_socket.rb', line 70</a>    <pre class='code ruby'><span class='const'><a href="PumaSocketInclude.html" title="TestPuma::PumaSocketInclude (module)">PumaSocketInclude</a></span><span class='op'>::</span><span class='const'><a href="PumaSocketInclude.html#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocketInclude::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a></span></pre>
  </li>
  <li>
    <span id='SET_TCP_NODELAY-constant' class='summary_signature'>SET_TCP_NODELAY =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L78-L78'># File 'test/helpers/test_puma/puma_socket.rb', line 78</a>    <pre class='code ruby'><span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>IPPROTO_TCP</span>) <span class='op'>&amp;&amp;</span> <span class='op'>::</span><span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>TCP_NODELAY</span>)</pre>
  </li>
  <li>
    <span id='UTF8-constant' class='summary_signature'>UTF8 =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L76-L76'># File 'test/helpers/test_puma/puma_socket.rb', line 76</a>    <pre class='code ruby'><span class='op'>::</span><span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#after_teardown-instance_method" title="#after_teardown (instance method)">#<strong>after_teardown</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes all io’s in <code>@ios_to_close</code>, also deletes them if they are files.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#before_setup-instance_method" title="#before_setup (instance method)">#<strong>before_setup</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close_ios-instance_method" title="#close_ios (instance method)">#<strong>close_ios</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new_ctx-instance_method" title="#new_ctx (instance method)">#<strong>new_ctx</strong> {|OpenSSL::SSL::SSLContext| ... } &#x21d2; OpenSSL::SSL::SSLContext </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Helper for creating an <code>OpenSSL::SSL::SSLContext</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new_socket-instance_method" title="#new_socket (instance method)">#<strong>new_socket</strong>(host: nil, port: nil, path: nil, ctx: nil, session: nil)  &#x21d2; PumaSSLSocket, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new client socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_response_array-instance_method" title="#read_response_array (instance method)">#<strong>read_response_array</strong>(skts, resp_count: nil, body_only: nil)  &#x21d2; Array&lt;String, Class&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reads an array of sockets that have already had requests sent.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http-instance_method" title="#send_http (instance method)">#<strong>send_http</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil)  &#x21d2; PumaSSLSocket, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a request and returns the socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_array-instance_method" title="#send_http_array (instance method)">#<strong>send_http_array</strong>(req = GET_11, len, dly: 0.000_1, max_retries: 5)  &#x21d2; Array&lt;PumaSSLSocket, PumaTCPSocket, PumaUNIXSocket&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an array of sockets, sending a request on each.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_all-instance_method" title="#send_http_read_all (instance method)">#<strong>send_http_read_all</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: RESP_READ_LEN, timeout: 15)  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a request and returns whatever can be read.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_body-instance_method" title="#send_http_read_body (instance method)">#<strong>send_http_read_body</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; Response </a>
      (also: #send_http_read_resp_body)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a request and returns the HTTP response body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_headers-instance_method" title="#send_http_read_headers (instance method)">#<strong>send_http_read_headers</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; Array&lt;String&gt; </a>
      (also: #send_http_read_resp_headers)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a request and returns the response header lines as an array of strings.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_resp_body-instance_method" title="#send_http_read_resp_body (instance method)">#<strong>send_http_read_resp_body</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#send_http_read_body-instance_method" title="TestPuma::PumaSocket#send_http_read_body (method)">#send_http_read_body</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_resp_headers-instance_method" title="#send_http_read_resp_headers (instance method)">#<strong>send_http_read_resp_headers</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#send_http_read_headers-instance_method" title="TestPuma::PumaSocket#send_http_read_headers (method)">#send_http_read_headers</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_http_read_response-instance_method" title="#send_http_read_response (instance method)">#<strong>send_http_read_response</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; Response </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a request and returns the HTTP response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#skt_closed_by_server-instance_method" title="#skt_closed_by_server (instance method)">#<strong>skt_closed_by_server</strong>(socket)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determines whether the socket has been closed by the server.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="after_teardown-instance_method">
  <h3 class='signature  first'>
    #<strong>after_teardown</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Closes all io’s in <code>@ios_to_close</code>, also deletes them if they are files</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L91-L101'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='91' data-end='101'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 91</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_after_teardown'>after_teardown</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_skipped?'>skipped?</span>
  <span class='kw'>super</span>
  <span class='id identifier rubyid_close_ios'><a href="#close_ios-instance_method" title="TestPuma::PumaSocket#close_ios (method)">close_ios</a></span> <span class='kw'>if</span> <span class='ivar'>@ios_to_close</span>

  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@ssl_socket_contexts</span>

  <span class='ivar'>@ssl_socket_contexts</span>.<span class='id identifier rubyid_pop'>pop</span> <span class='kw'>until</span> <span class='ivar'>@ssl_socket_contexts</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='ivar'>@ssl_socket_contexts</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@ssl_socket_contexts</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="before_setup-instance_method">
  <h3 class='signature '>
    #<strong>before_setup</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L80-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='80' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_before_setup'>before_setup</span>
  <span class='ivar'>@bind_port</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@bind_path</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@control_port</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@control_path</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@ssl_socket_contexts</span> <span class='op'>=</span> <span class='const'>Queue</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@ios_to_close</span> <span class='op'>||=</span> <span class='const'>Queue</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>super</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_ios-instance_method">
  <h3 class='signature '>
    #<strong>close_ios</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L103-L122'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='103' data-end='122'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 103</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close_ios'>close_ios</span>
  <span class='kw'>until</span> <span class='ivar'>@ios_to_close</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='ivar'>@ios_to_close</span>.<span class='id identifier rubyid_pop'>pop</span>
    <span class='kw'>begin</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_sysclose'>sysclose</span>
        <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_sync_close'>sync_close</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_sysclose'>sysclose</span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_closed?'>closed?</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>File</span>) <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='op'>&amp;.</span><span class='id identifier rubyid_path'>path</span>) <span class='op'>&amp;&amp;</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_path'>path</span>)
          <span class='const'>File</span>.<span class='id identifier rubyid_unlink'>unlink</span> <span class='id identifier rubyid_path'>path</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EBADF</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span><span class='comma'>,</span> <span class='const'>IOError</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@ios_to_close</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_ctx-instance_method">
  <h3 class='signature '>
    #<strong>new_ctx</strong> {|OpenSSL::SSL::SSLContext| ... } &#x21d2; <code>OpenSSL::SSL::SSLContext</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Helper for creating an <code>OpenSSL::SSL::SSLContext</code>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>&amp;blk</span>
    <span class='type'>(<code>Block</code>)</span>
&mdash;    <div class='inline'>
<p>Passed the SSLContext.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>The new socket</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L211-L219'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='219'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_new_ctx'>new_ctx</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_blk'>blk</span>)
  <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLContext</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_blk'>blk</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_ctx'>ctx</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ctx'>ctx</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_socket-instance_method">
  <h3 class='signature '>
    #<strong>new_socket</strong>(host: nil, port: nil, path: nil, ctx: nil, session: nil)  &#x21d2; <a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, ... 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new client socket.  TCP, SSL, and UNIX are supported</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, <a href="PumaTCPSocket.html" title="TestPuma::PumaTCPSocket (class)">PumaTCPSocket</a>, <a href="PumaUNIXSocket.html" title="TestPuma::PumaUNIXSocket (class)">PumaUNIXSocket</a>)</span>
&mdash;    <div class='inline'>
<p>the created socket</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L225-L253'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='225' data-end='253'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 225</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_new_socket'>new_socket</span>(<span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_port'>port</span>  <span class='op'>||=</span> <span class='ivar'>@bind_port</span>
  <span class='id identifier rubyid_path'>path</span>  <span class='op'>||=</span> <span class='ivar'>@bind_path</span>
  <span class='id identifier rubyid_ip'>ip</span> <span class='op'>||=</span> (<span class='id identifier rubyid_host'>host</span> <span class='op'>||</span> <span class='const'><a href="../TestPuma.html#HOST-constant" title="TestPuma::HOST (constant)">HOST</a></span>.<span class='id identifier rubyid_ip'>ip</span>).<span class='id identifier rubyid_gsub'>gsub</span> <span class='const'><a href="../TestPuma.html#RE_HOST_TO_IP-constant" title="TestPuma::RE_HOST_TO_IP (constant)">RE_HOST_TO_IP</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>  <span class='comment'># in case a URI style IPv6 is passed
</span>
  <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_port'>port</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_ctx'>ctx</span>
      <span class='const'><a href="PumaUNIXSocket.html" title="TestPuma::PumaUNIXSocket (class)">PumaUNIXSocket</a></span>.<span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A@</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># sub is for abstract
</span>    <span class='kw'>elsif</span> <span class='id identifier rubyid_port'>port</span> <span class='comment'># &amp;&amp; !path
</span>      <span class='id identifier rubyid_tcp'>tcp</span> <span class='op'>=</span> <span class='const'><a href="PumaTCPSocket.html" title="TestPuma::PumaTCPSocket (class)">PumaTCPSocket</a></span>.<span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_ip'>ip</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_tcp'>tcp</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'>Socket</span><span class='op'>::</span><span class='const'>IPPROTO_TCP</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>TCP_NODELAY</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='kw'>if</span> <span class='const'><a href="#SET_TCP_NODELAY-constant" title="TestPuma::PumaSocket::SET_TCP_NODELAY (constant)">SET_TCP_NODELAY</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>
        <span class='ivar'>@ssl_socket_contexts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ctx'>ctx</span> <span class='kw'>if</span> <span class='ivar'>@ssl_socket_contexts</span>
        <span class='const'><a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a></span>.<span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_tcp'>tcp</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_tcp'>tcp</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>port or path must be set!</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

  <span class='ivar'>@ios_to_close</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_skt'>skt</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>
    <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span> <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span>
    <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_sync_close'>sync_close</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_connect'>connect</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_skt'>skt</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_response_array-instance_method">
  <h3 class='signature '>
    #<strong>read_response_array</strong>(skts, resp_count: nil, body_only: nil)  &#x21d2; <code>Array</code>&lt;<code>String</code>, <code>Class</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reads an array of sockets that have already had requests sent.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>skts</span>
    <span class='type'>(<code>Array</code>&lt;<code>Sockets</code>])</span>
&mdash;    <div class='inline'>
<p>an array of sockets that have already had requests sent</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>, <code>Class</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>an array matching the order of the parameter <code>skts</code>, contains the response or the error class generated by the socket.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L284-L323'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='284' data-end='323'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 284</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_response_array'>read_response_array</span>(<span class='id identifier rubyid_skts'>skts</span><span class='comma'>,</span> <span class='label'>resp_count:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>body_only:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>Array</span>.<span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_skts'>skts</span>.<span class='id identifier rubyid_length'>length</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
    <span class='kw'>until</span> <span class='id identifier rubyid_skts'>skts</span>.<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_skts'>skts</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_skt'>skt</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_nil?'>nil?</span>
        <span class='kw'>begin</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_wait_readable'>wait_readable</span> <span class='float'>0.000_5</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_resp_count'>resp_count</span>
            <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_read_response'>read_response</span>.<span class='id identifier rubyid_dup'>dup</span>
            <span class='id identifier rubyid_cntr'>cntr</span> <span class='op'>=</span> <span class='int'>0</span>
            <span class='kw'>until</span> <span class='id identifier rubyid_resp'>resp</span>.<span class='id identifier rubyid_split'>split</span>(<span class='const'><a href="../TestPuma.html#RESP_SPLIT-constant" title="TestPuma::RESP_SPLIT (constant)">RESP_SPLIT</a></span>).<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='id identifier rubyid_resp_count'>resp_count</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_cntr'>cntr</span> <span class='op'>&gt;</span> <span class='int'>20</span>
              <span class='id identifier rubyid_cntr'>cntr</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='const'>Thread</span>.<span class='id identifier rubyid_pass'>pass</span>
              <span class='kw'>if</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_wait_readable'>wait_readable</span> <span class='float'>0.001</span>
                <span class='kw'>begin</span>
                  <span class='id identifier rubyid_resp'>resp</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_read_response'>read_response</span>
                <span class='kw'>rescue</span> <span class='const'>EOFError</span>
                  <span class='kw'>break</span>
                <span class='kw'>end</span>
              <span class='kw'>end</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_results'>results</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_resp'>resp</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_results'>results</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_body_only'>body_only</span> <span class='op'>?</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_read_body'>read_body</span> <span class='op'>:</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_read_response'>read_response</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_results'>results</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span>
        <span class='kw'>end</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_closed?'>closed?</span> <span class='comment'># skt.close may return Errno::EBADF
</span>        <span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_results'>results</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>||=</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_skts'>skts</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_join'>join</span> <span class='int'>15</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http-instance_method">
  <h3 class='signature '>
    #<strong>send_http</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil)  &#x21d2; <a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, ... 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a request and returns the socket</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <code>nil</code>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>The request stirng.</p>
</div>
  </li>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl host</p>
</div>
  </li>
  <li>
    <span class='name'>port</span>
    <span class='type'>(<code>Integer</code>/<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl port</p>
</div>
  </li>
  <li>
    <span class='name'>path</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>unix socket, full path</p>
</div>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>ssl context</p>
</div>
  </li>
  <li>
    <span class='name'>session:</span>
    <span class='type'>(<code>OpenSSL::SSL::Session</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>ssl session</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, <a href="PumaTCPSocket.html" title="TestPuma::PumaTCPSocket (class)">PumaTCPSocket</a>, <a href="PumaUNIXSocket.html" title="TestPuma::PumaUNIXSocket (class)">PumaUNIXSocket</a>)</span>
&mdash;    <div class='inline'>
<p>the created socket</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L181-L184'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='181' data-end='184'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 181</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http'>send_http</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_new_socket'><a href="#new_socket-instance_method" title="TestPuma::PumaSocket#new_socket (method)">new_socket</a></span>(<span class='label'>host:</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span>)
    .<span class='id identifier rubyid_send_http'>send_http</span> <span class='id identifier rubyid_req'>req</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_array-instance_method">
  <h3 class='signature '>
    #<strong>send_http_array</strong>(req = GET_11, len, dly: 0.000_1, max_retries: 5)  &#x21d2; <code>Array</code>&lt;<a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, <a href="PumaTCPSocket.html" title="TestPuma::PumaTCPSocket (class)">PumaTCPSocket</a>, <a href="PumaUNIXSocket.html" title="TestPuma::PumaUNIXSocket (class)">PumaUNIXSocket</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an array of sockets, sending a request on each</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>the request</p>
</div>
  </li>
  <li>
    <span class='name'>len</span>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>the number of requests to send</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L260-L276'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='260' data-end='276'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http_array'>send_http_array</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='label'>dly:</span> <span class='float'>0.000_1</span><span class='comma'>,</span> <span class='label'>max_retries:</span> <span class='int'>5</span>)
  <span class='const'>Array</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_len'>len</span>) {
    <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span> <span class='id identifier rubyid_send_http'><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">send_http</a></span> <span class='id identifier rubyid_req'>req</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='id identifier rubyid_dly'>dly</span> <span class='kw'>if</span> <span class='id identifier rubyid_dly'>dly</span>
      <span class='id identifier rubyid_skt'>skt</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNREFUSED</span>
      <span class='id identifier rubyid_retries'>retries</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_max_retries'>max_retries</span>
        <span class='kw'>retry</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_flunk'>flunk</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Generate requests failed from Errno::ECONNREFUSED</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_all-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_all</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: RESP_READ_LEN, timeout: 15)  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a request and returns whatever can be read.  Use when multiple responses are sent by the server</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl host</p>
</div>
  </li>
  <li>
    <span class='name'>port</span>
    <span class='type'>(<code>Integer</code>/<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl port</p>
</div>
  </li>
  <li>
    <span class='name'>path</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>unix socket, full path</p>
</div>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>ssl context</p>
</div>
  </li>
  <li>
    <span class='name'>session:</span>
    <span class='type'>(<code>OpenSSL::SSL::Session</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>ssl session</p>
</div>
  </li>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>total socket read timeout, defaults to <a href="#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocket::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a></p>
</div>
  </li>
  <li>
    <span class='name'>len</span>
    <span class='type'>(<code>Integer</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the <code>read_nonblock</code> maxlen, defaults to <a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>socket read string</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L159-L163'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='159' data-end='163'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 159</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http_read_all'>send_http_read_all</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='const'><a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a></span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='int'>15</span>)
  <span class='id identifier rubyid_send_http'><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">send_http</a></span>(<span class='id identifier rubyid_req'>req</span><span class='comma'>,</span> <span class='label'>host:</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span>)
    .<span class='id identifier rubyid_read_all'>read_all</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='id identifier rubyid_len'>len</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_body-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_body</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; <a href="Response.html" title="TestPuma::Response (class)">Response</a> 
    <span class='aliases'>Also known as: <span class='names'>#send_http_read_resp_body</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a request and returns the HTTP response body.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl host</p>
</div>
  </li>
  <li>
    <span class='name'>port</span>
    <span class='type'>(<code>Integer</code>/<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl port</p>
</div>
  </li>
  <li>
    <span class='name'>path</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>unix socket, full path</p>
</div>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>ssl context</p>
</div>
  </li>
  <li>
    <span class='name'>session:</span>
    <span class='type'>(<code>OpenSSL::SSL::Session</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>ssl session</p>
</div>
  </li>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>total socket read timeout, defaults to <a href="#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocket::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a></p>
</div>
  </li>
  <li>
    <span class='name'>len</span>
    <span class='type'>(<code>Integer</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the <code>read_nonblock</code> maxlen, defaults to <a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Response.html" title="TestPuma::Response (class)">Response</a>)</span>
&mdash;    <div class='inline'>
<p>the body portion of the HTTP response</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L144-L148'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='144' data-end='148'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 144</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http_read_body'>send_http_read_body</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_send_http'><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">send_http</a></span>(<span class='id identifier rubyid_req'>req</span><span class='comma'>,</span> <span class='label'>host:</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span>)
    .<span class='id identifier rubyid_read_body'>read_body</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='id identifier rubyid_len'>len</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_headers-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_headers</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; <code>Array</code>&lt;<code>String</code>&gt; 
    <span class='aliases'>Also known as: <span class='names'>#send_http_read_resp_headers</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a request and returns the response header lines as an array of strings. Includes the status line.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl host</p>
</div>
  </li>
  <li>
    <span class='name'>port</span>
    <span class='type'>(<code>Integer</code>/<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl port</p>
</div>
  </li>
  <li>
    <span class='name'>path</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>unix socket, full path</p>
</div>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>ssl context</p>
</div>
  </li>
  <li>
    <span class='name'>session:</span>
    <span class='type'>(<code>OpenSSL::SSL::Session</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>ssl session</p>
</div>
  </li>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>total socket read timeout, defaults to <a href="#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocket::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a></p>
</div>
  </li>
  <li>
    <span class='name'>len</span>
    <span class='type'>(<code>Integer</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the <code>read_nonblock</code> maxlen, defaults to <a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>array of header lines in the response</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L132-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http_read_headers'>send_http_read_headers</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_send_http'><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">send_http</a></span>(<span class='id identifier rubyid_req'>req</span><span class='comma'>,</span> <span class='label'>host:</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span>)
    .<span class='id identifier rubyid_read_response'>read_response</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='id identifier rubyid_len'>len</span>)
    .<span class='id identifier rubyid_split'>split</span>(<span class='const'><a href="../TestPuma.html#RESP_SPLIT-constant" title="TestPuma::RESP_SPLIT (constant)">RESP_SPLIT</a></span><span class='comma'>,</span> <span class='int'>2</span>).<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_split'>split</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_resp_body-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_resp_body</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#send_http_read_body-instance_method" title="TestPuma::PumaSocket#send_http_read_body (method)">#send_http_read_body</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L151-L151'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='151' data-end='151'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 151</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_http_read_resp_body'>send_http_read_resp_body</span>    <span class='symbeg'>:</span><span class='id identifier rubyid_send_http_read_body'><a href="#send_http_read_body-instance_method" title="TestPuma::PumaSocket#send_http_read_body (method)">send_http_read_body</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_resp_headers-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_resp_headers</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#send_http_read_headers-instance_method" title="TestPuma::PumaSocket#send_http_read_headers (method)">#send_http_read_headers</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L150-L150'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='150'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_http_read_resp_headers'>send_http_read_resp_headers</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_http_read_headers'><a href="#send_http_read_headers-instance_method" title="TestPuma::PumaSocket#send_http_read_headers (method)">send_http_read_headers</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_http_read_response-instance_method">
  <h3 class='signature '>
    #<strong>send_http_read_response</strong>(req = GET_11, host: nil, port: nil, path: nil, ctx: nil, session: nil, len: nil, timeout: nil)  &#x21d2; <a href="Response.html" title="TestPuma::Response (class)">Response</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a request and returns the HTTP response.  Assumes one response is sent.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>req</span>
    <span class='type'>(<code>String</code>, <a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a>)</span>
    <em class='default'>(defaults to: <tt>GET_11</tt>)</em>
&mdash;    <div class='inline'>
<p>request path</p>
</div>
  </li>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl host</p>
</div>
  </li>
  <li>
    <span class='name'>port</span>
    <span class='type'>(<code>Integer</code>/<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>tcp/ssl port</p>
</div>
  </li>
  <li>
    <span class='name'>path</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>unix socket, full path</p>
</div>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<code>OpenSSL::SSL::SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>ssl context</p>
</div>
  </li>
  <li>
    <span class='name'>session:</span>
    <span class='type'>(<code>OpenSSL::SSL::Session</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>ssl session</p>
</div>
  </li>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>total socket read timeout, defaults to <a href="#RESP_READ_TIMEOUT-constant" title="TestPuma::PumaSocket::RESP_READ_TIMEOUT (constant)">RESP_READ_TIMEOUT</a></p>
</div>
  </li>
  <li>
    <span class='name'>len</span>
    <span class='type'>(<code>Integer</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the <code>read_nonblock</code> maxlen, defaults to <a href="#RESP_READ_LEN-constant" title="TestPuma::PumaSocket::RESP_READ_LEN (constant)">RESP_READ_LEN</a></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Response.html" title="TestPuma::Response (class)">Response</a>)</span>
&mdash;    <div class='inline'>
<p>the HTTP response</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L170-L174'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='170' data-end='174'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 170</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_http_read_response'>send_http_read_response</span>(<span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><a href="#GET_11-constant" title="TestPuma::PumaSocket::GET_11 (constant)">GET_11</a></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_send_http'><a href="#send_http-instance_method" title="TestPuma::PumaSocket#send_http (method)">send_http</a></span>(<span class='id identifier rubyid_req'>req</span><span class='comma'>,</span> <span class='label'>host:</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>ctx:</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span>)
    .<span class='id identifier rubyid_read_response'>read_response</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='label'>len:</span> <span class='id identifier rubyid_len'>len</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skt_closed_by_server-instance_method">
  <h3 class='signature '>
    #<strong>skt_closed_by_server</strong>(socket)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determines whether the socket has been closed by the server.  Only works when <code>Socket::TCP_INFO is defined</code>, linux/Ubuntu</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>socket</span>
    <span class='type'>(<a href="PumaSSLSocket.html" title="TestPuma::PumaSSLSocket (class)">PumaSSLSocket</a>, <a href="PumaTCPSocket.html" title="TestPuma::PumaTCPSocket (class)">PumaTCPSocket</a>, <a href="PumaUNIXSocket.html" title="TestPuma::PumaUNIXSocket (class)">PumaUNIXSocket</a>)</span>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if closed by server, false is indeterminate, as it may not be writable</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/main/test/helpers/test_puma/puma_socket.rb#L192-L205'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='192' data-end='205'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'test/helpers/test_puma/puma_socket.rb', line 192</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skt_closed_by_server'>skt_closed_by_server</span>(<span class='id identifier rubyid_socket'>socket</span>)
  <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_to_io'>to_io</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>TCPSocket</span>)

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tcp_info'>tcp_info</span> <span class='op'>=</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='const'>Socket</span><span class='op'>::</span><span class='const'>IPPROTO_TCP</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>TCP_INFO</span>)
  <span class='kw'>rescue</span> <span class='const'>IOError</span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
    <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_tcp_info'>tcp_info</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C</span><span class='tstring_end'>&#39;</span></span>)[<span class='int'>0</span>]
    <span class='comment'># TIME_WAIT: 6, CLOSE: 7, CLOSE_WAIT: 8, LAST_ACK: 9, CLOSING: 11
</span>    (<span class='id identifier rubyid_state'>state</span> <span class='op'>&gt;=</span> <span class='int'>6</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>&lt;=</span> <span class='int'>9</span>) <span class='op'>||</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>==</span> <span class='int'>11</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>