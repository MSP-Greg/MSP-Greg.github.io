<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionView::Helpers::CacheHelper &mdash; Rails 4.2.11.3</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionView::Helpers::CacheHelper",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 4.2.11.3</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActionView.html" title="ActionView (module)">ActionView</a> &raquo; 
        <a class='nodoc' href="../Helpers.html" title="ActionView::Helpers (module)">Helpers</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>CacheHelper&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionView::Helpers::CacheHelper</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="../Base.html" title="ActionView::Base (class)">::ActionView::Base</a>,
          <a class='nodoc' href="../Helpers.html" title="ActionView::Helpers (module)">::ActionView::Helpers</a>,
          <a href="../TestCase.html" title="ActionView::TestCase (class)">::ActionView::TestCase</a>,
          <a href="../TestCase/Behavior.html" title="ActionView::TestCase::Behavior (module)">::ActionView::TestCase::Behavior</a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/actionview/lib/action_view/helpers/cache_helper.rb#L4'>actionview/lib/action_view/helpers/cache_helper.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#cache-instance_method" title="#cache (instance method)">#<strong>cache</strong>(name = {}, options = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This helper exposes a method for caching fragments of a view rather than an entire action or page.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_fragment_name-instance_method" title="#cache_fragment_name (instance method)">#<strong>cache_fragment_name</strong>(name = {}, options = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This helper returns the name of a cache key for a given fragment cache call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_if-instance_method" title="#cache_if (instance method)">#<strong>cache_if</strong>(condition, name = {}, options = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache fragments of a view if <code>condition</code> is true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_unless-instance_method" title="#cache_unless (instance method)">#<strong>cache_unless</strong>(condition, name = {}, options = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache fragments of a view unless <code>condition</code> is true.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="cache-instance_method">
  <h3 class='signature  first'>
    #<strong>cache</strong>(name = {}, options = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This helper exposes a method for caching fragments of a view rather than an entire action or page. This technique is useful caching pieces like menus, lists of new topics, static HTML fragments, and so on. This method takes a block that contains the content you wish to cache.</p>

<p>The best way to use this is by doing key-based cache expiration on top of a cache store like Memcached that&#39;ll automatically kick out old entries. For more on key-based expiration, see: <a href="http://signalvnoise.com/posts/3113-how-key-based-cache-expiration-works">signalvnoise.com/posts/3113-how-key-based-cache-expiration-works</a></p>

<p>When using this method, you list the cache dependency as the name of the cache, like so:</p>

<pre class="code xml"><code class="xml">&lt;% cache project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<p>This approach will assume that when a new topic is added, you&#39;ll touch the project. The cache key generated from this call will be something like:</p>

<pre class="code ruby"><code class="ruby">views/projects/123-20120806214154/7a1156131a6928cb0026877f8b749ac9
      ^class   ^id ^updated_at    ^template tree digest</code></pre>

<p>The cache is thus automatically bumped whenever the project updated_at is touched.</p>

<p>If your template cache depends on multiple sources (try to avoid this to keep things simple), you can name all these dependencies as part of an array:</p>

<pre class="code xml"><code class="xml">&lt;% cache [ project, current_user ] do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<p>This will include both records as part of the cache key and updating either of them will expire the cache.</p>

<h5 id="label-Template+digest">Template digest</h5>

<p>The template digest that&#39;s added to the cache key is computed by taking an md5 of the contents of the entire template file. This ensures that your caches will automatically expire when you change the template file.</p>

<p>Note that the md5 is taken of the entire template file, not just what&#39;s within the cache do/end call. So it&#39;s possible that changing something outside of that call will still expire the cache.</p>

<p>Additionally, the digestor will automatically look through your template file for explicit and implicit dependencies, and include those as part of the digest.</p>

<p>The digestor can be bypassed by passing skip_digest: true as an option to the cache call:</p>

<pre class="code xml"><code class="xml">&lt;% cache project, skip_digest: true do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<h5 id="label-Implicit+dependencies">Implicit dependencies</h5>

<p>Most template dependencies can be derived from calls to render in the template itself. Here are some examples of render calls that Cache Digests knows how to decode:</p>

<pre class="code ruby"><code class="ruby">render partial: &quot;comments/comment&quot;, collection: commentable.comments
render &quot;comments/comments&quot;
render &#39;comments/comments&#39;
render(&#39;comments/comments&#39;)

render &quot;header&quot; =&gt; render(&quot;comments/header&quot;)

render(@topic)         =&gt; render(&quot;topics/topic&quot;)
render(topics)         =&gt; render(&quot;topics/topic&quot;)
render(message.topics) =&gt; render(&quot;topics/topic&quot;)</code></pre>

<p>It&#39;s not possible to derive all render calls like that, though. Here are a few examples of things that can&#39;t be derived:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_render'>render</span> <span class='id identifier rubyid_group_of_attachments'>group_of_attachments</span>
<span class='id identifier rubyid_render'>render</span> <span class='ivar'>@project</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>You will have to rewrite those to the explicit form:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachments/attachment</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='id identifier rubyid_group_of_attachments'>group_of_attachments</span>
<span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>documents/document</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='ivar'>@project</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<h4 id="label-Explicit+dependencies">Explicit dependencies</h4>

<p>Some times you&#39;ll have template dependencies that can&#39;t be derived at all. This is typically the case when you have template rendering that happens in helpers. Here&#39;s an example:</p>

<pre class="code xml"><code class="xml">&lt;%= render_sortable_todolists @project.todolists %&gt;
</code></pre>

<p>You&#39;ll need to use a special comment format to call those out:</p>

<pre class="code xml"><code class="xml">&lt;%# Template Dependency: todolists/todolist %&gt;
&lt;%= render_sortable_todolists @project.todolists %&gt;
</code></pre>

<p>The pattern used to match these is /# <a href="../Template.html" title="ActionView::Template (class)">::ActionView::Template</a> Dependency: ([^ ]+)/, so it&#39;s important that you type it out just so. You can only declare one template dependency per line.</p>

<h4 id="label-External+dependencies">External dependencies</h4>

<p>If you use a helper method, for example, inside of a cached block and you then update that helper, you&#39;ll have to bump the cache as well. It doesn&#39;t really matter how you do it, but the md5 of the template file must change. One recommendation is to simply be explicit in a comment, like:</p>

<pre class="code xml"><code class="xml">&lt;%# Helper Dependency Updated: May 6, 2012 at 6pm %&gt;
&lt;%= some_helper_method(person) %&gt;
</code></pre>

<p>Now all you&#39;ll have to do is change that timestamp when the helper method changes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/actionview/lib/action_view/helpers/cache_helper.rb#L113-L121'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='113' data-end='121'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 113</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache'>cache</span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_perform_caching'>perform_caching</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_perform_caching'>perform_caching</span>
    <span class='id identifier rubyid_safe_concat'>safe_concat</span>(<span class='id identifier rubyid_fragment_for'>fragment_for</span>(<span class='id identifier rubyid_cache_fragment_name'><a href="#cache_fragment_name-instance_method" title="ActionView::Helpers::CacheHelper#cache_fragment_name (method)">cache_fragment_name</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>))
  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_fragment_name-instance_method">
  <h3 class='signature '>
    #<strong>cache_fragment_name</strong>(name = {}, options = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This helper returns the name of a cache key for a given fragment cache call. By supplying skip_digest: true to cache, the digestion of cache fragments can be manually bypassed. This is useful when cache fragments cannot be manually expired unless you know the exact key which is the case when using memcached.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/actionview/lib/action_view/helpers/cache_helper.rb#L154-L162'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='154' data-end='162'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 154</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_fragment_name'>cache_fragment_name</span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_skip_digest'>skip_digest</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_skip_digest'>skip_digest</span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_skip_digest'>skip_digest</span>
    <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fragment_name_with_digest'>fragment_name_with_digest</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_if-instance_method">
  <h3 class='signature '>
    #<strong>cache_if</strong>(condition, name = {}, options = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache fragments of a view if <code>condition</code> is true</p>

<pre class="code xml"><code class="xml">&lt;% cache_if admin?, project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/actionview/lib/action_view/helpers/cache_helper.rb#L129-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_if'>cache_if</span>(<span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_condition'>condition</span>
    <span class='id identifier rubyid_cache'><a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">cache</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_unless-instance_method">
  <h3 class='signature '>
    #<strong>cache_unless</strong>(condition, name = {}, options = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache fragments of a view unless <code>condition</code> is true</p>

<pre class="code xml"><code class="xml">&lt;% cache_unless admin?, project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/actionview/lib/action_view/helpers/cache_helper.rb#L145-L147'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='147'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_unless'>cache_unless</span>(<span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_cache_if'><a href="#cache_if-instance_method" title="ActionView::Helpers::CacheHelper#cache_if (method)">cache_if</a></span> <span class='op'>!</span><span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>