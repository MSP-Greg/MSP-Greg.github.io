<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Record CHANGELOG &mdash; Rails 4.2.11.3</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_record_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 4.2.11.3</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Record CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>Rails 4.2.11.3 (May 15, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.11.2 (May 15, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.11.1 (March 11, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.11 (November 27, 2018)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.10 (September 27, 2017)</h2>
<ul>
<li>
<p><code>Relation#joins</code> is no longer affected by the target model's
<code>current_scope</code>, with the exception of <code>unscoped</code>.</p>
<p>Fixes #29338.</p>
<p><em>Sean Griffin</em></p>
</li>
</ul>
<h2>Rails 4.2.9 (June 26, 2017)</h2>
<ul>
<li>
<p>Fix regression caused by <code>collection_singular_ids=</code> ignoring different primary key on relationship.</p>
<p><em>Nick Pezza</em></p>
</li>
<li>
<p>Fix <code>rake db:schema:load</code> with subdirectories.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix <code>rake db:migrate:status</code> with subdirectories.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix regression of #1969 with SELECT aliases in HAVING clause.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>Fix <code>wait_timeout</code> to configurable for mysql2 adapter.</p>
<p>Fixes #26556.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Make <code>table_name=</code> reset current statement cache,
so queries are not run against the previous table name.</p>
<p><em>namusyaka</em></p>
</li>
</ul>
<h2>Rails 4.2.8 (February 21, 2017)</h2>
<ul>
<li>
<p>Using a mysql2 connection after it fails to reconnect will now have an error message
saying the connection is closed rather than an undefined method error message.</p>
<p><em>Dylan Thacker-Smith</em></p>
</li>
<li>
<p>Bust Model.attribute_names cache when resetting column information</p>
<p><em>James Coleman</em></p>
</li>
<li>
<p>Fix query caching when type information is reset</p>
<p>Backports ancillary fix in 5.0.</p>
<p><em>James Coleman</em></p>
</li>
<li>
<p>Allow <code>joins</code> to be unscoped.</p>
<p>Fixes #13775.</p>
<p><em>Takashi Kokubun</em></p>
</li>
<li>
<p>Hashes can once again be passed to setters of <code>composed_of</code>, if all of the
mapping methods are methods implemented on <a href="Hash.html" title="Hash (class)">Hash</a>.</p>
<p>Fixes #25978.</p>
<p><em>Sean Griffin</em></p>
</li>
</ul>
<h2>Rails 4.2.7 (July 12, 2016)</h2>
<ul>
<li>
<p>Inspecting an object with an associated array of over 10 elements no longer
truncates the array, preventing <code>inspect</code> from looping infinitely in some
cases.</p>
<p><em>Kevin McPhillips</em></p>
</li>
<li>
<p>Ensure hashes can be assigned to attributes created using <code>composed_of</code>.
Fixes #25210.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Queries such as <code>Computer.joins(:monitor).group(:status).count</code> will now be
interpreted as  <code>Computer.joins(:monitor).group('computers.status').count</code>
so that when <code>Computer</code> and <code>Monitor</code> have both <code>status</code> columns we don't
have conflicts in projection.</p>
<p><em>Rafael Sales</em></p>
</li>
<li>
<p>ActiveRecord::Relation#count: raise an ArgumentError when finder options
are specified or an ActiveRecord::StatementInvalid when an invalid type
is provided for a column name (e.g. a Hash).</p>
<p>Fixes #20434</p>
<p><em>Konstantinos Rousis</em></p>
</li>
<li>
<p>Correctly pass MySQL options when using structure_dump or structure_load</p>
<p>Specifically, it fixes an issue when using SSL authentication.</p>
<p><em>Alex Coomans</em></p>
</li>
</ul>
<h2>Rails 4.2.6 (March 07, 2016)</h2>
<ul>
<li>
<p>Fix a bug where using <code>t.foreign_key</code> twice with the same <code>to_table</code> within
the same table definition would only create one foreign key.</p>
<p><em>George Millo</em></p>
</li>
<li>
<p>Fix regression in dirty attribute tracking after #dup.  Changes to the
clone no longer show as changed attributes in the original object.</p>
<p><em>Dominic Cleal</em></p>
</li>
<li>
<p>Fix regression when loading fixture files with symbol keys.</p>
<p>Closes #22584.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix <code>rake db:structure:dump</code> on Postgres when multiple schemas are used.</p>
<p>Fixes #22346.</p>
<p><em>Nick Muerdter</em>, <em>ckoenig</em></p>
</li>
<li>
<p>Introduce <code>connection.data_sources</code> and <code>connection.data_source_exists?</code>.
These methods determine what relations can be used to back Active Record
models (usually tables and views).</p>
<p><em>Yves Senn</em>, <em>Matthew Draper</em></p>
</li>
</ul>
<h2>Rails 4.2.5.2 (February 26, 2016)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.5.1 (January 25, 2015)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 4.2.5 (November 12, 2015)</h2>
<ul>
<li>
<p>No longer pass deprecated option <code>-i</code> to <code>pg_dump</code>.</p>
<p><em>Paul Sadauskas</em></p>
</li>
<li>
<p>Set <code>scope.reordering_value</code> to <code>true</code> if <code>:reordering</code> values are specified.</p>
<p>Fixes #21886.</p>
<p><em>Hiroaki Izu</em></p>
</li>
<li>
<p>Avoid disabling errors on the PostgreSQL connection when enabling the
standard_conforming_strings setting. Errors were previously disabled because
the setting wasn't writable in Postgres 8.1 and didn't exist in earlier
versions. Now Rails only supports Postgres 8.2+ we're fine to assume the
setting exists. Disabling errors caused problems when using a connection
pooling tool like PgBouncer because it's not guaranteed to have the same
connection between calls to <code>execute</code> and it could leave the connection
with errors disabled.</p>
<p>Fixes #22101.</p>
<p><em>Harry Marr</em></p>
</li>
<li>
<p>Includes HABTM returns correct size now. It's caused by the join dependency
only instantiates one HABTM object because the join table hasn't a primary key.</p>
<p>Fixes #16032.</p>
<p>Examples:</p>
<pre class="code ruby"><code class="ruby">before:

Project.first.salaried_developers.size # =&gt; 3
Project.includes(:salaried_developers).first.salaried_developers.size # =&gt; 1

after:

Project.first.salaried_developers.size # =&gt; 3
Project.includes(:salaried_developers).first.salaried_developers.size # =&gt; 3</code></pre>
<p><em>Bigxiang</em></p>
</li>
<li>
<p>Descriptive error message when fixtures contain a missing column.</p>
<p>Closes #21201.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p><code>bin/rake db:migrate</code> uses
<a href="ActiveRecord/Tasks/DatabaseTasks.html#migrations_paths-instance_method" title="ActiveRecord::Tasks::DatabaseTasks#migrations_paths (method)">ActiveRecord::Tasks::DatabaseTasks#migrations_paths</a> instead of
<code>Migrator.migrations_paths</code>.</p>
<p><em>Tobias Bielohlawek</em></p>
</li>
<li>
<p>Fix <code>rewhere</code> in a <code>has_many</code> association.</p>
<p>Fixes #21955.</p>
<p><em>Josh Branchaud</em>, <em>Kal</em></p>
</li>
<li>
<p>Added run_cmd class method to ActiveRecord::Tasks::DatabaseTasks for
drying up Kernel.system() calls within this namespace and to avoid
shell expansion by using a paramter list instead of string as arguments
for Kernel.system(). Thanks to Nate Berkopec for supply patch to get
test units passing.</p>
<p><em>Bryan Paxton</em></p>
</li>
<li>
<p>Avoid leaking the first relation we call <code>first</code> on, per model.</p>
<p>Fixes #21921.</p>
<p><em>Matthew Draper</em>, <em>Jean Boussier</em></p>
</li>
<li>
<p>Allow deserialization of Active Record models that were YAML encoded prior
to Rails 4.2</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Correctly apply <code>unscope</code> when preloading through associations.</p>
<p><em>Jimmy Bourassa</em></p>
</li>
<li>
<p>Ensure <code>select</code> quotes aliased attributes, even when using <code>from</code>.</p>
<p>Fixes #21488</p>
<p><em>Sean Griffin &amp; @johanlunds</em></p>
</li>
<li>
<p>Correct query for PostgreSQL 8.2 compatibility.</p>
<p><em>Ben Murphy</em>, <em>Matthew Draper</em></p>
</li>
<li>
<p>Uniqueness validator raises descriptive error when running on a persisted
record without primary key.</p>
<p>Closes #21304.</p>
<p><em>Yves Senn</em></p>
</li>
</ul>
<h2>Rails 4.2.4 (August 24, 2015)</h2>
<ul>
<li>
<p>Skip statement cache on through association reader.</p>
<p>If the through class has default scopes we should skip the statement
cache.</p>
<p>Closes #20745.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Fixes #19420. When generating schema.rb using Postgres BigInt[] data type
the limit: 8 was not coming through. This caused it to become Int[] data type
after doing a rebuild off of schema.rb.</p>
<p><em>Jake Waller</em></p>
</li>
<li>
<p>Fix state being carried over from previous transaction.</p>
<p>Considering the following example where <code>name</code> is a required attribute.
Before we had <code>new_record?</code> returning <code>true</code> for a persisted record:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='const'>Author</span>.<span class='id identifier rubyid_create!'>create!</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_save'>save</span>        <span class='comment'># =&gt; false
</span><span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='comment'># =&gt; true</span></code></pre>
<p>Fixes #20824.</p>
<p><em>Roque Pinel</em></p>
</li>
<li>
<p>Correctly ignore <code>mark_for_destruction</code> when <code>autosave</code> isn't set to <code>true</code>
when validating associations.</p>
<p>Fixes #20882.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix through associations using scopes having the scope merged multiple
times.</p>
<p>Fixes #20721.
Fixes #20727.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><a href="ActiveRecord/Base.html#dump_schema_after_migration-class_method" title="ActiveRecord::Base.dump_schema_after_migration (method)">ActiveRecord::Base.dump_schema_after_migration</a> applies migration tasks
other than <code>db:migrate</code>. (eg. <code>db:rollback</code>, <code>db:migrate:dup</code>, ...)</p>
<p>Fixes #20743.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Correctly raise <a href="ActiveRecord/AssociationTypeMismatch.html" title="ActiveRecord::AssociationTypeMismatch (class)">::ActiveRecord::AssociationTypeMismatch</a> when assigning
a wrong type to a namespaced association.</p>
<p>Fixes #20545.</p>
<p><em>Diego Carrion</em></p>
</li>
<li>
<p>Prevent error when using <code>force_reload: true</code> on an unassigned polymorphic
belongs_to association.</p>
<p>Fixes #20426.</p>
<p><em>James Dabbs</em></p>
</li>
</ul>
<h2>Rails 4.2.3 (June 25, 2015)</h2>
<ul>
<li>
<p>Let <code>WITH</code> queries (Common Table Expressions) be explainable.</p>
<p><em>Vladimir Kochnev</em></p>
</li>
<li>
<p>Fix n+1 query problem when eager loading nil associations (fixes #18312)</p>
<p><em>Sammy Larbi</em></p>
</li>
<li>
<p>Fixed an error which would occur in dirty checking when calling
<code>update_attributes</code> from a getter.</p>
<p>Fixes #20531.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Ensure symbols passed to <code>ActiveRecord::Relation#select</code> are always treated
as columns.</p>
<p>Fixes #20360.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Clear query cache when <code>ActiveRecord::Base#reload</code> is called.</p>
<p><em>Shane Hender</em></p>
</li>
<li>
<p>Pass <code>:extend</code> option for <code>has_and_belongs_to_many</code> associations to the
underlying <code>has_many :through</code>.</p>
<p><em>Jaehyun Shin</em></p>
</li>
<li>
<p>Make <code>unscope</code> aware of &quot;less than&quot; and &quot;greater than&quot; conditions.</p>
<p><em>TAKAHASHI Kazuaki</em></p>
</li>
<li>
<p>Revert behavior of <code>db:schema:load</code> back to loading the full
environment. This ensures that initializers are run.</p>
<p>Fixes #19545.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix missing index when using <code>timestamps</code> with the <code>index</code> option.</p>
<p>The <code>index</code> option used with <code>timestamps</code> should be passed to both
<code>column</code> definitions for <code>created_at</code> and <code>updated_at</code> rather than just
the first.</p>
<p><em>Paul Mucur</em></p>
</li>
<li>
<p>Rename <code>:class</code> to <code>:anonymous_class</code> in association options.</p>
<p>Fixes #19659.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fixed a bug where uniqueness validations would error on out of range values,
even if an validation should have prevented it from hitting the database.</p>
<p><em>Andrey Voronkov</em></p>
</li>
<li>
<p>Foreign key related methods in the migration DSL respect
<code>ActiveRecord::Base.pluralize_table_names = false</code>.</p>
<p>Fixes #19643.</p>
<p><em>Mehmet Emin İNAÇ</em></p>
</li>
<li>
<p>Reduce memory usage from loading types on pg.</p>
<p>Fixes #19578.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix referencing wrong table aliases while joining tables of has many through
association (only when calling calculation methods).</p>
<p>Fixes #19276.</p>
<p><em>pinglamb</em></p>
</li>
<li>
<p>Don't attempt to update counter caches, when the column wasn't selected.</p>
<p>Fixes #19437.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Correctly persist a serialized attribute that has been returned to
its default value by an in-place modification.</p>
<p>Fixes #19467.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>Fix default <code>format</code> value in <a href="ActiveRecord/Tasks/DatabaseTasks.html#schema_file-instance_method" title="ActiveRecord::Tasks::DatabaseTasks#schema_file (method)">ActiveRecord::Tasks::DatabaseTasks#schema_file</a>.</p>
<p><em>James Cox</em></p>
</li>
<li>
<p>Dont enroll records in the transaction if they dont have commit callbacks.
That was causing a memory grow problem when creating a lot of records inside a transaction.</p>
<p>Fixes #15549.</p>
<p><em>Will Bryant</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>Correctly create through records when created on a has many through
association when using <code>where</code>.</p>
<p>Fixes #19073.</p>
<p><em>Sean Griffin</em></p>
</li>
</ul>
<h2>Rails 4.2.2 (June 16, 2015)</h2>
<ul>
<li>No Changes *</li>
</ul>
<h2>Rails 4.2.1 (March 19, 2015)</h2>
<ul>
<li>
<p>Fixed ActiveRecord::Relation#becomes! and changed_attributes issues for type column</p>
<p>Fixes #17139.</p>
<p><em>Miklos Fazekas</em></p>
</li>
<li>
<p><code>remove_reference</code> with <code>foreign_key: true</code> removes the foreign key before
removing the column. This fixes a bug where it was not possible to remove
the column on MySQL.</p>
<p>Fixes #18664.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Add a <code>:foreign_key</code> option to <code>references</code> and associated migration
methods. The model and migration generators now use this option, rather than
the <code>add_foreign_key</code> form.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix rounding problem for PostgreSQL timestamp column.</p>
<p>If timestamp column have the precision, it need to format according to
the precision of timestamp column.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Respect the database default charset for <code>schema_migrations</code> table.</p>
<p>The charset of <code>version</code> column in <code>schema_migrations</code> table is depend
on the database default charset and collation rather than the encoding
of the connection.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Respect custom primary keys for associations when calling <code>Relation#where</code></p>
<p>Fixes #18813.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fixed several edge cases which could result in a counter cache updating
twice or not updating at all for <code>has_many</code> and <code>has_many :through</code>.</p>
<p>Fixes #10865.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Foreign keys added by migrations were given random, generated names. This
meant a different <code>structure.sql</code> would be generated every time a developer
ran migrations on their machine.</p>
<p>The generated part of foreign key names is now a hash of the table name and
column name, which is consistent every time you run the migration.</p>
<p><em>Chris Sinjakli</em></p>
</li>
<li>
<p>Fixed ActiveRecord::Relation#group method when argument is SQL reserved key word:</p>
<p>SplitTest.group(:key).count
Property.group(:value).count</p>
<p><em>Bogdan Gusiev</em></p>
</li>
<li>
<p>Don't define autosave association callbacks twice from
<code>accepts_nested_attributes_for</code>.</p>
<p>Fixes #18704.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><a href="Integer.html" title="Integer (class)">Integer</a> types will no longer raise a <code>RangeError</code> when assigning an
attribute, but will instead raise when going to the database.</p>
<p>Fixes several vague issues which were never reported directly. See the
commit message from the commit which added this line for some examples.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Values which would error while being sent to the database (such as an
ASCII-8BIT string with invalid UTF-8 bytes on Sqlite3), no longer error on
assignment. They will still error when sent to the database, but you are
given the ability to re-assign it to a valid value.</p>
<p>Fixes #18580.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Don't remove join dependencies in <code>Relation#exists?</code></p>
<p>Fixes #18632.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Invalid values assigned to a JSON column are assumed to be <code>nil</code>.</p>
<p>Fixes #18629.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>No longer issue deprecation warning when including a scope with extensions.
Previously every scope with extension methods was transformed into an
instance dependent scope. Including such a scope would wrongfully issue a
deprecation warning. This is no longer the case.</p>
<p>Fixes #18467.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Correctly use the type provided by <code>serialize</code> when updating records using
optimistic locking.</p>
<p>Fixes #18385.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>attribute_will_change!</code> will no longer cause non-persistable attributes to
be sent to the database.</p>
<p>Fixes #18407.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Format the datetime string according to the precision of the datetime field.</p>
<p>Incompatible to rounding behavior between MySQL 5.6 and earlier.</p>
<p>In 5.5, when you insert <code>2014-08-17 12:30:00.999999</code> the fractional part
is ignored. In 5.6, it's rounded to <code>2014-08-17 12:30:01</code>:</p>
<p><a href="http://bugs.mysql.com/bug.php?id=68760">http://bugs.mysql.com/bug.php?id=68760</a></p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow precision option for MySQL datetimes.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Clear query cache on rollback.</p>
<p><em>Florian Weingarten</em></p>
</li>
<li>
<p>Fixed setting of foreign_key for through associations while building of new record.</p>
<p>Fixes #12698.</p>
<p><em>Ivan Antropov</em></p>
</li>
<li>
<p>Fixed automatic inverse_of for models nested in module.</p>
<p><em>Andrew McCloud</em></p>
</li>
<li>
<p>Fix <code>reaping_frequency</code> option when the value is a string.</p>
<p>This usually happens when it is configured using <code>DATABASE_URL</code>.</p>
<p><em>korbin</em></p>
</li>
<li>
<p>Fix error message when trying to create an associated record and the foreign
key is missing.</p>
<p>Before this fix the following exception was being raised:</p>
<pre class="code ruby"><code class="ruby">NoMethodError: undefined method `val&#39; for #&lt;Arel::Nodes::BindParam:0x007fc64d19c218&gt;</code></pre>
<p>Now the message is:</p>
<pre class="code ruby"><code class="ruby">ActiveRecord::UnknownAttributeError: unknown attribute &#39;foreign_key&#39; for Model.</code></pre>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Fix change detection problem for PostgreSQL bytea type and
<code>ArgumentError: string contains null byte</code> exception with pg-0.18.</p>
<p>Fixes #17680.</p>
<p><em>Lars Kanis</em></p>
</li>
<li>
<p>When a table has a composite primary key, the <code>primary_key</code> method for
SQLite3 and PostgreSQL adapters was only returning the first field of the key.
Ensures that it will return nil instead, as Active Record doesn't support
composite primary keys.</p>
<p>Fixes #18070.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Ensure <code>first!</code> and friends work on loaded associations.</p>
<p>Fixes #18237.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Dump the default <code>nil</code> for PostgreSQL UUID primary key.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Don't raise when writing an attribute with an out-of-range datetime passed
by the user.</p>
<p><em>Grey Baker</em></p>
</li>
<li>
<p>Fixes bug with 'ActiveRecord::Type::Numeric' that causes negative values to
be marked as having changed when set to the same negative value.</p>
<p>Fixes #18161.</p>
<p><em>Daniel Fox</em></p>
</li>
</ul>
<h2>Rails 4.2.0 (December 20, 2014)</h2>
<ul>
<li>
<p>Introduce <code>force: :cascade</code> option for <code>create_table</code>. Using this option
will recreate tables even if they have dependent objects (like foreign keys).
<code>db/schema.rb</code> now uses <code>force: :cascade</code>. This makes it possible to
reload the schema when foreign keys are in place.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p><code>db:schema:load</code> and <code>db:structure:load</code> no longer purge the database
before loading the schema. This is left for the user to do.
<code>db:test:prepare</code> will still purge the database.</p>
<p>Fixes #17945.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix undesirable RangeError by Type::Integer. Add Type::UnsignedInteger.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Add <code>foreign_type</code> option to <code>has_one</code> and <code>has_many</code> association macros.</p>
<p>This option enables to define the column name of associated object's type for polymorphic associations.</p>
<p><em>Ulisses Almeida, Kassio Borges</em></p>
</li>
<li>
<p><code>add_timestamps</code> and <code>remove_timestamps</code> now properly reversible with
options.</p>
<p><em>Noam Gagliardi-Rabinovich</em></p>
</li>
<li>
<p>Bring back <code>db:test:prepare</code> to synchronize the test database schema.</p>
<p>Manual synchronization using <code>bin/rake db:test:prepare</code> is required
when a migration is rolled-back, edited and reapplied.</p>
<p><a href="ActiveRecord/Base.html#maintain_test_schema-class_method" title="ActiveRecord::Base.maintain_test_schema (method)">ActiveRecord::Base.maintain_test_schema</a> now uses <code>db:test:prepare</code>
to synchronize the schema. Plugins can use this task as a hook to
provide custom behavior after the schema has been loaded.</p>
<p>NOTE: <code>test:prepare</code> runs before the schema is synchronized.</p>
<p>Fixes #17171, #15787.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Change <code>reflections</code> public api to return the keys as <a href="String.html" title="String (class)">String</a> objects.</p>
<p>Fixes #16928.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Renaming a table in pg also renames the primary key index.</p>
<p>Fixes #12856</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Make it possible to access fixtures excluded by a <code>default_scope</code>.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix preloading of associations with a scope containing joins along with
conditions on the joined association.</p>
<p><em>Siddharth Sharma</em></p>
</li>
<li>
<p>Add <code>Table#name</code> to match <code>TableDefinition#name</code>.</p>
<p><em>Cody Cutrer</em></p>
</li>
<li>
<p>Cache <code>CollectionAssociation#reader</code> proxies separately before and after
the owner has been saved so that the proxy is not cached without the
owner's id.</p>
<p><em>Ben Woosley</em></p>
</li>
<li>
<p><a href="ActiveRecord/ReadOnlyRecord.html" title="ActiveRecord::ReadOnlyRecord (class)">::ActiveRecord::ReadOnlyRecord</a> now has a descriptive message.</p>
<p><em>Franky W.</em></p>
</li>
<li>
<p>Fix preloading of associations which unscope a default scope.</p>
<p>Fixes #11036.</p>
<p><em>Byron Bischoff</em></p>
</li>
<li>
<p>Added SchemaDumper support for tables with jsonb columns.</p>
<p><em>Ted O'Meara</em></p>
</li>
<li>
<p>Deprecate <code>sanitize_sql_hash_for_conditions</code> without replacement. Using a
<code>Relation</code> for performing queries and updates is the prefered API.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Queries now properly type cast values that are part of a join statement,
even when using type decorators such as <code>serialize</code>.</p>
<p><em>Melanie Gilman &amp; Sean Griffin</em></p>
</li>
<li>
<p>MySQL enum type lookups, with values matching another type, no longer result
in an endless loop.</p>
<p>Fixes #17402.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Raise <code>ArgumentError</code> when the body of a scope is not callable.</p>
<p><em>Mauro George</em></p>
</li>
<li>
<p>Use type column first in multi-column indexes created with <code>add-reference</code>.</p>
<p><em>Derek Prior</em></p>
</li>
<li>
<p>Fix <code>Relation.rewhere</code> to work with <a href="Range.html" title="Range (class)">Range</a> values.</p>
<p><em>Dan Olson</em></p>
</li>
<li>
<p><code>AR::UnknownAttributeError</code> now includes the class name of a record.</p>
<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Yuki Nishijima</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>project_attributes:</span> {<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kaminari</span><span class='tstring_end'>&quot;</span></span>})
<span class='comment'># =&gt; ActiveRecord::UnknownAttributeError: unknown attribute &#39;name&#39; for User.</span></code></pre>
<p><em>Yuki Nishijima</em></p>
</li>
<li>
<p>Fix a regression causing <code>after_create</code> callbacks to run before associated
records are autosaved.</p>
<p>Fixes #17209.</p>
<p><em>Agis Anastasopoulos</em></p>
</li>
<li>
<p>Honor overridden <code>rack.test</code> in <a href="Rack.html" title="Rack (module)">Rack</a> environment for the connection
management middleware.</p>
<p><em>Simon Eskildsen</em></p>
</li>
<li>
<p>Add a truncate method to the connection.</p>
<p><em>Aaron Patterson</em></p>
</li>
<li>
<p>Don't autosave unchanged has_one through records.</p>
<p><em>Alan Kennedy</em>, <em>Steve Parrington</em></p>
</li>
<li>
<p>Do not dump foreign keys for ignored tables.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>PostgreSQL adapter correctly dumps foreign keys targeting tables
outside the schema search path.</p>
<p>Fixes #16907.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>When a thread is killed, rollback the active transaction, instead of
committing it during the stack unwind. Previously, we could commit half-
completed work. This fix only works for Ruby 2.0+; on 1.9, we can't
distinguish a thread kill from an ordinary non-local (block) return, so must
default to committing.</p>
<p><em>Chris Hanks</em></p>
</li>
<li>
<p>A <code>NullRelation</code> should represent nothing. This fixes a bug where
<code>Comment.where(post_id: Post.none)</code> returned a non-empty result.</p>
<p>Fixes #15176.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Include default column limits in schema.rb. Allows defaults to be changed
in the future without affecting old migrations that assumed old defaults.</p>
<p><em>Jeremy Kemper</em></p>
</li>
<li>
<p>MySQL: schema.rb now includes TEXT and BLOB column limits.</p>
<p><em>Jeremy Kemper</em></p>
</li>
<li>
<p>MySQL: correct LONGTEXT and LONGBLOB limits from 2GB to their true 4GB.</p>
<p><em>Jeremy Kemper</em></p>
</li>
<li>
<p>SQLite3Adapter now checks for views in <code>table_exists?</code>. Fixes #14041.</p>
<p><em>Girish Sonawane</em></p>
</li>
<li>
<p>Introduce <code>connection.supports_views?</code> to check whether the current adapter
has support for SQL views. Connection adapters should define this method.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Allow included modules to override association methods.</p>
<p>Fixes #16684.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Schema loading rake tasks (like <code>db:schema:load</code> and <code>db:setup</code>) maintain
the database connection to the current environment.</p>
<p>Fixes #16757.</p>
<p><em>Joshua Cody</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>MySQL: set the connection collation along with the charset.</p>
<p>Sets the connection collation to the database collation configured in
database.yml. Otherwise, <code>SET NAMES utf8mb4</code> will use the default
collation for that charset (utf8mb4_general_ci) when you may have chosen
a different collation, like utf8mb4_unicode_ci.</p>
<p>This only applies to literal string comparisons, not column values, so it
is unlikely to affect you.</p>
<p><em>Jeremy Kemper</em></p>
</li>
<li>
<p><code>default_sequence_name</code> from the PostgreSQL adapter returns a <a href="String.html" title="String (class)">String</a>.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix a regression where whitespaces were stripped from DISTINCT queries in
PostgreSQL.</p>
<p><em>Agis Anastasopoulos</em></p>
<p>Fixes #16623.</p>
</li>
<li>
<p>Fix has_many <code>:through</code> relation merging failing when dynamic conditions are
passed as a lambda with an arity of one.</p>
<p>Fixes #16128.</p>
<p><em>Agis Anastasopoulos</em></p>
</li>
<li>
<p>Fix <code>Relation#exists?</code> to work with polymorphic associations.</p>
<p>Fixes #15821.</p>
<p><em>Kassio Borges</em></p>
</li>
<li>
<p>Currently, Active Record rescues any errors raised within
<code>after_rollback</code>/<code>after_create</code> callbacks and prints them to the logs.
Future versions of Rails will not rescue these errors anymore and
just bubble them up like the other callbacks.</p>
<p>This commit adds an opt-in flag to enable not rescuing the errors.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># Do not swallow errors in after_commit/after_rollback callbacks.
</span><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_record'>active_record</span>.<span class='id identifier rubyid_raise_in_transactional_callbacks'>raise_in_transactional_callbacks</span> <span class='op'>=</span> <span class='kw'>true</span></code></pre>
<p>Fixes #13460.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Fix an issue where custom accessor methods (such as those generated by
<code>enum</code>) with the same name as a global method are incorrectly overridden
when subclassing.</p>
<p>Fixes #16288.</p>
<p><em>Godfrey Chan</em></p>
</li>
<li>
<p><code>*_was</code> and <code>changes</code> now work correctly for in-place attribute changes as
well.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix regression on <code>after_commit</code> that did not fire with nested transactions.</p>
<p>Fixes #16425.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Do not try to write timestamps when a table has no timestamps columns.</p>
<p>Fixes #8813.</p>
<p><em>Sergey Potapov</em></p>
</li>
<li>
<p><code>index_exists?</code> with <code>:name</code> option does verify specified columns.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_add_index'>add_index</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idx_title</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Before:
</span><span class='id identifier rubyid_index_exists?'>index_exists?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idx_title</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; `true`
</span><span class='id identifier rubyid_index_exists?'>index_exists?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idx_title</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; `true`
</span>
<span class='comment'># After:
</span><span class='id identifier rubyid_index_exists?'>index_exists?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idx_title</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; `true`
</span><span class='id identifier rubyid_index_exists?'>index_exists?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>idx_title</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; `false`</span></code></pre>
<p><em>Yves Senn</em>, <em>Matthew Draper</em></p>
</li>
<li>
<p><code>add_timestamps</code> and <code>t.timestamps</code> now require you to pass the <code>:null</code> option.
Not passing the option is deprecated but the default is still <code>null: true</code>.
With Rails 5 this will change to <code>null: false</code>.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>When calling <code>update_columns</code> on a record that is not persisted, the error
message now reflects whether that object is a new record or has been
destroyed.</p>
<p><em>Lachlan Sylvester</em></p>
</li>
<li>
<p>Define <code>id_was</code> to get the previous value of the primary key.</p>
<p>Currently when we call <code>id_was</code> and we have a custom primary key name,
Active Record will return the current value of the primary key. This
makes it impossible to correctly do an update operation if you change the
id.</p>
<p>Fixes #16413.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Deprecate <code>DatabaseTasks.load_schema</code> to act on the current connection.
Use <code>.load_schema_current</code> instead. In the future <code>load_schema</code> will
require the <code>configuration</code> to act on as an argument.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix automatic maintaining test schema to properly handle sql structure
schema format.</p>
<p>Fixes #15394.</p>
<p><em>Wojciech Wnętrzak</em></p>
</li>
<li>
<p>Fix type casting to Decimal from <a href="Float.html" title="Float (class)">Float</a> with large precision.</p>
<p><em>Tomohiro Hashidate</em></p>
</li>
<li>
<p>Deprecate <code>Reflection#source_macro</code></p>
<p><code>Reflection#source_macro</code> is no longer needed in Active Record
source so it has been deprecated. Code that used <code>source_macro</code>
was removed in #16353.</p>
<p><em>Eileen M. Uchtitelle</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>No verbose backtrace by <code>db:drop</code> when database does not exist.</p>
<p>Fixes #16295.</p>
<p><em>Kenn Ejima</em></p>
</li>
<li>
<p>Add support for PostgreSQL JSONB.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_jsonb'>jsonb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_meta_data'>meta_data</span>
<span class='kw'>end</span></code></pre>
<p><em>Philippe Creux</em>, <em>Chris Teague</em></p>
</li>
<li>
<p><code>db:purge</code> with MySQL respects <a href="Rails.html#env-class_method" title="Rails.env (method)">Rails.env</a>.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p><code>change_column_default &lt;code&gt;:table&lt;/code&gt;, &lt;code&gt;:column&lt;/code&gt;, nil</code> with PostgreSQL will issue a
<code>DROP DEFAULT</code> instead of a <code>DEFAULT NULL</code> query.</p>
<p>Fixes #16261.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Allow to specify a type for the foreign key column in <code>references</code>
and <code>add_reference</code>.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_change_table'>change_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_vehicle'>vehicle</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_references'>references</span> <span class='symbeg'>:</span><span class='id identifier rubyid_station'>station</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_uuid'>uuid</span>
<span class='kw'>end</span></code></pre>
<p><em>Andrey Novikov</em>, <em>Łukasz Sarnacki</em></p>
</li>
<li>
<p><code>create_join_table</code> removes a common prefix when generating the join table.
This matches the existing behavior of HABTM associations.</p>
<p>Fixes #13683.</p>
<p><em>Stefan Kanev</em></p>
</li>
<li>
<p>Do not swallow errors on <code>compute_type</code> when having a bad <code>alias_method</code> on
a class.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>PostgreSQL invalid <code>uuid</code> are convert to nil.</p>
<p><em>Abdelkader Boudih</em></p>
</li>
<li>
<p>Restore 4.0 behavior for using serialize attributes with <code>JSON</code> as coder.</p>
<p>With 4.1.x, <code>serialize</code> started returning a string when <code>JSON</code> was passed as
the second attribute. It will now return a hash as per previous versions.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_serialize'>serialize</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='const'>JSON</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Comment</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="ActiveModel.html" title="ActiveModel (module)">ActiveModel</a></span><span class='op'>::</span><span class='const'><a href="ActiveModel/Model.html" title="ActiveModel::Model (module)">Model</a></span>
  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_category'>category</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_create!'>create!</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='const'>Comment</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>category:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Animals</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>text:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is a comment about squirrels.</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save!'>save!</span>

<span class='comment'># 4.0
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comment'>comment</span> <span class='comment'># =&gt; {&quot;category&quot;=&gt;&quot;Animals&quot;, &quot;text&quot;=&gt;&quot;This is a comment about squirrels.&quot;}
</span>
<span class='comment'># 4.1 before
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comment'>comment</span> <span class='comment'># =&gt; &quot;#&lt;Comment:0x007f80ab48ff98&gt;&quot;
</span>
<span class='comment'># 4.1 after
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comment'>comment</span> <span class='comment'># =&gt; {&quot;category&quot;=&gt;&quot;Animals&quot;, &quot;text&quot;=&gt;&quot;This is a comment about squirrels.&quot;}</span></code></pre>
<p>When using <code>JSON</code> as the coder in <code>serialize</code>, Active Record will use the
new <a href="ActiveRecord/Coders/JSON.html" title="ActiveRecord::Coders::JSON (class)">::ActiveRecord::Coders::JSON</a> coder which delegates its <code>dump/load</code> to
<code>ActiveSupport::JSON.encode/decode</code>. This ensures special objects are dumped
correctly using the <code>#as_json</code> hook.</p>
<p>To keep the previous behaviour, supply a custom coder instead
(<a href="https://gist.github.com/jenncoop/8c4142bbe59da77daa63" target="_parent" title="example">example</a>).</p>
<p>Fixes #15594.</p>
<p><em>Jenn Cooper</em></p>
</li>
<li>
<p>Do not use <code>RENAME INDEX</code> syntax for MariaDB 10.0.</p>
<p>Fixes #15931.</p>
<p><em>Jeff Browning</em></p>
</li>
<li>
<p>Calling <code>#empty?</code> on a <code>has_many</code> association would use the value from the
counter cache if one exists.</p>
<p><em>David Verhasselt</em></p>
</li>
<li>
<p>Fix the schema dump generated for tables without constraints and with
primary key with default value of custom PostgreSQL function result.</p>
<p>Fixes #16111.</p>
<p><em>Andrey Novikov</em></p>
</li>
<li>
<p>Fix the SQL generated when a <code>delete_all</code> is run on an association to not
produce an <code>IN</code> statements.</p>
<p>Before:</p>
<p>UPDATE &quot;categorizations&quot; SET &quot;category_id&quot; = NULL WHERE
&quot;categorizations&quot;.&quot;category_id&quot; = 1 AND &quot;categorizations&quot;.&quot;id&quot; IN (1, 2)</p>
<p>After:</p>
<p>UPDATE &quot;categorizations&quot; SET &quot;category_id&quot; = NULL WHERE
&quot;categorizations&quot;.&quot;category_id&quot; = 1</p>
<p><em>Eileen M. Uchitelle, Aaron Patterson</em></p>
</li>
<li>
<p>Avoid type casting boolean and <a href="ActiveSupport/Duration.html" title="ActiveSupport::Duration (class)">::ActiveSupport::Duration</a> values to numeric
values for string columns. Otherwise, in some database, the string column
values will be coerced to a numeric allowing false or 0.seconds match any
string starting with a non-digit.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>App</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>apikey:</span> <span class='kw'>false</span>) <span class='comment'># =&gt; SELECT * FROM users WHERE apikey = &#39;0&#39;</span></code></pre>
<p><em>Dylan Thacker-Smith</em></p>
</li>
<li>
<p>Add a <code>:required</code> option to singular associations, providing a nicer
API for presence validations on associations.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix an error in <code>reset_counters</code> when associations have <code>select</code> scope.
(Call to <code>count</code> generated invalid SQL.)</p>
<p><em>Cade Truitt</em></p>
</li>
<li>
<p>After a successful <code>reload</code>, <code>new_record?</code> is always false.</p>
<p>Fixes #12101.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>PostgreSQL renaming table doesn't attempt to rename non existent sequences.</p>
<p><em>Abdelkader Boudih</em></p>
</li>
<li>
<p>Move 'dependent: :destroy' handling for <code>belongs_to</code>
from <code>before_destroy</code> to <code>after_destroy</code> callback chain</p>
<p>Fixes #12380.</p>
<p><em>Ivan Antropov</em></p>
</li>
<li>
<p>Detect in-place modifications on <a href="String.html" title="String (class)">String</a> attributes.</p>
<p>Before this change, an attribute modified in-place had to be marked as
changed in order for it to be persisted in the database. Now it is no longer
required.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> Griffin</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name_will_change!'>name_will_change!</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_reload'>reload</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &quot;Sean Griffin&quot;</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> Griffin</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_reload'>reload</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &quot;Sean Griffin&quot;</span></code></pre>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Add <code>ActiveRecord::Base#validate!</code> that raises <code>RecordInvalid</code> if the record
is invalid.</p>
<p><em>Bogdan Gusiev</em>, <em>Marc Schütz</em></p>
</li>
<li>
<p>Support for adding and removing foreign keys. Foreign keys are now
a part of <code>schema.rb</code>. This is supported by Mysql2Adapter, MysqlAdapter
and PostgreSQLAdapter.</p>
<p>Many thanks to <em>Matthew Higgins</em> for laying the foundation with his work on
<a href="https://github.com/matthuhiggins/foreigner" target="_parent" title="foreigner">foreigner</a>.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># within your migrations:
</span><span class='id identifier rubyid_add_foreign_key'>add_foreign_key</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authors'>authors</span>
<span class='id identifier rubyid_remove_foreign_key'>remove_foreign_key</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authors'>authors</span></code></pre>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix subtle bugs regarding attribute assignment on models with no primary
key. <code>'id'</code> will no longer be part of the attributes hash.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Deprecate automatic counter caches on <code>has_many :through</code>. The behavior was
broken and inconsistent.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>preload</code> preserves readonly flag for associations.</p>
<p>See #15853.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Assume numeric types have changed if they were assigned to a value that
would fail numericality validation, regardless of the old value. Previously
this would only occur if the old value was 0.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_model'>model</span> <span class='op'>=</span> <span class='const'>Model</span>.<span class='id identifier rubyid_create!'>create!</span>(<span class='label'>number:</span> <span class='int'>5</span>)
<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>5wibble</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_number_changed?'>number_changed?</span> <span class='comment'># =&gt; true</span></code></pre>
<p>Fixes #14731.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>reload</code> no longer merges with the existing attributes.
The attribute hash is fully replaced. The record is put into the same state
as it would be with <code>Model.find(model.id)</code>.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>The object returned from <code>select_all</code> must respond to <code>column_types</code>.
If this is not the case a <code>NoMethodError</code> is raised.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Detect in-place modifications of PG array types</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Add <code>bin/rake db:purge</code> task to empty the current database.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Deprecate <code>serialized_attributes</code> without replacement.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Correctly extract IPv6 addresses from <code>DATABASE_URI</code>: the square brackets
are part of the URI structure, not the actual host.</p>
<p>Fixes #15705.</p>
<p><em>Andy Bakun</em>, <em>Aaron Stone</em></p>
</li>
<li>
<p>Ensure both parent IDs are set on join records when both sides of a
through association are new.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>ActiveRecord::Dirty</code> now detects in-place changes to mutable values.
Serialized attributes on ActiveRecord models will no longer save when
unchanged.</p>
<p>Fixes #8328.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>Pluck</code> now works when selecting columns from different tables with the same
name.</p>
<p>Fixes #15649.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Remove <code>cache_attributes</code> and friends. All attributes are cached.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Remove deprecated method <code>ActiveRecord::Base.quoted_locking_column</code>.</p>
<p><em>Akshay Vishnoi</em></p>
</li>
<li>
<p><a href="ActiveRecord/FinderMethods.html#find-instance_method" title="ActiveRecord::FinderMethods#find (method)">ActiveRecord::FinderMethods#find</a> with block can handle proc parameter as
<code>Enumerable#find</code> does.</p>
<p>Fixes #15382.</p>
<p><em>James Yang</em></p>
</li>
<li>
<p>Make timezone aware attributes work with PostgreSQL array columns.</p>
<p>Fixes #13402.</p>
<p><em>Kuldeep Aggarwal</em>, <em>Sean Griffin</em></p>
</li>
<li>
<p><a href="ActiveRecord/SchemaMigration.html" title="ActiveRecord::SchemaMigration (class)">::ActiveRecord::SchemaMigration</a> has no primary key regardless of the
<code>primary_key_prefix_type</code> configuration.</p>
<p>Fixes #15051.</p>
<p><em>JoseLuis Torres</em>, <em>Yves Senn</em></p>
</li>
<li>
<p><code>rake db:migrate:status</code> works with legacy migration numbers like <code>00018_xyz.rb</code>.</p>
<p>Fixes #15538.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Baseclass becomes! subclass.</p>
<p>Before this change, a record which changed its STI type, could not be
updated.</p>
<p>Fixes #14785.</p>
<p><em>Matthew Draper</em>, <em>Earl St Sauver</em>, <em>Edo Balvers</em></p>
</li>
<li>
<p>Remove deprecated <code>ActiveRecord::Migrator.proper_table_name</code>. Use the
<code>proper_table_name</code> instance method on <a href="ActiveRecord/Migration.html" title="ActiveRecord::Migration (class)">::ActiveRecord::Migration</a> instead.</p>
<p><em>Akshay Vishnoi</em></p>
</li>
<li>
<p>Fix regression on eager loading association based on SQL query rather than
existing column.</p>
<p>Fixes #15480.</p>
<p><em>Lauro Caetano</em>, <em>Carlos Antonio da Silva</em></p>
</li>
<li>
<p>Deprecate returning <code>nil</code> from <code>column_for_attribute</code> when no column exists.
It will return a null object in Rails 5.0</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Implemented <code>ActiveRecord::Base#pretty_print</code> to work with PP.</p>
<p><em>Ethan</em></p>
</li>
<li>
<p>Preserve type when dumping PostgreSQL point, bit, bit varying and money
columns.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>New records remain new after YAML serialization.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>PostgreSQL support default values for enum types. Fixes #7814.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>PostgreSQL <code>default_sequence_name</code> respects schema. Fixes #7516.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix <code>columns_for_distinct</code> of PostgreSQL adapter to work correctly
with orders without sort direction modifiers.</p>
<p><em>Nikolay Kondratyev</em></p>
</li>
<li>
<p>PostgreSQL <code>reset_pk_sequence!</code> respects schemas. Fixes #14719.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Keep PostgreSQL <code>hstore</code> and <code>json</code> attributes as <a href="Hash.html" title="Hash (class)">Hash</a> in <code>@attributes</code>.
Fixes duplication in combination with <code>store_accessor</code>.</p>
<p>Fixes #15369.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p><code>rake railties:install:migrations</code> respects the order of railties.</p>
<p><em>Arun Agrawal</em></p>
</li>
<li>
<p>Fix redefine a <code>has_and_belongs_to_many</code> inside inherited class
Fixing regression case, where redefining the same <code>has_and_belongs_to_many</code>
definition into a subclass would raise.</p>
<p>Fixes #14983.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Fix <code>has_and_belongs_to_many</code> public reflection.
When defining a <code>has_and_belongs_to_many</code>, internally we convert that to two has_many.
But as <code>reflections</code> is a public API, people expect to see the right macro.</p>
<p>Fixes #14682.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Fix serialization for records with an attribute named <code>format</code>.</p>
<p>Fixes #15188.</p>
<p><em>Godfrey Chan</em></p>
</li>
<li>
<p>When a <code>group</code> is set, <code>sum</code>, <code>size</code>, <code>average</code>, <code>minimum</code> and <code>maximum</code>
on a NullRelation should return a Hash.</p>
<p><em>Kuldeep Aggarwal</em></p>
</li>
<li>
<p>Fix serialized fields returning serialized data after being updated with
<code>update_column</code>.</p>
<p><em>Simon Hørup Eskildsen</em></p>
</li>
<li>
<p>Fix polymorphic eager loading when using a <a href="String.html" title="String (class)">String</a> as foreign key.</p>
<p>Fixes #14734.</p>
<p><em>Lauro Caetano</em></p>
</li>
<li>
<p>Change belongs_to touch to be consistent with timestamp updates</p>
<p>If a model is set up with a belongs_to: touch relationship the parent
record will only be touched if the record was modified. This makes it
consistent with timestamp updating on the record itself.</p>
<p><em>Brock Trappitt</em></p>
</li>
<li>
<p>Fix the inferred table name of a <code>has_and_belongs_to_many</code> auxiliary
table inside a schema.</p>
<p>Fixes #14824.</p>
<p><em>Eric Chahin</em></p>
</li>
<li>
<p>Remove unused <code>:timestamp</code> type. Transparently alias it to <code>:datetime</code>
in all cases. Fixes inconsistencies when column types are sent outside of
<a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a>, such as for XML Serialization.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Fix bug that added <code>table_name_prefix</code> and <code>table_name_suffix</code> to
extension names in PostgreSQL when migrating.</p>
<p><em>Joao Carlos</em></p>
</li>
<li>
<p>The <code>:index</code> option in migrations, which previously was only available for
<code>references</code>, now works with any column types.</p>
<p><em>Marc Schütz</em></p>
</li>
<li>
<p>Add support for counter name to be passed as parameter on <code>CounterCache::ClassMethods#reset_counters</code>.</p>
<p><em>jnormore</em></p>
</li>
<li>
<p>Restrict deletion of record when using <code>delete_all</code> with <code>uniq</code>, <code>group</code>, <code>having</code>
or <code>offset</code>.</p>
<p>In these cases the generated query ignored them and that caused unintended
records to be deleted.</p>
<p>Fixes #11985.</p>
<p><em>Leandro Facchinetti</em></p>
</li>
<li>
<p>Floats with limit &gt;= 25 that get turned into doubles in MySQL no longer have
their limit dropped from the schema.</p>
<p>Fixes #14135.</p>
<p><em>Aaron Nelson</em></p>
</li>
<li>
<p>Fix how to calculate associated class name when using namespaced <code>has_and_belongs_to_many</code>
association.</p>
<p>Fixes #14709.</p>
<p><em>Kassio Borges</em></p>
</li>
<li>
<p>ActiveRecord::Relation::Merger#filter_binds now compares equivalent symbols and
strings in column names as equal.</p>
<p>This fixes a rare case in which more bind values are passed than there are
placeholders for them in the generated SQL statement, which can make PostgreSQL
throw a <code>StatementInvalid</code> exception.</p>
<p><em>Nat Budin</em></p>
</li>
<li>
<p>Fix <code>stored_attributes</code> to correctly merge the details of stored
attributes defined in parent classes.</p>
<p>Fixes #14672.</p>
<p><em>Brad Bennett</em>, <em>Jessica Yao</em>, <em>Lakshmi Parthasarathy</em></p>
</li>
<li>
<p><code>change_column_default</code> allows <code>[]</code> as argument to <code>change_column_default</code>.</p>
<p>Fixes #11586.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Handle <code>name</code> and <code>&quot;char&quot;</code> column types in the PostgreSQL adapter.</p>
<p><code>name</code> and <code>&quot;char&quot;</code> are special character types used internally by
PostgreSQL and are used by internal system catalogs. These field types
can sometimes show up in structure-sniffing queries that feature internal system
structures or with certain PostgreSQL extensions.</p>
<p><em>J Smith</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Fix <code>PostgreSQLAdapter::OID::Float#type_cast</code> to convert Infinity and
NaN PostgreSQL values into a native Ruby <code>Float::INFINITY</code> and <code>Float::NAN</code></p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Point</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>value:</span> <span class='float'>1.0</span><span class='op'>/</span><span class='int'>0</span>)
<span class='const'>Point</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; 0.0</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Point</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>value:</span> <span class='float'>1.0</span><span class='op'>/</span><span class='int'>0</span>)
<span class='const'>Point</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; Infinity</span></code></pre>
<p><em>Innokenty Mikhailov</em></p>
</li>
<li>
<p>Allow the PostgreSQL adapter to handle bigserial primary key types again.</p>
<p>Fixes #10410.</p>
<p><em>Patrick Robertson</em></p>
</li>
<li>
<p>Deprecate joining, eager loading and preloading of instance dependent
associations without replacement. These operations happen before instances
are created. The current behavior is unexpected and can result in broken
behavior.</p>
<p>Fixes #15024.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix <code>has_and_belongs_to_many</code> CollectionAssociation size calculations.</p>
<p><code>has_and_belongs_to_many</code> should fall back to using the normal CollectionAssociation's
size calculation if the collection is not cached or loaded.</p>
<p>Fixes #14913, #14914.</p>
<p><em>Fred Wu</em></p>
</li>
<li>
<p>Return a non zero status when running <code>rake db:migrate:status</code> and migration table does
not exist.</p>
<p><em>Paul B.</em></p>
</li>
<li>
<p>Add support for module-level <code>table_name_suffix</code> in models.</p>
<p>This makes <code>table_name_suffix</code> work the same way as <code>table_name_prefix</code> when
using namespaced models.</p>
<p><em>Jenner LaFave</em></p>
</li>
<li>
<p>Revert the behaviour of <code>ActiveRecord::Relation#join</code> changed through 4.0 =&gt; 4.1 to 4.0.</p>
<p>In 4.1.0 <code>Relation#join</code> is delegated to <code>Arel#SelectManager</code>.
In 4.0 series it is delegated to <code>Array#join</code>.</p>
<p><em>Bogdan Gusiev</em></p>
</li>
<li>
<p>Log nil binary column values correctly.</p>
<p>When an object with a binary column is updated with a nil value
in that column, the SQL logger would throw an exception when trying
to log that nil value. This only occurs when updating a record
that already has a non-nil value in that column since an initial nil
value isn't included in the SQL anyway (at least, when dirty checking
is enabled.) The column's new value will now be logged as <code>&lt;NULL binary data&gt;</code>
to parallel the existing <code>&lt;N bytes of binary data&gt;</code> for non-nil values.</p>
<p><em>James Coleman</em></p>
</li>
<li>
<p><a href="Rails.html" title="Rails (module)">Rails</a> will now pass a custom validation context through to autosave associations
in order to validate child associations with the same context.</p>
<p>Fixes #13854.</p>
<p><em>Eric Chahin</em>, <em>Aaron Nelson</em>, <em>Kevin Casey</em></p>
</li>
<li>
<p>Stringify all variables keys of MySQL connection configuration.</p>
<p>When <code>sql_mode</code> variable for MySQL adapters set in configuration as <a href="String.html" title="String (class)">String</a>
was ignored and overwritten by strict mode option.</p>
<p>Fixes #14895.</p>
<p><em>Paul Nikitochkin</em></p>
</li>
<li>
<p>Ensure SQLite3 statements are closed on errors.</p>
<p>Fixes #13631.</p>
<p><em>Timur Alperovich</em></p>
</li>
<li>
<p>Give <a href="ActiveRecord/PredicateBuilder.html" title="ActiveRecord::PredicateBuilder (class)">::ActiveRecord::PredicateBuilder</a> private methods the privacy they deserve.</p>
<p><em>Hector Satre</em></p>
</li>
<li>
<p>When using a custom <code>join_table</code> name on a <code>habtm</code>, rails was not saving it
on Reflections. This causes a problem when rails loads fixtures, because it
uses the reflections to set database with fixtures.</p>
<p>Fixes #14845.</p>
<p><em>Kassio Borges</em></p>
</li>
<li>
<p>Reset the cache when modifying a Relation with cached Arel.
Additionally display a warning message to make the user aware.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>PostgreSQL should internally use <code>:datetime</code> consistently for TimeStamp. Assures
different spellings of timestamps are treated the same.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mytimestamp'>mytimestamp</span>.<span class='id identifier rubyid_simplified_type'>simplified_type</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timestamp without time zone</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; :datetime
</span><span class='id identifier rubyid_mytimestamp'>mytimestamp</span>.<span class='id identifier rubyid_simplified_type'>simplified_type</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timestamp(6) without time zone</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; also :datetime (previously would be :timestamp)</span></code></pre>
<p>See #14513.</p>
<p><em>Jefferson Lai</em></p>
</li>
<li>
<p><code>ActiveRecord::Base.no_touching</code> no longer triggers callbacks or start empty transactions.</p>
<p>Fixes #14841.</p>
<p><em>Lucas Mazza</em></p>
</li>
<li>
<p>Fix name collision with <code>Array#select!</code> with <code>Relation#select!</code>.</p>
<p>Fixes #14752.</p>
<p><em>Earl St Sauver</em></p>
</li>
<li>
<p>Fix unexpected behavior for <code>has_many :through</code> associations going through
a scoped <code>has_many</code>.</p>
<p>If a <code>has_many</code> association is adjusted using a scope, and another
<code>has_many :through</code> uses this association, then the scope adjustment is
unexpectedly neglected.</p>
<p>Fixes #14537.</p>
<p><em>Jan Habermann</em></p>
</li>
<li>
<p><code>@destroyed</code> should always be set to <code>false</code> when an object is duped.</p>
<p><em>Kuldeep Aggarwal</em></p>
</li>
<li>
<p>Enable <code>has_many</code> associations to support irregular inflections.</p>
<p>Fixes #8928.</p>
<p><em>arthurnn</em>, <em>Javier Goizueta</em></p>
</li>
<li>
<p>Fix <code>count</code> used with a grouping not returning a <a href="Hash.html" title="Hash (class)">Hash</a>.</p>
<p>Fixes #14721.</p>
<p><em>Eric Chahin</em></p>
</li>
<li>
<p><code>sanitize_sql_like</code> helper method to escape a string for safe use in an SQL
LIKE statement.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_search'>search</span>(<span class='id identifier rubyid_term'>term</span>)
    <span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title LIKE ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_sanitize_sql_like'>sanitize_sql_like</span>(<span class='id identifier rubyid_term'>term</span>))
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>Article</span>.<span class='id identifier rubyid_search'>search</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20% _reduction_</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; Query looks like &quot;... title LIKE &#39;20\% \_reduction\_&#39; ...&quot;</span></code></pre>
<p><em>Rob Gilson</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Do not quote uuid default value on <code>change_column</code>.</p>
<p>Fixes #14604.</p>
<p><em>Eric Chahin</em></p>
</li>
<li>
<p>The comparison between <code>Relation</code> and <code>CollectionProxy</code> should be consistent.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_posts'>posts</span> <span class='op'>==</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>author_id:</span> <span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_id'>id</span>)
<span class='comment'># =&gt; true
</span><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>author_id:</span> <span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_id'>id</span>) <span class='op'>==</span> <span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_posts'>posts</span>
<span class='comment'># =&gt; true</span></code></pre>
<p>Fixes #13506.</p>
<p><em>Lauro Caetano</em></p>
</li>
<li>
<p>Calling <code>delete_all</code> on an unloaded <code>CollectionProxy</code> no longer
generates an SQL statement containing each id of the collection:</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby">DELETE FROM `model` WHERE `model`.`parent_id` = 1
AND `model`.`id` IN (1, 2, 3...)</code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby">DELETE FROM `model` WHERE `model`.`parent_id` = 1</code></pre>
<p><em>Eileen M. Uchitelle</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>Fix invalid SQL when aggregate methods (<code>empty?</code>, <code>any?</code>, <code>count</code>) used
with <code>select</code>.</p>
<p>Fixes #13648.</p>
<p><em>Simon Woker</em></p>
</li>
<li>
<p>PostgreSQL adapter only warns once for every missing OID per connection.</p>
<p>Fixes #14275.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>PostgreSQL adapter automatically reloads it's type map when encountering
unknown OIDs.</p>
<p>Fixes #14678.</p>
<p><em>Matthew Draper</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Fix insertion of records via <code>has_many :through</code> association with scope.</p>
<p>Fixes #3548.</p>
<p><em>Ivan Antropov</em></p>
</li>
<li>
<p>Auto-generate stable fixture UUIDs on PostgreSQL.</p>
<p>Fixes #11524.</p>
<p><em>Roderick van Domburg</em></p>
</li>
<li>
<p>Fix a problem where an enum would overwrite values of another enum with the
same name in an unrelated class.</p>
<p>Fixes #14607.</p>
<p><em>Evan Whalen</em></p>
</li>
<li>
<p>PostgreSQL and SQLite string columns no longer have a default limit of 255.</p>
<p>Fixes #13435, #9153.</p>
<p><em>Vladimir Sazhin</em>, <em>Toms Mikoss</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Make possible to have an association called <code>records</code>.</p>
<p>Fixes #11645.</p>
<p><em>prathamesh-sonpatki</em></p>
</li>
<li>
<p><code>to_sql</code> on an association now matches the query that is actually executed, where it
could previously have incorrectly accrued additional conditions (e.g. as a result of
a previous query). <code>CollectionProxy</code> now always defers to the association scope's
<code>arel</code> method so the (incorrect) inherited one should be entirely concealed.</p>
<p>Fixes #14003.</p>
<p><em>Jefferson Lai</em></p>
</li>
<li>
<p>Block a few default <a href="Class.html" title="Class (class)">Class</a> methods as scope name.</p>
<p>For instance, this will raise:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_scope'>scope</span> <span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span>(<span class='label'>status:</span> <span class='int'>1</span>) }</code></pre>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Fix error when using <code>with_options</code> with lambda.</p>
<p>Fixes #9805.</p>
<p><em>Lauro Caetano</em></p>
</li>
<li>
<p>Switch <code>sqlite3:///</code> URLs (which were temporarily
deprecated in 4.1) from relative to absolute.</p>
<p>If you still want the previous interpretation, you should replace
<code>sqlite3:///my/path</code> with <code>sqlite3:my/path</code>.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>Treat blank UUID values as <code>nil</code>.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Sample</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>uuid_field:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'>#=&gt; &lt;Sample id: nil, uuid_field: nil&gt;</span></code></pre>
<p><em>Dmitry Lavrov</em></p>
</li>
<li>
<p>Enable support for materialized views on PostgreSQL &gt;= 9.3.</p>
<p><em>Dave Lee</em></p>
</li>
<li>
<p>The PostgreSQL adapter supports custom domains. Fixes #14305.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>PostgreSQL <code>Column#type</code> is now determined through the corresponding OID.
The column types stay the same except for enum columns. They no longer have
<code>nil</code> as type but <code>enum</code>.</p>
<p>See #7814.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Fix error when specifying a non-empty default value on a PostgreSQL array
column.</p>
<p>Fixes #10613.</p>
<p><em>Luke Steensen</em></p>
</li>
<li>
<p>Fix error where <code>.persisted?</code> throws SystemStackError for an unsaved model with a
custom primary key that did not save due to validation error.</p>
<p>Fixes #14393.</p>
<p><em>Chris Finne</em></p>
</li>
<li>
<p>Introduce <code>validate</code> as an alias for <code>valid?</code>.</p>
<p>This is more intuitive when you want to run validations but don't care about the return value.</p>
<p><em>Henrik Nyh</em></p>
</li>
<li>
<p>Create indexes inline in CREATE TABLE for MySQL.</p>
<p>This is important, because adding an index on a temporary table after it has been created
would commit the transaction.</p>
<p>It also allows creating and dropping indexed tables with fewer queries and fewer permissions
required.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_temp'>temp</span><span class='comma'>,</span> <span class='label'>temporary:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id, name, zip FROM a_really_complicated_query</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_index'>index</span> <span class='symbeg'>:</span><span class='id identifier rubyid_zip'>zip</span>
<span class='kw'>end</span>
<span class='comment'># =&gt; CREATE TEMPORARY TABLE temp (INDEX (zip)) AS SELECT id, name, zip FROM a_really_complicated_query</span></code></pre>
<p><em>Cody Cutrer</em>, <em>Steve Rice</em>, <em>Rafael Mendonça Franca</em></p>
</li>
<li>
<p>Use singular table name in generated migrations when
<a href="ActiveRecord/Base.html#pluralize_table_names-class_method" title="ActiveRecord::Base.pluralize_table_names (method)">ActiveRecord::Base.pluralize_table_names</a> is <code>false</code>.</p>
<p>Fixes #13426.</p>
<p><em>Kuldeep Aggarwal</em></p>
</li>
<li>
<p><code>touch</code> accepts many attributes to be touched at once.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># touches :signed_at, :sealed_at, and :updated_at/on attributes.
</span><span class='const'>Photo</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_touch'>touch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_signed_at'>signed_at</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_sealed_at'>sealed_at</span>)</code></pre>
<p><em>James Pinto</em></p>
</li>
<li>
<p><code>rake db:structure:dump</code> only dumps schema information if the schema
migration table exists.</p>
<p>Fixes #14217.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Reap connections that were checked out by now-dead threads, instead
of waiting until they disconnect by themselves. Before this change,
a suitably constructed series of short-lived threads could starve
the connection pool, without ever having more than a couple alive at
the same time.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p><code>pk_and_sequence_for</code> now ensures that only the pg_depend entries
pointing to pg_class, and thus only sequence objects, are considered.</p>
<p><em>Josh Williams</em></p>
</li>
<li>
<p><code>where.not</code> adds <code>references</code> for <code>includes</code> like normal <code>where</code> calls do.</p>
<p>Fixes #14406.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Extend fixture <code>$LABEL</code> replacement to allow string interpolation.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby">martin:
  email: $LABEL@email.com

users(:martin).email # =&gt; martin@email.com</code></pre>
<p><em>Eric Steele</em></p>
</li>
<li>
<p>Add support for <code>Relation</code> be passed as parameter on <code>QueryCache#select_all</code>.</p>
<p>Fixes #14361.</p>
<p><em>arthurnn</em></p>
</li>
<li>
<p>Passing an Active Record object to <code>find</code> or <code>exists?</code> is now deprecated.
Call <code>.id</code> on the object first.</p>
<p><em>Aaron Patterson</em></p>
</li>
<li>
<p>Only use BINARY for MySQL case sensitive uniqueness check when column
has a case insensitive collation.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Support for MySQL 5.6 fractional seconds.</p>
<p><em>arthurnn</em>, <em>Tatsuhiko Miyagawa</em></p>
</li>
<li>
<p>Support for PostgreSQL <code>citext</code> data type enabling case-insensitive
<code>where</code> values without needing to wrap in UPPER/LOWER sql functions.</p>
<p><em>Troy Kruthoff</em>, <em>Lachlan Sylvester</em></p>
</li>
<li>
<p>Only save has_one associations if record has changes.
Previously after save related callbacks, such as <code>#after_commit</code>, were triggered when the has_one
object did not get saved to the db.</p>
<p><em>Alan Kennedy</em></p>
</li>
<li>
<p>Allow strings to specify the <code>#order</code> value.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_order'>order</span>(<span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>asc</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_to_sql'>to_sql</span> <span class='op'>==</span> <span class='const'>Model</span>.<span class='id identifier rubyid_order'>order</span>(<span class='label'>id:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_asc'>asc</span>).<span class='id identifier rubyid_to_sql'>to_sql</span></code></pre>
<p><em>Marcelo Casiraghi</em>, <em>Robin Dupret</em></p>
</li>
<li>
<p>Dynamically register PostgreSQL enum OIDs. This prevents &quot;unknown OID&quot;
warnings on enum columns.</p>
<p><em>Dieter Komendera</em></p>
</li>
<li>
<p><code>includes</code> is able to detect the right preloading strategy when string
joins are involved.</p>
<p>Fixes #14109.</p>
<p><em>Aaron Patterson</em>, <em>Yves Senn</em></p>
</li>
<li>
<p>Fix error with validation with enum fields for records where the value for
any enum attribute is always evaluated as 0 during uniqueness validation.</p>
<p>Fixes #14172.</p>
<p><em>Vilius Luneckas</em> <em>Ahmed AbouElhamayed</em></p>
</li>
<li>
<p><code>before_add</code> callbacks are fired before the record is saved on
<code>has_and_belongs_to_many</code> associations <em>and</em> on <code>has_many :through</code>
associations.  Before this change, <code>before_add</code> callbacks would be fired
before the record was saved on <code>has_and_belongs_to_many</code> associations, but
<em>not</em> on <code>has_many :through</code> associations.</p>
<p>Fixes #14144.</p>
</li>
<li>
<p>Fix STI classes not defining an attribute method if there is a conflicting
private method defined on its ancestors.</p>
<p>Fixes #11569.</p>
<p><em>Godfrey Chan</em></p>
</li>
<li>
<p>Coerce strings when reading attributes. Fixes #10485.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_book'>book</span> <span class='op'>=</span> <span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>title:</span> <span class='int'>12345</span>)
<span class='id identifier rubyid_book'>book</span>.<span class='id identifier rubyid_save!'>save!</span>
<span class='id identifier rubyid_book'>book</span>.<span class='id identifier rubyid_title'>title</span> <span class='comment'># =&gt; &quot;12345&quot;</span></code></pre>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Deprecate half-baked support for PostgreSQL range values with excluding beginnings.
We currently map PostgreSQL ranges to Ruby ranges. This conversion is not fully
possible because the Ruby range does not support excluded beginnings.</p>
<p>The current solution of incrementing the beginning is not correct and is now
deprecated. For subtypes where we don't know how to increment (e.g. <code>#succ</code>
is not defined) it will raise an <code>ArgumentException</code> for ranges with excluding
beginnings.</p>
<p><em>Yves Senn</em></p>
</li>
<li>
<p>Support for user created range types in PostgreSQL.</p>
<p><em>Yves Senn</em></p>
</li>
</ul>
<p>Please check <a href="https://github.com/rails/rails/blob/4-1-stable/activerecord/CHANGELOG.md" target="_parent" title="4-1-stable">4-1-stable</a> for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>