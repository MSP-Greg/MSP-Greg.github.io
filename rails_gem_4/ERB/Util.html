<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ERB::Util &mdash; Rails 4.2.11.3</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ERB::Util",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 4.2.11.3</a> &raquo; 
      <a href='../_index.html#alpha_U'>Index (U)</a> &raquo; 
        <a href="../ERB.html" title="ERB (class)">ERB</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Util&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ERB::Util</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="../ActionView/Base.html" title="ActionView::Base (class)">::ActionView::Base</a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L6'>activesupport/lib/active_support/core_ext/string/output_safety.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='HTML_ESCAPE-constant' class='summary_signature'>HTML_ESCAPE =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L7-L7'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 7</a>    <pre class='code ruby'>{ <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;amp;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>   <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;lt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;quot;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;#39;</span><span class='tstring_end'>&#39;</span></span> }</pre>
  </li>
  <li>
    <span id='HTML_ESCAPE_ONCE_REGEXP-constant' class='summary_signature'>HTML_ESCAPE_ONCE_REGEXP =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L10-L10'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 10</a>    <pre class='code ruby'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[&quot;&gt;&lt;&#39;]|&amp;(?!([a-zA-Z]|(#\d)|(#[xX][\dA-Fa-f]+));)</span><span class='regexp_end'>/</span></span></pre>
  </li>
  <li>
    <span id='HTML_ESCAPE_REGEXP-constant' class='summary_signature'>HTML_ESCAPE_REGEXP =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L9-L9'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 9</a>    <pre class='code ruby'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[&amp;&quot;&#39;&gt;&lt;]</span><span class='regexp_end'>/</span></span></pre>
  </li>
  <li>
    <span id='JSON_ESCAPE-constant' class='summary_signature'>JSON_ESCAPE =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L8-L8'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 8</a>    <pre class='code ruby'>{ <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\u0026</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\u003e</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\u003c</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u2028</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\u2028</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u2029</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\u2029</span><span class='tstring_end'>&#39;</span></span> }</pre>
  </li>
  <li>
    <span id='JSON_ESCAPE_REGEXP-constant' class='summary_signature'>JSON_ESCAPE_REGEXP =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L11-L11'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 11</a>    <pre class='code ruby'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\u2028\u2029&amp;&gt;&lt;]</span><span class='regexp_end'>/u</span></span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature mf'>
      <a href="#h-class_method" title=".h (class method)">.<strong>h</strong>(s)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for #html_escape.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#html_escape-class_method" title=".html_escape (class method)">.<strong>html_escape</strong>(s)  </a>
      (also: #h)
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>A utility method for escaping HTML tag characters.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#html_escape_once-class_method" title=".html_escape_once (class method)">.<strong>html_escape_once</strong>(s)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>A utility method for escaping HTML without affecting existing escaped entities.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#json_escape-class_method" title=".json_escape (class method)">.<strong>json_escape</strong>(s)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>A utility method for escaping HTML entities in JSON strings.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="h-class_method">
  <h3 class='signature private first'>
    .<strong>h</strong>(s)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for #html_escape.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L27-L27'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='27' data-end='27'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 27</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_h'>h</span> <span class='id identifier rubyid_html_escape'><a href="#html_escape-class_method" title="ERB::Util.html_escape (method)">html_escape</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="html_escape-class_method">
  <h3 class='signature private'>
    .<strong>html_escape</strong>(s)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#h</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A utility method for escaping HTML tag characters. This method is also aliased as <a href="#h-class_method" title="ERB::Util.h (method)">.h</a>.</p>

<p>In your <a href="../ERB.html" title="ERB (class)">::ERB</a> templates, use this method to escape any unsafe content. For example:</p>

<pre class="code ruby"><code class="ruby">&lt;%=h @person.name %&gt;

puts html_escape(&#39;is a &gt; 0 &amp; a &lt; 10?&#39;)
# =&gt; is a &amp;gt; 0 &amp;amp; a &amp;lt; 10?</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L21-L23'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='23'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_html_escape'>html_escape</span>(<span class='id identifier rubyid_s'>s</span>)
  <span class='id identifier rubyid_unwrapped_html_escape'><a href="#unwrapped_html_escape-class_method" title="ERB::Util.unwrapped_html_escape (method)">unwrapped_html_escape</a></span>(<span class='id identifier rubyid_s'>s</span>).<span class='id identifier rubyid_html_safe'>html_safe</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="html_escape_once-class_method">
  <h3 class='signature private'>
    .<strong>html_escape_once</strong>(s)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A utility method for escaping HTML without affecting existing escaped entities.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_html_escape_once'>html_escape_once</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1 &lt; 2 &amp;amp; 3</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; &quot;1 &amp;lt; 2 &amp;amp; 3&quot;
</span>
<span class='id identifier rubyid_html_escape_once'>html_escape_once</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;lt;&amp;lt; Accept &amp; Checkout</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; &quot;&amp;lt;&amp;lt; Accept &amp;amp; Checkout&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L53-L56'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='53' data-end='56'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 53</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_html_escape_once'>html_escape_once</span>(<span class='id identifier rubyid_s'>s</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_gsub'>gsub</span>(<span class='const'><a href="#HTML_ESCAPE_ONCE_REGEXP-constant" title="ERB::Util::HTML_ESCAPE_ONCE_REGEXP (constant)">HTML_ESCAPE_ONCE_REGEXP</a></span><span class='comma'>,</span> <span class='const'><a href="#HTML_ESCAPE-constant" title="ERB::Util::HTML_ESCAPE (constant)">HTML_ESCAPE</a></span>)
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='op'>?</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_html_safe'>html_safe</span> <span class='op'>:</span> <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="json_escape-class_method">
  <h3 class='signature private'>
    .<strong>json_escape</strong>(s)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A utility method for escaping HTML entities in JSON strings. Specifically, the &amp;, &gt; and &lt; characters are replaced with their equivalent unicode escaped form - u0026, u003e, and u003c. The Unicode sequences u2028 and u2029 are also escaped as they are treated as newline characters in some JavaScript engines. These sequences have identical meaning as the original characters inside the context of a JSON string, so assuming the input is a valid and well-formed JSON value, the output will have equivalent meaning when parsed:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_json'>json</span> <span class='op'>=</span> <span class='const'>JSON</span>.<span class='id identifier rubyid_generate'>generate</span>({ <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;</span><span class='tstring_end'>&quot;</span></span>})
<span class='comment'># =&gt; &quot;{\&quot;name\&quot;:\&quot;&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;\&quot;}&quot;
</span>
<span class='id identifier rubyid_json_escape'>json_escape</span>(<span class='id identifier rubyid_json'>json</span>)
<span class='comment'># =&gt; &quot;{\&quot;name\&quot;:\&quot;\\u003C/script\\u003E\\u003Cscript\\u003Ealert(&#39;PWNED!!!&#39;)\\u003C/script\\u003E\&quot;}&quot;
</span>
<span class='const'>JSON</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_json'>json</span>) <span class='op'>==</span> <span class='const'>JSON</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_json_escape'>json_escape</span>(<span class='id identifier rubyid_json'>json</span>))
<span class='comment'># =&gt; true</span></code></pre>

<p>The intended use case for this method is to escape JSON strings before including them inside a script tag to avoid XSS vulnerability:</p>

<pre class="code xml"><code class="xml">&lt;script&gt;
  var currentUser = &lt;%= raw json_escape(current_user.to_json) %&gt;;
&lt;/script&gt;
</code></pre>

<p>It is necessary to <code>raw</code> the result of <code>json_escape</code>, so that quotation marks don&#39;t get converted to <code>&amp;quot;</code> entities. <code>json_escape</code> doesn&#39;t automatically flag the result as HTML safe, since the raw value is unsafe to use inside HTML attributes.</p>

<p>If you need to output JSON elsewhere in your HTML, you can just do something like this, as any unsafe characters (including quotation marks) will be automatically escaped for you:</p>

<pre class="code xml"><code class="xml">&lt;div data-user-info=&quot;&lt;%= current_user.to_json %&gt;&quot;&gt;...&lt;/div&gt;
</code></pre>

<p>WARNING: this helper only works with valid JSON. Using this on non-JSON values will open up serious XSS vulnerabilities. For example, if you replace the <code>current_user.to_json</code> in the example above with user input instead, the browser will happily eval() that string as JavaScript.</p>

<p>The escaping performed in this method is identical to those performed in the Active Support JSON encoder when <code>ActiveSupport.escape_html_entities_in_json</code> is set to true. Because this transformation is idempotent, this helper can be applied even if <code>ActiveSupport.escape_html_entities_in_json</code> is already true.</p>

<p>Therefore, when you are unsure if <code>ActiveSupport.escape_html_entities_in_json</code> is enabled, or if you are unsure where your JSON string originated from, it is recommended that you always apply this helper (other libraries, such as the JSON gem, do not provide this kind of protection by default; also some gems might override <code>to_json</code> to bypass Active Support&#39;s encoder).</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v4.2.11.3/activesupport/lib/active_support/core_ext/string/output_safety.rb#L110-L113'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='110' data-end='113'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/core_ext/string/output_safety.rb', line 110</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_json_escape'>json_escape</span>(<span class='id identifier rubyid_s'>s</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_gsub'>gsub</span>(<span class='const'><a href="#JSON_ESCAPE_REGEXP-constant" title="ERB::Util::JSON_ESCAPE_REGEXP (constant)">JSON_ESCAPE_REGEXP</a></span><span class='comma'>,</span> <span class='const'><a href="#JSON_ESCAPE-constant" title="ERB::Util::JSON_ESCAPE (constant)">JSON_ESCAPE</a></span>)
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='op'>?</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_html_safe'>html_safe</span> <span class='op'>:</span> <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>