<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Unicorn::CGIWrapper &mdash; Unicorn master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Unicorn::CGIWrapper",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Unicorn master</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a class='nodoc' href="../Unicorn.html" title="Unicorn (module)">Unicorn</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>CGIWrapper&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Unicorn::CGIWrapper</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          CGI
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          CGI
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>CGI</span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'>CGI</li>
          <li class='next'>Unicorn::CGIWrapper</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L22'>lib/unicorn/cgi_wrapper.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The beginning of a complete wrapper around Unicorn’s internal HTTP processing system but maintaining the original Ruby CGI module.  Use this only as a crutch to get existing CGI based systems working.  It should handle everything, but please notify us if you see special warnings.  This work is still very alpha so we need testers to help work out the various corner cases.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='CHARSET-constant' class='summary_signature nodoc'>CHARSET =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Completely ignored. Why is CGI doing this?</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L30-L30'># File 'lib/unicorn/cgi_wrapper.rb', line 30</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>charset</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='CONNECTION-constant' class='summary_signature nodoc'>CONNECTION =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Completely ignored, <a href="../Unicorn.html" title="Unicorn (module)"><code>::Unicorn</code></a> outputs the date regardless</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L29-L29'># File 'lib/unicorn/cgi_wrapper.rb', line 29</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>connection</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='CONTENT_LENGTH-constant' class='summary_signature nodoc'>CONTENT_LENGTH =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>this is NOT <code>Const::CONTENT_LENGTH</code></p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L39-L39'># File 'lib/unicorn/cgi_wrapper.rb', line 39</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Length</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='CONTENT_TYPE-constant' class='summary_signature nodoc'>CONTENT_TYPE =</span>
    <br/>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L38-L38'># File 'lib/unicorn/cgi_wrapper.rb', line 38</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='COOKIE-constant' class='summary_signature nodoc'>COOKIE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>this gets appended to Content-Type</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L31-L31'># File 'lib/unicorn/cgi_wrapper.rb', line 31</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cookie</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='HEADER_MAP-constant' class='summary_signature nodoc'>HEADER_MAP =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>this maps CGI header names to HTTP header names</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L44-L51'># File 'lib/unicorn/cgi_wrapper.rb', line 44</a>    <pre class='code ruby'>{
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>status</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#Status-constant" title="Unicorn::CGIWrapper::Status (constant)">Status</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#CONTENT_TYPE-constant" title="Unicorn::CGIWrapper::CONTENT_TYPE (constant)">CONTENT_TYPE</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>server</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Server</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>language</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Language</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expires</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Expires</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#CONTENT_LENGTH-constant" title="Unicorn::CGIWrapper::CONTENT_LENGTH (constant)">CONTENT_LENGTH</a></span><span class='comma'>,</span>
}</pre>
  </li>
  <li>
    <span id='NPH-constant' class='summary_signature nodoc'>NPH =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>these are stripped out of any keys passed to <a href="#header-instance_method" title="Unicorn::CGIWrapper#header (method)">#header</a> function</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L28-L28'># File 'lib/unicorn/cgi_wrapper.rb', line 28</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nph</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='RACK_ERRORS-constant' class='summary_signature nodoc'>RACK_ERRORS =</span>
    <br/>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L41-L41'># File 'lib/unicorn/cgi_wrapper.rb', line 41</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.errors</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='RACK_INPUT-constant' class='summary_signature nodoc'>RACK_INPUT =</span>
    <br/>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L40-L40'># File 'lib/unicorn/cgi_wrapper.rb', line 40</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.input</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='SET_COOKIE-constant' class='summary_signature nodoc'>SET_COOKIE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>some of these are common strings, but this is the only module using them and the reason they’re not in <a href="Const.html" title="Unicorn::Const (module)"><code>Const</code></a></p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L37-L37'># File 'lib/unicorn/cgi_wrapper.rb', line 37</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Set-Cookie</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='STATUS-constant' class='summary_signature nodoc'>STATUS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>maps (Hash,Array,String) to “Set-Cookie” headers</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L32-L32'># File 'lib/unicorn/cgi_wrapper.rb', line 32</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>status</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='Status-constant' class='summary_signature nodoc'>Status =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>stored as @status</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L33-L33'># File 'lib/unicorn/cgi_wrapper.rb', line 33</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Status</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(rack_env, *args)  &#x21d2; CGIWrapper </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Takes an a Rackable environment, plus any additional <code>CGI.new</code> arguments These are used internally to create a wrapper around the real CGI while maintaining Rack/Unicorn’s view of the world.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#body-instance_method" title="#body (instance method)">#<strong>body</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#env_table-instance_method" title="#env_table (instance method)">#<strong>env_table</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#header-instance_method" title="#header (instance method)">#<strong>header</strong>(options = &quot;text/html&quot;)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The header is typically called to send back the header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#out-instance_method" title="#out (instance method)">#<strong>out</strong>(options = &quot;text/html&quot;)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The dumb thing is people can call header or this or both and in any order.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#rack_response-instance_method" title="#rack_response (instance method)">#<strong>rack_response</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>finalizes the response in a way Rack applications would expect.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#stdinput-instance_method" title="#stdinput (instance method)">#<strong>stdinput</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Used to wrap the normal stdinput variable used inside CGI.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#stdoutput-instance_method" title="#stdoutput (instance method)">#<strong>stdoutput</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>return a pointer to the StringIO body since it’s STDOUT-like.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>(rack_env, *args)  &#x21d2; <code>CGIWrapper</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Takes an a Rackable environment, plus any additional <code>CGI.new</code> arguments These are used internally to create a wrapper around the real CGI while maintaining Rack/Unicorn’s view of the world.  This this will NOT deal well with large responses that take up a lot of memory, but neither does the CGI nor the original <code>CGIWrapper</code> from Mongrel…</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L59-L66'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='59' data-end='66'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 59</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_rack_env'>rack_env</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='ivar'>@env_table</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_env'>rack_env</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@head</span> <span class='op'>=</span> {}
  <span class='ivar'>@headv</span> <span class='op'>=</span> <span class='const'>Hash</span>.<span class='id identifier rubyid_new'>new</span> { <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> [] }
  <span class='ivar'>@body</span> <span class='op'>=</span> <span class='const'>StringIO</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>super</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="body-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>body</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L25-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='25' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 25</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="env_table-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>env_table</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L24-L24'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='24' data-end='24'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 24</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_env_table'>env_table</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="header-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>header</strong>(options = &quot;text/html&quot;)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The header is typically called to send back the header.  In our case we collect it into a hash for later usage.  This can be called multiple times to set different cookies.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L85-L125'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='125'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_header'>header</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/html</span><span class='tstring_end'>&quot;</span></span>)
  <span class='comment'># if they pass in a string then just write the Content-Type
</span>  <span class='kw'>if</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_options'>options</span>
    <span class='ivar'>@head</span>[<span class='const'><a href="#CONTENT_TYPE-constant" title="Unicorn::CGIWrapper::CONTENT_TYPE (constant)">CONTENT_TYPE</a></span>] <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span>
  <span class='kw'>else</span>
    <span class='const'><a href="#HEADER_MAP-constant" title="Unicorn::CGIWrapper::HEADER_MAP (constant)">HEADER_MAP</a></span>.<span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='op'>|</span>
      <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_from'>from</span>) <span class='kw'>or</span> <span class='kw'>next</span>
      <span class='ivar'>@head</span>[<span class='id identifier rubyid_to'>to</span>] <span class='op'>=</span> <span class='id identifier rubyid_from'>from</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>

    <span class='ivar'>@head</span>[<span class='const'><a href="#CONTENT_TYPE-constant" title="Unicorn::CGIWrapper::CONTENT_TYPE (constant)">CONTENT_TYPE</a></span>] <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/html</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_charset'>charset</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#CHARSET-constant" title="Unicorn::CGIWrapper::CHARSET (constant)">CHARSET</a></span>)
      <span class='ivar'>@head</span>[<span class='const'><a href="#CONTENT_TYPE-constant" title="Unicorn::CGIWrapper::CONTENT_TYPE (constant)">CONTENT_TYPE</a></span>] <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>; charset=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_charset'>charset</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># lots of ways to set cookies
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cookie'>cookie</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#COOKIE-constant" title="Unicorn::CGIWrapper::COOKIE (constant)">COOKIE</a></span>)
      <span class='id identifier rubyid_set_cookies'>set_cookies</span> <span class='op'>=</span> <span class='ivar'>@headv</span>[<span class='const'><a href="#SET_COOKIE-constant" title="Unicorn::CGIWrapper::SET_COOKIE (constant)">SET_COOKIE</a></span>]
      <span class='kw'>case</span> <span class='id identifier rubyid_cookie'>cookie</span>
      <span class='kw'>when</span> <span class='const'>Array</span>
        <span class='id identifier rubyid_cookie'>cookie</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_set_cookies'>set_cookies</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_to_s'>to_s</span> }
      <span class='kw'>when</span> <span class='const'>Hash</span>
        <span class='id identifier rubyid_cookie'>cookie</span>.<span class='id identifier rubyid_each_value'>each_value</span> { <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_set_cookies'>set_cookies</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_to_s'>to_s</span> }
      <span class='kw'>else</span>
        <span class='id identifier rubyid_set_cookies'>set_cookies</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cookie'>cookie</span>.<span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@status</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#STATUS-constant" title="Unicorn::CGIWrapper::STATUS (constant)">STATUS</a></span>) <span class='comment'># all lower-case
</span>
    <span class='comment'># drop the keys we don&#39;t want anymore
</span>    <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#NPH-constant" title="Unicorn::CGIWrapper::NPH (constant)">NPH</a></span>)
    <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#CONNECTION-constant" title="Unicorn::CGIWrapper::CONNECTION (constant)">CONNECTION</a></span>)

    <span class='comment'># finally, set the rest of the headers as-is, allowing duplicates
</span>    <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_each_pair'>each_pair</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@headv</span>[<span class='id identifier rubyid_k'>k</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_v'>v</span> }
  <span class='kw'>end</span>

  <span class='comment'># doing this fakes out the cgi library to think the headers are empty
</span>  <span class='comment'># we then do the real headers in the out function call later
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="out-instance_method">
  <h3 class='signature nodoc'>
    #<strong>out</strong>(options = &quot;text/html&quot;)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The dumb thing is people can call header or this or both and in any order.  So, we just reuse header and then finalize the <a href="HttpResponse.html" title="Unicorn::HttpResponse (module)"><code>HttpResponse</code></a> the right way.  This will have no effect if called the second time if the first “outputted” anything.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L131-L135'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='131' data-end='135'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 131</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_out'>out</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/html</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_header'><a href="#header-instance_method" title="Unicorn::CGIWrapper#header (method)">header</a></span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='ivar'>@body</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>or</span> <span class='kw'>return</span>
  <span class='ivar'>@body</span> <span class='op'>&lt;&lt;</span> <span class='kw'>yield</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rack_response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>rack_response</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>finalizes the response in a way Rack applications would expect</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L69-L80'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='69' data-end='80'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 69</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rack_response'>rack_response</span>
  <span class='comment'># @head[CONTENT_LENGTH] ||= @body.size
</span>  <span class='ivar'>@headv</span>[<span class='const'><a href="#SET_COOKIE-constant" title="Unicorn::CGIWrapper::SET_COOKIE (constant)">SET_COOKIE</a></span>].<span class='id identifier rubyid_concat'>concat</span>(<span class='ivar'>@output_cookies</span>) <span class='kw'>if</span> <span class='ivar'>@output_cookies</span>
  <span class='ivar'>@headv</span>.<span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='ivar'>@head</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>||=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Capitalized &quot;Status:&quot;, with human-readable status code (e.g. &quot;200 OK&quot;)
</span>  <span class='ivar'>@status</span> <span class='op'>||=</span> <span class='ivar'>@head</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#Status-constant" title="Unicorn::CGIWrapper::Status (constant)">Status</a></span>)

  [ <span class='ivar'>@status</span> <span class='op'>||</span> <span class='int'>500</span><span class='comma'>,</span> <span class='ivar'>@head</span><span class='comma'>,</span> [ <span class='ivar'>@body</span>.<span class='id identifier rubyid_string'>string</span> ] ]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stdinput-instance_method">
  <h3 class='signature nodoc'>
    #<strong>stdinput</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Used to wrap the normal stdinput variable used inside CGI.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L138-L140'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='138' data-end='140'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 138</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stdinput'>stdinput</span>
  <span class='ivar'>@env_table</span>[<span class='const'><a href="#RACK_INPUT-constant" title="Unicorn::CGIWrapper::RACK_INPUT (constant)">RACK_INPUT</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stdoutput-instance_method">
  <h3 class='signature nodoc'>
    #<strong>stdoutput</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>return a pointer to the StringIO body since it’s STDOUT-like</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L143-L145'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='143' data-end='145'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/cgi_wrapper.rb', line 143</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stdoutput'>stdoutput</span>
  <span class='ivar'>@body</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>