<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Unicorn::HttpServer &mdash; Unicorn master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Unicorn::HttpServer",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Unicorn master</a> &raquo; 
      <a href='../_index.html#alpha_H'>Index (H)</a> &raquo; 
        <a class='nodoc' href="../Unicorn.html" title="Unicorn (module)">Unicorn</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>HttpServer&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Unicorn::HttpServer</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="HttpResponse.html" title="Unicorn::HttpResponse (module)"><code>HttpResponse</code></a>,
          <a class='nodoc' href="SocketHelper.html" title="Unicorn::SocketHelper (module)"><code>SocketHelper</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L12'>lib/unicorn/http_server.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This is the process manager of <a href="../Unicorn.html" title="Unicorn (module)"><code>::Unicorn</code></a>. This manages worker processes which in turn handle the I/O and application process. Listener sockets are started in the master process and shared with forked worker children.</p>

<p>Users do not need to know the internals of this class, but reading the <a href="https://yhbt.net/unicorn.git/tree/lib/unicorn/http_server.rb" target="_parent" title="source">source</a> is education for programmers wishing to learn how unicorn works. See <a href="Configurator.html" title="Unicorn::Configurator (class)"><code>Configurator</code></a> for information on how to configure unicorn.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='LISTENERS-constant' class='summary_signature nodoc'>LISTENERS =</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>all bound listener sockets note: this is public used by raindrops, but not recommended for use in new projects</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L28-L28'># File 'lib/unicorn/http_server.rb', line 28</a>    <pre class='code ruby'>[]</pre>
  </li>
  <li>
    <span id='NEW_LISTENERS-constant' class='summary_signature nodoc'>NEW_LISTENERS =</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>listeners we have yet to bind</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L31-L31'># File 'lib/unicorn/http_server.rb', line 31</a>    <pre class='code ruby'>[]</pre>
  </li>
  <li>
    <span id='START_CTX-constant' class='summary_signature'>START_CTX =</span>
    <br/>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L51-L54'># File 'lib/unicorn/http_server.rb', line 51</a>    <pre class='code ruby'>{
  <span class='symbeg'>:</span><span class='id identifier rubyid_argv'>argv</span> <span class='op'>=&gt;</span> <span class='const'>ARGV</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_dup'>dup</span>)<span class='comma'>,</span>
  <span class='int'>0</span> <span class='op'>=&gt;</span> <span class='gvar'>$0</span>.<span class='id identifier rubyid_dup'>dup</span><span class='comma'>,</span>
}</pre>
  </li>
</ul>
  <h3 class='inherited'><a href="SocketHelper.html" title="Unicorn::SocketHelper (module)"><code>SocketHelper</code></a> - Included</h3>
  <p  class='inherited'>
    <a class='nodoc' href="SocketHelper.html#DEFAULTS-constant" title="Unicorn::SocketHelper::DEFAULTS (constant)">DEFAULTS</a>
  </p>
  <h3 class='inherited'><a href="HttpResponse.html" title="Unicorn::HttpResponse (module)"><code>HttpResponse</code></a> - Included</h3>
  <p  class='inherited'>
    <a class='nodoc' href="HttpResponse.html#STATUS_CODES-constant" title="Unicorn::HttpResponse::STATUS_CODES (constant)">STATUS_CODES</a>, 
    <a class='nodoc' href="HttpResponse.html#STATUS_WITH_NO_ENTITY_BODY-constant" title="Unicorn::HttpResponse::STATUS_WITH_NO_ENTITY_BODY (constant)">STATUS_WITH_NO_ENTITY_BODY</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(app, options = {})  &#x21d2; HttpServer </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a working server on host:port (strange things happen if port isn’t a Number).</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#after_fork-instance_method" title="#after_fork (instance method)">#<strong>after_fork</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#after_worker_exit=-instance_method" title="#after_worker_exit= (instance method)">#<strong>after_worker_exit=</strong>(value)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#after_worker_ready=-instance_method" title="#after_worker_ready= (instance method)">#<strong>after_worker_ready=</strong>(value)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#app-instance_method" title="#app (instance method)">#<strong>app</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#before_exec-instance_method" title="#before_exec (instance method)">#<strong>before_exec</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#before_fork-instance_method" title="#before_fork (instance method)">#<strong>before_fork</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#check_client_connection-instance_method" title="#check_client_connection (instance method)">#<strong>check_client_connection</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#check_client_connection=-instance_method" title="#check_client_connection= (instance method)">#<strong>check_client_connection=</strong>(bool)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#client_body_buffer_size-instance_method" title="#client_body_buffer_size (instance method)">#<strong>client_body_buffer_size</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#client_body_buffer_size=-instance_method" title="#client_body_buffer_size= (instance method)">#<strong>client_body_buffer_size=</strong>(bytes)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#config-instance_method" title="#config (instance method)">#<strong>config</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#default_middleware-instance_method" title="#default_middleware (instance method)">#<strong>default_middleware</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#early_hints-instance_method" title="#early_hints (instance method)">#<strong>early_hints</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#listener_opts-instance_method" title="#listener_opts (instance method)">#<strong>listener_opts</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#listeners=-instance_method" title="#listeners= (instance method)">#<strong>listeners=</strong>(listeners)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>replaces current listener set with <code>listeners</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#logger-instance_method" title="#logger (instance method)">#<strong>logger</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#logger=-instance_method" title="#logger= (instance method)">#<strong>logger=</strong>(obj)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#orig_app-instance_method" title="#orig_app (instance method)">#<strong>orig_app</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#pid-instance_method" title="#pid (instance method)">#<strong>pid</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#pid=-instance_method" title="#pid= (instance method)">#<strong>pid=</strong>(path)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>sets the path for the PID file of the master process.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#preload_app-instance_method" title="#preload_app (instance method)">#<strong>preload_app</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#ready_pipe-instance_method" title="#ready_pipe (instance method)">#<strong>ready_pipe</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#rewindable_input-instance_method" title="#rewindable_input (instance method)">#<strong>rewindable_input</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#rewindable_input=-instance_method" title="#rewindable_input= (instance method)">#<strong>rewindable_input=</strong>(bool)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#stderr_path=-instance_method" title="#stderr_path= (instance method)">#<strong>stderr_path=</strong>(path)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#stdout_path=-instance_method" title="#stdout_path= (instance method)">#<strong>stdout_path=</strong>(path)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#timeout-instance_method" title="#timeout (instance method)">#<strong>timeout</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#user-instance_method" title="#user (instance method)">#<strong>user</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#worker_exec=-instance_method" title="#worker_exec= (instance method)">#<strong>worker_exec=</strong>(value)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#worker_processes-instance_method" title="#worker_processes (instance method)">#<strong>worker_processes</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#clobber_pid-instance_method" title="#clobber_pid (instance method)">#<strong>clobber_pid</strong>(path)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>monitors children and receives signals forever (or until a termination signal is sent).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#listen-instance_method" title="#listen (instance method)">#<strong>listen</strong>(address, opt = {}.merge(listener_opts[address] || {}))  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>add a given address to the <code>listeners</code> set, idempotently Allows workers to add a private, per-process listener via the after_fork hook.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#start-instance_method" title="#start (instance method)">#<strong>start</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Runs the thing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>(graceful = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Terminates all workers, but does not exit master process.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#after_fork_internal-instance_method" title="#after_fork_internal (instance method)">#<strong>after_fork_internal</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#awaken_master-instance_method" title="#awaken_master (instance method)">#<strong>awaken_master</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#bind_new_listeners!-instance_method" title="#bind_new_listeners! (instance method)">#<strong>bind_new_listeners!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>call only after calling inherit_listeners! This binds any listeners we did NOT inherit from the parent.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#build_app!-instance_method" title="#build_app! (instance method)">#<strong>build_app!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#e100_response_write-instance_method" title="#e100_response_write (instance method)">#<strong>e100_response_write</strong>(client, env)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#e103_response_write-instance_method" title="#e103_response_write (instance method)">#<strong>e103_response_write</strong>(client, headers)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#handle_error-instance_method" title="#handle_error (instance method)">#<strong>handle_error</strong>(client, e)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>if we get any error, try to write something back to the client assuming we haven’t closed the socket, but don’t get hung up if the socket is already closed or broken.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#inherit_listeners!-instance_method" title="#inherit_listeners! (instance method)">#<strong>inherit_listeners!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#init_worker_process-instance_method" title="#init_worker_process (instance method)">#<strong>init_worker_process</strong>(worker)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>gets rid of stuff the worker has no business keeping track of to free some resources and drops all sig handlers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#kill_each_worker-instance_method" title="#kill_each_worker (instance method)">#<strong>kill_each_worker</strong>(signal)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>delivers a signal to each worker.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#kill_worker-instance_method" title="#kill_worker (instance method)">#<strong>kill_worker</strong>(signal, wpid)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>delivers a signal to a worker and fails gracefully if the worker is no longer running.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#listener_names-instance_method" title="#listener_names (instance method)">#<strong>listener_names</strong>(listeners = LISTENERS)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>returns an array of string names for the given listener array.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#listener_sockets-instance_method" title="#listener_sockets (instance method)">#<strong>listener_sockets</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#load_config!-instance_method" title="#load_config! (instance method)">#<strong>load_config!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#maintain_worker_count-instance_method" title="#maintain_worker_count (instance method)">#<strong>maintain_worker_count</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#master_sleep-instance_method" title="#master_sleep (instance method)">#<strong>master_sleep</strong>(sec)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>wait for a signal hander to wake us up and then consume the pipe.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#murder_lazy_workers-instance_method" title="#murder_lazy_workers (instance method)">#<strong>murder_lazy_workers</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>forcibly terminate all workers that haven’t checked in in timeout seconds.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#nuke_listeners!-instance_method" title="#nuke_listeners! (instance method)">#<strong>nuke_listeners!</strong>(readers)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#prep_readers-instance_method" title="#prep_readers (instance method)">#<strong>prep_readers</strong>(readers)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#proc_name-instance_method" title="#proc_name (instance method)">#<strong>proc_name</strong>(tag)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#process_client-instance_method" title="#process_client (instance method)">#<strong>process_client</strong>(client, ai)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>once a client is accepted, it is processed in its entirety here in 3 easy steps: read request, call app, write app response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#reap_all_workers-instance_method" title="#reap_all_workers (instance method)">#<strong>reap_all_workers</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>reaps all unreaped workers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#redirect_io-instance_method" title="#redirect_io (instance method)">#<strong>redirect_io</strong>(io, path)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#reexec-instance_method" title="#reexec (instance method)">#<strong>reexec</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>reexecutes the <a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a> with a new binary.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#reopen_worker_logs-instance_method" title="#reopen_worker_logs (instance method)">#<strong>reopen_worker_logs</strong>(worker_nr)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#soft_kill_each_worker-instance_method" title="#soft_kill_each_worker (instance method)">#<strong>soft_kill_each_worker</strong>(signal)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#spawn_missing_workers-instance_method" title="#spawn_missing_workers (instance method)">#<strong>spawn_missing_workers</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#unlink_pid_safe-instance_method" title="#unlink_pid_safe (instance method)">#<strong>unlink_pid_safe</strong>(path)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>unlinks a PID file at given <code>path</code> if it contains the current PID still potentially racy without locking the directory (which is non-portable and may interact badly with other programs), but the window for hitting the race condition is small.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#valid_pid%3F-instance_method" title="#valid_pid? (instance method)">#<strong>valid_pid?</strong>(path)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>returns a PID if a given path contains a non-stale PID file, nil otherwise.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#worker_loop-instance_method" title="#worker_loop (instance method)">#<strong>worker_loop</strong>(worker)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>runs inside each forked worker, this sits around and waits for connections and doesn’t die until the parent dies (or is given a INT, QUIT, or TERM signal).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#worker_spawn-instance_method" title="#worker_spawn (instance method)">#<strong>worker_spawn</strong>(worker)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited'><a href="HttpResponse.html" title="Unicorn::HttpResponse (module)"><code>HttpResponse</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="HttpResponse.html#httpdate-instance_method" title="Unicorn::HttpResponse#httpdate (method)">#httpdate</a></td>
      <td><div class='inline'><p>Returns a string which represents the time as rfc1123-date of HTTP-date defined by RFC 2616:</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="HttpResponse.html#append_header-instance_method" title="Unicorn::HttpResponse#append_header (method)">#append_header</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="HttpResponse.html#err_response-instance_method" title="Unicorn::HttpResponse#err_response (method)">#err_response</a></td>
      <td><div class='inline'><p>internal API, code will always be common-enough-for-even-old-Rack.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="HttpResponse.html#http_response_write-instance_method" title="Unicorn::HttpResponse#http_response_write (method)">#http_response_write</a></td>
      <td><div class='inline'><p>writes the rack_response to socket as an HTTP response.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited nodoc'><a href="SocketHelper.html" title="Unicorn::SocketHelper (module)"><code>SocketHelper</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="SocketHelper.html#bind_listen-instance_method" title="Unicorn::SocketHelper#bind_listen (method)">#bind_listen</a></td>
      <td><div class='inline'><p>creates a new server, socket.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="SocketHelper.html#log_buffer_sizes-instance_method" title="Unicorn::SocketHelper#log_buffer_sizes (method)">#log_buffer_sizes</a>,
        <a class='i_m nodoc' href="SocketHelper.html#new_tcp_server-instance_method" title="Unicorn::SocketHelper#new_tcp_server (method)">#new_tcp_server</a>,
        <a class='i_m nodoc' href="SocketHelper.html#set_server_sockopt-instance_method" title="Unicorn::SocketHelper#set_server_sockopt (method)">#set_server_sockopt</a>,
        <a class='i_m nodoc' href="SocketHelper.html#set_tcp_sockopt-instance_method" title="Unicorn::SocketHelper#set_tcp_sockopt (method)">#set_tcp_sockopt</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="SocketHelper.html#sock_name-instance_method" title="Unicorn::SocketHelper#sock_name (method)">#sock_name</a></td>
      <td><div class='inline'><p>Returns the configuration name of a socket as a string.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="SocketHelper.html#tcp_name-instance_method" title="Unicorn::SocketHelper#tcp_name (method)">#tcp_name</a></td>
      <td><div class='inline'><p>returns rfc2732-style (e.g.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>(app, options = {})  &#x21d2; <code>HttpServer</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a working server on host:port (strange things happen if port isn’t a Number).  Use <code>HttpServer.run</code> to start the server and <code>HttpServer.run</code>.join to join the thread that’s processing incoming requests on the socket.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L70-L117'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='117'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>
  <span class='ivar'>@reexec_pid</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@default_middleware</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='ivar'>@ready_pipe</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span>)
  <span class='ivar'>@init_listeners</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>] <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>].<span class='id identifier rubyid_dup'>dup</span> <span class='op'>:</span> []
  <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_use_defaults'>use_defaults</span>] <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span> <span class='op'>=</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Configurator.html" title="Unicorn::Configurator (class)">Configurator</a></span>.<span class='id identifier rubyid_new'><a href="Configurator.html#new-class_method" title="Unicorn::Configurator.new (method)">new</a></span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span> <span class='op'>=</span> {}
  <span class='ivar'>@immortal</span> <span class='op'>=</span> [] <span class='comment'># immortal inherited sockets from systemd
</span>
  <span class='comment'># We use @self_pipe differently in the master and worker processes:
</span>  <span class='comment'>#
</span>  <span class='comment'># * The master process never closes or reinitializes this once
</span>  <span class='comment'># initialized.  Signal handlers in the master process will write to
</span>  <span class='comment'># it to wake up the master from IO.select in exactly the same manner
</span>  <span class='comment'># djb describes in https://cr.yp.to/docs/selfpipe.html
</span>  <span class='comment'>#
</span>  <span class='comment'># * The workers immediately close the pipe they inherit.  See the
</span>  <span class='comment'># Unicorn::Worker class for the pipe workers use.
</span>  <span class='ivar'>@self_pipe</span> <span class='op'>=</span> []
  <span class='ivar'>@workers</span> <span class='op'>=</span> {} <span class='comment'># hash maps PIDs to Workers
</span>  <span class='ivar'>@sig_queue</span> <span class='op'>=</span> [] <span class='comment'># signal queue used for self-piping
</span>  <span class='ivar'>@pid</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># we try inheriting listeners first, so we bind them later.
</span>  <span class='comment'># we don&#39;t write the pid file until we&#39;ve bound listeners in case
</span>  <span class='comment'># unicorn was started twice by mistake.  Even though our #pid= method
</span>  <span class='comment'># checks for stale/existing pid files, race conditions are still
</span>  <span class='comment'># possible (and difficult/non-portable to avoid) and can be likely
</span>  <span class='comment'># to clobber the pid if the second start was in quick succession
</span>  <span class='comment'># after the first, so we rely on the listener binding to fail in
</span>  <span class='comment'># that case.  Some tests (in and outside of this source tree) and
</span>  <span class='comment'># monitoring tools may also rely on pid files existing before we
</span>  <span class='comment'># attempt to connect to the listener(s)
</span>  <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_commit!'>commit!</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip'>skip</span> <span class='op'>=&gt;</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>])
  <span class='ivar'>@orig_app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>
  <span class='comment'># list of signals we care about and trap in master.
</span>  <span class='ivar'>@queue_sigs</span> <span class='op'>=</span> [
    <span class='symbeg'>:</span><span class='const'>WINCH</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>QUIT</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>INT</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TERM</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USR1</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USR2</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>HUP</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TTIN</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TTOU</span> ]

  <span class='ivar'>@worker_data</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_worker_data'>worker_data</span> <span class='op'>=</span> <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNICORN_WORKER</span><span class='tstring_end'>&#39;</span></span>]
    <span class='id identifier rubyid_worker_data'>worker_data</span> <span class='op'>=</span> <span class='id identifier rubyid_worker_data'>worker_data</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_map!'>map!</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_i'>to_i</span>)
    <span class='id identifier rubyid_worker_data'>worker_data</span>[<span class='int'>1</span>] <span class='op'>=</span> <span class='id identifier rubyid_worker_data'>worker_data</span>.<span class='id identifier rubyid_slice!'>slice!</span>(<span class='int'>1</span><span class='op'>..</span><span class='int'>2</span>).<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='const'>IO</span>.<span class='id identifier rubyid_for_fd'>for_fd</span>(<span class='id identifier rubyid_i'>i</span>) }
    <span class='id identifier rubyid_worker_data'>worker_data</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="after_fork-instance_method">
  <h3 class='signature rw  nodoc first'>
    #<strong>after_fork</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'>after_fork</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="after_worker_exit=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>after_worker_exit=</strong>(value)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L19-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='19' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 19</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span>   <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_exit'>after_worker_exit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_ready'>after_worker_ready</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_exec'>worker_exec</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="after_worker_ready=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>after_worker_ready=</strong>(value)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L19-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='19' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 19</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span>   <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_exit'>after_worker_exit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_ready'>after_worker_ready</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_exec'>worker_exec</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="app-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>app</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="before_exec-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>before_exec</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'>before_exec</span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="before_fork-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>before_fork</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'>before_fork</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_client_connection-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>check_client_connection</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L369-L371'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='369' data-end='371'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_client_connection'>check_client_connection</span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span>.<span class='id identifier rubyid_check_client_connection'>check_client_connection</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_client_connection=-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>check_client_connection=</strong>(bool)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L373-L375'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='373' data-end='375'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 373</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_client_connection='>check_client_connection=</span>(<span class='id identifier rubyid_bool'>bool</span>)
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span>.<span class='id identifier rubyid_check_client_connection'><a href="#check_client_connection-instance_method" title="Unicorn::HttpServer#check_client_connection (method)">check_client_connection</a></span> <span class='op'>=</span> <span class='id identifier rubyid_bool'>bool</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client_body_buffer_size-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>client_body_buffer_size</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L361-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='361' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 361</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client_body_buffer_size'>client_body_buffer_size</span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="TeeInput.html" title="Unicorn::TeeInput (class)">TeeInput</a></span>.<span class='id identifier rubyid_client_body_buffer_size'><a href="TeeInput.html#client_body_buffer_size-class_method" title="Unicorn::TeeInput.client_body_buffer_size (method)">client_body_buffer_size</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client_body_buffer_size=-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>client_body_buffer_size=</strong>(bytes)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L365-L367'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='365' data-end='367'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 365</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client_body_buffer_size='>client_body_buffer_size=</span>(<span class='id identifier rubyid_bytes'>bytes</span>)
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="TeeInput.html" title="Unicorn::TeeInput (class)">TeeInput</a></span>.<span class='id identifier rubyid_client_body_buffer_size'><a href="TeeInput.html#client_body_buffer_size-class_method" title="Unicorn::TeeInput.client_body_buffer_size (method)">client_body_buffer_size</a></span> <span class='op'>=</span> <span class='id identifier rubyid_bytes'>bytes</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="config-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>config</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'>config</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_middleware-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>default_middleware</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'>default_middleware</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="early_hints-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>early_hints</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'>early_hints</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listener_opts-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>listener_opts</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'>listener_opts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listeners=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>listeners=</strong>(listeners)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>replaces current listener set with <code>listeners</code>.  This will close the socket if it will not exist in the new listener set</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L148-L172'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='148' data-end='172'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 148</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_listeners='>listeners=</span>(<span class='id identifier rubyid_listeners'>listeners</span>)
  <span class='id identifier rubyid_cur_names'>cur_names</span><span class='comma'>,</span> <span class='id identifier rubyid_dead_names'>dead_names</span> <span class='op'>=</span> []<span class='comma'>,</span> []
  <span class='id identifier rubyid_listener_names'><a href="#listener_names-instance_method" title="Unicorn::HttpServer#listener_names (method)">listener_names</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>)
      <span class='comment'># mark unlinked sockets as dead so we can rebind them
</span>      (<span class='const'>File</span>.<span class='id identifier rubyid_socket?'>socket?</span>(<span class='id identifier rubyid_name'>name</span>) <span class='op'>?</span> <span class='id identifier rubyid_cur_names'>cur_names</span> <span class='op'>:</span> <span class='id identifier rubyid_dead_names'>dead_names</span>) <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cur_names'>cur_names</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_set_names'>set_names</span> <span class='op'>=</span> <span class='id identifier rubyid_listener_names'><a href="#listener_names-instance_method" title="Unicorn::HttpServer#listener_names (method)">listener_names</a></span>(<span class='id identifier rubyid_listeners'>listeners</span>)
  <span class='id identifier rubyid_dead_names'>dead_names</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_cur_names'>cur_names</span> <span class='op'>-</span> <span class='id identifier rubyid_set_names'>set_names</span>).<span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_dead_names'>dead_names</span> <span class='op'>-=</span> <span class='ivar'>@immortal</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span> <span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>) }

  <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_dead_names'>dead_names</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>))
      (<span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>).<span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># true
</span>    <span class='kw'>else</span>
      <span class='id identifier rubyid_set_server_sockopt'>set_server_sockopt</span>(<span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span>[<span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>)])
      <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  (<span class='id identifier rubyid_set_names'>set_names</span> <span class='op'>-</span> <span class='id identifier rubyid_cur_names'>cur_names</span>).<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_addr'>addr</span><span class='op'>|</span> <span class='id identifier rubyid_listen'><a href="#listen-instance_method" title="Unicorn::HttpServer#listen (method)">listen</a></span>(<span class='id identifier rubyid_addr'>addr</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="logger-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>logger</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L21-L21'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='21'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_logger'>logger</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="logger=-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>logger=</strong>(obj)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L177-L179'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='177' data-end='179'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 177</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_logger='>logger=</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span><span class='op'>::</span><span class='const'>DEFAULTS</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.logger</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='ivar'>@logger</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="orig_app-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>orig_app</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'>orig_app</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pid-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>pid</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L21-L21'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='21'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pid=-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>pid=</strong>(path)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>sets the path for the PID file of the master process</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L198-L225'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='198' data-end='225'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 198</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pid='>pid=</span>(<span class='id identifier rubyid_path'>path</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_valid_pid?'><a href="#valid_pid%3F-instance_method" title="Unicorn::HttpServer#valid_pid? (method)">valid_pid?</a></span>(<span class='id identifier rubyid_path'>path</span>)
      <span class='kw'>return</span> <span class='id identifier rubyid_path'>path</span> <span class='kw'>if</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>==</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>==</span> <span class='gvar'>$$</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>==</span> <span class='ivar'>@reexec_pid</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>.<span class='id identifier rubyid_end_with?'>end_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.oldbin</span><span class='tstring_end'>&#39;</span></span>)
        <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>will not set pid=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> while reexec-ed </span><span class='tstring_end'>&quot;</span></span>\
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>child is running PID:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
        <span class='kw'>return</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Already running on PID:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> \
                           <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(or pid=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> is stale)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># rename the old pid if possible
</span>  <span class='kw'>if</span> <span class='ivar'>@pid</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_path'>path</span>
    <span class='kw'>begin</span>
      <span class='const'>File</span>.<span class='id identifier rubyid_rename'>rename</span>(<span class='ivar'>@pid</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span>)
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EXDEV</span>
      <span class='comment'># a user may have accidentally removed the original,
</span>      <span class='comment'># obviously cross-FS renames don&#39;t work, either.
</span>      <span class='id identifier rubyid_clobber_pid'><a href="#clobber_pid-instance_method" title="Unicorn::HttpServer#clobber_pid (method)">clobber_pid</a></span>(<span class='id identifier rubyid_path'>path</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_clobber_pid'><a href="#clobber_pid-instance_method" title="Unicorn::HttpServer#clobber_pid (method)">clobber_pid</a></span>(<span class='id identifier rubyid_path'>path</span>)
  <span class='kw'>end</span>
  <span class='ivar'>@pid</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="preload_app-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>preload_app</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'>preload_app</span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ready_pipe-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>ready_pipe</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'>ready_pipe</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rewindable_input-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>rewindable_input</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L352-L354'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='352' data-end='354'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 352</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rewindable_input'>rewindable_input</span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span>.<span class='id identifier rubyid_input_class'>input_class</span>.<span class='id identifier rubyid_method_defined?'>method_defined?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rewind'>rewind</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rewindable_input=-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>rewindable_input=</strong>(bool)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L356-L359'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='356' data-end='359'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 356</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rewindable_input='>rewindable_input=</span>(<span class='id identifier rubyid_bool'>bool</span>)
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span>.<span class='id identifier rubyid_input_class'>input_class</span> <span class='op'>=</span> <span class='id identifier rubyid_bool'>bool</span> <span class='op'>?</span>
                              <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="TeeInput.html" title="Unicorn::TeeInput (class)">TeeInput</a></span> <span class='op'>:</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="StreamInput.html" title="Unicorn::StreamInput (class)">StreamInput</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stderr_path=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>stderr_path=</strong>(path)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L175-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='175' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 175</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stderr_path='>stderr_path=</span>(<span class='id identifier rubyid_path'>path</span>)<span class='semicolon'>;</span> <span class='id identifier rubyid_redirect_io'><a href="#redirect_io-instance_method" title="Unicorn::HttpServer#redirect_io (method)">redirect_io</a></span>(<span class='gvar'>$stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span>)<span class='semicolon'>;</span> <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stdout_path=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>stdout_path=</strong>(path)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L174-L174'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='174' data-end='174'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 174</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stdout_path='>stdout_path=</span>(<span class='id identifier rubyid_path'>path</span>)<span class='semicolon'>;</span> <span class='id identifier rubyid_redirect_io'><a href="#redirect_io-instance_method" title="Unicorn::HttpServer#redirect_io (method)">redirect_io</a></span>(<span class='gvar'>$stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span>)<span class='semicolon'>;</span> <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="timeout-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>timeout</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="user-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>user</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="worker_exec=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>worker_exec=</strong>(value)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L19-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='19' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 19</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span>   <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_exit'>after_worker_exit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_worker_ready'>after_worker_ready</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_exec'>worker_exec</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="worker_processes-instance_method">
  <h3 class='signature rw  nodoc'>
    #<strong>worker_processes</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L14-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='14' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_worker_processes'>worker_processes</span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_orig_app'><a href="#orig_app-instance_method" title="Unicorn::HttpServer#orig_app (method)">orig_app</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ready_pipe'><a href="#ready_pipe-instance_method" title="Unicorn::HttpServer#ready_pipe (method)">ready_pipe</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span><span class='comma'>,</span>
              <span class='symbeg'>:</span><span class='id identifier rubyid_default_middleware'><a href="#default_middleware-instance_method" title="Unicorn::HttpServer#default_middleware (method)">default_middleware</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="after_fork_internal-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>after_fork_internal</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L497-L506'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='497' data-end='506'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 497</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_after_fork_internal'>after_fork_internal</span>
  <span class='ivar'>@self_pipe</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>).<span class='id identifier rubyid_clear'>clear</span> <span class='comment'># this is master-only, now
</span>  <span class='ivar'>@ready_pipe</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='ivar'>@ready_pipe</span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Configurator.html" title="Unicorn::Configurator (class)">Configurator</a></span><span class='op'>::</span><span class='const'><a href="Configurator.html#RACKUP-constant" title="Unicorn::Configurator::RACKUP (constant)">RACKUP</a></span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='ivar'>@ready_pipe</span> <span class='op'>=</span> <span class='ivar'>@init_listeners</span> <span class='op'>=</span> <span class='ivar'>@before_exec</span> <span class='op'>=</span> <span class='ivar'>@before_fork</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># The OpenSSL PRNG is seeded with only the pid, and apps with frequently
</span>  <span class='comment'># dying workers can recycle pids
</span>  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Random</span>.<span class='id identifier rubyid_seed'>seed</span>(<span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_to_s'>to_s</span>) <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Random</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="awaken_master-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>awaken_master</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L389-L393'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='389' data-end='393'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_awaken_master'>awaken_master</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='gvar'>$$</span> <span class='op'>!=</span> <span class='ivar'>@master_pid</span>
  <span class='comment'># wakeup master process from select
</span>  <span class='ivar'>@self_pipe</span>[<span class='int'>1</span>].<span class='id identifier rubyid_write_nonblock'>write_nonblock</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="bind_new_listeners!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>bind_new_listeners!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>call only after calling inherit_listeners! This binds any listeners we did NOT inherit from the parent</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L842-L845'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='842' data-end='845'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 842</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_bind_new_listeners!'>bind_new_listeners!</span>
  <span class='const'><a href="#NEW_LISTENERS-constant" title="Unicorn::HttpServer::NEW_LISTENERS (constant)">NEW_LISTENERS</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_addr'>addr</span><span class='op'>|</span> <span class='id identifier rubyid_listen'><a href="#listen-instance_method" title="Unicorn::HttpServer#listen (method)">listen</a></span>(<span class='id identifier rubyid_addr'>addr</span>) }.<span class='id identifier rubyid_clear'>clear</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no listeners</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_app!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>build_app!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L783-L791'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='783' data-end='791'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 783</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_app!'>build_app!</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_arity'>arity</span>) <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>||</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>2</span>)
    <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'>Gem</span>) <span class='op'>&amp;&amp;</span> <span class='const'>Gem</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_refresh'>refresh</span>)
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Refreshing Gem list</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'>Gem</span>.<span class='id identifier rubyid_refresh'>refresh</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_call'>call</span> <span class='op'>:</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>self</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clobber_pid-instance_method">
  <h3 class='signature nodoc'>
    #<strong>clobber_pid</strong>(path)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L181-L195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='181' data-end='195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 181</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clobber_pid'>clobber_pid</span>(<span class='id identifier rubyid_path'>path</span>)
  <span class='id identifier rubyid_unlink_pid_safe'><a href="#unlink_pid_safe-instance_method" title="Unicorn::HttpServer#unlink_pid_safe (method)">unlink_pid_safe</a></span>(<span class='ivar'>@pid</span>) <span class='kw'>if</span> <span class='ivar'>@pid</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span>
    <span class='id identifier rubyid_fp'>fp</span> <span class='op'>=</span> <span class='kw'>begin</span>
      <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>File</span>.<span class='id identifier rubyid_dirname'>dirname</span>(<span class='id identifier rubyid_path'>path</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rand'>rand</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embvar'>#</span><span class='gvar'>$$</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'>File</span>.<span class='id identifier rubyid_open'>open</span>(<span class='id identifier rubyid_tmp'>tmp</span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>RDWR</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>CREAT</span><span class='op'>|</span><span class='const'>File</span><span class='op'>::</span><span class='const'>EXCL</span><span class='comma'>,</span> <span class='int'>0644</span>)
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EEXIST</span>
      <span class='kw'>retry</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_fp'>fp</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_fp'>fp</span>.<span class='id identifier rubyid_write'>write</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embvar'>#</span><span class='gvar'>$$</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>)
    <span class='const'>File</span>.<span class='id identifier rubyid_rename'>rename</span>(<span class='id identifier rubyid_fp'>fp</span>.<span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span>)
    <span class='id identifier rubyid_fp'>fp</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="e100_response_write-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>e100_response_write</strong>(client, env)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L578-L587'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='578' data-end='587'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 578</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_e100_response_write'>e100_response_write</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
  <span class='comment'># We use String#freeze to avoid allocations under Ruby 2.1+
</span>  <span class='comment'># Not many users hit this code path, so it&#39;s better to reduce the
</span>  <span class='comment'># constant table sizes even for Ruby 2.0 users who&#39;ll hit extra
</span>  <span class='comment'># allocations here.
</span>  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_write'>write</span>(<span class='ivar'>@request</span>.<span class='id identifier rubyid_response_start_sent'>response_start_sent</span> <span class='op'>?</span>
               <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>100 Continue\r\n\r\nHTTP/1.1 </span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span> <span class='op'>:</span>
               <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP/1.1 100 Continue\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>)
  <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_EXPECT</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="e103_response_write-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>e103_response_write</strong>(client, headers)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L570-L576'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='570' data-end='576'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 570</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_e103_response_write'>e103_response_write</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='id identifier rubyid_rss'>rss</span> <span class='op'>=</span> <span class='ivar'>@request</span>.<span class='id identifier rubyid_response_start_sent'>response_start_sent</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_rss'>rss</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>103 Early Hints\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP/1.1 103 Early Hints\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_append_header'>append_header</span>(<span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>) }
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> (<span class='id identifier rubyid_rss'>rss</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\nHTTP/1.1 </span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>)
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_buf'>buf</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_error-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>handle_error</strong>(client, e)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>if we get any error, try to write something back to the client assuming we haven’t closed the socket, but don’t get hung up if the socket is already closed or broken.  We’ll always ensure the socket is closed at the end of this function</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L548-L568'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='548' data-end='568'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 548</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_error'>handle_error</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>)
  <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>when</span> <span class='const'>EOFError</span><span class='comma'>,</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span><span class='comma'>,</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOTCONN</span>
    <span class='comment'># client disconnected on us and there&#39;s nothing we can do
</span>  <span class='kw'>when</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="RequestURITooLongError.html" title="Unicorn::RequestURITooLongError (class)">RequestURITooLongError</a></span>
    <span class='int'>414</span>
  <span class='kw'>when</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="RequestEntityTooLargeError.html" title="Unicorn::RequestEntityTooLargeError (class)">RequestEntityTooLargeError</a></span>
    <span class='int'>413</span>
  <span class='kw'>when</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="HttpParserError.html" title="Unicorn::HttpParserError (class)">HttpParserError</a></span> <span class='comment'># try to tell the client they&#39;re bad
</span>    <span class='int'>400</span>
  <span class='kw'>else</span>
    <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span>.<span class='id identifier rubyid_log_error'><a href="../Unicorn.html#log_error-class_method" title="Unicorn.log_error (method)">log_error</a></span>(<span class='ivar'>@logger</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>app error</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>)
    <span class='int'>500</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_code'>code</span>
    <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='id identifier rubyid_err_response'>err_response</span>(<span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='ivar'>@request</span>.<span class='id identifier rubyid_response_start_sent'>response_start_sent</span>)
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_write_nonblock'>write_nonblock</span>(<span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_close'>close</span>
<span class='kw'>rescue</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inherit_listeners!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>inherit_listeners!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L803-L838'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='803' data-end='838'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 803</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inherit_listeners!'>inherit_listeners!</span>
  <span class='comment'># inherit sockets from parents, they need to be plain Socket objects
</span>  <span class='id identifier rubyid_inherited'>inherited</span> <span class='op'>=</span> <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNICORN_FD</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_immortal'>immortal</span> <span class='op'>=</span> []

  <span class='comment'># emulate sd_listen_fds() for systemd
</span>  <span class='id identifier rubyid_sd_pid'>sd_pid</span><span class='comma'>,</span> <span class='id identifier rubyid_sd_fds'>sd_fds</span> <span class='op'>=</span> <span class='const'>ENV</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LISTEN_PID</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LISTEN_FDS</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_sd_pid'>sd_pid</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='gvar'>$$</span> <span class='comment'># n.b. $$ can never be zero
</span>    <span class='comment'># 3 = SD_LISTEN_FDS_START
</span>    <span class='id identifier rubyid_immortal'>immortal</span> <span class='op'>=</span> (<span class='int'>3</span><span class='op'>...</span>(<span class='int'>3</span> <span class='op'>+</span> <span class='id identifier rubyid_sd_fds'>sd_fds</span>.<span class='id identifier rubyid_to_i'>to_i</span>)).<span class='id identifier rubyid_to_a'>to_a</span>
    <span class='id identifier rubyid_inherited'>inherited</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_immortal'>immortal</span>)
  <span class='kw'>end</span>
  <span class='comment'># to ease debugging, we will not unset LISTEN_PID and LISTEN_FDS
</span>
  <span class='id identifier rubyid_inherited'>inherited</span>.<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fd'>fd</span><span class='op'>|</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'>Socket</span>.<span class='id identifier rubyid_for_fd'>for_fd</span>(<span class='id identifier rubyid_fd'>fd</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
    <span class='ivar'>@immortal</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>if</span> <span class='id identifier rubyid_immortal'>immortal</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_fd'>fd</span>)
    <span class='id identifier rubyid_set_server_sockopt'>set_server_sockopt</span>(<span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span>[<span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>)])
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inherited addr=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>)<span class='embexpr_end'>}</span><span class='tstring_content'> fd=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_fileno'>fileno</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_io'>io</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_config_listeners'>config_listeners</span> <span class='op'>=</span> <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='id identifier rubyid_inherited'>inherited</span>)

  <span class='comment'># we only use generic Socket objects for aggregate Socket#accept_nonblock
</span>  <span class='comment'># return value [ Socket, Addrinfo ].  This allows us to avoid having to
</span>  <span class='comment'># make getpeername(2) syscalls later on to fill in env[&#39;REMOTE_ADDR&#39;]
</span>  <span class='id identifier rubyid_config_listeners'>config_listeners</span> <span class='op'>-=</span> <span class='id identifier rubyid_listener_names'><a href="#listener_names-instance_method" title="Unicorn::HttpServer#listener_names (method)">listener_names</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_config_listeners'>config_listeners</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_config_listeners'>config_listeners</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Const.html" title="Unicorn::Const (module)">Const</a></span><span class='op'>::</span><span class='const'><a href="Const.html#DEFAULT_LISTEN-constant" title="Unicorn::Const::DEFAULT_LISTEN (constant)">DEFAULT_LISTEN</a></span>
    <span class='ivar'>@init_listeners</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Const.html" title="Unicorn::Const (module)">Const</a></span><span class='op'>::</span><span class='const'><a href="Const.html#DEFAULT_LISTEN-constant" title="Unicorn::Const::DEFAULT_LISTEN (constant)">DEFAULT_LISTEN</a></span>
    <span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_argv'>argv</span>] <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-l</span><span class='embexpr_beg'>#{</span><span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Const.html" title="Unicorn::Const (module)">Const</a></span><span class='op'>::</span><span class='const'><a href="Const.html#DEFAULT_LISTEN-constant" title="Unicorn::Const::DEFAULT_LISTEN (constant)">DEFAULT_LISTEN</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='const'><a href="#NEW_LISTENERS-constant" title="Unicorn::HttpServer::NEW_LISTENERS (constant)">NEW_LISTENERS</a></span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='id identifier rubyid_config_listeners'>config_listeners</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="init_worker_process-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>init_worker_process</strong>(worker)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>gets rid of stuff the worker has no business keeping track of to free some resources and drops all sig handlers. traps for USR1, USR2, and HUP may be set in the after_fork Proc by the user.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L640-L664'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='640' data-end='664'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 640</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_init_worker_process'>init_worker_process</span>(<span class='id identifier rubyid_worker'>worker</span>)
  <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_atfork_child'>atfork_child</span>
  <span class='comment'># we&#39;ll re-trap :QUIT later for graceful shutdown iff we accept clients
</span>  <span class='id identifier rubyid_exit_sigs'>exit_sigs</span> <span class='op'>=</span> [ <span class='symbeg'>:</span><span class='const'>QUIT</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>TERM</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>INT</span> ]
  <span class='id identifier rubyid_exit_sigs'>exit_sigs</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_sig'>sig</span><span class='op'>|</span> <span class='id identifier rubyid_trap'>trap</span>(<span class='id identifier rubyid_sig'>sig</span>) { <span class='id identifier rubyid_exit!'>exit!</span>(<span class='int'>0</span>) } }
  <span class='id identifier rubyid_exit!'>exit!</span>(<span class='int'>0</span>) <span class='kw'>if</span> (<span class='ivar'>@sig_queue</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_exit_sigs'>exit_sigs</span>)[<span class='int'>0</span>]
  (<span class='ivar'>@queue_sigs</span> <span class='op'>-</span> <span class='id identifier rubyid_exit_sigs'>exit_sigs</span>).<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_sig'>sig</span><span class='op'>|</span> <span class='id identifier rubyid_trap'>trap</span>(<span class='id identifier rubyid_sig'>sig</span><span class='comma'>,</span> <span class='kw'>nil</span>) }
  <span class='id identifier rubyid_trap'>trap</span>(<span class='symbeg'>:</span><span class='const'>CHLD</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEFAULT</span><span class='tstring_end'>&#39;</span></span>)
  <span class='ivar'>@sig_queue</span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='id identifier rubyid_proc_name'><a href="#proc_name-instance_method" title="Unicorn::HttpServer#proc_name (method)">proc_name</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>worker[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_nr'>nr</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='ivar'>@workers</span>.<span class='id identifier rubyid_clear'>clear</span>

  <span class='id identifier rubyid_after_fork'><a href="#after_fork-instance_method" title="Unicorn::HttpServer#after_fork (method)">after_fork</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span>) <span class='comment'># can drop perms and create listeners
</span>  <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_close_on_exec'>close_on_exec</span> <span class='op'>=</span> <span class='kw'>true</span> }

  <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span>(<span class='op'>*</span><span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span>) <span class='kw'>if</span> <span class='id identifier rubyid_user'><a href="#user-instance_method" title="Unicorn::HttpServer#user (method)">user</a></span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Array</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_switched'>switched</span>
  <span class='ivar'>@config</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_build_app!'><a href="#build_app!-instance_method" title="Unicorn::HttpServer#build_app! (method)">build_app!</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span>
  <span class='ivar'>@after_fork</span> <span class='op'>=</span> <span class='ivar'>@listener_opts</span> <span class='op'>=</span> <span class='ivar'>@orig_app</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_readers'>readers</span> <span class='op'>=</span> <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_readers'>readers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_worker'>worker</span>
  <span class='id identifier rubyid_trap'>trap</span>(<span class='symbeg'>:</span><span class='const'>QUIT</span>) { <span class='id identifier rubyid_nuke_listeners!'><a href="#nuke_listeners!-instance_method" title="Unicorn::HttpServer#nuke_listeners! (method)">nuke_listeners!</a></span>(<span class='id identifier rubyid_readers'>readers</span>) }
  <span class='id identifier rubyid_readers'>readers</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="join-instance_method">
  <h3 class='signature nodoc'>
    #<strong>join</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>monitors children and receives signals forever (or until a termination signal is sent).  This handles signals one-at-a-time time and we’ll happily drop signals in case somebody is signalling us too often.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L265-L334'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='265' data-end='334'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 265</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_respawn'>respawn</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_last_check'>last_check</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>

  <span class='id identifier rubyid_proc_name'><a href="#proc_name-instance_method" title="Unicorn::HttpServer#proc_name (method)">proc_name</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master process ready</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># test_exec.rb relies on this message
</span>  <span class='kw'>if</span> <span class='ivar'>@ready_pipe</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@ready_pipe</span>.<span class='id identifier rubyid_syswrite'>syswrite</span>(<span class='gvar'>$$</span>.<span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>grandparent died too soon?: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>end</span>
    <span class='ivar'>@ready_pipe</span> <span class='op'>=</span> <span class='ivar'>@ready_pipe</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_reap_all_workers'><a href="#reap_all_workers-instance_method" title="Unicorn::HttpServer#reap_all_workers (method)">reap_all_workers</a></span>
    <span class='kw'>case</span> <span class='ivar'>@sig_queue</span>.<span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>when</span> <span class='kw'>nil</span>
      <span class='comment'># avoid murdering workers after our master process (or the
</span>      <span class='comment'># machine) comes out of suspend/hibernation
</span>      <span class='kw'>if</span> (<span class='id identifier rubyid_last_check'>last_check</span> <span class='op'>+</span> <span class='ivar'>@timeout</span>) <span class='op'>&gt;=</span> (<span class='id identifier rubyid_last_check'>last_check</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>)
        <span class='id identifier rubyid_sleep_time'>sleep_time</span> <span class='op'>=</span> <span class='id identifier rubyid_murder_lazy_workers'><a href="#murder_lazy_workers-instance_method" title="Unicorn::HttpServer#murder_lazy_workers (method)">murder_lazy_workers</a></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_sleep_time'>sleep_time</span> <span class='op'>=</span> <span class='ivar'>@timeout</span><span class='op'>/</span><span class='float'>2.0</span> <span class='op'>+</span> <span class='int'>1</span>
        <span class='ivar'>@logger</span>.<span class='id identifier rubyid_debug'>debug</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>waiting </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sleep_time'>sleep_time</span><span class='embexpr_end'>}</span><span class='tstring_content'>s after suspend/hibernation</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>end</span>
      <span class='id identifier rubyid_maintain_worker_count'><a href="#maintain_worker_count-instance_method" title="Unicorn::HttpServer#maintain_worker_count (method)">maintain_worker_count</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_respawn'>respawn</span>
      <span class='id identifier rubyid_master_sleep'><a href="#master_sleep-instance_method" title="Unicorn::HttpServer#master_sleep (method)">master_sleep</a></span>(<span class='id identifier rubyid_sleep_time'>sleep_time</span>)
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>QUIT</span> <span class='comment'># graceful shutdown
</span>      <span class='kw'>break</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>TERM</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>INT</span> <span class='comment'># immediate shutdown
</span>      <span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Unicorn::HttpServer#stop (method)">stop</a></span>(<span class='kw'>false</span>)
      <span class='kw'>break</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>USR1</span> <span class='comment'># rotate logs
</span>      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master reopening logs...</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Unicorn::Util (module)">Util</a></span>.<span class='id identifier rubyid_reopen_logs'><a href="Util.html#reopen_logs-class_method" title="Unicorn::Util.reopen_logs (method)">reopen_logs</a></span>
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master done reopening logs</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_soft_kill_each_worker'><a href="#soft_kill_each_worker-instance_method" title="Unicorn::HttpServer#soft_kill_each_worker (method)">soft_kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>USR1</span>)
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>USR2</span> <span class='comment'># exec binary, stay alive in case something went wrong
</span>      <span class='id identifier rubyid_reexec'><a href="#reexec-instance_method" title="Unicorn::HttpServer#reexec (method)">reexec</a></span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>WINCH</span>
      <span class='kw'>if</span> <span class='gvar'>$stdin</span>.<span class='id identifier rubyid_tty?'>tty?</span>
        <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIGWINCH ignored because we&#39;re not daemonized</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_respawn'>respawn</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gracefully stopping all workers</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_soft_kill_each_worker'><a href="#soft_kill_each_worker-instance_method" title="Unicorn::HttpServer#soft_kill_each_worker (method)">soft_kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>QUIT</span>)
        <span class='kw'>self</span>.<span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>TTIN</span>
      <span class='id identifier rubyid_respawn'>respawn</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>TTOU</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span> <span class='op'>-=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='const'>HUP</span>
      <span class='id identifier rubyid_respawn'>respawn</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_config_file'>config_file</span>
        <span class='id identifier rubyid_load_config!'><a href="#load_config!-instance_method" title="Unicorn::HttpServer#load_config! (method)">load_config!</a></span>
      <span class='kw'>else</span> <span class='comment'># exec binary and exit if there&#39;s no config file
</span>        <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>config_file not present, reexecuting binary</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_reexec'><a href="#reexec-instance_method" title="Unicorn::HttpServer#reexec (method)">reexec</a></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span>.<span class='id identifier rubyid_log_error'><a href="../Unicorn.html#log_error-class_method" title="Unicorn.log_error (method)">log_error</a></span>(<span class='ivar'>@logger</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master loop error</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>)
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Unicorn::HttpServer#stop (method)">stop</a></span> <span class='comment'># gracefully shutdown all workers on our way out
</span>  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>master complete</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_unlink_pid_safe'><a href="#unlink_pid_safe-instance_method" title="Unicorn::HttpServer#unlink_pid_safe (method)">unlink_pid_safe</a></span>(<span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>) <span class='kw'>if</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill_each_worker-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>kill_each_worker</strong>(signal)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>delivers a signal to each worker</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L731-L733'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='731' data-end='733'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 731</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_kill_each_worker'>kill_each_worker</span>(<span class='id identifier rubyid_signal'>signal</span>)
  <span class='ivar'>@workers</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_wpid'>wpid</span><span class='op'>|</span> <span class='id identifier rubyid_kill_worker'><a href="#kill_worker-instance_method" title="Unicorn::HttpServer#kill_worker (method)">kill_worker</a></span>(<span class='id identifier rubyid_signal'>signal</span><span class='comma'>,</span> <span class='id identifier rubyid_wpid'>wpid</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill_worker-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>kill_worker</strong>(signal, wpid)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>delivers a signal to a worker and fails gracefully if the worker is no longer running.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L724-L728'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='724' data-end='728'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 724</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_kill_worker'>kill_worker</span>(<span class='id identifier rubyid_signal'>signal</span><span class='comma'>,</span> <span class='id identifier rubyid_wpid'>wpid</span>)
  <span class='const'>Process</span>.<span class='id identifier rubyid_kill'>kill</span>(<span class='id identifier rubyid_signal'>signal</span><span class='comma'>,</span> <span class='id identifier rubyid_wpid'>wpid</span>)
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ESRCH</span>
  <span class='id identifier rubyid_worker'>worker</span> <span class='op'>=</span> <span class='ivar'>@workers</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_wpid'>wpid</span>) <span class='kw'>and</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listen-instance_method">
  <h3 class='signature nodoc'>
    #<strong>listen</strong>(address, opt = {}.merge(listener_opts[address] || {}))  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>add a given address to the <code>listeners</code> set, idempotently Allows workers to add a private, per-process listener via the after_fork hook.  Very useful for debugging and testing. <code>:tries</code> may be specified as an option for the number of times to retry, and <code>:delay</code> may be specified as the time in seconds to delay between retries. A negative value for <code>:tries</code> indicates the listen will be retried indefinitely, this is useful when workers belonging to different masters are spawned during a transparent upgrade.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L236-L259'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='236' data-end='259'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 236</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_listen'>listen</span>(<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> {}.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_listener_opts'><a href="#listener_opts-instance_method" title="Unicorn::HttpServer#listener_opts (method)">listener_opts</a></span>[<span class='id identifier rubyid_address'>address</span>] <span class='op'>||</span> {}))
  <span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_expand_addr'>expand_addr</span>(<span class='id identifier rubyid_address'>address</span>)
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_address'>address</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_listener_names'><a href="#listener_names-instance_method" title="Unicorn::HttpServer#listener_names (method)">listener_names</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_address'>address</span>)

  <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_delay'>delay</span>] <span class='op'>||</span> <span class='float'>0.5</span>
  <span class='id identifier rubyid_tries'>tries</span> <span class='op'>=</span> <span class='id identifier rubyid_opt'>opt</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_tries'>tries</span>] <span class='op'>||</span> <span class='int'>5</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_bind_listen'>bind_listen</span>(<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span>)
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listening on addr=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>)<span class='embexpr_end'>}</span><span class='tstring_content'> fd=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_fileno'>fileno</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_io'>io</span>
    <span class='id identifier rubyid_io'>io</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EADDRINUSE</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_err'>err</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adding listener failed addr=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'>address</span><span class='embexpr_end'>}</span><span class='tstring_content'> (in use)</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_err'>err</span> <span class='kw'>if</span> <span class='id identifier rubyid_tries'>tries</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_tries'>tries</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>retrying in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_delay'>delay</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds </span><span class='tstring_end'>&quot;</span></span> \
                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tries'>tries</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>infinite</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_tries'>tries</span><span class='embexpr_end'>}</span><span class='tstring_content'> tries left)</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_sleep'>sleep</span>(<span class='id identifier rubyid_delay'>delay</span>)
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_err'>err</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error adding listener addr=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'>address</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_err'>err</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listener_names-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>listener_names</strong>(listeners = LISTENERS)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>returns an array of string names for the given listener array</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L779-L781'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='779' data-end='781'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 779</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_listener_names'>listener_names</span>(<span class='id identifier rubyid_listeners'>listeners</span> <span class='op'>=</span> <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>)
  <span class='id identifier rubyid_listeners'>listeners</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span> <span class='id identifier rubyid_sock_name'>sock_name</span>(<span class='id identifier rubyid_io'>io</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listener_sockets-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>listener_sockets</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L470-L474'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='470' data-end='474'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 470</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_listener_sockets'>listener_sockets</span>
  <span class='id identifier rubyid_listener_fds'>listener_fds</span> <span class='op'>=</span> {}
  <span class='const'><a href="#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span> <span class='id identifier rubyid_listener_fds'>listener_fds</span>[<span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_fileno'>fileno</span>] <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span> }
  <span class='id identifier rubyid_listener_fds'>listener_fds</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_config!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>load_config!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L761-L776'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='761' data-end='776'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 761</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_config!'>load_config!</span>
  <span class='id identifier rubyid_loaded_app'>loaded_app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reloading config_file=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_config_file'>config_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>].<span class='id identifier rubyid_replace'>replace</span>(<span class='ivar'>@init_listeners</span>)
  <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_reload'>reload</span>
  <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_commit!'>commit!</span>(<span class='kw'>self</span>)
  <span class='id identifier rubyid_soft_kill_each_worker'><a href="#soft_kill_each_worker-instance_method" title="Unicorn::HttpServer#soft_kill_each_worker (method)">soft_kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>QUIT</span>)
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Unicorn::Util (module)">Util</a></span>.<span class='id identifier rubyid_reopen_logs'><a href="Util.html#reopen_logs-class_method" title="Unicorn::Util.reopen_logs (method)">reopen_logs</a></span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span> <span class='op'>=</span> <span class='ivar'>@orig_app</span>
  <span class='id identifier rubyid_build_app!'><a href="#build_app!-instance_method" title="Unicorn::HttpServer#build_app! (method)">build_app!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>done reloading config_file=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_config_file'>config_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='const'>LoadError</span><span class='comma'>,</span> <span class='const'>SyntaxError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span>.<span class='id identifier rubyid_log_error'><a href="../Unicorn.html#log_error-class_method" title="Unicorn.log_error (method)">log_error</a></span>(<span class='ivar'>@logger</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error reloading config_file=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>.<span class='id identifier rubyid_config_file'>config_file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Unicorn::HttpServer#app (method)">app</a></span> <span class='op'>=</span> <span class='id identifier rubyid_loaded_app'>loaded_app</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="maintain_worker_count-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>maintain_worker_count</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L538-L542'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='538' data-end='542'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 538</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_maintain_worker_count'>maintain_worker_count</span>
  (<span class='id identifier rubyid_off'>off</span> <span class='op'>=</span> <span class='ivar'>@workers</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span>) <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='kw'>return</span>
  <span class='id identifier rubyid_off'>off</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='kw'>return</span> <span class='id identifier rubyid_spawn_missing_workers'><a href="#spawn_missing_workers-instance_method" title="Unicorn::HttpServer#spawn_missing_workers (method)">spawn_missing_workers</a></span>
  <span class='ivar'>@workers</span>.<span class='id identifier rubyid_each_value'>each_value</span> { <span class='op'>|</span><span class='id identifier rubyid_w'>w</span><span class='op'>|</span> <span class='id identifier rubyid_w'>w</span>.<span class='id identifier rubyid_nr'>nr</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_worker_processes'><a href="#worker_processes-instance_method" title="Unicorn::HttpServer#worker_processes (method)">worker_processes</a></span> <span class='kw'>and</span> <span class='id identifier rubyid_w'>w</span>.<span class='id identifier rubyid_soft_kill'>soft_kill</span>(<span class='symbeg'>:</span><span class='const'>QUIT</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="master_sleep-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>master_sleep</strong>(sec)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>wait for a signal hander to wake us up and then consume the pipe</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L380-L387'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='380' data-end='387'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 380</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_master_sleep'>master_sleep</span>(<span class='id identifier rubyid_sec'>sec</span>)
  <span class='ivar'>@self_pipe</span>[<span class='int'>0</span>].<span class='id identifier rubyid_wait'>wait</span>(<span class='id identifier rubyid_sec'>sec</span>) <span class='kw'>or</span> <span class='kw'>return</span>
  <span class='comment'># 11 bytes is the maximum string length which can be embedded within
</span>  <span class='comment'># the Ruby itself and not require a separate malloc (on 32-bit MRI 1.9+).
</span>  <span class='comment'># Most reads are only one byte here and uncommon, so it&#39;s not worth a
</span>  <span class='comment'># persistent buffer, either:
</span>  <span class='ivar'>@self_pipe</span>[<span class='int'>0</span>].<span class='id identifier rubyid_read_nonblock'>read_nonblock</span>(<span class='int'>11</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="murder_lazy_workers-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>murder_lazy_workers</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>forcibly terminate all workers that haven’t checked in in timeout seconds.  The timeout is implemented using an unlinked File</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L477-L495'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='477' data-end='495'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 477</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_murder_lazy_workers'>murder_lazy_workers</span>
  <span class='id identifier rubyid_next_sleep'>next_sleep</span> <span class='op'>=</span> <span class='ivar'>@timeout</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>.<span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@workers</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wpid'>wpid</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span><span class='op'>|</span>
    <span class='id identifier rubyid_tick'>tick</span> <span class='op'>=</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_tick'>tick</span>
    <span class='int'>0</span> <span class='op'>==</span> <span class='id identifier rubyid_tick'>tick</span> <span class='kw'>and</span> <span class='kw'>next</span> <span class='comment'># skip workers that haven&#39;t processed any clients
</span>    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='id identifier rubyid_tick'>tick</span>
    <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='ivar'>@timeout</span> <span class='op'>-</span> <span class='id identifier rubyid_diff'>diff</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_next_sleep'>next_sleep</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_tmp'>tmp</span> <span class='kw'>and</span> <span class='id identifier rubyid_next_sleep'>next_sleep</span> <span class='op'>=</span> <span class='id identifier rubyid_tmp'>tmp</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_next_sleep'>next_sleep</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>worker=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_nr'>nr</span><span class='embexpr_end'>}</span><span class='tstring_content'> PID:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wpid'>wpid</span><span class='embexpr_end'>}</span><span class='tstring_content'> timeout </span><span class='tstring_end'>&quot;</span></span> \
                 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_diff'>diff</span><span class='embexpr_end'>}</span><span class='tstring_content'>s &gt; </span><span class='embexpr_beg'>#{</span><span class='ivar'>@timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'>s), killing</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_kill_worker'><a href="#kill_worker-instance_method" title="Unicorn::HttpServer#kill_worker (method)">kill_worker</a></span>(<span class='symbeg'>:</span><span class='const'>KILL</span><span class='comma'>,</span> <span class='id identifier rubyid_wpid'>wpid</span>) <span class='comment'># take no prisoners for timeout violations
</span>  <span class='kw'>end</span>
  <span class='id identifier rubyid_next_sleep'>next_sleep</span> <span class='op'>&lt;=</span> <span class='int'>0</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id identifier rubyid_next_sleep'>next_sleep</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="nuke_listeners!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>nuke_listeners!</strong>(readers)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L629-L634'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='629' data-end='634'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 629</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_nuke_listeners!'>nuke_listeners!</span>(<span class='id identifier rubyid_readers'>readers</span>)
  <span class='comment'># only called from the worker, ordering is important here
</span>  <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='id identifier rubyid_readers'>readers</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_readers'>readers</span>.<span class='id identifier rubyid_replace'>replace</span>([<span class='kw'>false</span>]) <span class='comment'># ensure worker does not continue ASAP
</span>  <span class='id identifier rubyid_tmp'>tmp</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span> } <span class='comment'># break out of IO.select
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prep_readers-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>prep_readers</strong>(readers)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L676-L684'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='676' data-end='684'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 676</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_prep_readers'>prep_readers</span>(<span class='id identifier rubyid_readers'>readers</span>)
  <span class='id identifier rubyid_wtr'>wtr</span> <span class='op'>=</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>Waiter</span>.<span class='id identifier rubyid_prep_readers'>prep_readers</span>(<span class='id identifier rubyid_readers'>readers</span>)
  <span class='ivar'>@timeout</span> <span class='op'>*=</span> <span class='int'>500</span> <span class='comment'># to milliseconds for epoll, but halved
</span>  <span class='id identifier rubyid_wtr'>wtr</span>
<span class='kw'>rescue</span>
  <span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_waiter</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@timeout</span> <span class='op'>/=</span> <span class='float'>2.0</span> <span class='comment'># halved for IO.select
</span>  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="SelectWaiter.html" title="Unicorn::SelectWaiter (class)">SelectWaiter</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Unicorn::HttpServer.new (method)">new</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="proc_name-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>proc_name</strong>(tag)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L793-L796'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='793' data-end='796'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 793</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_proc_name'>proc_name</span>(<span class='id identifier rubyid_tag'>tag</span>)
  <span class='gvar'>$0</span> <span class='op'>=</span> ([ <span class='const'>File</span>.<span class='id identifier rubyid_basename'>basename</span>(<span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='int'>0</span>])<span class='comma'>,</span> <span class='id identifier rubyid_tag'>tag</span>
        ]).<span class='id identifier rubyid_concat'>concat</span>(<span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_argv'>argv</span>]).<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Unicorn::HttpServer#join (method)">join</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_client-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>process_client</strong>(client, ai)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>once a client is accepted, it is processed in its entirety here in 3 easy steps: read request, call app, write app response</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L591-L627'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='591' data-end='627'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 591</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_client'>process_client</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span>)
  <span class='ivar'>@request</span> <span class='op'>=</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'>HttpRequest</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Unicorn::HttpServer.new (method)">new</a></span>
  <span class='id identifier rubyid_env'>env</span> <span class='op'>=</span> <span class='ivar'>@request</span>.<span class='id identifier rubyid_read_headers'>read_headers</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Unicorn::HttpServer#early_hints (method)">early_hints</a></span>
    <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.early_hints</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_headers'>headers</span><span class='op'>|</span>
      <span class='id identifier rubyid_e103_response_write'><a href="#e103_response_write-instance_method" title="Unicorn::HttpServer#e103_response_write (method)">e103_response_write</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.after_reply</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> []

  <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='ivar'>@app</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)

  <span class='kw'>begin</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@request</span>.<span class='id identifier rubyid_hijacked?'>hijacked?</span>

    <span class='kw'>if</span> <span class='int'>100</span> <span class='op'>==</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_e100_response_write'><a href="#e100_response_write-instance_method" title="Unicorn::HttpServer#e100_response_write (method)">e100_response_write</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
      <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='ivar'>@app</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)
      <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@request</span>.<span class='id identifier rubyid_hijacked?'>hijacked?</span>
    <span class='kw'>end</span>
    <span class='ivar'>@request</span>.<span class='id identifier rubyid_headers?'>headers?</span> <span class='kw'>or</span> <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_http_response_write'>http_response_write</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='ivar'>@request</span>)
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>) <span class='kw'>and</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_closed?'>closed?</span> <span class='comment'># rack.hijack may&#39;ve close this for us
</span>    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_shutdown'>shutdown</span> <span class='comment'># in case of fork() in Rack app
</span>    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_close'>close</span> <span class='comment'># flush and uncork socket immediately, no keepalive
</span>  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_handle_error'><a href="#handle_error-instance_method" title="Unicorn::HttpServer#handle_error (method)">handle_error</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>)
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.after_reply</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>) <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reap_all_workers-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>reap_all_workers</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>reaps all unreaped workers</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L396-L412'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='396' data-end='412'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 396</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reap_all_workers'>reap_all_workers</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_wpid'>wpid</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_waitpid2'>waitpid2</span>(<span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='const'>Process</span><span class='op'>::</span><span class='const'>WNOHANG</span>)
    <span class='id identifier rubyid_wpid'>wpid</span> <span class='kw'>or</span> <span class='kw'>return</span>
    <span class='kw'>if</span> <span class='ivar'>@reexec_pid</span> <span class='op'>==</span> <span class='id identifier rubyid_wpid'>wpid</span>
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reaped </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> exec()-ed</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@reexec_pid</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>=</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>.<span class='id identifier rubyid_chomp'>chomp</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.oldbin</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>if</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>
      <span class='id identifier rubyid_proc_name'><a href="#proc_name-instance_method" title="Unicorn::HttpServer#proc_name (method)">proc_name</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_worker'>worker</span> <span class='op'>=</span> <span class='ivar'>@workers</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_wpid'>wpid</span>) <span class='kw'>and</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
      <span class='ivar'>@after_worker_exit</span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span>)
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECHILD</span>
    <span class='kw'>break</span>
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="redirect_io-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>redirect_io</strong>(io, path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L798-L801'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='798' data-end='801'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 798</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_io'>redirect_io</span>(<span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span>)
  <span class='const'>File</span>.<span class='id identifier rubyid_open'>open</span>(<span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ab</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_fp'>fp</span><span class='op'>|</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_reopen'>reopen</span>(<span class='id identifier rubyid_fp'>fp</span>) } <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span>
  <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reexec-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>reexec</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>reexecutes the <a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a> with a new binary</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L415-L454'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='415' data-end='454'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 415</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reexec'>reexec</span>
  <span class='kw'>if</span> <span class='ivar'>@reexec_pid</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>begin</span>
      <span class='const'>Process</span>.<span class='id identifier rubyid_kill'>kill</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='ivar'>@reexec_pid</span>)
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reexec-ed child already running PID:</span><span class='embvar'>#</span><span class='ivar'>@reexec_pid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ESRCH</span>
      <span class='ivar'>@reexec_pid</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>
    <span class='id identifier rubyid_old_pid'>old_pid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>.oldbin</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>begin</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>=</span> <span class='id identifier rubyid_old_pid'>old_pid</span>  <span class='comment'># clear the path for a new pid file
</span>    <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>old PID:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_valid_pid?'><a href="#valid_pid%3F-instance_method" title="Unicorn::HttpServer#valid_pid? (method)">valid_pid?</a></span>(<span class='id identifier rubyid_old_pid'>old_pid</span>)<span class='embexpr_end'>}</span><span class='tstring_content'> running with </span><span class='tstring_end'>&quot;</span></span> \
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>existing pid=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_old_pid'>old_pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>, refusing rexec</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error writing pid=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_old_pid'>old_pid</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@reexec_pid</span> <span class='op'>=</span> <span class='id identifier rubyid_fork'>fork</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_listener_fds'>listener_fds</span> <span class='op'>=</span> <span class='id identifier rubyid_listener_sockets'><a href="#listener_sockets-instance_method" title="Unicorn::HttpServer#listener_sockets (method)">listener_sockets</a></span>
    <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNICORN_FD</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_listener_fds'>listener_fds</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Unicorn::HttpServer#join (method)">join</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)
    <span class='const'>Dir</span>.<span class='id identifier rubyid_chdir'>chdir</span>(<span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cwd'>cwd</span>])
    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> [ <span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='int'>0</span>] ].<span class='id identifier rubyid_concat'>concat</span>(<span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_argv'>argv</span>])

    <span class='comment'># exec(command, hash) works in at least 1.9.1+, but will only be
</span>    <span class='comment'># required in 1.9.4/2.0.0 at earliest.
</span>    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_listener_fds'>listener_fds</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>executing </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> (in </span><span class='embexpr_beg'>#{</span><span class='const'>Dir</span>.<span class='id identifier rubyid_pwd'>pwd</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_before_exec'><a href="#before_exec-instance_method" title="Unicorn::HttpServer#before_exec (method)">before_exec</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span>)
    <span class='id identifier rubyid_exec'>exec</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_proc_name'><a href="#proc_name-instance_method" title="Unicorn::HttpServer#proc_name (method)">proc_name</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master (old)</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reopen_worker_logs-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>reopen_worker_logs</strong>(worker_nr)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L666-L674'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='666' data-end='674'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 666</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reopen_worker_logs'>reopen_worker_logs</span>(<span class='id identifier rubyid_worker_nr'>worker_nr</span>)
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>worker=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_worker_nr'>worker_nr</span><span class='embexpr_end'>}</span><span class='tstring_content'> reopening logs...</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Unicorn::Util (module)">Util</a></span>.<span class='id identifier rubyid_reopen_logs'><a href="Util.html#reopen_logs-class_method" title="Unicorn::Util.reopen_logs (method)">reopen_logs</a></span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>worker=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_worker_nr'>worker_nr</span><span class='embexpr_end'>}</span><span class='tstring_content'> done reopening logs</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>false</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span>(<span class='id identifier rubyid_e'>e</span>) <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_exit!'>exit!</span>(<span class='int'>77</span>) <span class='comment'># EX_NOPERM in sysexits.h
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="soft_kill_each_worker-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>soft_kill_each_worker</strong>(signal)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L735-L737'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='735' data-end='737'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 735</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_soft_kill_each_worker'>soft_kill_each_worker</span>(<span class='id identifier rubyid_signal'>signal</span>)
  <span class='ivar'>@workers</span>.<span class='id identifier rubyid_each_value'>each_value</span> { <span class='op'>|</span><span class='id identifier rubyid_worker'>worker</span><span class='op'>|</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_soft_kill'>soft_kill</span>(<span class='id identifier rubyid_signal'>signal</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="spawn_missing_workers-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>spawn_missing_workers</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L508-L536'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='508' data-end='536'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 508</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_spawn_missing_workers'>spawn_missing_workers</span>
  <span class='kw'>if</span> <span class='ivar'>@worker_data</span>
    <span class='id identifier rubyid_worker'>worker</span> <span class='op'>=</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Worker.html" title="Unicorn::Worker (class)">Worker</a></span>.<span class='id identifier rubyid_new'><a href="Worker.html#new-class_method" title="Unicorn::Worker.new (method)">new</a></span>(<span class='op'>*</span><span class='ivar'>@worker_data</span>)
    <span class='id identifier rubyid_after_fork_internal'><a href="#after_fork_internal-instance_method" title="Unicorn::HttpServer#after_fork_internal (method)">after_fork_internal</a></span>
    <span class='id identifier rubyid_worker_loop'><a href="#worker_loop-instance_method" title="Unicorn::HttpServer#worker_loop (method)">worker_loop</a></span>(<span class='id identifier rubyid_worker'>worker</span>)
    <span class='id identifier rubyid_exit'>exit</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_worker_nr'>worker_nr</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>until</span> (<span class='id identifier rubyid_worker_nr'>worker_nr</span> <span class='op'>+=</span> <span class='int'>1</span>) <span class='op'>==</span> <span class='ivar'>@worker_processes</span>
    <span class='ivar'>@workers</span>.<span class='id identifier rubyid_value?'>value?</span>(<span class='id identifier rubyid_worker_nr'>worker_nr</span>) <span class='kw'>and</span> <span class='kw'>next</span>
    <span class='id identifier rubyid_worker'>worker</span> <span class='op'>=</span> <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span><span class='op'>::</span><span class='const'><a href="Worker.html" title="Unicorn::Worker (class)">Worker</a></span>.<span class='id identifier rubyid_new'><a href="Worker.html#new-class_method" title="Unicorn::Worker.new (method)">new</a></span>(<span class='id identifier rubyid_worker_nr'>worker_nr</span>)
    <span class='id identifier rubyid_before_fork'><a href="#before_fork-instance_method" title="Unicorn::HttpServer#before_fork (method)">before_fork</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span>)

    <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>=</span> <span class='ivar'>@worker_exec</span> <span class='op'>?</span> <span class='id identifier rubyid_worker_spawn'><a href="#worker_spawn-instance_method" title="Unicorn::HttpServer#worker_spawn (method)">worker_spawn</a></span>(<span class='id identifier rubyid_worker'>worker</span>) <span class='op'>:</span> <span class='id identifier rubyid_fork'>fork</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>
      <span class='id identifier rubyid_after_fork_internal'><a href="#after_fork_internal-instance_method" title="Unicorn::HttpServer#after_fork_internal (method)">after_fork_internal</a></span>
      <span class='id identifier rubyid_worker_loop'><a href="#worker_loop-instance_method" title="Unicorn::HttpServer#worker_loop (method)">worker_loop</a></span>(<span class='id identifier rubyid_worker'>worker</span>)
      <span class='id identifier rubyid_exit'>exit</span>
    <span class='kw'>end</span>

    <span class='ivar'>@workers</span>[<span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_worker'>worker</span>
    <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_atfork_parent'>atfork_parent</span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='ivar'>@logger</span>.<span class='id identifier rubyid_error'>error</span>(<span class='id identifier rubyid_e'>e</span>) <span class='kw'>rescue</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_exit!'>exit!</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start-instance_method">
  <h3 class='signature nodoc'>
    #<strong>start</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Runs the thing.  Returns self so you can run join on it</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L120-L144'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='120' data-end='144'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 120</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='id identifier rubyid_inherit_listeners!'><a href="#inherit_listeners!-instance_method" title="Unicorn::HttpServer#inherit_listeners! (method)">inherit_listeners!</a></span>
  <span class='comment'># this pipe is used to wake us up from select(2) in #join when signals
</span>  <span class='comment'># are trapped.  See trap_deferred.
</span>  <span class='ivar'>@self_pipe</span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span>.<span class='id identifier rubyid_pipe'><a href="../Unicorn.html#pipe-class_method" title="Unicorn.pipe (method)">pipe</a></span>)
  <span class='ivar'>@master_pid</span> <span class='op'>=</span> <span class='ivar'>@worker_data</span> <span class='op'>?</span> <span class='const'>Process</span>.<span class='id identifier rubyid_ppid'>ppid</span> <span class='op'>:</span> <span class='gvar'>$$</span>

  <span class='comment'># setup signal handlers before writing pid file in case people get
</span>  <span class='comment'># trigger happy and send signals as soon as the pid file exists.
</span>  <span class='comment'># Note that signals don&#39;t actually get handled until the #join method
</span>  <span class='ivar'>@queue_sigs</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_sig'>sig</span><span class='op'>|</span> <span class='id identifier rubyid_trap'>trap</span>(<span class='id identifier rubyid_sig'>sig</span>) { <span class='ivar'>@sig_queue</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_sig'>sig</span><span class='semicolon'>;</span> <span class='id identifier rubyid_awaken_master'><a href="#awaken_master-instance_method" title="Unicorn::HttpServer#awaken_master (method)">awaken_master</a></span> } }
  <span class='id identifier rubyid_trap'>trap</span>(<span class='symbeg'>:</span><span class='const'>CHLD</span>) { <span class='id identifier rubyid_awaken_master'><a href="#awaken_master-instance_method" title="Unicorn::HttpServer#awaken_master (method)">awaken_master</a></span> }

  <span class='comment'># write pid early for Mongrel compatibility if we&#39;re not inheriting sockets
</span>  <span class='comment'># This is needed for compatibility some Monit setups at least.
</span>  <span class='comment'># This unfortunately has the side effect of clobbering valid PID if
</span>  <span class='comment'># we upgrade and the upgrade breaks during preload_app==true &amp;&amp; build_app!
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span> <span class='op'>=</span> <span class='id identifier rubyid_config'><a href="#config-instance_method" title="Unicorn::HttpServer#config (method)">config</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_pid'><a href="#pid-instance_method" title="Unicorn::HttpServer#pid (method)">pid</a></span>]

  <span class='id identifier rubyid_build_app!'><a href="#build_app!-instance_method" title="Unicorn::HttpServer#build_app! (method)">build_app!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_preload_app'><a href="#preload_app-instance_method" title="Unicorn::HttpServer#preload_app (method)">preload_app</a></span>
  <span class='id identifier rubyid_bind_new_listeners!'><a href="#bind_new_listeners!-instance_method" title="Unicorn::HttpServer#bind_new_listeners! (method)">bind_new_listeners!</a></span>

  <span class='id identifier rubyid_spawn_missing_workers'><a href="#spawn_missing_workers-instance_method" title="Unicorn::HttpServer#spawn_missing_workers (method)">spawn_missing_workers</a></span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stop-instance_method">
  <h3 class='signature nodoc'>
    #<strong>stop</strong>(graceful = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Terminates all workers, but does not exit master process</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L337-L350'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='337' data-end='350'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 337</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>(<span class='id identifier rubyid_graceful'>graceful</span> <span class='op'>=</span> <span class='kw'>true</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_listeners'>listeners</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span> <span class='op'>+</span> <span class='id identifier rubyid_timeout'><a href="#timeout-instance_method" title="Unicorn::HttpServer#timeout (method)">timeout</a></span>
  <span class='kw'>until</span> <span class='ivar'>@workers</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='id identifier rubyid_time_now'>time_now</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_limit'>limit</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_graceful'>graceful</span>
      <span class='id identifier rubyid_soft_kill_each_worker'><a href="#soft_kill_each_worker-instance_method" title="Unicorn::HttpServer#soft_kill_each_worker (method)">soft_kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>QUIT</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_kill_each_worker'><a href="#kill_each_worker-instance_method" title="Unicorn::HttpServer#kill_each_worker (method)">kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>TERM</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_sleep'>sleep</span>(<span class='float'>0.1</span>)
    <span class='id identifier rubyid_reap_all_workers'><a href="#reap_all_workers-instance_method" title="Unicorn::HttpServer#reap_all_workers (method)">reap_all_workers</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_kill_each_worker'><a href="#kill_each_worker-instance_method" title="Unicorn::HttpServer#kill_each_worker (method)">kill_each_worker</a></span>(<span class='symbeg'>:</span><span class='const'>KILL</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unlink_pid_safe-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>unlink_pid_safe</strong>(path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>unlinks a PID file at given <code>path</code> if it contains the current PID still potentially racy without locking the directory (which is non-portable and may interact badly with other programs), but the window for hitting the race condition is small</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L743-L745'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='743' data-end='745'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 743</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unlink_pid_safe'>unlink_pid_safe</span>(<span class='id identifier rubyid_path'>path</span>)
  (<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_path'>path</span>).<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='gvar'>$$</span> <span class='kw'>and</span> <span class='const'>File</span>.<span class='id identifier rubyid_unlink'>unlink</span>(<span class='id identifier rubyid_path'>path</span>)) <span class='kw'>rescue</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_pid?-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>valid_pid?</strong>(path)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>returns a PID if a given path contains a non-stale PID file, nil otherwise.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L749-L759'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='749' data-end='759'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 749</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_pid?'>valid_pid?</span>(<span class='id identifier rubyid_path'>path</span>)
  <span class='id identifier rubyid_wpid'>wpid</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_path'>path</span>).<span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_wpid'>wpid</span> <span class='op'>&lt;=</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='kw'>return</span>
  <span class='const'>Process</span>.<span class='id identifier rubyid_kill'>kill</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_wpid'>wpid</span>)
  <span class='id identifier rubyid_wpid'>wpid</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPERM</span>
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Unicorn::HttpServer#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pid=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'> possibly stale, got EPERM signalling PID:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wpid'>wpid</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>nil</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ESRCH</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
  <span class='comment'># don&#39;t unlink stale pid files, racy without non-portable locking...
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="worker_loop-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>worker_loop</strong>(worker)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>runs inside each forked worker, this sits around and waits for connections and doesn’t die until the parent dies (or is given a INT, QUIT, or TERM signal)</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L689-L720'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='689' data-end='720'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 689</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_worker_loop'>worker_loop</span>(<span class='id identifier rubyid_worker'>worker</span>)
  <span class='id identifier rubyid_readers'>readers</span> <span class='op'>=</span> <span class='id identifier rubyid_init_worker_process'><a href="#init_worker_process-instance_method" title="Unicorn::HttpServer#init_worker_process (method)">init_worker_process</a></span>(<span class='id identifier rubyid_worker'>worker</span>)
  <span class='id identifier rubyid_waiter'>waiter</span> <span class='op'>=</span> <span class='id identifier rubyid_prep_readers'><a href="#prep_readers-instance_method" title="Unicorn::HttpServer#prep_readers (method)">prep_readers</a></span>(<span class='id identifier rubyid_readers'>readers</span>)
  <span class='id identifier rubyid_reopen'>reopen</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># this only works immediately if the master sent us the signal
</span>  <span class='comment'># (which is the normal case)
</span>  <span class='id identifier rubyid_trap'>trap</span>(<span class='symbeg'>:</span><span class='const'>USR1</span>) { <span class='id identifier rubyid_reopen'>reopen</span> <span class='op'>=</span> <span class='kw'>true</span> }

  <span class='id identifier rubyid_ready'>ready</span> <span class='op'>=</span> <span class='id identifier rubyid_readers'>readers</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='ivar'>@after_worker_ready</span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span>)

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_reopen'>reopen</span> <span class='op'>=</span> <span class='id identifier rubyid_reopen_worker_logs'><a href="#reopen_worker_logs-instance_method" title="Unicorn::HttpServer#reopen_worker_logs (method)">reopen_worker_logs</a></span>(<span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_nr'>nr</span>) <span class='kw'>if</span> <span class='id identifier rubyid_reopen'>reopen</span>
    <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_tick'>tick</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>.<span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_ready'>ready</span>.<span class='id identifier rubyid_shift'>shift</span>
      <span class='id identifier rubyid_client_ai'>client_ai</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span>(<span class='label'>exception:</span> <span class='kw'>false</span>)
      <span class='kw'>if</span> <span class='id identifier rubyid_client_ai'>client_ai</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_wait_readable'>wait_readable</span>
        <span class='id identifier rubyid_process_client'><a href="#process_client-instance_method" title="Unicorn::HttpServer#process_client (method)">process_client</a></span>(<span class='op'>*</span><span class='id identifier rubyid_client_ai'>client_ai</span>)
        <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_tick'>tick</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>.<span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>end</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_reopen'>reopen</span>
    <span class='kw'>end</span>

    <span class='comment'># timeout so we can .tick and keep parent from SIGKILL-ing us
</span>    <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_tick'>tick</span> <span class='op'>=</span> <span class='id identifier rubyid_time_now'>time_now</span>.<span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_waiter'>waiter</span>.<span class='id identifier rubyid_get_readers'>get_readers</span>(<span class='id identifier rubyid_ready'>ready</span><span class='comma'>,</span> <span class='id identifier rubyid_readers'>readers</span><span class='comma'>,</span> <span class='ivar'>@timeout</span>)
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='kw'>redo</span> <span class='kw'>if</span> <span class='id identifier rubyid_reopen'>reopen</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_readers'>readers</span>[<span class='int'>0</span>]
    <span class='const'><a href="../Unicorn.html" title="Unicorn (module)">Unicorn</a></span>.<span class='id identifier rubyid_log_error'><a href="../Unicorn.html#log_error-class_method" title="Unicorn.log_error (method)">log_error</a></span>(<span class='ivar'>@logger</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listen loop error</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span>) <span class='kw'>if</span> <span class='id identifier rubyid_readers'>readers</span>[<span class='int'>0</span>]
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='id identifier rubyid_readers'>readers</span>[<span class='int'>0</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="worker_spawn-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>worker_spawn</strong>(worker)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/http_server.rb#L456-L468'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='456' data-end='468'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn/http_server.rb', line 456</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_worker_spawn'>worker_spawn</span>(<span class='id identifier rubyid_worker'>worker</span>)
  <span class='id identifier rubyid_listener_fds'>listener_fds</span> <span class='op'>=</span> <span class='id identifier rubyid_listener_sockets'><a href="#listener_sockets-instance_method" title="Unicorn::HttpServer#listener_sockets (method)">listener_sockets</a></span>
  <span class='id identifier rubyid_env'>env</span> <span class='op'>=</span> {}
  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNICORN_FD</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_listener_fds'>listener_fds</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Unicorn::HttpServer#join (method)">join</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_listener_fds'>listener_fds</span>[<span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_to_io'>to_io</span>.<span class='id identifier rubyid_fileno'>fileno</span>] <span class='op'>=</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_to_io'>to_io</span>
  <span class='id identifier rubyid_listener_fds'>listener_fds</span>[<span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_master'>master</span>.<span class='id identifier rubyid_fileno'>fileno</span>] <span class='op'>=</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_master'>master</span>

  <span class='id identifier rubyid_worker_info'>worker_info</span> <span class='op'>=</span> [<span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_nr'>nr</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_to_io'>to_io</span>.<span class='id identifier rubyid_fileno'>fileno</span><span class='comma'>,</span> <span class='id identifier rubyid_worker'>worker</span>.<span class='id identifier rubyid_master'>master</span>.<span class='id identifier rubyid_fileno'>fileno</span>]
  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNICORN_WORKER</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_worker_info'>worker_info</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Unicorn::HttpServer#join (method)">join</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)

  <span class='const'>Process</span>.<span class='id identifier rubyid_spawn'>spawn</span>(<span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='op'>*</span><span class='const'><a href="#START_CTX-constant" title="Unicorn::HttpServer::START_CTX (constant)">START_CTX</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_argv'>argv</span>]<span class='comma'>,</span> <span class='id identifier rubyid_listener_fds'>listener_fds</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>