<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Unicorn &mdash; Unicorn master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Unicorn",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Unicorn master</a> &raquo; 
      <a href='_index.html#alpha_U'>Index (U)</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Unicorn&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Unicorn</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This module is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Unicorn/App.html" title="Unicorn::App (module)"><code>App</code></a>,
        <a class='nodoc' href="Unicorn/Const.html" title="Unicorn::Const (module)"><code>Const</code></a>,
        <a href="Unicorn/HttpResponse.html" title="Unicorn::HttpResponse (module)"><code>HttpResponse</code></a>,
        <a class='nodoc' href="Unicorn/Launcher.html" title="Unicorn::Launcher (module)"><code>Launcher</code></a>,
        <a href="Unicorn/OobGC.html" title="Unicorn::OobGC (module)"><code>OobGC</code></a>,
        <a class='nodoc' href="Unicorn/SocketHelper.html" title="Unicorn::SocketHelper (module)"><code>SocketHelper</code></a>,
        <a class='nodoc' href="Unicorn/Util.html" title="Unicorn::Util (module)"><code>Util</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="Unicorn/CGIWrapper.html" title="Unicorn::CGIWrapper (class)"><code>CGIWrapper</code></a>,
        <a href="Unicorn/Configurator.html" title="Unicorn::Configurator (class)"><code>Configurator</code></a>,
        <a href="Unicorn/HttpParser.html" title="Unicorn::HttpParser (class)"><code>HttpParser</code></a>,
        <a href="Unicorn/HttpServer.html" title="Unicorn::HttpServer (class)"><code>HttpServer</code></a>,
        <a class='nodoc' href="Unicorn/PrereadInput.html" title="Unicorn::PrereadInput (class)"><code>PrereadInput</code></a>,
        <a class='nodoc' href="Unicorn/SelectWaiter.html" title="Unicorn::SelectWaiter (class)"><code>SelectWaiter</code></a>,
        <a href="Unicorn/StreamInput.html" title="Unicorn::StreamInput (class)"><code>StreamInput</code></a>,
        <a href="Unicorn/TeeInput.html" title="Unicorn::TeeInput (class)"><code>TeeInput</code></a>,
        <a class='nodoc' href="Unicorn/TmpIO.html" title="Unicorn::TmpIO (class)"><code>TmpIO</code></a>,
        <a href="Unicorn/Worker.html" title="Unicorn::Worker (class)"><code>Worker</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Unicorn/HttpParserError.html" title="Unicorn::HttpParserError (class)"><code>HttpParserError</code></a>,
        <a href="Unicorn/RequestEntityTooLargeError.html" title="Unicorn::RequestEntityTooLargeError (class)"><code>RequestEntityTooLargeError</code></a>,
        <a href="Unicorn/RequestURITooLongError.html" title="Unicorn::RequestURITooLongError (class)"><code>RequestURITooLongError</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Unicorn/Configurator.html" title="Unicorn::Configurator (class)"><code>Configurator</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L23'>lib/unicorn.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/defunkt/unicorn/blob/master/ext/unicorn_http/httpdate.c#L82'>ext/unicorn_http/httpdate.c</a>,<br/> <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/ext/unicorn_http/unicorn_http.rl#L979'>ext/unicorn_http/unicorn_http.rl</a>,<br/> <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/cgi_wrapper.rb#L14'>lib/unicorn/cgi_wrapper.rb</a>,<br/> <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/preread_input.rb#L3'>lib/unicorn/preread_input.rb</a>,<br/> <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/socket_helper.rb#L5'>lib/unicorn/socket_helper.rb</a>,<br/> <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn/app/old_rails.rb#L13'>lib/unicorn/app/old_rails.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>unicorn exposes very little of an user-visible API and most of its internals are subject to change.  unicorn is designed to host Rack applications, so applications should be written against the Rack SPEC and not unicorn internals.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='ClientShutdown-constant' class='summary_signature nodoc'>ClientShutdown =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Raised inside <a href="Unicorn/TeeInput.html" title="Unicorn::TeeInput (class)"><code>::Unicorn::TeeInput</code></a> when a client closes the socket inside the application dispatch.  This is always raised with an empty backtrace since there is nothing in the application stack that is responsible for client shutdowns/disconnects.  This exception is visible to Rack applications unless <a href="Unicorn/PrereadInput.html" title="Unicorn::PrereadInput (class)"><code>::Unicorn::PrereadInput</code></a> middleware is loaded.  This is a subclass of the standard EOFError class and applications should not rescue it explicitly, but rescue EOFError instead.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L32-L32'># File 'lib/unicorn.rb', line 32</a>    <pre class='code ruby'><span class='const'>Class</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>EOFError</span>)</pre>
  </li>
  <li>
    <span id='F_SETPIPE_SZ-constant' class='summary_signature nodoc'>F_SETPIPE_SZ =</span>
    <br/>
    <a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L111-L111'># File 'lib/unicorn.rb', line 111</a>    <pre class='code ruby'><span class='int'>1031</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#builder-class_method" title=".builder (class method)">.<strong>builder</strong>(ru, op)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This returns a lambda to pass in as the app, this does not “build” the app (which we defer based on the outcome of “preload_app” in the <code>Unicorn</code> config).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#listener_names-class_method" title=".listener_names (class method)">.<strong>listener_names</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>returns an array of strings representing TCP listen socket addresses and Unix domain socket paths.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#log_error-class_method" title=".log_error (class method)">.<strong>log_error</strong>(logger, prefix, exc)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#pipe-class_method" title=".pipe (class method)">.<strong>pipe</strong>  </a>
    </span>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="builder-class_method">
  <h3 class='signature nodoc first'>
    .<strong>builder</strong>(ru, op)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This returns a lambda to pass in as the app, this does not “build” the app (which we defer based on the outcome of “preload_app” in the <code>Unicorn</code> config).  The returned lambda will be called when it is time to build the app.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L40-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='40' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn.rb', line 40</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_builder'>builder</span>(<span class='id identifier rubyid_ru'>ru</span><span class='comma'>,</span> <span class='id identifier rubyid_op'>op</span>)
  <span class='comment'># allow Configurator to parse cli switches embedded in the ru file
</span>  <span class='id identifier rubyid_op'>op</span> <span class='op'>=</span> <span class='const'>Unicorn</span><span class='op'>::</span><span class='const'><a href="Unicorn/Configurator.html" title="Unicorn::Configurator (class)">Configurator</a></span><span class='op'>::</span><span class='const'><a href="Unicorn/Configurator.html#RACKUP-constant" title="Unicorn::Configurator::RACKUP (constant)">RACKUP</a></span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_file'>file</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ru'>ru</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optparse'>optparse</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_op'>op</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_ru'>ru</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.ru$</span><span class='regexp_end'>/</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='kw'>defined?</span>(<span class='const'>Rack</span><span class='op'>::</span><span class='const'>Builder</span>)
    <span class='id identifier rubyid_abort'>abort</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack and Rack::Builder must be available for processing </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ru'>ru</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># always called after config file parsing, may be called after forking
</span>  <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
    <span class='id identifier rubyid_inner_app'>inner_app</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_ru'>ru</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.ru$</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_ru'>ru</span>)
      <span class='id identifier rubyid_raw'>raw</span>.<span class='id identifier rubyid_sub!'>sub!</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^__END__\n.*</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_eval'>eval</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rack::Builder.new {(\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raw'>raw</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n)}.to_app</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>TOPLEVEL_BINDING</span><span class='comma'>,</span> <span class='id identifier rubyid_ru'>ru</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_require'>require</span> <span class='id identifier rubyid_ru'>ru</span>
      <span class='const'><a href="Object.html" title="Object (class)">Object</a></span>.<span class='id identifier rubyid_const_get'>const_get</span>(<span class='const'>File</span>.<span class='id identifier rubyid_basename'>basename</span>(<span class='id identifier rubyid_ru'>ru</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.rb</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_capitalize'>capitalize</span>)
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='gvar'>$DEBUG</span>
      <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pp</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_pp'>pp</span>({ <span class='symbeg'>:</span><span class='id identifier rubyid_inner_app'>inner_app</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_inner_app'>inner_app</span> })
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_inner_app'>inner_app</span> <span class='kw'>unless</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_default_middleware'>default_middleware</span>

    <span class='id identifier rubyid_middleware'>middleware</span> <span class='op'>=</span> { <span class='comment'># order matters
</span>      <span class='label'>ContentLength:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>CommonLogger:</span> [ <span class='gvar'>$stderr</span> ]<span class='comma'>,</span>
      <span class='label'>ShowExceptions:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>Lint:</span> <span class='kw'>nil</span><span class='comma'>,</span>
      <span class='label'>TempfileReaper:</span> <span class='kw'>nil</span><span class='comma'>,</span>
    }

    <span class='comment'># return value, matches rackup defaults based on env
</span>    <span class='comment'># Unicorn does not support persistent connections, but Rainbows!
</span>    <span class='comment'># does.  Users accustomed to the Rack::Server default
</span>    <span class='comment'># middlewares will need ContentLength middleware.
</span>    <span class='kw'>case</span> <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RACK_ENV</span><span class='tstring_end'>&quot;</span></span>]
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>development</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deployment</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_middleware'>middleware</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='const'>ShowExceptions</span>)
      <span class='id identifier rubyid_middleware'>middleware</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='const'>Lint</span>)
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_inner_app'>inner_app</span>
    <span class='kw'>end</span>
    <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Builder</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_middleware'>middleware</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
        <span class='id identifier rubyid_use'>use</span>(<span class='const'>Rack</span>.<span class='id identifier rubyid_const_get'>const_get</span>(<span class='id identifier rubyid_m'>m</span>)<span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>if</span> <span class='const'>Rack</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='id identifier rubyid_m'>m</span>)
      <span class='kw'>end</span>
      <span class='id identifier rubyid_run'>run</span> <span class='id identifier rubyid_inner_app'>inner_app</span>
    <span class='kw'>end</span>.<span class='id identifier rubyid_to_app'>to_app</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listener_names-class_method">
  <h3 class='signature nodoc'>
    .<strong>listener_names</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>returns an array of strings representing TCP listen socket addresses and Unix domain socket paths.  This is useful for use with <code>Raindrops::Middleware</code> under Linux: <a href="https://yhbt.net/raindrops">yhbt.net/raindrops</a>/</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L98-L102'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='102'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn.rb', line 98</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_listener_names'>listener_names</span>
  <span class='const'>Unicorn</span><span class='op'>::</span><span class='const'><a href="Unicorn/HttpServer.html" title="Unicorn::HttpServer (class)">HttpServer</a></span><span class='op'>::</span><span class='const'><a href="Unicorn/HttpServer.html#LISTENERS-constant" title="Unicorn::HttpServer::LISTENERS (constant)">LISTENERS</a></span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='const'>Unicorn</span><span class='op'>::</span><span class='const'><a href="Unicorn/SocketHelper.html" title="Unicorn::SocketHelper (module)">SocketHelper</a></span>.<span class='id identifier rubyid_sock_name'><a href="Unicorn/SocketHelper.html#sock_name-class_method" title="Unicorn::SocketHelper.sock_name (method)">sock_name</a></span>(<span class='id identifier rubyid_io'>io</span>)
  <span class='kw'>end</span> <span class='op'>+</span> <span class='const'>Unicorn</span><span class='op'>::</span><span class='const'><a href="Unicorn/HttpServer.html" title="Unicorn::HttpServer (class)">HttpServer</a></span><span class='op'>::</span><span class='const'><a href="Unicorn/HttpServer.html#NEW_LISTENERS-constant" title="Unicorn::HttpServer::NEW_LISTENERS (constant)">NEW_LISTENERS</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="log_error-class_method">
  <h3 class='signature nodoc'>
    .<strong>log_error</strong>(logger, prefix, exc)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L104-L109'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='104' data-end='109'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn.rb', line 104</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_log_error'>log_error</span>(<span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='id identifier rubyid_prefix'>prefix</span><span class='comma'>,</span> <span class='id identifier rubyid_exc'>exc</span>)
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_exc'>exc</span>.<span class='id identifier rubyid_message'>message</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_dump'>dump</span> <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[[:cntrl:]]</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_message'>message</span>
  <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'>prefix</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exc'>exc</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_exc'>exc</span>.<span class='id identifier rubyid_backtrace'>backtrace</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_error'>error</span>(<span class='id identifier rubyid_line'>line</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipe-class_method">
  <h3 class='signature nodoc'>
    .<strong>pipe</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/defunkt/unicorn/blob/master/lib/unicorn.rb#L113-L128'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='113' data-end='128'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/unicorn.rb', line 113</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_pipe'>pipe</span> <span class='comment'># :nodoc:
</span>  <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='comment'># shrink pipes to minimize impact on /proc/sys/fs/pipe-user-pages-soft
</span>    <span class='comment'># limits.
</span>    <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'><a href="#F_SETPIPE_SZ-constant" title="Unicorn::F_SETPIPE_SZ (constant)">F_SETPIPE_SZ</a></span>)
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_fcntl'>fcntl</span>(<span class='const'><a href="#F_SETPIPE_SZ-constant" title="Unicorn::F_SETPIPE_SZ (constant)">F_SETPIPE_SZ</a></span><span class='comma'>,</span> <span class='const'>Raindrops</span><span class='op'>::</span><span class='const'>PAGE_SIZE</span>)
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINVAL</span>
        <span class='comment'># old kernel
</span>      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPERM</span>
        <span class='comment'># resizes fail if Linux is close to the pipe limit for the user
</span>        <span class='comment'># or if the user does not have permissions to resize
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>