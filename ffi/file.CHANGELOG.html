<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: CHANGELOG &mdash; FFI master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>FFI master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>1.17.0.rc2 / 2024-04-22</h2>

<p>Fixed:</p>

<ul>
<li>Add missing write barriers to StructLayout#initialize causing a segfault with GC.stress. #1079</li>
</ul>

<h2>1.17.0.rc1 / 2024-04-08</h2>

<p>Fixed:</p>

<ul>
<li>Fix type definitions on <code>aarch64-linux</code>. #1067, #1066</li>
<li>Use RB_TEST for <code>Pointer.autorelease=</code> . #1065
So that <code>false</code> and <code>nil</code> are treated as falsey and anything else as truthy.</li>
<li>Replace Fixnum by Integer. #1064
Fixnum is no longer present in the ruby language.</li>
<li>Update <a href="FFI/NativeType.html" title="FFI::NativeType (module)"><code>::FFI::NativeType</code></a> doc. #1061</li>
<li>Store FFI::Type::Mapped of <a href="FFI/StrPtrConverter.html" title="FFI::StrPtrConverter (class)"><code>::FFI::StrPtrConverter</code></a> in global instead of custom type map</li>
<li>Various documentation fixes. #1042</li>
<li>Update <a href="FFI/Pointer.html#==-instance_method" title="FFI::Pointer#== (method)">FFI::Pointer#==</a> to return <code>false</code> if a pointer is compared to a non-pointer object, which is the expected behavior. #1083</li>
<li>Avoid warning about undefined wariable <code>@ffi_functions</code> #1085</li>
<li>Fix a very unlikely GC bug when using a callback block. # 1089</li>
</ul>

<p>Added:</p>

<ul>
<li>Provide binary gems for many platforms. #990</li>
<li>Add Windows fat binary gem for Ruby-3.3</li>
<li>Add RBS type definitions for many user facing parts of the <a href="FFI.html" title="FFI (module)"><code>FFI</code></a> API. #1042</li>
<li>Improve fallback search path logic. #1088
Respect LD_LIBRARY_PATH and DYLD_LIBRARY_PATH on Macos.</li>
<li>Update libffi to current git master branch.</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove <code>enum CHAR_ARRAY</code> which is no longer used. #1063</li>
</ul>

<h2>1.16.3 / 2023-10-04</h2>

<p>Fixed:</p>

<ul>
<li>Fix gcc error when building on CentOS 7. #1052</li>
<li>Avoid trying to store new DataConverter type in frozen TypeDefs hash. #1057</li>
</ul>

<h2>1.16.2 / 2023-09-25</h2>

<p>Fixed:</p>

<ul>
<li>Handle null pointer crash after fork. #1051</li>
</ul>

<h2>1.16.1 / 2023-09-24</h2>

<p>Fixed:</p>

<ul>
<li>Fix compiling the builtin libffi. #1049</li>
</ul>

<h2>1.16.0 / 2023-09-23</h2>

<p>Fixed:</p>

<ul>
<li>Fix an issue with signed bitmasks when using flags on the most significant bit. #949</li>
<li>Fix FFI::Pointer#initialize using NUM2LL instead of NUM2ULL.</li>
<li>Fix FFI::Type#inspect to properly display the constant name. #1002</li>
<li>Use libffi closure allocations on hppa-Linux. #1017
Previously they would segfault.</li>
<li>Fix class name of Symbol#inspect.</li>
<li>Fix MSVC support of libtest. #1028</li>
<li>Fix attach_function of functions ending in ? or ! #971</li>
</ul>

<p>Added:</p>

<ul>
<li>Convert all C-based classes to TypedData and use write barriers. #994, #995, #996, #997, #998, #999, #1000, #1001, #1003, #1004, #1005, #1006, #1007, #1008, #1009, #1010, #1011, #1012
This results in less pressure on the garbage collector, since the objects can be promoted to the old generation, which means they only get marked on major GC.</li>
<li>Implement <code>ObjectSpace.memsize_of()</code> of all C-based classes.</li>
<li>Make FFI Ractor compatible. #1023
Modules extended per <code>extend FFI::Library</code> need to be frozen in order to be used by non-main Ractors.
This can be done by calling <code>freeze</code> below of all C interface definitions.

<ul>
<li>In a Ractor it&#39;s possible to:</li>
<li>load DLLs and call its functions, access its global variables</li>
<li>use builtin typedefs</li>
<li>use and modify ractor local typedefs</li>
<li>define callbacks</li>
<li>receive async callbacks from non-ruby threads</li>
<li>use frozen FFI::Library based modules with all attributes (enums, structs, typedefs, functions, callbacks)</li>
<li>invoke frozen functions and callbacks defined in the main Ractor</li>
<li>use FFI::Struct definitions from the main Ractor</li>
<li>In a Ractor it&#39;s impossible to:</li>
<li>create new FFI::Library based modules</li>
<li>create new FFI::Struct definitions</li>
<li>use custom global typedefs</li>
<li>use non-frozen FFI::Library based modules</li>
</ul></li>
<li>Allow type retrieval of attached functions+variables. #1023</li>
<li>Make FFI classes <code>GC.compact</code> friendly. #1021</li>
<li>Update libffi and disable custom trampoline when using libffi closure allocation. #1020
This is because libffi changed the way how closures are allocated to static trampolines.</li>
<li>Add types.conf for loongarch64-linux. #943</li>
<li>Add types.conf for sw_64-linux (Shen Wei 64-bit, based on Alpha).  #1018</li>
<li>Add support for aarch64-windows. #1035</li>
<li>Windows: Update LoadLibrary error message to include error code. #1026</li>
<li>Allow private release method for <a href="FFI/ManagedStruct.html" title="FFI::ManagedStruct (class)"><code>::FFI::ManagedStruct</code></a> and <a href="FFI/AutoPointer.html" title="FFI::AutoPointer (class)"><code>::FFI::AutoPointer</code></a>. #1029</li>
<li>Add support for passing ABI version to <a href="FFI.html" title="FFI (module)"><code>FFI</code></a>.map_library_name. #963
This adds the new class FFI::LibraryPath .</li>
<li>Add support for ruby-3.2 to windows binary gem. #1047</li>
<li>Enable debug symbols for <code>rake compile</code> builds to ease debugging. #1048</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove allocator of AbstractMemory. #1013
This disables AbstractMemory.new, which has no practical use.</li>
<li>Remove unused FFI::SizeTypes. #1022</li>
</ul>

<h2>1.15.5 / 2022-01-10</h2>

<p>Fixed:</p>

<ul>
<li>Fix long double argument or return values on 32bit i686. #849</li>
<li>FFI::ConstGenerator: avoid usage of the same binary file simultaneously. #929</li>
</ul>

<p>Added:</p>

<ul>
<li>Add Windows fat binary gem for Ruby-3.1</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove Windows fat binary gem for Ruby &lt; 2.4</li>
</ul>

<h2>1.15.4 / 2021-09-01</h2>

<p>Fixed:</p>

<ul>
<li>Fix build for uClibc. #913</li>
<li>Correct module lookup when including <code>ffi-module</code> gem. #912</li>
</ul>

<p>Changed:</p>

<ul>
<li>Use ruby code of the ffi gem in JRuby-9.2.20+. #915</li>
</ul>

<h2>1.15.3 / 2021-06-16</h2>

<p>Fixed:</p>

<ul>
<li>Fix temporary packaging issue with libffi. #904</li>
</ul>

<h2>1.15.2 / 2021-06-16</h2>

<p>Added:</p>

<ul>
<li>Add support for Windows MINGW-UCRT build. #903</li>
<li>Add <code>/opt/homebrew/lib/</code> to fallback search paths to improve homebrew support. #880 #882</li>
</ul>

<p>Changed:</p>

<ul>
<li>Regenerate <code>types.conf</code> for FreeBSD12 aarch64. #902</li>
</ul>

<h2>1.15.1 / 2021-05-22</h2>

<p>Fixed:</p>

<ul>
<li>Append -pthread to linker options. #893</li>
<li>Use arm or aarch64 to identify Apple ARM CPU arch. #899</li>
<li>Allow overriding <code>gcc</code> with the <code>CC</code> env var in <code>const_generator.rb</code> and <code>struct_generator.rb</code>. #897</li>
</ul>

<h2>1.15.0 / 2021-03-05</h2>

<p>Fixed:</p>

<ul>
<li>Fix MSVC build</li>
<li>Fix async callbacks in conjunction with fork(). #884</li>
</ul>

<p>Added:</p>

<ul>
<li>Allow to pass callbacks in varargs. #885</li>
<li>Name the threads for <a href="FFI.html" title="FFI (module)"><code>FFI</code></a> callback dispatcher and async thread calls for easier debugging. #883
The name can be retrieved by Thread.name and is shown by Thread.list.inspect etc.
Even gdb shows the thread name on supported operating systems.</li>
<li>Add types.conf for powerpc64le-linux</li>
<li>Add types.conf for riscv64-linux</li>
<li>More release automation of ffi gems</li>
</ul>

<p>Changed:</p>

<ul>
<li>Switch from rubygems-tasks to bundler/gem_helper</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove unused VariadicInvoker#init</li>
</ul>

<h2>1.14.2 / 2020-12-21</h2>

<p>Fixed:</p>

<ul>
<li>Fix builtin libffi on newer Ubuntu caused by an outdated Makefile.in . #863</li>
</ul>

<h2>1.14.1 / 2020-12-19</h2>

<p>Changed:</p>

<ul>
<li>Revert changes to FFI::Pointer#write_string made in ffi-1.14.0.
It breaks compatibilty in a way that can cause hard to find errors. #857</li>
</ul>

<h2>1.14.0 / 2020-12-18</h2>

<p>Added:</p>

<ul>
<li>Add types.conf for x86_64-msys, x86_64-haiku, aarch64-openbsd and aarch64-darwin (alias arm64-darwin)</li>
<li>Add method AbstractMemory#size_limit? . #829</li>
<li>Add new extconf option --enable-libffi-alloc which is enabled per default on Apple M1 (arm64-darwin).</li>
</ul>

<p>Changed:</p>

<ul>
<li>Do NULL pointer check only when array length &gt; 0 . #305</li>
<li>Raise an error on an unknown order argument. #830</li>
<li>Change FFI::Pointer#write_string to terminate with a NUL byte like other string methods. #805</li>
<li>Update bundled libffi to latest master.</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove win32/stdint.h and stdbool.h because of copyright issue.  #693</li>
</ul>

<p>Fixed:</p>

<ul>
<li>Fix possible UTF-8 load error in loader script interpretation. #792</li>
<li>Fix segfault on non-array argument to #write_array_of_*</li>
<li>Fix memory leak in MethodHandle . #815</li>
<li>Fix possible segfault in combination with fiddle or other libffi using gems . #835</li>
<li>Fix possibility to use ffi ruby gem with JRuby-9.3 . #763</li>
<li>Fix a GC issue, when a callback Proc is used on more than 2 callback signatures. #820</li>
</ul>

<h2>1.13.1 / 2020-06-09</h2>

<p>Changed:</p>

<ul>
<li>Revert use of <code>ucrtbase.dll</code> as default C library on Windows-MINGW.
<code>ucrtbase.dll</code> is still used on MSWIN target. #790</li>
<li>Test for <code>ffi_prep_closure_loc()</code> to make sure we can use this function.
This fixes incorrect use of system libffi on MacOS Mojave (10.14). #787</li>
<li>Update types.conf on x86_64-dragonflybsd</li>
</ul>

<h2>1.13.0 / 2020-06-01</h2>

<p>Added:</p>

<ul>
<li>Add TruffleRuby support. Almost all specs are running on TruffleRuby and succeed. #768</li>
<li>Add ruby source files to the java gem. This allows to ship the Ruby library code per platform java gem and add it as a default gem to JRuby. #763</li>
<li>Add FFI::Platform::LONG_DOUBLE_SIZE</li>
<li>Add bounds checks for writing to an inline char[] . #756</li>
<li>Add long double as callback return value. #771</li>
<li>Update type definitions and add types from stdint.h and stddef.h on i386-windows, x86_64-windows, x86_64-darwin, x86_64-linux, arm-linux, powerpc-linux. #749</li>
<li>Add new type definitions for powerpc-openbsd and sparcv9-openbsd. #775, #778</li>
</ul>

<p>Changed:</p>

<ul>
<li>Raise required ruby version to &gt;= 2.3.</li>
<li>Lots of cleanups and improvements in library, specs and benchmarks.</li>
<li>Fix a lot of compiler warnings at the C-extension</li>
<li>Fix several install issues on MacOS:

<ul>
<li>Look for libffi in SDK paths, since recent versions of macOS removed it from <code>/usr/include</code> . #757</li>
<li>Fix error <code>ld: library not found for -lgcc_s.10.4</code></li>
<li>Don&#39;t built for i386 architecture as it is deprecated</li>
</ul></li>
<li>Several fixes for MSVC build on Windows. #779</li>
<li>Use <code>ucrtbase.dll</code> as default C library on Windows instead of old <code>msvcrt.dll</code>. #779</li>
<li>Update builtin libffi to fix a Powerpc issue with parameters of type long</li>
<li>Allow unmodified sourcing of (the ruby code of) this gem in JRuby and TruffleRuby as a default gem. #747</li>
<li>Improve check to detect if a module has a #find_type method suitable for <a href="FFI.html" title="FFI (module)"><code>FFI</code></a>. This fixes compatibility with stdlib <code>mkmf</code> . #776</li>
</ul>

<p>Removed:</p>

<ul>
<li>Reject callback with <code>:string</code> return type at definition, because it didn&#39;t work so far and is not save to use. #751, #782</li>
</ul>

<h2>1.12.2 / 2020-02-01</h2>

<ul>
<li>Fix possible segfault at FFI::Struct#[] and []= after GC.compact . #742</li>
</ul>

<h2>1.12.1 / 2020-01-14</h2>

<p>Added:</p>

<ul>
<li>Add binary gem support for ruby-2.7 on Windows</li>
</ul>

<h2>1.12.0 / 2020-01-14</h2>

<p>Added:</p>

<ul>
<li><a href="FFI.html#VERSION-constant" title="FFI::VERSION (constant)">FFI::VERSION</a> is defined as part of <code>require &#39;ffi&#39;</code> now.
It is no longer necessary to <code>require &#39;ffi/version&#39;</code> .</li>
</ul>

<p>Changed:</p>

<ul>
<li>Update libffi to latest master.</li>
</ul>

<p>Deprecated:</p>

<ul>
<li>Overwriting struct layouts is now warned and will be disallowed in ffi-2.0. #734, #735</li>
</ul>

<h2>1.11.3 / 2019-11-25</h2>

<p>Removed:</p>

<ul>
<li>Remove support for tainted objects which cause deprecation warnings in ruby-2.7. #730</li>
</ul>

<h2>1.11.2 / 2019-11-11</h2>

<p>Added:</p>

<ul>
<li>Add DragonFlyBSD as a platform. #724</li>
</ul>

<p>Changed:</p>

<ul>
<li>Sort all types.conf files, so that files and changes are easier to compare.</li>
<li>Regenerated type conf for freebsd12 and x86_64-linux targets. #722</li>
<li>Remove MACOSX_DEPLOYMENT_TARGET that was targeting very old version 10.4. #647</li>
<li>Fix library name mangling for non glibc Linux/UNIX. #727</li>
<li>Fix compiler warnings raised by ruby-2.7</li>
<li>Update libffi to latest master.</li>
</ul>

<h2>1.11.1 / 2019-05-20</h2>

<p>Changed:</p>

<ul>
<li>Raise required ruby version to &gt;=2.0. #699, #700</li>
<li>Fix a possible linker error on ruby &lt; 2.3 on Linux.</li>
</ul>

<h2>1.11.0 / 2019-05-17</h2>

<p>This version was yanked on 2019-05-20 to fix an install issue on ruby-1.9.3. #700</p>

<p>Added:</p>

<ul>
<li>Add ability to disable or force use of system libffi. #669
Use like <code>gem inst ffi -- --enable-system-libffi</code> .</li>
<li>Add ability to call <a href="FFI.html" title="FFI (module)"><code>FFI</code></a> callbacks from outside of <a href="FFI.html" title="FFI (module)"><code>FFI</code></a> call frame. #584</li>
<li>Add proper documentation to <a href="FFI/Generator.html" title="FFI::Generator (class)"><code>::FFI::Generator</code></a> and ::Task</li>
<li>Add gemspec metadata. #696, #698</li>
</ul>

<p>Changed:</p>

<ul>
<li>Fix stdcall on Win32. #649, #669</li>
<li>Fix load paths for FFI::Generator::Task</li>
<li>Fix FFI::Pointer#read_string(0) to return a binary String. #692</li>
<li>Fix benchmark suite so that it runs on ruby-2.x</li>
<li>Move FFI::Platform::CPU from C to Ruby. #663</li>
<li>Move FFI::StructByReference to Ruby. #681</li>
<li>Move FFI::DataConverter to Ruby (#661)</li>
<li>Various cleanups and improvements of specs and benchmarks</li>
</ul>

<p>Removed:</p>

<ul>
<li>Remove ruby-1.8 and 1.9 compatibility code. #683</li>
<li>Remove unused spec files. #684</li>
</ul>

<h2>1.10.0 / 2019-01-06</h2>

<p>Added:</p>

<ul>
<li>Add /opt/local/lib/ to ffi&#39;s fallback library search path. #638</li>
<li>Add binary gem support for ruby-2.6 on Windows</li>
<li>Add FreeBSD on AArch64 and ARM support. #644</li>
<li>Add FFI::LastError.winapi_error on Windows native or Cygwin. #633</li>
</ul>

<p>Changed:</p>

<ul>
<li>Update to rake-compiler-dock-0.7.0</li>
<li>Use 64-bit inodes on FreeBSD &gt;= 12. #644</li>
<li>Switch time_t and suseconds_t types to long on FreeBSD. #627</li>
<li>Make register_t long_long on 64-bit FreeBSD. #644</li>
<li>Fix Pointer#write_array_of_type #637</li>
</ul>

<p>Removed:</p>

<ul>
<li>Drop binary gem support for ruby-2.0 and 2.1 on Windows</li>
</ul>

<h2>1.9.25 / 2018-06-03</h2>

<p>Changed:</p>

<ul>
<li>Revert closures via libffi.
This re-adds ClosurePool and fixes compat with SELinux enabled systems. #621</li>
</ul>

<h2>1.9.24 / 2018-06-02</h2>

<p>Security Note:</p>

<p>This update addresses vulnerability CVE-2018-1000201: DLL loading issue which can be hijacked on Windows OS, when a Symbol is used as DLL name instead of a String. Found by Matthew Bush.</p>

<p>Added:</p>

<ul>
<li>Added a CHANGELOG file</li>
<li>Add mips64(eb) support, and mips r6 support. (#601)</li>
</ul>

<p>Changed:</p>

<ul>
<li>Update libffi to latest changes on master.</li>
<li>Don&#39;t search in hardcoded /usr paths on Windows.</li>
<li>Don&#39;t treat Symbol args different to Strings in ffi_lib.</li>
<li>Make sure size_t is defined in Thread.c. Fixes #609</li>
</ul>

<h2>1.9.23 / 2018-02-25</h2>

<p>Changed:</p>

<ul>
<li>Fix unnecessary rebuild of configure in darwin multi arch. Fixes #605</li>
</ul>

<h2>1.9.22 / 2018-02-22</h2>

<p>Changed:</p>

<ul>
<li>Update libffi to latest changes on master.</li>
<li>Update detection of system libffi to match new requirements. Fixes #617</li>
<li>Prefer bundled libffi over system libffi on Mac OS.</li>
<li>Do closures via libffi. This removes ClosurePool and fixes compat with PaX. #540</li>
<li>Use a more deterministic gem packaging.</li>
<li>Fix unnecessary update of autoconf files at gem install.</li>
</ul>

<h2>1.9.21 / 2018-02-06</h2>

<p>Added:</p>

<ul>
<li>Ruby-2.5 support by Windows binary gems. Fixes #598</li>
<li>Add missing win64 types.</li>
<li>Added support for Bitmask. (#573)</li>
<li>Add support for MSYS2 (#572) and Sparc64 Linux. (#574)</li>
</ul>

<p>Changed:</p>

<ul>
<li>Fix read_string to not throw an error on length 0.</li>
<li>Don&#39;t use absolute paths for sh and env. Fixes usage on Adroid #528</li>
<li>Use Ruby implementation for <code>which</code> for better compat with Windows. Fixes #315</li>
<li>Fix compatibility with PPC64LE platform. (#577)</li>
<li>Normalize sparc64 to sparcv9. (#575)</li>
</ul>

<p>Removed:</p>

<ul>
<li>Drop Ruby 1.8.7 support (#480)</li>
</ul>

<h2>1.9.18 / 2017-03-03</h2>

<p>Added:</p>

<ul>
<li>Add compatibility with Ruby-2.4.</li>
</ul>

<p>Changed:</p>

<ul>
<li>Add missing shlwapi.h include to fix Windows build.</li>
<li>Avoid undefined behaviour of LoadLibrary() on Windows. #553</li>
</ul>

<h2>1.9.17 / 2017-01-13</h2>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>