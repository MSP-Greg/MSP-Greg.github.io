<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: JSON::Ext::Parser &mdash; json Ruby-2.4.0 d2016-07-07</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "JSON::Ext::Parser",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../../index.html'>Home</a> &raquo; 
          <a href='../../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../../index.html'>json</a> &raquo; 
          <a href='../../_index.html'>Index (P)</a> &raquo; 
        #  <a href="../../JSON.html" title="JSON (module)">JSON</a> &raquo; 
        #  <a href="../Ext.html" title="JSON::Ext (module)">Ext</a> &raquo; 
          <span class='title'>Parser</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: JSON::Ext::Parser</h1>

<div class="box_info">
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class='inheritName'>Object</span>
        <ul class='fullTree'>
          <li>Object</li>
            <li class='next'>JSON::Ext::Parser</li>
        </ul>
        <a href='#' class='inheritanceTree'>show all</a>
    </dd>
  </dl>



  <dl>
    <dt>Defined in:</dt>
    <dd>json/parser/parser.c</dd>
  </dl>
</div>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is the JSON parser implemented as a C extension. It can be configured
to be used by setting</p>

<pre class="code ruby"><code class="ruby">{JSON.parser} = {JSON::Ext::Parser}</code></pre>

<p>with the method parser= in JSON.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(source, opts)  &#x21d2; {} </a>
      </span>
      <span class='note title constructor'>constructor</span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new <a href="" title="JSON::Ext::Parser (class)">Parser</a> instance for the string <em>source</em>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#parse-instance_method" title="#parse (instance method)">#<strong>parse</strong>()  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Parses the current JSON text <em>source</em> and returns the complete data
structure as a result.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source-instance_method" title="#source (instance method)">#<strong>source</strong>()  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a copy of the current <em>source</em> string, that was used to
construct this Parser.</p>
</div>
      </span>
    </li>
  </ul>

<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(source, opts)  &#x21d2; <tt>{}</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new <a href="" title="JSON::Ext::Parser (class)">JSON::Ext::Parser</a> instance for the string <em>source</em>.</p>

<p>Creates a new <a href="" title="JSON::Ext::Parser (class)">JSON::Ext::Parser</a> instance for the string <em>source</em>.</p>

<p>It will be configured by the <em>opts</em> hash. <em>opts</em> can have the
following keys:</p>

<p><em>opts</em> can have the following keys:</p>
<ul><li>
<p><strong>max_nesting</strong>: The maximum depth of nesting allowed in the
parsed data structures. Disable depth checking with :max_nesting =&gt;
false|nil|0, it defaults to 100.</p>
</li><li>
<p><strong>allow_nan</strong>: If set to true, allow NaN, Infinity and
-Infinity in defiance of RFC 4627 to be parsed by the Parser. This option
defaults to false.</p>
</li><li>
<p><strong>symbolize_names</strong>: If set to true, returns symbols for the
names (keys) in a JSON object. Otherwise strings are returned, which is
also the default. It&#39;s not possible to use this option in conjunction
with the <strong>create_additions</strong> option.</p>
</li><li>
<p><strong>create_additions</strong>: If set to false, the Parser doesn&#39;t
create additions even if a matching class and create_id was found. This
option defaults to false.</p>
</li><li>
<p><strong>object_class</strong>: Defaults to Hash</p>
</li><li>
<p><strong>array_class</strong>: Defaults to Array</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805</pre>
  <div class='lines_code'>
      <pre class='code cpp'><span class='info file'># File 'json/parser/parser.c', line 1708</span>

static VALUE cParser_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE source, opts;
    GET_PARSER_INIT;

    if (json-&gt;Vsource) {
        rb_raise(rb_eTypeError, &quot;already initialized instance&quot;);
    }
#ifdef HAVE_RB_SCAN_ARGS_OPTIONAL_HASH
    rb_scan_args(argc, argv, &quot;1:&quot;, &amp;source, &amp;opts);
#else
    rb_scan_args(argc, argv, &quot;11&quot;, &amp;source, &amp;opts);
#endif
    if (!NIL_P(opts)) {
#ifndef HAVE_RB_SCAN_ARGS_OPTIONAL_HASH
        opts = rb_convert_type(opts, T_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);
        if (NIL_P(opts)) {
            rb_raise(rb_eArgError, &quot;opts needs to be like a hash&quot;);
        } else {
#endif
            VALUE tmp = ID2SYM(i_max_nesting);
            if (option_given_p(opts, tmp)) {
                VALUE max_nesting = rb_hash_aref(opts, tmp);
                if (RTEST(max_nesting)) {
                    Check_Type(max_nesting, T_FIXNUM);
                    json-&gt;max_nesting = FIX2INT(max_nesting);
                } else {
                    json-&gt;max_nesting = 0;
                }
            } else {
                json-&gt;max_nesting = 100;
            }
            tmp = ID2SYM(i_allow_nan);
            if (option_given_p(opts, tmp)) {
                json-&gt;allow_nan = RTEST(rb_hash_aref(opts, tmp)) ? 1 : 0;
            } else {
                json-&gt;allow_nan = 0;
            }
            tmp = ID2SYM(i_symbolize_names);
            if (option_given_p(opts, tmp)) {
                json-&gt;symbolize_names = RTEST(rb_hash_aref(opts, tmp)) ? 1 : 0;
            } else {
                json-&gt;symbolize_names = 0;
            }
            tmp = ID2SYM(i_create_additions);
            if (option_given_p(opts, tmp)) {
                json-&gt;create_additions = RTEST(rb_hash_aref(opts, tmp));
            } else {
                json-&gt;create_additions = 0;
            }
            if (json-&gt;symbolize_names &amp;&amp; json-&gt;create_additions) {
              rb_raise(rb_eArgError,
                &quot;options :symbolize_names and :create_additions cannot be &quot;
                &quot; used in conjunction&quot;);
            }
            tmp = ID2SYM(i_create_id);
            if (option_given_p(opts, tmp)) {
                json-&gt;create_id = rb_hash_aref(opts, tmp);
            } else {
                json-&gt;create_id = rb_funcall(mJSON, i_create_id, 0);
            }
            tmp = ID2SYM(i_object_class);
            if (option_given_p(opts, tmp)) {
                json-&gt;object_class = rb_hash_aref(opts, tmp);
            } else {
                json-&gt;object_class = Qnil;
            }
            tmp = ID2SYM(i_array_class);
            if (option_given_p(opts, tmp)) {
                json-&gt;array_class = rb_hash_aref(opts, tmp);
            } else {
                json-&gt;array_class = Qnil;
            }
            tmp = ID2SYM(i_match_string);
            if (option_given_p(opts, tmp)) {
                VALUE match_string = rb_hash_aref(opts, tmp);
                json-&gt;match_string = RTEST(match_string) ? match_string : Qnil;
            } else {
                json-&gt;match_string = Qnil;
            }
#ifndef HAVE_RB_SCAN_ARGS_OPTIONAL_HASH
        }
#endif
    } else {
        json-&gt;max_nesting = 100;
        json-&gt;allow_nan = 0;
        json-&gt;create_additions = 1;
        json-&gt;create_id = rb_funcall(mJSON, i_create_id, 0);
        json-&gt;object_class = Qnil;
        json-&gt;array_class = Qnil;
    }
    source = convert_encoding(StringValue(source));
    StringValue(source);
    json-&gt;len = RSTRING_LEN(source);
    json-&gt;source = RSTRING_PTR(source);;
    json-&gt;Vsource = source;
    return self;
}</pre>
  </div>
</div>
</section><h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="parse-instance_method">
  <h3 class='signature first'>
  #<strong>parse</strong>()  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Parses the current JSON text <em>source</em> and returns the complete data
structure as a result.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935
1936
1937
1938
1939
1940
1941
1942
1943
1944
1945
1946
1947
1948
1949
1950
1951
1952
1953
1954
1955
1956
1957
1958
1959
1960
1961
1962
1963
1964
1965
1966
1967
1968
1969
1970
1971
1972
1973
1974
1975
1976
1977
1978
1979
1980
1981
1982
1983</pre>
  <div class='lines_code'>
      <pre class='code cpp'><span class='info file'># File 'json/parser/parser.c', line 1825</span>

static VALUE cParser_parse(VALUE self)
{
  char *p, *pe;
  int cs = EVIL;
  VALUE result = Qnil;
  GET_PARSER;


#line 1834 &quot;parser.c&quot;
	{
	cs = JSON_start;
	}

#line 733 &quot;parser.rl&quot;
  p = json-&gt;source;
  pe = p + json-&gt;len;

#line 1843 &quot;parser.c&quot;
	{
	if ( p == pe )
		goto _test_eof;
	switch ( cs )
	{
st1:
	if ( ++p == pe )
		goto _test_eof1;
case 1:
	switch( (*p) ) {
		case 13: goto st1;
		case 32: goto st1;
		case 34: goto tr2;
		case 45: goto tr2;
		case 47: goto st6;
		case 73: goto tr2;
		case 78: goto tr2;
		case 91: goto tr2;
		case 102: goto tr2;
		case 110: goto tr2;
		case 116: goto tr2;
		case 123: goto tr2;
	}
	if ( (*p) &gt; 10 ) {
		if ( 48 &lt;= (*p) &amp;&amp; (*p) &lt;= 57 )
			goto tr2;
	} else if ( (*p) &gt;= 9 )
		goto st1;
	goto st0;
st0:
cs = 0;
	goto _out;
tr2:
#line 709 &quot;parser.rl&quot;
	{
        char *np = JSON_parse_value(json, p, pe, &amp;result, 0);
        if (np == NULL) { p--; {p++; cs = 10; goto _out;} } else {p = (( np))-1;}
    }
	goto st10;
st10:
	if ( ++p == pe )
		goto _test_eof10;
case 10:
#line 1887 &quot;parser.c&quot;
	switch( (*p) ) {
		case 13: goto st10;
		case 32: goto st10;
		case 47: goto st2;
	}
	if ( 9 &lt;= (*p) &amp;&amp; (*p) &lt;= 10 )
		goto st10;
	goto st0;
st2:
	if ( ++p == pe )
		goto _test_eof2;
case 2:
	switch( (*p) ) {
		case 42: goto st3;
		case 47: goto st5;
	}
	goto st0;
st3:
	if ( ++p == pe )
		goto _test_eof3;
case 3:
	if ( (*p) == 42 )
		goto st4;
	goto st3;
st4:
	if ( ++p == pe )
		goto _test_eof4;
case 4:
	switch( (*p) ) {
		case 42: goto st4;
		case 47: goto st10;
	}
	goto st3;
st5:
	if ( ++p == pe )
		goto _test_eof5;
case 5:
	if ( (*p) == 10 )
		goto st10;
	goto st5;
st6:
	if ( ++p == pe )
		goto _test_eof6;
case 6:
	switch( (*p) ) {
		case 42: goto st7;
		case 47: goto st9;
	}
	goto st0;
st7:
	if ( ++p == pe )
		goto _test_eof7;
case 7:
	if ( (*p) == 42 )
		goto st8;
	goto st7;
st8:
	if ( ++p == pe )
		goto _test_eof8;
case 8:
	switch( (*p) ) {
		case 42: goto st8;
		case 47: goto st1;
	}
	goto st7;
st9:
	if ( ++p == pe )
		goto _test_eof9;
case 9:
	if ( (*p) == 10 )
		goto st1;
	goto st9;
	}
	_test_eof1: cs = 1; goto _test_eof;
	_test_eof10: cs = 10; goto _test_eof;
	_test_eof2: cs = 2; goto _test_eof;
	_test_eof3: cs = 3; goto _test_eof;
	_test_eof4: cs = 4; goto _test_eof;
	_test_eof5: cs = 5; goto _test_eof;
	_test_eof6: cs = 6; goto _test_eof;
	_test_eof7: cs = 7; goto _test_eof;
	_test_eof8: cs = 8; goto _test_eof;
	_test_eof9: cs = 9; goto _test_eof;

	_test_eof: {}
	_out: {}
	}

#line 736 &quot;parser.rl&quot;

  if (cs &gt;= JSON_first_final &amp;&amp; p == pe) {
    return result;
  } else {
    rb_enc_raise(EXC_ENCODING eParserError, &quot;%u: unexpected token at &#39;%s&#39;&quot;, __LINE__, p);
    return Qnil;
  }
}</pre>
  </div>
</div>
</section>  <section class='method_details' id="source-instance_method">
  <h3 class='signature'>
  #<strong>source</strong>()  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a copy of the current <em>source</em> string, that was used to
construct this Parser.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2033
2034
2035
2036
2037</pre>
  <div class='lines_code'>
      <pre class='code cpp'><span class='info file'># File 'json/parser/parser.c', line 2033</span>

static VALUE cParser_source(VALUE self)
{
    GET_PARSER;
    return rb_str_dup(json-&gt;Vsource);
}</pre>
  </div>
</div>
</section>
<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.8.7.6 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>