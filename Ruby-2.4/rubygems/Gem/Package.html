<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Gem::Package &mdash; rubygems Ruby-2.4.0 d2016-07-21</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Gem::Package",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>rubygems</a> &raquo; 
          <a href='../_index.html'>Index (P)</a> &raquo; 
          <a href="../Gem.html" title="Gem (module)">Gem</a> &raquo; 
          <span class='title'>Package</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Gem::Package</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>Gem::Package</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Package/DigestIO.html" title="Gem::Package::DigestIO (class)">DigestIO</a>,
    <a href="Package/FileSource.html" title="Gem::Package::FileSource (class)">FileSource</a>,
    <a href="Package/IOSource.html" title="Gem::Package::IOSource (class)">IOSource</a>,
    <a href="Package/Old.html" title="Gem::Package::Old (class)">Old</a>,
    <a href="Package/Source.html" title="Gem::Package::Source (class)">Source</a>,
    <a href="Package/TarHeader.html" title="Gem::Package::TarHeader (class)">TarHeader</a>,
    <a href="Package/TarReader.html" title="Gem::Package::TarReader (class)">TarReader</a>,
    <a href="Package/TarTestCase.html" title="Gem::Package::TarTestCase (class)">TarTestCase</a>,
    <a href="Package/TarWriter.html" title="Gem::Package::TarWriter (class)">TarWriter</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="Package/Error.html" title="Gem::Package::Error (class)">Error</a>,
    <a href="Package/FormatError.html" title="Gem::Package::FormatError (class)">FormatError</a>,
    <a href="Package/NonSeekableIO.html" title="Gem::Package::NonSeekableIO (class)">NonSeekableIO</a>,
    <a href="Package/PathError.html" title="Gem::Package::PathError (class)">PathError</a>,
    <a href="Package/TarInvalidError.html" title="Gem::Package::TarInvalidError (class)">TarInvalidError</a>,
    <a href="Package/TooLongFileName.html" title="Gem::Package::TooLongFileName (class)">TooLongFileName</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Includes:</td>
    <td><a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Direct Subclasses:</td>
    <td>
      <a href="Package/Old.html" title="Gem::Package::Old (class)">Old</a>
    </td>
  </tr>


  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
rubygems/package.rb</div>  </td>
  </tr>
</table>



<h2>Instance Attribute Summary <small><a href='#' class='summary_toggle'>collapse</a></small></h2>

  <ul class="summary">
    <li>
      <span class="summary_signature">
        <a href="#checksums-instance_method" title="#checksums (instance method)">#<strong>checksums</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checksums for the contents of the package</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#files-instance_method" title="#files (instance method)">#<strong>files</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The files in this package.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#security_policy-instance_method" title="#security_policy (instance method)">#<strong>security_policy</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The security policy used for verifying the contents of this package.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#spec-instance_method" title="#spec (instance method)">#<strong>spec</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The spec for this gem.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#spec%3D-instance_method" title="#spec= (instance method)">#<strong>spec=</strong>(value)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to use to build this package.</p>
</div>
      </span>
    </li>
  </ul>


<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#build-class_method" title=".build (class method)">.<strong>build</strong>(spec, skip_validation = false)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(gem, security_policy = nil)  &#x21d2; Package </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new <a href="" title="Gem::Package (class)">Package</a> for the file at <code>gem</code>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#add_checksums-instance_method" title="#add_checksums (instance method)">#<strong>add_checksums</strong>(tar)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds a checksum for each entry in the gem to checksums.yaml.gz.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_contents-instance_method" title="#add_contents (instance method)">#<strong>add_contents</strong>(tar)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds the files listed in the packages&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to
data.tar.gz and adds this file to the <code>tar</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_files-instance_method" title="#add_files (instance method)">#<strong>add_files</strong>(tar)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds files included the package&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to the
<code>tar</code> file</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_metadata-instance_method" title="#add_metadata (instance method)">#<strong>add_metadata</strong>(tar)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds the package&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to the <code>tar</code> file</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(skip_validation = false)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Builds this package based on the specification set by <a href="#spec%3D-instance_method" title="Gem::Package#spec= (method)">#spec=</a></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#contents-instance_method" title="#contents (instance method)">#<strong>contents</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>A list of file names contained in this gem</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#copy_to-instance_method" title="#copy_to (instance method)">#<strong>copy_to</strong>(path)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Copies this package to <code>path</code> (if possible)</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#digest-instance_method" title="#digest (instance method)">#<strong>digest</strong>(entry)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a digest of the TarEntry <code>entry</code> from the digest
algorithm set by the security policy.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#extract_files-instance_method" title="#extract_files (instance method)">#<strong>extract_files</strong>(destination_dir, pattern = &quot;*&quot;)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts the files in this package into <code>destination_dir</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#extract_tar_gz-instance_method" title="#extract_tar_gz (instance method)">#<strong>extract_tar_gz</strong>(io, destination_dir, pattern = &quot;*&quot;)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts all the files in the gzipped tar archive <code>io</code> into
<code>destination_dir</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#gzip_to-instance_method" title="#gzip_to (instance method)">#<strong>gzip_to</strong>(io)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gzips content written to <code>gz_io</code> to <code>io</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(gem, security_policy)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new package that will read or write to the file <code>gem</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#install_location-instance_method" title="#install_location (instance method)">#<strong>install_location</strong>(filename, destination_dir)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the full path for installing <code>filename</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#load_spec-instance_method" title="#load_spec (instance method)">#<strong>load_spec</strong>(entry)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Loads a <a href="Specification.html" title="Gem::Specification (class)">Specification</a> from the TarEntry <code>entry</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#open_tar_gz-instance_method" title="#open_tar_gz (instance method)">#<strong>open_tar_gz</strong>(io)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Opens <code>io</code> as a gzipped tar archive</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#read_checksums-instance_method" title="#read_checksums (instance method)">#<strong>read_checksums</strong>(gem)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Reads and loads checksums.yaml.gz from the tar file <code>gem</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#setup_signer-instance_method" title="#setup_signer (instance method)">#<strong>setup_signer</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Prepares the gem for signing and checksum generation.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify-instance_method" title="#verify (instance method)">#<strong>verify</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies that this gem:</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_checksums-instance_method" title="#verify_checksums (instance method)">#<strong>verify_checksums</strong>(digests, checksums)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies the <code>checksums</code> against the <code>digests</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_entry-instance_method" title="#verify_entry (instance method)">#<strong>verify_entry</strong>(entry)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies <code>entry</code> in a gem file.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_files-instance_method" title="#verify_files (instance method)">#<strong>verify_files</strong>(gem)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies the files of the <code>gem</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_gz-instance_method" title="#verify_gz (instance method)">#<strong>verify_gz</strong>(entry)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies that <code>entry</code> is a valid gzipped file.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a></h3>
  <p class="inherited"><a href="UserInteraction.html#alert-instance_method" title="Gem::UserInteraction#alert (method)">#alert</a>, <a href="UserInteraction.html#alert_error-instance_method" title="Gem::UserInteraction#alert_error (method)">#alert_error</a>, <a href="UserInteraction.html#alert_warning-instance_method" title="Gem::UserInteraction#alert_warning (method)">#alert_warning</a>, <a href="UserInteraction.html#ask-instance_method" title="Gem::UserInteraction#ask (method)">#ask</a>, <a href="UserInteraction.html#ask_for_password-instance_method" title="Gem::UserInteraction#ask_for_password (method)">#ask_for_password</a>, <a href="UserInteraction.html#ask_yes_no-instance_method" title="Gem::UserInteraction#ask_yes_no (method)">#ask_yes_no</a>, <a href="UserInteraction.html#choose_from_list-instance_method" title="Gem::UserInteraction#choose_from_list (method)">#choose_from_list</a>, <a href="UserInteraction.html#say-instance_method" title="Gem::UserInteraction#say (method)">#say</a>, <a href="UserInteraction.html#terminate_interaction-instance_method" title="Gem::UserInteraction#terminate_interaction (method)">#terminate_interaction</a>, <a href="UserInteraction.html#verbose-instance_method" title="Gem::UserInteraction#verbose (method)">#verbose</a></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="DefaultUserInteraction.html" title="Gem::DefaultUserInteraction (module)">DefaultUserInteraction</a></h3>
  <p class="inherited"><a href="DefaultUserInteraction.html#ui-class_method" title="Gem::DefaultUserInteraction.ui (method)">.ui</a>, <a href="DefaultUserInteraction.html#ui-instance_method" title="Gem::DefaultUserInteraction#ui (method)">#ui</a>, <a href="DefaultUserInteraction.html#ui%3D-instance_method" title="Gem::DefaultUserInteraction#ui= (method)">#ui=</a>, <a href="DefaultUserInteraction.html#ui%3D-class_method" title="Gem::DefaultUserInteraction.ui= (method)">.ui=</a>, <a href="DefaultUserInteraction.html#use_ui-class_method" title="Gem::DefaultUserInteraction.use_ui (method)">.use_ui</a>, <a href="DefaultUserInteraction.html#use_ui-instance_method" title="Gem::DefaultUserInteraction#use_ui (method)">#use_ui</a></p>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(gem, security_policy = nil)  &#x21d2; <tt><a href="" title="Gem::Package (class)">Package</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new <a href="" title="Gem::Package (class)">Gem::Package</a> for the file at <code>gem</code>.
<code>gem</code> can also be provided as an IO object.</p>

<p>If <code>gem</code> is an existing file in the old format a
<a href="Package/Old.html" title="Gem::Package::Old (class)">Old</a> will be returned.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 127</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem'>gem</span><span class='comma'>,</span> <span class='id identifier rubyid_security_policy'>security_policy</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_gem'>gem</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>Source</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_gem'>gem</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:read</span>
          <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>IOSource</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem'>gem</span>
        <span class='kw'>else</span>
          <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FileSource</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem'>gem</span>
        <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span> <span class='op'>==</span> <span class='kw'>self</span>
  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MD5SUM =</span><span class='tstring_end'>&#39;</span></span>

  <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>Old</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem'>gem</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Attribute Details</h2>
  <section class='method_details first' id="checksums-instance_method">
  <h3 class='signature first'>
  #<strong>checksums</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checksums for the contents of the package</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


92</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 92</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:checksums</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="files-instance_method">
  <h3 class='signature'>
  #<strong>files</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The files in this package.  This is not the contents of the gem, just the
files in the top-level container.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


98</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 98</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:files</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="security_policy-instance_method">
  <h3 class='signature'>
  #<strong>security_policy</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The security policy used for verifying the contents of this package.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


103</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 103</span>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:security_policy</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="spec-instance_method">
  <h3 class='signature'>
  #<strong>spec</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The spec for this gem.</p>

<p>If this is a package for a built gem the spec is loaded from the gem and
returned.  If this is a package for a gem being built the provided spec is
returned.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


500
501
502
503
504</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 500</span>

<span class='kw'>def</span> <span class='id identifier rubyid_spec'>spec</span>
  <span class='id identifier rubyid_verify'>verify</span> <span class='kw'>unless</span> <span class='ivar'>@spec</span>

  <span class='ivar'>@spec</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="spec=-instance_method">
  <h3 class='signature'>
  #<strong>spec=</strong>(value)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to use to build this package.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


108</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 108</span>

<span class='id identifier rubyid_attr_writer'>attr_writer</span> <span class='symbol'>:spec</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="build-class_method">
  <h3 class='signature first'>
  .<strong>build</strong>(spec, skip_validation = false)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


110
111
112
113
114
115
116
117
118</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 110</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span><span class='op'>=</span><span class='kw'>false</span>
  <span class='id identifier rubyid_gem_file'>gem_file</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_file_name'>file_name</span>

  <span class='id identifier rubyid_package'>package</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem_file'>gem_file</span>
  <span class='id identifier rubyid_package'>package</span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span>
  <span class='id identifier rubyid_package'>package</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span>

  <span class='id identifier rubyid_gem_file'>gem_file</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="add_checksums-instance_method">
  <h3 class='signature first'>
  #<strong>add_checksums</strong>(tar)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds a checksum for each entry in the gem to checksums.yaml.gz.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_checksums'>add_checksums</span> <span class='id identifier rubyid_tar'>tar</span>
  <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_load_yaml'>load_yaml</span>

  <span class='id identifier rubyid_checksums_by_algorithm'>checksums_by_algorithm</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>

  <span class='ivar'>@checksums</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_digests'>digests</span><span class='op'>|</span>
    <span class='id identifier rubyid_digests'>digests</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='comma'>,</span> <span class='id identifier rubyid_digest'>digest</span><span class='op'>|</span>
      <span class='id identifier rubyid_checksums_by_algorithm'>checksums_by_algorithm</span><span class='lbracket'>[</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_digest'>digest</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_add_file_signed'>add_file_signed</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>checksums.yaml.gz</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0444</span><span class='comma'>,</span> <span class='ivar'>@signer</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_gzip_to'>gzip_to</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gz_io'>gz_io</span><span class='op'>|</span>
      <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span> <span class='id identifier rubyid_checksums_by_algorithm'>checksums_by_algorithm</span><span class='comma'>,</span> <span class='id identifier rubyid_gz_io'>gz_io</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_contents-instance_method">
  <h3 class='signature'>
  #<strong>add_contents</strong>(tar)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds the files listed in the packages&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to
data.tar.gz and adds this file to the <code>tar</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


194
195
196
197
198
199
200
201
202
203
204</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_contents'>add_contents</span> <span class='id identifier rubyid_tar'>tar</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_digests'>digests</span> <span class='op'>=</span> <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_add_file_signed'>add_file_signed</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0444</span><span class='comma'>,</span> <span class='ivar'>@signer</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_gzip_to'>gzip_to</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gz_io'>gz_io</span><span class='op'>|</span>
      <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarWriter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gz_io'>gz_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data_tar'>data_tar</span><span class='op'>|</span>
        <span class='id identifier rubyid_add_files'>add_files</span> <span class='id identifier rubyid_data_tar'>data_tar</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@checksums</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_digests'>digests</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_files-instance_method">
  <h3 class='signature'>
  #<strong>add_files</strong>(tar)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds files included the package&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to the
<code>tar</code> file</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 209</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_files'>add_files</span> <span class='id identifier rubyid_tar'>tar</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_files'>files</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
    <span class='id identifier rubyid_stat'>stat</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_lstat'>lstat</span> <span class='id identifier rubyid_file'>file</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_symlink?'>symlink?</span>
      <span class='id identifier rubyid_relative_dir'>relative_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_pwd'>pwd</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_target_path'>target_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_relative_dir'>relative_dir</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readlink'>readlink</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_add_symlink'>add_symlink</span> <span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_target_path'>target_path</span><span class='comma'>,</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span>
    <span class='kw'>end</span>

    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span>

    <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_add_file_simple'>add_file_simple</span> <span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dst_io'>dst_io</span><span class='op'>|</span>
      <span class='id identifier rubyid_open'>open</span> <span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_src_io'>src_io</span><span class='op'>|</span>
        <span class='id identifier rubyid_dst_io'>dst_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_src_io'>src_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='int'>16384</span> <span class='kw'>until</span> <span class='id identifier rubyid_src_io'>src_io</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_metadata-instance_method">
  <h3 class='signature'>
  #<strong>add_metadata</strong>(tar)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds the package&#39;s <a href="Specification.html" title="Gem::Specification (class)">Specification</a> to the <code>tar</code> file</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


232
233
234
235
236
237
238
239
240</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_metadata'>add_metadata</span> <span class='id identifier rubyid_tar'>tar</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_digests'>digests</span> <span class='op'>=</span> <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_add_file_signed'>add_file_signed</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata.gz</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>0444</span><span class='comma'>,</span> <span class='ivar'>@signer</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_gzip_to'>gzip_to</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gz_io'>gz_io</span><span class='op'>|</span>
      <span class='id identifier rubyid_gz_io'>gz_io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_to_yaml'>to_yaml</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@checksums</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata.gz</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_digests'>digests</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="build-instance_method">
  <h3 class='signature'>
  #<strong>build</strong>(skip_validation = false)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Builds this package based on the specification set by <a href="#spec%3D-instance_method" title="Gem::Package#spec= (method)">#spec=</a></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_load_yaml'>load_yaml</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubygems/security</span><span class='tstring_end'>&#39;</span></span>

  <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_mark_version'>mark_version</span>
  <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_validate'>validate</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skip_validation'>skip_validation</span>

  <span class='id identifier rubyid_setup_signer'>setup_signer</span>

  <span class='ivar'>@gem</span><span class='period'>.</span><span class='id identifier rubyid_with_write_io'>with_write_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gem_io'>gem_io</span><span class='op'>|</span>
    <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarWriter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gem_io'>gem_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gem'>gem</span><span class='op'>|</span>
      <span class='id identifier rubyid_add_metadata'>add_metadata</span> <span class='id identifier rubyid_gem'>gem</span>
      <span class='id identifier rubyid_add_contents'>add_contents</span> <span class='id identifier rubyid_gem'>gem</span>
      <span class='id identifier rubyid_add_checksums'>add_checksums</span> <span class='id identifier rubyid_gem'>gem</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_say'>say</span> <span class='heredoc_beg'>&lt;&lt;-EOM</span>
<span class='tstring_content'>Successfully built RubyGem
Name: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>
Version: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'>
File: </span><span class='embexpr_beg'>#{</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span> <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_cache_file'>cache_file</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='heredoc_end'>EOM
</span><span class='kw'>ensure</span>
  <span class='ivar'>@signer</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="contents-instance_method">
  <h3 class='signature'>
  #<strong>contents</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>A list of file names contained in this gem</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 275</span>

<span class='kw'>def</span> <span class='id identifier rubyid_contents'>contents</span>
  <span class='kw'>return</span> <span class='ivar'>@contents</span> <span class='kw'>if</span> <span class='ivar'>@contents</span>

  <span class='id identifier rubyid_verify'>verify</span> <span class='kw'>unless</span> <span class='ivar'>@spec</span>

  <span class='ivar'>@contents</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='ivar'>@gem</span><span class='period'>.</span><span class='id identifier rubyid_with_read_io'>with_read_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_gem_tar'>gem_tar</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarReader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span>

    <span class='id identifier rubyid_gem_tar'>gem_tar</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span>

      <span class='id identifier rubyid_open_tar_gz'>open_tar_gz</span> <span class='id identifier rubyid_entry'>entry</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pkg_tar'>pkg_tar</span><span class='op'>|</span>
        <span class='id identifier rubyid_pkg_tar'>pkg_tar</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_contents_entry'>contents_entry</span><span class='op'>|</span>
          <span class='ivar'>@contents</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_contents_entry'>contents_entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>return</span> <span class='ivar'>@contents</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="copy_to-instance_method">
  <h3 class='signature'>
  #<strong>copy_to</strong>(path)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Copies this package to <code>path</code> (if possible)</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


165
166
167</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_copy_to'>copy_to</span> <span class='id identifier rubyid_path'>path</span>
  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span> <span class='ivar'>@gem</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_path'>path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="digest-instance_method">
  <h3 class='signature'>
  #<strong>digest</strong>(entry)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a digest of the TarEntry <code>entry</code> from the digest
algorithm set by the security policy.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 303</span>

<span class='kw'>def</span> <span class='id identifier rubyid_digest'>digest</span> <span class='id identifier rubyid_entry'>entry</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_algorithms'>algorithms</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@checksums</span> <span class='kw'>then</span>
                 <span class='ivar'>@checksums</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
               <span class='kw'>else</span>
                 <span class='lbracket'>[</span><span class='const'>Gem</span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'>DIGEST_NAME</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
               <span class='kw'>end</span>

  <span class='id identifier rubyid_algorithms'>algorithms</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='op'>|</span>
    <span class='id identifier rubyid_digester'>digester</span> <span class='op'>=</span>
      <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='rparen'>)</span> <span class='kw'>then</span>
        <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_algorithm'>algorithm</span>
      <span class='kw'>else</span>
        <span class='const'>Digest</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='kw'>end</span>

    <span class='id identifier rubyid_digester'>digester</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>16384</span><span class='rparen'>)</span> <span class='kw'>until</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span>

    <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>

    <span class='ivar'>@digests</span><span class='lbracket'>[</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_digester'>digester</span>
  <span class='kw'>end</span>

  <span class='ivar'>@digests</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="extract_files-instance_method">
  <h3 class='signature'>
  #<strong>extract_files</strong>(destination_dir, pattern = &quot;*&quot;)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts the files in this package into <code>destination_dir</code></p>

<p>If <code>pattern</code> is specified, only entries matching that glob will
be extracted.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_files'>extract_files</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_pattern'>pattern</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_verify'>verify</span> <span class='kw'>unless</span> <span class='ivar'>@spec</span>

  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span>

  <span class='ivar'>@gem</span><span class='period'>.</span><span class='id identifier rubyid_with_read_io'>with_read_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='id identifier rubyid_reader'>reader</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarReader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span>

    <span class='id identifier rubyid_reader'>reader</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span>

      <span class='id identifier rubyid_extract_tar_gz'>extract_tar_gz</span> <span class='id identifier rubyid_entry'>entry</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_pattern'>pattern</span>

      <span class='kw'>return</span> <span class='comment'># ignore further entries
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="extract_tar_gz-instance_method">
  <h3 class='signature'>
  #<strong>extract_tar_gz</strong>(io, destination_dir, pattern = &quot;*&quot;)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts all the files in the gzipped tar archive <code>io</code> into
<code>destination_dir</code>.</p>

<p>If an entry in the archive contains a relative path above
<code>destination_dir</code> or an absolute path is encountered an
exception is raised.</p>

<p>If <code>pattern</code> is specified, only entries matching that glob will
be extracted.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 363</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_tar_gz'>extract_tar_gz</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_pattern'>pattern</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_open_tar_gz'>open_tar_gz</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tar'>tar</span><span class='op'>|</span>
    <span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_fnmatch'>fnmatch</span> <span class='id identifier rubyid_pattern'>pattern</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='comma'>,</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>FNM_DOTMATCH</span>

      <span class='id identifier rubyid_destination'>destination</span> <span class='op'>=</span> <span class='id identifier rubyid_install_location'>install_location</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span>

      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span> <span class='id identifier rubyid_destination'>destination</span>

      <span class='id identifier rubyid_mkdir_options'>mkdir_options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_mkdir_options'>mkdir_options</span><span class='lbracket'>[</span><span class='symbol'>:mode</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span> <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='id identifier rubyid_mkdir'>mkdir</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='kw'>then</span>
          <span class='id identifier rubyid_destination'>destination</span>
        <span class='kw'>else</span>
          <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span> <span class='id identifier rubyid_destination'>destination</span>
        <span class='kw'>end</span>

      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span> <span class='id identifier rubyid_mkdir'>mkdir</span><span class='comma'>,</span> <span class='id identifier rubyid_mkdir_options'>mkdir_options</span>

      <span class='id identifier rubyid_open'>open</span> <span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_out'>out</span><span class='op'>|</span>
        <span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
        <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chmod'>chmod</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_destination'>destination</span>
      <span class='kw'>end</span> <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span>

      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_symlink'>symlink</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_linkname'>linkname</span><span class='comma'>,</span> <span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_symlink?'>symlink?</span>

      <span class='id identifier rubyid_verbose'>verbose</span> <span class='id identifier rubyid_destination'>destination</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="gzip_to-instance_method">
  <h3 class='signature'>
  #<strong>gzip_to</strong>(io)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gzips content written to <code>gz_io</code> to <code>io</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


401
402
403
404
405
406
407
408</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 401</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gzip_to'>gzip_to</span> <span class='id identifier rubyid_io'>io</span> <span class='comment'># :yields: gz_io
</span>  <span class='id identifier rubyid_gz_io'>gz_io</span> <span class='op'>=</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipWriter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>BEST_COMPRESSION</span>
  <span class='id identifier rubyid_gz_io'>gz_io</span><span class='period'>.</span><span class='id identifier rubyid_mtime'>mtime</span> <span class='op'>=</span> <span class='ivar'>@build_time</span>

  <span class='kw'>yield</span> <span class='id identifier rubyid_gz_io'>gz_io</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_gz_io'>gz_io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="initialize-instance_method">
  <h3 class='signature'>
  #<strong>initialize</strong>(gem, security_policy)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new package that will read or write to the file <code>gem</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


148
149
150
151
152
153
154
155
156
157
158
159
160</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_gem'>gem</span><span class='comma'>,</span> <span class='id identifier rubyid_security_policy'>security_policy</span> <span class='comment'># :notnew:
</span>  <span class='ivar'>@gem</span> <span class='op'>=</span> <span class='id identifier rubyid_gem'>gem</span>

  <span class='ivar'>@build_time</span>      <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@checksums</span>       <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@contents</span>        <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@digests</span>         <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>
  <span class='ivar'>@files</span>           <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@security_policy</span> <span class='op'>=</span> <span class='id identifier rubyid_security_policy'>security_policy</span>
  <span class='ivar'>@signatures</span>      <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@signer</span>          <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@spec</span>            <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="install_location-instance_method">
  <h3 class='signature'>
  #<strong>install_location</strong>(filename, destination_dir)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the full path for installing <code>filename</code>.</p>

<p>If <code>filename</code> is not inside <code>destination_dir</code> an
exception is raised.</p>


  </div>
</div>
<div class="tags">
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<tt><a href="Package/PathError.html" title="Gem::Package::PathError (class)">Gem::Package::PathError</a></tt>)</span>
  </li>
</ul>

</div><div class='source_code h'>
  <pre class='lines_num'>


415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 415</span>

<span class='kw'>def</span> <span class='id identifier rubyid_install_location'>install_location</span> <span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>PathError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='rparen'>)</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_filename'>filename</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_destination_dir'>destination_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_realpath'>realpath</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span> <span class='kw'>if</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:realpath</span>
  <span class='id identifier rubyid_destination_dir'>destination_dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span>

  <span class='id identifier rubyid_destination'>destination</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span>
  <span class='id identifier rubyid_destination'>destination</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span> <span class='id identifier rubyid_destination'>destination</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>PathError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span><span class='rparen'>)</span> <span class='kw'>unless</span>
    <span class='id identifier rubyid_destination'>destination</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span> <span class='id identifier rubyid_destination_dir'>destination_dir</span>

  <span class='id identifier rubyid_destination'>destination</span><span class='period'>.</span><span class='id identifier rubyid_untaint'>untaint</span>
  <span class='id identifier rubyid_destination'>destination</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="load_spec-instance_method">
  <h3 class='signature'>
  #<strong>load_spec</strong>(entry)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Loads a <a href="Specification.html" title="Gem::Specification (class)">Specification</a> from the TarEntry <code>entry</code></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


436
437
438
439
440
441
442
443
444
445
446
447
448
449
450</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 436</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_spec'>load_spec</span> <span class='id identifier rubyid_entry'>entry</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='ivar'>@spec</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Specification</span><span class='period'>.</span><span class='id identifier rubyid_from_yaml'>from_yaml</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>metadata.gz</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_entry'>entry</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='symbol'>:external_encoding</span> <span class='op'>=&gt;</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span> <span class='rbrace'>}</span> <span class='kw'>if</span>
      <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:Encoding</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
        <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipReader</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:wrap</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_arity'>arity</span> <span class='op'>!=</span> <span class='int'>1</span>

    <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipReader</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gzio'>gzio</span><span class='op'>|</span>
      <span class='ivar'>@spec</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Specification</span><span class='period'>.</span><span class='id identifier rubyid_from_yaml'>from_yaml</span> <span class='id identifier rubyid_gzio'>gzio</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="open_tar_gz-instance_method">
  <h3 class='signature'>
  #<strong>open_tar_gz</strong>(io)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Opens <code>io</code> as a gzipped tar archive</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


455
456
457
458
459
460
461</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 455</span>

<span class='kw'>def</span> <span class='id identifier rubyid_open_tar_gz'>open_tar_gz</span> <span class='id identifier rubyid_io'>io</span> <span class='comment'># :nodoc:
</span>  <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipReader</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gzio'>gzio</span><span class='op'>|</span>
    <span class='id identifier rubyid_tar'>tar</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarReader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_gzio'>gzio</span>

    <span class='kw'>yield</span> <span class='id identifier rubyid_tar'>tar</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="read_checksums-instance_method">
  <h3 class='signature'>
  #<strong>read_checksums</strong>(gem)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Reads and loads checksums.yaml.gz from the tar file <code>gem</code></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


466
467
468
469
470
471
472
473
474</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 466</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_checksums'>read_checksums</span> <span class='id identifier rubyid_gem'>gem</span>
  <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_load_yaml'>load_yaml</span>

  <span class='ivar'>@checksums</span> <span class='op'>=</span> <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>checksums.yaml.gz</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipReader</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span> <span class='id identifier rubyid_entry'>entry</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gz_io'>gz_io</span><span class='op'>|</span>
      <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span> <span class='id identifier rubyid_gz_io'>gz_io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="setup_signer-instance_method">
  <h3 class='signature'>
  #<strong>setup_signer</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Prepares the gem for signing and checksum generation.  If a signing
certificate and key are not present only checksum generation is set up.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


480
481
482
483
484
485
486
487
488
489
490
491</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 480</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_signer'>setup_signer</span>
  <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GEM_PRIVATE_KEY_PASSPHRASE</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_signing_key'>signing_key</span> <span class='kw'>then</span>
    <span class='ivar'>@signer</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'>Signer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>
    <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_signing_key'>signing_key</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>=</span> <span class='ivar'>@signer</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span> <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='ivar'>@signer</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'>Signer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>
    <span class='ivar'>@spec</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>=</span> <span class='ivar'>@signer</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span> <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span> <span class='rbrace'>}</span> <span class='kw'>if</span>
      <span class='ivar'>@signer</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify-instance_method">
  <h3 class='signature'>
  #<strong>verify</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies that this gem:</p>
<ul><li>
<p>Contains a valid gem specification</p>
</li><li>
<p>Contains a contents archive</p>
</li><li>
<p>The contents archive is not corrupt</p>
</li></ul>

<p>After verification the gem specification from the gem is available from
<a href="#spec-instance_method" title="Gem::Package#spec (method)">#spec</a></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 516</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify'>verify</span>
  <span class='ivar'>@files</span>     <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@spec</span>      <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='ivar'>@gem</span><span class='period'>.</span><span class='id identifier rubyid_with_read_io'>with_read_io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarReader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reader'>reader</span><span class='op'>|</span>
      <span class='id identifier rubyid_read_checksums'>read_checksums</span> <span class='id identifier rubyid_reader'>reader</span>

      <span class='id identifier rubyid_verify_files'>verify_files</span> <span class='id identifier rubyid_reader'>reader</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_verify_checksums'>verify_checksums</span> <span class='ivar'>@digests</span><span class='comma'>,</span> <span class='ivar'>@checksums</span>

  <span class='ivar'>@security_policy</span><span class='period'>.</span><span class='id identifier rubyid_verify_signatures'>verify_signatures</span> <span class='ivar'>@spec</span><span class='comma'>,</span> <span class='ivar'>@digests</span><span class='comma'>,</span> <span class='ivar'>@signatures</span> <span class='kw'>if</span>
    <span class='ivar'>@security_policy</span>

  <span class='kw'>true</span>
<span class='kw'>rescue</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'>Exception</span>
  <span class='ivar'>@spec</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>rescue</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>TarInvalidError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='ivar'>@gem</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_checksums-instance_method">
  <h3 class='signature'>
  #<strong>verify_checksums</strong>(digests, checksums)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies the <code>checksums</code> against the <code>digests</code>.  This
check is not cryptographically secure.  Missing checksums are ignored.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


548
549
550
551
552
553
554
555
556
557
558
559
560
561</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 548</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_checksums'>verify_checksums</span> <span class='id identifier rubyid_digests'>digests</span><span class='comma'>,</span> <span class='id identifier rubyid_checksums'>checksums</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_checksums'>checksums</span>

  <span class='id identifier rubyid_checksums'>checksums</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='comma'>,</span> <span class='id identifier rubyid_gem_digests'>gem_digests</span><span class='op'>|</span>
    <span class='id identifier rubyid_gem_digests'>gem_digests</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file_name'>file_name</span><span class='comma'>,</span> <span class='id identifier rubyid_gem_hexdigest'>gem_hexdigest</span><span class='op'>|</span>
      <span class='id identifier rubyid_computed_digest'>computed_digest</span> <span class='op'>=</span> <span class='id identifier rubyid_digests'>digests</span><span class='lbracket'>[</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_file_name'>file_name</span><span class='rbracket'>]</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_computed_digest'>computed_digest</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span> <span class='op'>==</span> <span class='id identifier rubyid_gem_hexdigest'>gem_hexdigest</span> <span class='kw'>then</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> \
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='embexpr_end'>}</span><span class='tstring_content'> checksum mismatch for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file_name'>file_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@gem</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_entry-instance_method">
  <h3 class='signature'>
  #<strong>verify_entry</strong>(entry)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies <code>entry</code> in a gem file.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 566</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_entry'>verify_entry</span> <span class='id identifier rubyid_entry'>entry</span>
  <span class='id identifier rubyid_file_name'>file_name</span> <span class='op'>=</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span>
  <span class='ivar'>@files</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_file_name'>file_name</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_file_name'>file_name</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.sig$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span>
    <span class='ivar'>@signatures</span><span class='lbracket'>[</span><span class='backref'>$`</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='kw'>if</span> <span class='ivar'>@security_policy</span>
    <span class='kw'>return</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_digest'>digest</span> <span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_file_name'>file_name</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^metadata(.gz)?$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span>
    <span class='id identifier rubyid_load_spec'>load_spec</span> <span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='id identifier rubyid_verify_gz'>verify_gz</span> <span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>package is corrupt, exception while verifying: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='ivar'>@gem</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_files-instance_method">
  <h3 class='signature'>
  #<strong>verify_files</strong>(gem)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies the files of the <code>gem</code></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


593
594
595
596
597
598
599
600
601
602
603
604
605
606</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 593</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_files'>verify_files</span> <span class='id identifier rubyid_gem'>gem</span>
  <span class='id identifier rubyid_gem'>gem</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='id identifier rubyid_verify_entry'>verify_entry</span> <span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='ivar'>@spec</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>package metadata is missing</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='ivar'>@gem</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data.tar.gz</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> \
            <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>package content (data.tar.gz) is missing</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='ivar'>@gem</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_gz-instance_method">
  <h3 class='signature'>
  #<strong>verify_gz</strong>(entry)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies that <code>entry</code> is a valid gzipped file.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


611
612
613
614
615
616
617</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/package.rb', line 611</span>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_gz'>verify_gz</span> <span class='id identifier rubyid_entry'>entry</span> <span class='comment'># :nodoc:
</span>  <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipReader</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span> <span class='id identifier rubyid_entry'>entry</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gzio'>gzio</span><span class='op'>|</span>
    <span class='id identifier rubyid_gzio'>gzio</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='int'>16384</span> <span class='kw'>until</span> <span class='id identifier rubyid_gzio'>gzio</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span> <span class='comment'># gzip checksum verification
</span>  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipFile</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Package</span><span class='op'>::</span><span class='const'>FormatError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.3 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>