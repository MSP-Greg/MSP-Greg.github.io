<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Gem::RemoteFetcher &mdash; rubygems Ruby-2.4.0 d2016-07-21</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Gem::RemoteFetcher",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>rubygems</a> &raquo; 
          <a href='../_index.html'>Index (R)</a> &raquo; 
          <a href="../Gem.html" title="Gem (module)">Gem</a> &raquo; 
          <span class='title'>RemoteFetcher</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Gem::RemoteFetcher</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>Gem::RemoteFetcher</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="RemoteFetcher/FetchError.html" title="Gem::RemoteFetcher::FetchError (class)">FetchError</a>,
    <a href="RemoteFetcher/UnknownHostError.html" title="Gem::RemoteFetcher::UnknownHostError (class)">UnknownHostError</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Includes:</td>
    <td><a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a>
    </td>
  </tr>



  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
rubygems/test_utilities.rb<span class='defines'>,<br />rubygems/remote_fetcher.rb</span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>RemoteFetcher handles the details of fetching gems and gem information from
a remote source.</p>


  </div>
</div>
<div class="tags">
  
</div>


<h2>Instance Attribute Summary <small><a href='#' class='summary_toggle'>collapse</a></small></h2>

  <ul class="summary">
    <li>
      <span class="summary_signature">
        <a href="#headers-instance_method" title="#headers (instance method)">#<strong>headers</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>


<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#fetcher-class_method" title=".fetcher (class method)">.<strong>fetcher</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Cached RemoteFetcher instance.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetcher%3D-class_method" title=".fetcher= (class method)">.<strong>fetcher=</strong>(fetcher)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(proxy = nil, dns = Resolv::DNS.new, headers = {})  &#x21d2; RemoteFetcher </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Initialize a remote fetcher using the source URI and possible proxy
information.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#api_endpoint-instance_method" title="#api_endpoint (instance method)">#<strong>api_endpoint</strong>(uri)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Given a source at <code>uri</code>, calculate what hostname to actually
connect to query the data for it.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#cache_update_path-instance_method" title="#cache_update_path (instance method)">#<strong>cache_update_path</strong>(uri, path = nil, update = true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Downloads <code>uri</code> to <code>path</code> if necessary.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#close_all-instance_method" title="#close_all (instance method)">#<strong>close_all</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#correct_for_windows_path-instance_method" title="#correct_for_windows_path (instance method)">#<strong>correct_for_windows_path</strong>(path)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#download-instance_method" title="#download (instance method)">#<strong>download</strong>(spec, source_uri, install_dir = Gem.dir)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Moves the gem <code>spec</code> from <code>source_uri</code> to the cache
dir unless it is already there.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#download_to_cache-instance_method" title="#download_to_cache (instance method)">#<strong>download_to_cache</strong>(dependency)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Given a name and requirement, downloads this gem into cache and returns the
filename.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_file-instance_method" title="#fetch_file (instance method)">#<strong>fetch_file</strong>(uri, *_)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>File Fetcher.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_http-instance_method" title="#fetch_http (instance method)">#<strong>fetch_http</strong>(uri, last_modified = nil, head = false, depth = 0)  </a>
        (also: #fetch_https)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>HTTP Fetcher.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_https-instance_method" title="#fetch_https (instance method)">#<strong>fetch_https</strong>(uri, last_modified = nil, head = false, depth = 0)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#fetch_http-instance_method" title="Gem::RemoteFetcher#fetch_http (method)">#fetch_http</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_path-instance_method" title="#fetch_path (instance method)">#<strong>fetch_path</strong>(uri, mtime = nil, head = false)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Downloads <code>uri</code> and returns it as a String.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_s3-instance_method" title="#fetch_s3 (instance method)">#<strong>fetch_s3</strong>(uri, mtime = nil, head = false)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fetch_size-instance_method" title="#fetch_size (instance method)">#<strong>fetch_size</strong>(uri)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the size of <code>uri</code> in bytes.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#https%3F-instance_method" title="#https? (instance method)">#<strong>https?</strong>(uri)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#pools_for-instance_method" title="#pools_for (instance method)">#<strong>pools_for</strong>(proxy)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#proxy_for-instance_method" title="#proxy_for (instance method)">#<strong>proxy_for</strong>(proxy, uri)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#request-instance_method" title="#request (instance method)">#<strong>request</strong>(uri, request_class, last_modified = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Performs a <code>Net::HTTP</code> request of type <code>request_class</code> on
<code>uri</code> returning a <code>Net::HTTP</code> response object.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="UserInteraction.html" title="Gem::UserInteraction (module)">UserInteraction</a></h3>
  <p class="inherited"><a href="UserInteraction.html#alert-instance_method" title="Gem::UserInteraction#alert (method)">#alert</a>, <a href="UserInteraction.html#alert_error-instance_method" title="Gem::UserInteraction#alert_error (method)">#alert_error</a>, <a href="UserInteraction.html#alert_warning-instance_method" title="Gem::UserInteraction#alert_warning (method)">#alert_warning</a>, <a href="UserInteraction.html#ask-instance_method" title="Gem::UserInteraction#ask (method)">#ask</a>, <a href="UserInteraction.html#ask_for_password-instance_method" title="Gem::UserInteraction#ask_for_password (method)">#ask_for_password</a>, <a href="UserInteraction.html#ask_yes_no-instance_method" title="Gem::UserInteraction#ask_yes_no (method)">#ask_yes_no</a>, <a href="UserInteraction.html#choose_from_list-instance_method" title="Gem::UserInteraction#choose_from_list (method)">#choose_from_list</a>, <a href="UserInteraction.html#say-instance_method" title="Gem::UserInteraction#say (method)">#say</a>, <a href="UserInteraction.html#terminate_interaction-instance_method" title="Gem::UserInteraction#terminate_interaction (method)">#terminate_interaction</a>, <a href="UserInteraction.html#verbose-instance_method" title="Gem::UserInteraction#verbose (method)">#verbose</a></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="DefaultUserInteraction.html" title="Gem::DefaultUserInteraction (module)">DefaultUserInteraction</a></h3>
  <p class="inherited"><a href="DefaultUserInteraction.html#ui-class_method" title="Gem::DefaultUserInteraction.ui (method)">.ui</a>, <a href="DefaultUserInteraction.html#ui-instance_method" title="Gem::DefaultUserInteraction#ui (method)">#ui</a>, <a href="DefaultUserInteraction.html#ui%3D-instance_method" title="Gem::DefaultUserInteraction#ui= (method)">#ui=</a>, <a href="DefaultUserInteraction.html#ui%3D-class_method" title="Gem::DefaultUserInteraction.ui= (method)">.ui=</a>, <a href="DefaultUserInteraction.html#use_ui-class_method" title="Gem::DefaultUserInteraction.use_ui (method)">.use_ui</a>, <a href="DefaultUserInteraction.html#use_ui-instance_method" title="Gem::DefaultUserInteraction#use_ui (method)">#use_ui</a></p>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(proxy = nil, dns = Resolv::DNS.new, headers = {})  &#x21d2; <tt><a href="" title="Gem::RemoteFetcher (class)">RemoteFetcher</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Initialize a remote fetcher using the source URI and possible proxy
information.</p>

<p><code>proxy</code></p>
<ul><li>
<p>[String]: explicit specification of proxy; overrides any environment</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_variable'>variable</span> <span class='id identifier rubyid_setting'>setting</span>
</code></pre>
</li><li>
<p>nil: respect environment variables (HTTP_PROXY, HTTP_PROXY_USER,</p>

<pre class="code ruby"><code class="ruby">HTTP_PROXY_PASS)</code></pre>
</li><li>
<p><code>:no_proxy</code>: ignore environment variables and _don&#39;t_ use a
proxy</p>
</li></ul>

<p><code>dns</code>: An object to use for DNS resolution of the API endpoint.</p>

<pre class="code ruby"><code class="ruby">By default, use Resolv::DNS.</code></pre>

<p><code>headers</code>: A set of additional HTTP headers to be sent to the
server when</p>

<pre class="code ruby"><code class="ruby">fetching the gem.</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_dns'>dns</span><span class='op'>=</span><span class='const'>Resolv</span><span class='op'>::</span><span class='const'>DNS</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/http</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stringio</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span>

  <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='ivar'>@proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span>
  <span class='ivar'>@pools</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@pool_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@cert_files</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_get_cert_files'>get_cert_files</span>

  <span class='ivar'>@dns</span> <span class='op'>=</span> <span class='id identifier rubyid_dns'>dns</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Attribute Details</h2>
  <section class='method_details first' id="headers-instance_method">
  <h3 class='signature first'>
  #<strong>headers</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


61</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 61</span>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:headers</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="fetcher-class_method">
  <h3 class='signature first'>
  .<strong>fetcher</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Cached RemoteFetcher instance.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


57
58
59</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 57</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetcher'>fetcher</span>
  <span class='ivar'>@fetcher</span> <span class='op'>||=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='lbracket'>[</span><span class='symbol'>:http_proxy</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetcher=-class_method">
  <h3 class='signature'>
  .<strong>fetcher=</strong>(fetcher)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


176
177
178</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/test_utilities.rb', line 176</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetcher='>fetcher=</span><span class='lparen'>(</span><span class='id identifier rubyid_fetcher'>fetcher</span><span class='rparen'>)</span>
  <span class='ivar'>@fetcher</span> <span class='op'>=</span> <span class='id identifier rubyid_fetcher'>fetcher</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="api_endpoint-instance_method">
  <h3 class='signature first'>
  #<strong>api_endpoint</strong>(uri)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Given a source at <code>uri</code>, calculate what hostname to actually
connect to query the data for it.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_api_endpoint'>api_endpoint</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='ivar'>@dns</span><span class='period'>.</span><span class='id identifier rubyid_getresource'>getresource</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_rubygems._tcp.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                           <span class='const'>Resolv</span><span class='op'>::</span><span class='const'>DNS</span><span class='op'>::</span><span class='const'>Resource</span><span class='op'>::</span><span class='const'>IN</span><span class='op'>::</span><span class='const'>SRV</span>
  <span class='kw'>rescue</span> <span class='const'>Resolv</span><span class='op'>::</span><span class='const'>ResolvError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_verbose'>verbose</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Getting SRV record failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_uri'>uri</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

    <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_quote'>quote</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>\z</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_target'>target</span>
      <span class='kw'>return</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='embexpr_end'>}</span><span class='tstring_content'>://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_target'>target</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_uri'>uri</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="cache_update_path-instance_method">
  <h3 class='signature'>
  #<strong>cache_update_path</strong>(uri, path = nil, update = true)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Downloads <code>uri</code> to <code>path</code> if necessary. If no path is
given, it just passes the data.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 321</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_update_path'>cache_update_path</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_update'>update</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_mtime'>mtime</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>&amp;&amp;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_stat'>stat</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_mtime'>mtime</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_path'>fetch_path</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_mtime'>mtime</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='comment'># indicates the server returned 304 Not Modified
</span>    <span class='kw'>return</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_read_binary'>read_binary</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_update'>update</span> <span class='kw'>and</span> <span class='id identifier rubyid_path'>path</span>
    <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_write_binary'>write_binary</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="close_all-instance_method">
  <h3 class='signature'>
  #<strong>close_all</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


374
375
376</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 374</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_all'>close_all</span>
  <span class='ivar'>@pools</span><span class='period'>.</span><span class='id identifier rubyid_each_value'>each_value</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pool'>pool</span><span class='op'>|</span> <span class='id identifier rubyid_pool'>pool</span><span class='period'>.</span><span class='id identifier rubyid_close_all'>close_all</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="correct_for_windows_path-instance_method">
  <h3 class='signature'>
  #<strong>correct_for_windows_path</strong>(path)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


346
347
348
349
350
351
352</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 346</span>

<span class='kw'>def</span> <span class='id identifier rubyid_correct_for_windows_path'>correct_for_windows_path</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_path'>path</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[a-z]</span><span class='regexp_end'>/i</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_path'>path</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_path'>path</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_path'>path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="download-instance_method">
  <h3 class='signature'>
  #<strong>download</strong>(spec, source_uri, install_dir = Gem.dir)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Moves the gem <code>spec</code> from <code>source_uri</code> to the cache
dir unless it is already there.  If the source_uri is local the gem cache
dir copy is always replaced.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_download'>download</span><span class='lparen'>(</span><span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_install_dir'>install_dir</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cache_dir'>cache_dir</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_pwd'>pwd</span> <span class='op'>==</span> <span class='id identifier rubyid_install_dir'>install_dir</span> <span class='kw'>then</span> <span class='comment'># see fetch_command
</span>      <span class='id identifier rubyid_install_dir'>install_dir</span>
    <span class='kw'>elsif</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span> <span class='id identifier rubyid_install_dir'>install_dir</span> <span class='kw'>then</span>
      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='id identifier rubyid_install_dir'>install_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cache</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_user_dir'>user_dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cache</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

  <span class='id identifier rubyid_gem_file_name'>gem_file_name</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_cache_file'>cache_file</span>
  <span class='id identifier rubyid_local_gem_path'>local_gem_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='id identifier rubyid_cache_dir'>cache_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_gem_file_name'>gem_file_name</span>

  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span> <span class='id identifier rubyid_cache_dir'>cache_dir</span> <span class='kw'>rescue</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_cache_dir'>cache_dir</span>

  <span class='comment'># Always escape URI&#39;s to deal with potential spaces and such
</span>  <span class='comment'># It should also be considered that source_uri may already be
</span>  <span class='comment'># a valid URI with escaped characters. e.g. &quot;{DESede}&quot; is encoded
</span>  <span class='comment'># as &quot;%7BDESede%7D&quot;. If this is escaped again the percentage
</span>  <span class='comment'># symbols will be escaped.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>URI</span><span class='op'>::</span><span class='const'>Generic</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_source_uri'>source_uri</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='id identifier rubyid_source_uri'>source_uri</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:DEFAULT_PARSER</span><span class='rparen'>)</span> <span class='op'>?</span>
                             <span class='const'>URI</span><span class='op'>::</span><span class='const'>DEFAULT_PARSER</span><span class='period'>.</span><span class='id identifier rubyid_escape'>escape</span><span class='lparen'>(</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>:</span>
                             <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_escape'>escape</span><span class='lparen'>(</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span>

  <span class='comment'># URI.parse gets confused by MS Windows paths with forward slashes.
</span>  <span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[a-z]$</span><span class='regexp_end'>/i</span></span>

  <span class='comment'># REFACTOR: split this up and dispatch on scheme (eg download_http)
</span>  <span class='comment'># REFACTOR: be sure to clean up fake fetcher when you do this... cleaner
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_scheme'>scheme</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>s3</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span> <span class='kw'>then</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_verbose'>verbose</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Downloading gem </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gem_file_name'>gem_file_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gems/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gem_file_name'>gem_file_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cache_update_path'>cache_update_path</span> <span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span><span class='comma'>,</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span>
      <span class='kw'>rescue</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>RemoteFetcher</span><span class='op'>::</span><span class='const'>FetchError</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>if</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_original_platform'>original_platform</span> <span class='op'>==</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_platform'>platform</span>

        <span class='id identifier rubyid_alternate_name'>alternate_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_original_name'>original_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>.gem</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_verbose'>verbose</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed, downloading gem </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternate_name'>alternate_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

        <span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gems/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternate_name'>alternate_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cache_update_path'>cache_update_path</span> <span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span><span class='comma'>,</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_extname'>extname</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.gem</span><span class='tstring_end'>&#39;</span></span>

      <span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span> <span class='op'>=</span> <span class='id identifier rubyid_correct_for_windows_path'>correct_for_windows_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gems</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_gem_file_name'>gem_file_name</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='lparen'>(</span><span class='id identifier rubyid_remote_gem_path'>remote_gem_path</span><span class='comma'>,</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EACCES</span>
      <span class='id identifier rubyid_local_gem_path'>local_gem_path</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_verbose'>verbose</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Using local gem </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_local_gem_path'>local_gem_path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='kw'>nil</span> <span class='kw'>then</span> <span class='comment'># TODO test for local overriding cache
</span>    <span class='id identifier rubyid_source_path'>source_path</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_win_platform?'>win_platform?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>&amp;&amp;</span>
                     <span class='op'>!</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>then</span>
                    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>else</span>
                    <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
                  <span class='kw'>end</span>

    <span class='id identifier rubyid_source_path'>source_path</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>UriFormatter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_source_path'>source_path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unescape'>unescape</span>

    <span class='kw'>begin</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span> <span class='id identifier rubyid_source_path'>source_path</span><span class='comma'>,</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span> <span class='kw'>unless</span>
        <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_identical?'>identical?</span><span class='lparen'>(</span><span class='id identifier rubyid_source_path'>source_path</span><span class='comma'>,</span> <span class='id identifier rubyid_local_gem_path'>local_gem_path</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EACCES</span>
      <span class='id identifier rubyid_local_gem_path'>local_gem_path</span> <span class='op'>=</span> <span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_verbose'>verbose</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Using local gem </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_local_gem_path'>local_gem_path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unsupported URI scheme </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_uri'>source_uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_local_gem_path'>local_gem_path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="download_to_cache-instance_method">
  <h3 class='signature'>
  #<strong>download_to_cache</strong>(dependency)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Given a name and requirement, downloads this gem into cache and returns the
filename. Returns nil if the gem cannot be located.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


128
129
130
131
132
133
134
135
136</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_download_to_cache'>download_to_cache</span> <span class='id identifier rubyid_dependency'>dependency</span>
  <span class='id identifier rubyid_found'>found</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>SpecFetcher</span><span class='period'>.</span><span class='id identifier rubyid_fetcher'>fetcher</span><span class='period'>.</span><span class='id identifier rubyid_spec_for_dependency'>spec_for_dependency</span> <span class='id identifier rubyid_dependency'>dependency</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_found'>found</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='id identifier rubyid_found'>found</span><span class='period'>.</span><span class='id identifier rubyid_max_by'>max_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span><span class='id identifier rubyid__'>_</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_download'>download</span> <span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetch_file-instance_method">
  <h3 class='signature'>
  #<strong>fetch_file</strong>(uri, *_)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>File Fetcher. Dispatched by <code>fetch_path</code>. Use it instead.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


242
243
244</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_file'>fetch_file</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__'>_</span>
  <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_read_binary'>read_binary</span> <span class='id identifier rubyid_correct_for_windows_path'>correct_for_windows_path</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetch_http-instance_method">
  <h3 class='signature'>
  #<strong>fetch_http</strong>(uri, last_modified = nil, head = false, depth = 0)  
  <span class='aliases'>Also known as: <span class='names'><span>fetch_https</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>HTTP Fetcher. Dispatched by <code>fetch_path</code>. Use it instead.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 249</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_http'>fetch_http</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_depth'>depth</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_fetch_type'>fetch_type</span> <span class='op'>=</span> <span class='id identifier rubyid_head'>head</span> <span class='op'>?</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Head</span> <span class='op'>:</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Get</span>
  <span class='id identifier rubyid_response'>response</span>   <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_fetch_type'>fetch_type</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req'>req</span><span class='op'>|</span>
    <span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_add_field'>add_field</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_response'>response</span>
  <span class='kw'>when</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPOK</span><span class='comma'>,</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPNotModified</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:uri</span>
    <span class='id identifier rubyid_head'>head</span> <span class='op'>?</span> <span class='id identifier rubyid_response'>response</span> <span class='op'>:</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
  <span class='kw'>when</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPMovedPermanently</span><span class='comma'>,</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPFound</span><span class='comma'>,</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSeeOther</span><span class='comma'>,</span>
       <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPTemporaryRedirect</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FetchError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>too many redirects</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_depth'>depth</span> <span class='op'>&gt;</span> <span class='int'>10</span>

    <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_https?'>https?</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_https?'>https?</span><span class='lparen'>(</span><span class='id identifier rubyid_location'>location</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FetchError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redirecting to non-https resource: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_location'>location</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_fetch_http'>fetch_http</span><span class='lparen'>(</span><span class='id identifier rubyid_location'>location</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span><span class='comma'>,</span> <span class='id identifier rubyid_depth'>depth</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FetchError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bad response </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetch_https-instance_method">
  <h3 class='signature'>
  #<strong>fetch_https</strong>(uri, last_modified = nil, head = false, depth = 0)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#fetch_http-instance_method" title="Gem::RemoteFetcher#fetch_http (method)">#fetch_http</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="fetch_path-instance_method">
  <h3 class='signature'>
  #<strong>fetch_path</strong>(uri, mtime = nil, head = false)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Downloads <code>uri</code> and returns it as a String.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_path'>fetch_path</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_mtime'>mtime</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_uri'>uri</span> <span class='kw'>unless</span> <span class='const'>URI</span><span class='op'>::</span><span class='const'>Generic</span> <span class='op'>===</span> <span class='id identifier rubyid_uri'>uri</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bad uri: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_uri'>uri</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uri scheme is invalid: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fetch_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_mtime'>mtime</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='kw'>and</span> <span class='op'>!</span><span class='id identifier rubyid_head'>head</span> <span class='kw'>and</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.gz$</span><span class='regexp_end'>/</span></span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='period'>.</span><span class='id identifier rubyid_gunzip'>gunzip</span> <span class='id identifier rubyid_data'>data</span>
    <span class='kw'>rescue</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipFile</span><span class='op'>::</span><span class='const'>Error</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FetchError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>server did not return a valid file</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data'>data</span>
<span class='kw'>rescue</span> <span class='const'>FetchError</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>rescue</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>UnknownHostError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timed out</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>IOError</span><span class='comma'>,</span> <span class='const'>SocketError</span><span class='comma'>,</span> <span class='const'>SystemCallError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>getaddrinfo</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>UnknownHostError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no such name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>FetchError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetch_s3-instance_method">
  <h3 class='signature'>
  #<strong>fetch_s3</strong>(uri, mtime = nil, head = false)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


312
313
314
315</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 312</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_s3'>fetch_s3</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_mtime'>mtime</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_public_uri'>public_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_sign_s3_url'>sign_s3_url</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fetch_https'>fetch_https</span> <span class='id identifier rubyid_public_uri'>public_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_mtime'>mtime</span><span class='comma'>,</span> <span class='id identifier rubyid_head'>head</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fetch_size-instance_method">
  <h3 class='signature'>
  #<strong>fetch_size</strong>(uri)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the size of <code>uri</code> in bytes.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


340
341
342
343
344</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 340</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_size'>fetch_size</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span> <span class='comment'># TODO: phase this out
</span>  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_path'>fetch_path</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="https?-instance_method">
  <h3 class='signature'>
  #<strong>https?</strong>(uri)  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


370
371
372</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid_https?'>https?</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="pools_for-instance_method">
  <h3 class='signature'>
  #<strong>pools_for</strong>(proxy)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


411
412
413
414
415</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 411</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pools_for'>pools_for</span> <span class='id identifier rubyid_proxy'>proxy</span>
  <span class='ivar'>@pool_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@pools</span><span class='lbracket'>[</span><span class='id identifier rubyid_proxy'>proxy</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Request</span><span class='op'>::</span><span class='const'>ConnectionPools</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='ivar'>@cert_files</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="proxy_for-instance_method">
  <h3 class='signature'>
  #<strong>proxy_for</strong>(proxy, uri)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


407
408
409</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proxy_for'>proxy_for</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span>
  <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>||</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_get_proxy_from_env'>get_proxy_from_env</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="request-instance_method">
  <h3 class='signature'>
  #<strong>request</strong>(uri, request_class, last_modified = nil)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Performs a <code>Net::HTTP</code> request of type <code>request_class</code> on
<code>uri</code> returning a <code>Net::HTTP</code> response object.  request
maintains a table of persistent connections to reduce connect overhead.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


359
360
361
362
363
364
365
366
367
368</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'rubygems/remote_fetcher.rb', line 359</span>

<span class='kw'>def</span> <span class='id identifier rubyid_request'>request</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_request_class'>request_class</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_for'>proxy_for</span> <span class='ivar'>@proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span>
  <span class='id identifier rubyid_pool'>pool</span>  <span class='op'>=</span> <span class='id identifier rubyid_pools_for'>pools_for</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_pool_for'>pool_for</span> <span class='id identifier rubyid_uri'>uri</span>

  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_request_class'>request_class</span><span class='comma'>,</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='id identifier rubyid_pool'>pool</span>

  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req'>req</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_req'>req</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.4 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>