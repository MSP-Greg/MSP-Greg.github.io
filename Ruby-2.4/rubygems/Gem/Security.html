<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Gem::Security &mdash; rubygems Ruby-2.4.0 d2016-07-27</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Gem::Security",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>rubygems</a> &raquo; 
          <a href='../_index.html'>Index (S)</a> &raquo; 
          <a href="../Gem.html" title="Gem (module)">Gem</a> &raquo; 
          <span class='title'>Security</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: Gem::Security</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a>,
    <a href="Security/Signer.html" title="Gem::Security::Signer (class)">Signer</a>,
    <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a>
    </td>
  </tr>




  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L332'>lib/rubygems/security.rb</a><span class='defines'>,<br /><a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/install_update_options.rb#L12'>lib/rubygems/install_update_options.rb</a>,<br/> <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security/policies.rb#L2'>lib/rubygems/security/policies.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2 id="label-Signing+gems">Signing gems</h2>

<p>The <a href="" title="Gem::Security (module)">Security</a> implements cryptographic signatures for gems.  The
section below is a step-by-step guide to using signed gems and generating
your own.</p>

<h3 id="label-Walkthrough">Walkthrough</h3>

<h4 id="label-Building+your+certificate">Building your certificate</h4>

<p>In order to start signing your gems, you&#39;ll need to build a private key
and a self-signed certificate.  Here&#39;s how:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># build a private key and certificate for yourself:
</span></code></pre>

<p>This could take anywhere from a few seconds to a minute or two, depending
on the speed of your computer (public key algorithms aren&#39;t exactly the
speediest crypto algorithms in the world).  When it&#39;s finished,
you&#39;ll see the files “gem-private_key.pem” and “gem-public_cert.pem” in
the current directory.</p>

<p>First things first: Move both files to ~/.gem if you don&#39;t already have
a key and certificate in that directory.  Ensure the file permissions make
the key unreadable by others (by default the file is saved securely).</p>

<p>Keep your private key hidden; if it&#39;s compromised, someone can sign
packages as you (note: PKI has ways of mitigating the risk of stolen keys;
more on that later).</p>

<h4 id="label-Signing+Gems">Signing Gems</h4>

<p>In RubyGems 2 and newer there is no extra work to sign a gem.  RubyGems
will automatically find your key and certificate in your home directory and
use them to sign newly packaged gems.</p>

<p>If your certificate is not self-signed (signed by a third party) RubyGems
will attempt to load the certificate chain from the trusted certificates.
Use <code>gem cert --add signing_cert.pem</code> to add your signers as
trusted certificates.  See below for further information on certificate
chains.</p>

<p>If you build your gem it will automatically be signed.  If you peek inside
your gem file, you&#39;ll see a couple of new files have been added:</p>

<pre class="code ruby"><code class="ruby">$ tar tf your-gem-1.0.gem
metadata.gz
metadata.gz.sum
metadata.gz.sig # metadata signature
data.tar.gz
data.tar.gz.sum
data.tar.gz.sig # data signature</code></pre>

<h4 id="label-Manually+signing+gems">Manually signing gems</h4>

<p>If you wish to store your key in a separate secure location you&#39;ll need
to set your gems up for signing by hand.  To do this, set the
<code>signing_key</code> and <code>cert_chain</code> in the gemspec before
packaging your gem:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_signing_key'>signing_key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/secure/path/to/gem-private_key.pem</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>/secure/path/to/gem-public_cert.pem</span><span class='words_sep'>]</span>
</code></pre>

<p>When you package your gem with these options set RubyGems will
automatically load your key and certificate from the secure paths.</p>

<h4 id="label-Signed+gems+and+security+policies">Signed gems and security policies</h4>

<p>Now let&#39;s verify the signature.  Go ahead and install the gem, but add
the following options: <code>-P HighSecurity</code>, like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># install the gem with using the security policy &quot;HighSecurity&quot;
</span></code></pre>

<p>The <code>-P</code> option sets your security policy – we&#39;ll talk about
that in just a minute.  Eh, what&#39;s this?</p>

<pre class="code ruby"><code class="ruby">$ gem install -P HighSecurity your-gem-1.0.gem
ERROR:  While executing gem ... (Gem::Security::Exception)
    root cert /CN=you/DC=example is not trusted</code></pre>

<p>The culprit here is the security policy.  RubyGems has several different
security policies.  Let&#39;s take a short break and go over the security
policies.  Here&#39;s a list of the available security policies, and a
brief description of each one:</p>
<ul><li>
<p>NoSecurity - Well, no security at all.  Signed packages are treated like
unsigned packages.</p>
</li><li>
<p>LowSecurity - Pretty much no security.  If a package is signed then
RubyGems will make sure the signature matches the signing certificate, and
that the signing certificate hasn&#39;t expired, but that&#39;s it.  A
malicious user could easily circumvent this kind of security.</p>
</li><li>
<p>MediumSecurity - Better than LowSecurity and NoSecurity, but still
fallible.  Package contents are verified against the signing certificate,
and the signing certificate is checked for validity, and checked against
the rest of the certificate chain (if you don&#39;t know what a certificate
chain is, stay tuned, we&#39;ll get to that). The biggest improvement over
LowSecurity is that MediumSecurity won&#39;t install packages that are
signed by untrusted sources. Unfortunately, MediumSecurity still isn&#39;t
totally secure – a malicious user can still unpack the gem, strip the
signatures, and distribute the gem unsigned.</p>
</li><li>
<p>HighSecurity - Here&#39;s the bugger that got us into this mess. The
HighSecurity policy is identical to the MediumSecurity policy, except that
it does not allow unsigned gems.  A malicious user doesn&#39;t have a whole
lot of options here; they can&#39;t modify the package contents without
invalidating the signature, and they can&#39;t modify or remove signature
or the signing certificate chain, or RubyGems will simply refuse to install
the package.  Oh well, maybe they&#39;ll have better luck causing problems
for CPAN users instead :).</p>
</li></ul>

<p>The reason RubyGems refused to install your shiny new signed gem was
because it was from an untrusted source.  Well, your code is infallible
(naturally), so you need to add yourself as a trusted source:</p>

<pre class="code ruby"><code class="ruby"># add trusted certificate
gem cert --add ~/.gem/gem-public_cert.pem</code></pre>

<p>You&#39;ve now added your public certificate as a trusted source.  Now you
can install packages signed by your private key without any hassle. 
Let&#39;s try the install command above again:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># install the gem with using the HighSecurity policy (and this time
</span><span class='comment'># without any shenanigans)
</span></code></pre>

<p>This time RubyGems will accept your signed package and begin installing.</p>

<p>While you&#39;re waiting for RubyGems to work it&#39;s magic, have a look
at some of the other security commands by running <code>gem help
cert</code>:</p>

<pre class="code ruby"><code class="ruby">Options:
  -a, --add CERT                   Add a trusted certificate.
  -l, --list [FILTER]              List trusted certificates where the
                                   subject contains FILTER
  -r, --remove FILTER              Remove trusted certificates where the
                                   subject contains FILTER
  -b, --build EMAIL_ADDR           Build private key and self-signed
                                   certificate for EMAIL_ADDR
  -C, --certificate CERT           Signing certificate for --sign
  -K, --private-key KEY            Key for --sign or --build
  -s, --sign CERT                  Signs CERT with the key from -K
                                   and the certificate from -C</code></pre>

<p>We&#39;ve already covered the <code>--build</code> option, and the
<code>--add</code>, <code>--list</code>, and <code>--remove</code> commands
seem fairly straightforward; they allow you to add, list, and remove the
certificates in your trusted certificate list.  But what&#39;s with this
<code>--sign</code> option?</p>

<h4 id="label-Certificate+chains">Certificate chains</h4>

<p>To answer that question, let&#39;s take a look at “certificate chains”, a
concept I mentioned earlier.  There are a couple of problems with
self-signed certificates: first of all, self-signed certificates don&#39;t
offer a whole lot of security.  Sure, the certificate says Yukihiro
Matsumoto, but how do I know it was actually generated and signed by matz
himself unless he gave me the certificate in person?</p>

<p>The second problem is scalability.  Sure, if there are 50 gem authors, then
I have 50 trusted certificates, no problem.  What if there are 500 gem
authors?  1000?  Having to constantly add new trusted certificates is a
pain, and it actually makes the trust system less secure by encouraging
RubyGems users to blindly trust new certificates.</p>

<p>Here&#39;s where certificate chains come in.  A certificate chain
establishes an arbitrarily long chain of trust between an issuing
certificate and a child certificate.  So instead of trusting certificates
on a per-developer basis, we use the PKI concept of certificate chains to
build a logical hierarchy of trust.  Here&#39;s a hypothetical example of a
trust hierarchy based (roughly) on geography:</p>

<pre class="code ruby"><code class="ruby">                    --------------------------
                    | rubygems@rubygems.org |
                    --------------------------
                                |
              -----------------------------------
              |                                 |
  ----------------------------    -----------------------------
  |  seattlerb@seattlerb.org |    | dcrubyists@richkilmer.com |
  ----------------------------    -----------------------------
       |                |                 |             |
---------------   ----------------   -----------   --------------
|   drbrain   |   |   zenspider  |   | pabs@dc |   | tomcope@dc |
---------------   ----------------   -----------   --------------</code></pre>

<p>Now, rather than having 4 trusted certificates (one for drbrain, zenspider,
pabs@dc, and tomecope@dc), a user could actually get by with one
certificate, the “rubygems@rubygems.org” certificate.</p>

<p>Here&#39;s how it works:</p>

<p>I install “rdoc-3.12.gem”, a package signed by “drbrain”.  I&#39;ve never
heard of “drbrain”, but his certificate has a valid signature from the
“seattle.rb@seattlerb.org” certificate, which in turn has a valid signature
from the “rubygems@rubygems.org” certificate.  Voila!  At this point,
it&#39;s much more reasonable for me to trust a package signed by
“drbrain”, because I can establish a chain to “rubygems@rubygems.org”,
which I do trust.</p>

<h4 id="label-Signing+certificates">Signing certificates</h4>

<p>The <code>--sign</code> option allows all this to happen.  A developer
creates their build certificate with the <code>--build</code> option, then
has their certificate signed by taking it with them to their next regional
Ruby meetup (in our hypothetical example), and it&#39;s signed there by the
person holding the regional RubyGems signing certificate, which is signed
at the next RubyConf by the holder of the top-level RubyGems certificate. 
At each point the issuer runs the same command:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># sign a certificate with the specified key and certificate
</span><span class='comment'># (note that this modifies client_cert.pem!)
</span></code></pre>

<p>Then the holder of issued certificate (in this case, your buddy “drbrain”),
can start using this signed certificate to sign RubyGems.  By the way, in
order to let everyone else know about his new fancy signed certificate,
“drbrain” would save his newly signed certificate as
<code>~/.gem/gem-public_cert.pem</code></p>

<p>Obviously this RubyGems trust infrastructure doesn&#39;t exist yet.  Also,
in the “real world”, issuers actually generate the child certificate from a
certificate request, rather than sign an existing certificate.  And our
hypothetical infrastructure is missing a certificate revocation system.
These are that can be fixed in the future…</p>

<p>At this point you should know how to do all of these new and interesting
things:</p>
<ul><li>
<p>build a gem signing key and certificate</p>
</li><li>
<p>adjust your security policy</p>
</li><li>
<p>modify your trusted certificate list</p>
</li><li>
<p>sign a certificate</p>
</li></ul>

<h3 id="label-Manually+verifying+signatures">Manually verifying signatures</h3>

<p>In case you don&#39;t trust RubyGems you can verify gem signatures
manually:</p>
<ol><li>
<p>Fetch and unpack the gem</p>

<pre class="code ruby"><code class="ruby">gem fetch some_signed_gem
tar -xf some_signed_gem-1.0.gem</code></pre>
</li><li>
<p>Grab the public key from the gemspec</p>

<pre class="code ruby"><code class="ruby">gem spec some_signed_gem-1.0.gem cert_chain | \
  ruby -ryaml -e &#39;puts YAML.load_documents($stdin)&#39; &gt; public_key.crt</code></pre>
</li><li>
<p>Generate a SHA1 hash of the data.tar.gz</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_dgst'>dgst</span> <span class='op'>-</span><span class='id identifier rubyid_sha1'>sha1</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_tar'>tar</span><span class='period'>.</span><span class='id identifier rubyid_gz'>gz</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_my'>my</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span>
</code></pre>
</li><li>
<p>Verify the signature</p>

<pre class="code ruby"><code class="ruby">openssl rsautl -verify -inkey public_key.crt -certin \
  -in data.tar.gz.sig &gt; verified.hash</code></pre>
</li><li>
<p>Compare your hash to the verified hash</p>

<pre class="code ruby"><code class="ruby">diff -s verified.hash my.hash</code></pre>
</li><li>
<p>Repeat 5 and 6 with metadata.gz</p>
</li></ol>

<h3 id="label-OpenSSL+Reference">OpenSSL Reference</h3>

<p>The pem files generated by –build and –sign are PEM files.  Here&#39;s a
couple of useful OpenSSL commands for manipulating them:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># convert a PEM format X509 certificate into DER format:
</span><span class='comment'># (note: Windows .cer files are X509 certificates in DER format)
</span></code></pre>

<p>And you can do the same thing with the private key file as well:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># convert a PEM format RSA key into DER format:
</span></code></pre>

<h3 id="label-Bugs-2FTODO">Bugs/TODO</h3>
<ul><li>
<p>There&#39;s no way to define a system-wide trust list.</p>
</li><li>
<p>custom security policies (from a YAML file, etc)</p>
</li><li>
<p>Simple method to generate a signed certificate request</p>
</li><li>
<p>Support for OCSP, SCVP, CRLs, or some other form of cert status check (list
is in order of preference)</p>
</li><li>
<p>Support for encrypted private keys</p>
</li><li>
<p>Some sort of semi-formal trust hierarchy (see long-winded explanation
above)</p>
</li><li>
<p>Path discovery (for gem certificate chains that don&#39;t have a
self-signed root) – by the way, since we don&#39;t have this, THE ROOT OF
THE CERTIFICATE CHAIN MUST BE SELF SIGNED if Policy#verify_root is true
(and it is for the MediumSecurity and HighSecurity policies)</p>
</li><li>
<p>Better explanation of X509 naming (ie, we don&#39;t have to use email
addresses)</p>
</li><li>
<p>Honor AIA field (see note about OCSP above)</p>
</li><li>
<p>Honor extension restrictions</p>
</li><li>
<p>Might be better to store the certificate chain as a <code>PKCS#7</code> or <code>PKCS#12</code>
file, instead of an array embedded in the metadata.</p>
</li><li>
<p>Flexible signature and key algorithms, not hard-coded to RSA and SHA1.</p>
</li></ul>

<h3 id="label-Original+author">Original author</h3>

<p>Paul Duncan &lt;pabs@pablotron.org&gt; <a
href="http://pablotron.org">pablotron.org</a>/</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='AlmostNoSecurity-constant'>
      AlmostNoSecurity =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>AlmostNo security policy: only verify that the signing certificate is the
one that actually signed the data.  Make no attempt to verify the signing
certificate chain.</p>

<p>This policy is basically useless. better than nothing, but can still be
easily spoofed, and is not recommended.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Almost No Security</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rparen'>)</span></pre>
    </dd>
    <dt id='DIGEST_ALGORITHM-constant'>
      DIGEST_ALGORITHM =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Digest algorithm used to sign gems</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='rparen'>)</span> <span class='kw'>then</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span>
<span class='kw'>end</span></pre>
    </dd>
    <dt id='DIGEST_NAME-constant'>
      DIGEST_NAME =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Used internally to select the signing digest from all computed digests</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='kw'>if</span> <span class='const'><a href="#DIGEST_ALGORITHM-constant" title="Gem::Security::DIGEST_ALGORITHM (constant)">DIGEST_ALGORITHM</a></span> <span class='kw'>then</span>
  <span class='const'><a href="#DIGEST_ALGORITHM-constant" title="Gem::Security::DIGEST_ALGORITHM (constant)">DIGEST_ALGORITHM</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span></pre>
    </dd>
    <dt id='EXTENSIONS-constant'>
      EXTENSIONS =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>The default set of extensions are:</p>
<ul><li>
<p>The certificate is not a certificate authority</p>
</li><li>
<p>The key for the certificate may be used for key and data encipherment and
digital signatures</p>
</li><li>
<p>The certificate contains a subject key identifier</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>basicConstraints</span><span class='tstring_end'>&#39;</span></span>     <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CA:FALSE</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>keyUsage</span><span class='tstring_end'>&#39;</span></span>             <span class='op'>=&gt;</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>keyEncipherment,dataEncipherment,digitalSignature</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subjectKeyIdentifier</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hash</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre>
    </dd>
    <dt id='HighSecurity-constant'>
      HighSecurity =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>High security policy: only allow signed gems to be installed, verify the
signing certificate, verify the signing certificate chain all the way to
the root certificate, and only trust root certificates that we have
explicitly allowed trust for.</p>

<p>This security policy is significantly more difficult to bypass, and offers
a reasonable guarantee that the contents of the gem have not been altered.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>High Security</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span>
<span class='rparen'>)</span></pre>
    </dd>
    <dt id='KEY_ALGORITHM-constant'>
      KEY_ALGORITHM =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Algorithm for creating the key pair used to sign gems</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span><span class='rparen'>)</span> <span class='kw'>then</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span>
<span class='kw'>end</span></pre>
    </dd>
    <dt id='KEY_CIPHER-constant'>
      KEY_CIPHER =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Cipher used to encrypt the key pair used to sign gems. Must be in the list
returned by <code>OpenSSL::Cipher</code>.ciphers</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AES-256-CBC</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></pre>
    </dd>
    <dt id='KEY_LENGTH-constant'>
      KEY_LENGTH =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Length of keys created by KEY_ALGORITHM</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='int'>2048</span></pre>
    </dd>
    <dt id='LowSecurity-constant'>
      LowSecurity =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Low security policy: only verify that the signing certificate is actually
the gem signer, and that the signing certificate is valid.</p>

<p>This policy is better than nothing, but can still be easily spoofed, and is
not recommended.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Low Security</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rparen'>)</span></pre>
    </dd>
    <dt id='MediumSecurity-constant'>
      MediumSecurity =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Medium security policy: verify the signing certificate, verify the signing
certificate chain all the way to the root certificate, and only trust root
certificates that we have explicitly allowed trust for.</p>

<p>This security policy is reasonable, but it allows unsigned packages, so a
malicious person could simply delete the package signature and pass the gem
off as unsigned.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Medium Security</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rparen'>)</span></pre>
    </dd>
    <dt id='NoSecurity-constant'>
      NoSecurity =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>No security policy: all package signature checks are disabled.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No Security</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rparen'>)</span></pre>
    </dd>
    <dt id='ONE_YEAR-constant'>
      ONE_YEAR =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>One year in seconds</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='int'>86400</span> <span class='op'>*</span> <span class='int'>365</span></pre>
    </dd>
    <dt id='Policies-constant'>
      Policies =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Hash of configured security policies</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NoSecurity</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='const'><a href="#NoSecurity-constant" title="Gem::Security::NoSecurity (constant)">NoSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AlmostNoSecurity</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#AlmostNoSecurity-constant" title="Gem::Security::AlmostNoSecurity (constant)">AlmostNoSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LowSecurity</span><span class='tstring_end'>&#39;</span></span>      <span class='op'>=&gt;</span> <span class='const'><a href="#LowSecurity-constant" title="Gem::Security::LowSecurity (constant)">LowSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>MediumSecurity</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='const'><a href="#MediumSecurity-constant" title="Gem::Security::MediumSecurity (constant)">MediumSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HighSecurity</span><span class='tstring_end'>&#39;</span></span>     <span class='op'>=&gt;</span> <span class='const'><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a></span><span class='comma'>,</span>
  <span class='comment'># SigningPolicy is not intended for use by `gem -P` so do not list it
</span><span class='rbrace'>}</span></pre>
    </dd>
    <dt id='SigningPolicy-constant'>
      SigningPolicy =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Policy used to verify a certificate and key when signing a gem</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Signing Policy</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rparen'>)</span></pre>
    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#alt_name_or_x509_entry-class_method" title=".alt_name_or_x509_entry (class method)">.<strong>alt_name_or_x509_entry</strong>(certificate, x509_entry)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_cert-class_method" title=".create_cert (class method)">.<strong>create_cert</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates an unsigned certificate for <code>subject</code> and
<code>key</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_cert_email-class_method" title=".create_cert_email (class method)">.<strong>create_cert_email</strong>(email, key, age = ONE_YEAR, extensions = EXTENSIONS)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a self-signed certificate with an issuer and subject from
<code>email</code>, a subject alternative name of <code>email</code> and
the given <code>extensions</code> for the <code>key</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_cert_self_signed-class_method" title=".create_cert_self_signed (class method)">.<strong>create_cert_self_signed</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a self-signed certificate with an issuer and subject of
<code>subject</code> and the given <code>extensions</code> for the
<code>key</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_key-class_method" title=".create_key (class method)">.<strong>create_key</strong>(length = KEY_LENGTH, algorithm = KEY_ALGORITHM)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new key pair of the specified <code>length</code> and
<code>algorithm</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#email_to_name-class_method" title=".email_to_name (class method)">.<strong>email_to_name</strong>(email_address)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Turns <code>email_address</code> into an <code>OpenSSL::X509::Name</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#re_sign-class_method" title=".re_sign (class method)">.<strong>re_sign</strong>(expired_certificate, private_key, age = ONE_YEAR, extensions = EXTENSIONS)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Signs <code>expired_certificate</code> with <code>private_key</code> if the
keys match and the expired certificate was self-signed.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reset-class_method" title=".reset (class method)">.<strong>reset</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Resets the trust directory for verifying gems.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sign-class_method" title=".sign (class method)">.<strong>sign</strong>(certificate, signing_key, signing_cert, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sign the public key from <code>certificate</code> with the
<code>signing_key</code> and <code>signing_cert</code>, using the
<a href="#DIGEST_ALGORITHM-constant" title="Gem::Security::DIGEST_ALGORITHM (constant)">DIGEST_ALGORITHM</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#trust_dir-class_method" title=".trust_dir (class method)">.<strong>trust_dir</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a> which wraps the directory where trusted
certificates live.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#trusted_certificates-class_method" title=".trusted_certificates (class method)">.<strong>trusted_certificates</strong>(&amp;block)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Enumerates the trusted certificates via <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#write-class_method" title=".write (class method)">.<strong>write</strong>(pemmable, path, permissions = 0600, passphrase = nil, cipher = KEY_CIPHER)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Writes <code>pemmable</code>, which must respond to <code>to_pem</code> to
<code>path</code> with the given <code>permissions</code>.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="alt_name_or_x509_entry-class_method">
  <h3 class='signature first'>
  .<strong>alt_name_or_x509_entry</strong>(certificate, x509_entry)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L394'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


394
395
396
397
398
399
400
401
402</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 394</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_alt_name_or_x509_entry'>alt_name_or_x509_entry</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_x509_entry'>x509_entry</span>
  <span class='id identifier rubyid_alt_name'>alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='period'>.</span><span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span><span class='period'>.</span><span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x509_entry'>x509_entry</span><span class='embexpr_end'>}</span><span class='tstring_content'>AltName</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_alt_name'>alt_name</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span> <span class='id identifier rubyid_alt_name'>alt_name</span>

  <span class='id identifier rubyid_certificate'>certificate</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_x509_entry'>x509_entry</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_cert-class_method">
  <h3 class='signature'>
  .<strong>create_cert</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates an unsigned certificate for <code>subject</code> and
<code>key</code>.  The lifetime of the key is from the current time to
<code>age</code> which defaults to one year.</p>

<p>The <code>extensions</code> restrict the key to the indicated uses.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L410'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 410</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_cert'>create_cert</span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span>
                     <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span>
  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>    <span class='op'>=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_serial'>serial</span>     <span class='op'>=</span> <span class='id identifier rubyid_serial'>serial</span>

  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_not_before'>not_before</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_not_after'>not_after</span>  <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_age'>age</span>

  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>    <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span>

  <span class='id identifier rubyid_ef'>ef</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>ExtensionFactory</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_cert'>cert</span>

  <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ext_name'>ext_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_ef'>ef</span><span class='period'>.</span><span class='id identifier rubyid_create_extension'>create_extension</span> <span class='id identifier rubyid_ext_name'>ext_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cert'>cert</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_cert_email-class_method">
  <h3 class='signature'>
  .<strong>create_cert_email</strong>(email, key, age = ONE_YEAR, extensions = EXTENSIONS)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a self-signed certificate with an issuer and subject from
<code>email</code>, a subject alternative name of <code>email</code> and
the given <code>extensions</code> for the <code>key</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L437'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


437
438
439
440
441
442
443</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 437</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_cert_email'>create_cert_email</span> <span class='id identifier rubyid_email'>email</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span>
  <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_email_to_name'>email_to_name</span> <span class='id identifier rubyid_email'>email</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_email'>email</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_create_cert_self_signed'>create_cert_self_signed</span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_cert_self_signed-class_method">
  <h3 class='signature'>
  .<strong>create_cert_self_signed</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a self-signed certificate with an issuer and subject of
<code>subject</code> and the given <code>extensions</code> for the
<code>key</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L449'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


449
450
451
452
453
454</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 449</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_cert_self_signed'>create_cert_self_signed</span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span>
                                 <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_certificate'>certificate</span> <span class='op'>=</span> <span class='id identifier rubyid_create_cert'>create_cert</span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span>

  <span class='id identifier rubyid_sign'>sign</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_key-class_method">
  <h3 class='signature'>
  .<strong>create_key</strong>(length = KEY_LENGTH, algorithm = KEY_ALGORITHM)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new key pair of the specified <code>length</code> and
<code>algorithm</code>.  The default is a 2048 bit RSA key.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L460'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


460
461
462</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 460</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_key'>create_key</span> <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='const'><a href="#KEY_LENGTH-constant" title="Gem::Security::KEY_LENGTH (constant)">KEY_LENGTH</a></span><span class='comma'>,</span> <span class='id identifier rubyid_algorithm'>algorithm</span> <span class='op'>=</span> <span class='const'><a href="#KEY_ALGORITHM-constant" title="Gem::Security::KEY_ALGORITHM (constant)">KEY_ALGORITHM</a></span>
  <span class='id identifier rubyid_algorithm'>algorithm</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_length'>length</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="email_to_name-class_method">
  <h3 class='signature'>
  .<strong>email_to_name</strong>(email_address)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Turns <code>email_address</code> into an <code>OpenSSL::X509::Name</code></p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L467'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


467
468
469
470
471
472
473
474
475
476
477</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 467</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email_to_name'>email_to_name</span> <span class='id identifier rubyid_email_address'>email_address</span>
  <span class='id identifier rubyid_email_address'>email_address</span> <span class='op'>=</span> <span class='id identifier rubyid_email_address'>email_address</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^\w@.-]+</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cn'>cn</span><span class='comma'>,</span> <span class='id identifier rubyid_dcs'>dcs</span> <span class='op'>=</span> <span class='id identifier rubyid_email_address'>email_address</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_dcs'>dcs</span> <span class='op'>=</span> <span class='id identifier rubyid_dcs'>dcs</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CN=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cn'>cn</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dcs'>dcs</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_dc'>dc</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DC=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dc'>dc</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Name</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="re_sign-class_method">
  <h3 class='signature'>
  .<strong>re_sign</strong>(expired_certificate, private_key, age = ONE_YEAR, extensions = EXTENSIONS)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Signs <code>expired_certificate</code> with <code>private_key</code> if the
keys match and the expired certificate was self-signed.</p>


  </div>
</div>
<div class="tags">
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<tt><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Gem::Security::Exception</a></tt>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L485'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 485</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_re_sign'>re_sign</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_private_key'>private_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span>
                 <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'><a href="" title="Gem::Security (module)">Security</a></span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>incorrect signing key for re-signing </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span>
    <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span> <span class='op'>==</span> <span class='id identifier rubyid_private_key'>private_key</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span>
         <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_issuer'>issuer</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_alt_name_or_x509_entry'>alt_name_or_x509_entry</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='symbol'>:subject</span>
    <span class='id identifier rubyid_issuer'>issuer</span>  <span class='op'>=</span> <span class='id identifier rubyid_alt_name_or_x509_entry'>alt_name_or_x509_entry</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='symbol'>:issuer</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'><a href="" title="Gem::Security (module)">Security</a></span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subject'>subject</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not self-signed, contact </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_issuer'>issuer</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to obtain a valid certificate</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_serial'>serial</span> <span class='op'>+</span> <span class='int'>1</span>

  <span class='id identifier rubyid_create_cert_self_signed'>create_cert_self_signed</span><span class='lparen'>(</span><span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_private_key'>private_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span>
                          <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reset-class_method">
  <h3 class='signature'>
  .<strong>reset</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Resets the trust directory for verifying gems.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L511'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


511
512
513</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 511</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
  <span class='ivar'>@trust_dir</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sign-class_method">
  <h3 class='signature'>
  .<strong>sign</strong>(certificate, signing_key, signing_cert, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sign the public key from <code>certificate</code> with the
<code>signing_key</code> and <code>signing_cert</code>, using the
<a href="#DIGEST_ALGORITHM-constant" title="Gem::Security::DIGEST_ALGORITHM (constant)">DIGEST_ALGORITHM</a>.  Uses the default certificate validity
range and extensions.</p>

<p>Returns the newly signed certificate.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L522'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 522</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span><span class='comma'>,</span>
              <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_signee_subject'>signee_subject</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>
  <span class='id identifier rubyid_signee_key'>signee_key</span>     <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span>

  <span class='id identifier rubyid_alt_name'>alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='period'>.</span><span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span><span class='period'>.</span><span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_alt_name'>alt_name</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_alt_name'>alt_name</span>

  <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span><span class='period'>.</span><span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span><span class='period'>.</span><span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>issuerAltName</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span>

  <span class='id identifier rubyid_signed'>signed</span> <span class='op'>=</span> <span class='id identifier rubyid_create_cert'>create_cert</span> <span class='id identifier rubyid_signee_subject'>signee_subject</span><span class='comma'>,</span> <span class='id identifier rubyid_signee_key'>signee_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span>
  <span class='id identifier rubyid_signed'>signed</span><span class='period'>.</span><span class='id identifier rubyid_issuer'>issuer</span> <span class='op'>=</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>

  <span class='id identifier rubyid_signed'>signed</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span> <span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'><a href="" title="Gem::Security (module)">Security</a></span><span class='op'>::</span><span class='const'><a href="#DIGEST_ALGORITHM-constant" title="Gem::Security::DIGEST_ALGORITHM (constant)">DIGEST_ALGORITHM</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="trust_dir-class_method">
  <h3 class='signature'>
  .<strong>trust_dir</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a> which wraps the directory where trusted
certificates live.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L551'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


551
552
553
554
555
556
557</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 551</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_trust_dir'>trust_dir</span>
  <span class='kw'>return</span> <span class='ivar'>@trust_dir</span> <span class='kw'>if</span> <span class='ivar'>@trust_dir</span>

  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='period'>.</span><span class='id identifier rubyid_user_home'><a href="../Gem.html#user_home-class_method" title="Gem.user_home (method)">user_home</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.gem</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>trust</span><span class='tstring_end'>&#39;</span></span>

  <span class='ivar'>@trust_dir</span> <span class='op'>||=</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'><a href="" title="Gem::Security (module)">Security</a></span><span class='op'>::</span><span class='const'><a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Security/TrustDir.html#new-class_method" title="Gem::Security::TrustDir.new (method)">new</a></span> <span class='id identifier rubyid_dir'>dir</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="trusted_certificates-class_method">
  <h3 class='signature'>
  .<strong>trusted_certificates</strong>(&amp;block)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Enumerates the trusted certificates via <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L562'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


562
563
564</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 562</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_trusted_certificates'>trusted_certificates</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_trust_dir'>trust_dir</span><span class='period'>.</span><span class='id identifier rubyid_each_certificate'>each_certificate</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="write-class_method">
  <h3 class='signature'>
  .<strong>write</strong>(pemmable, path, permissions = 0600, passphrase = nil, cipher = KEY_CIPHER)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Writes <code>pemmable</code>, which must respond to <code>to_pem</code> to
<code>path</code> with the given <code>permissions</code>. If passed
<code>cipher</code> and <code>passphrase</code> those arguments will be
passed to <code>to_pem</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/rubygems/security.rb#L571'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


571
572
573
574
575
576
577
578
579
580
581
582
583</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/rubygems/security.rb', line 571</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_pemmable'>pemmable</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_permissions'>permissions</span> <span class='op'>=</span> <span class='int'>0600</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'><a href="#KEY_CIPHER-constant" title="Gem::Security::KEY_CIPHER (constant)">KEY_CIPHER</a></span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span> <span class='id identifier rubyid_path'>path</span>

  <span class='id identifier rubyid_open'>open</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_permissions'>permissions</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='kw'>and</span> <span class='id identifier rubyid_cipher'>cipher</span>
      <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_pemmable'>pemmable</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_pemmable'>pemmable</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_path'>path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>