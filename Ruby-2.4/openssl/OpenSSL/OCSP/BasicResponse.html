<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: OpenSSL::OCSP::BasicResponse &mdash; openssl Ruby-2.4.0 d2016-08-04</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "OpenSSL::OCSP::BasicResponse",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../../index.html'>Home</a> &raquo; 
          <a href='../../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../../index.html'>openssl</a> &raquo; 
          <a href='../../_index.html'>Index (B)</a> &raquo; 
          <a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a> &raquo; 
          <a href="../OCSP.html" title="OpenSSL::OCSP (module)">OCSP</a> &raquo; 
          <span class='title'>BasicResponse</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: OpenSSL::OCSP::BasicResponse</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>OpenSSL::OCSP::BasicResponse</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L693'>ext/openssl/ossl_ocsp.c</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An <a href="" title="OpenSSL::OCSP::BasicResponse (class)">BasicResponse</a> contains the status of a certificate
check which is created from an <a href="Request.html" title="OpenSSL::OCSP::Request (class)">Request</a>.  A BasicResponse
is more detailed than a Response.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(der_string = nil)  &#x21d2; basic_response </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new BasicResponse.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#add_nonce-instance_method" title="#basic_response.add_nonce (instance method)">#<strong>basic_response.add_nonce</strong>(nonce = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds <code>nonce</code> to this response.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_status-instance_method" title="#basic_response.add_status (instance method)">#<strong>basic_response.add_status</strong>(certificate_id, status, reason, revocation_time, this_update, next_update, extensions)  &#x21d2; basic_response </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds a certificate status for <code>certificate_id</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#copy_nonce-instance_method" title="#basic_response.copy_nonce (instance method)">#<strong>basic_response.copy_nonce</strong>(request)  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Copies the nonce from <code>request</code> into this response.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#find_response-instance_method" title="#basic_response.find_response (instance method)">#<strong>basic_response.find_response</strong>(certificate_id)  &#x21d2; SingleResponse | nil </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a SingleResponse whose CertId matches with
<code>certificate_id</code>, or nil if this BasicResponse does not contain
it.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#responses-instance_method" title="#basic_response.responses (instance method)">#<strong>basic_response.responses</strong>  &#x21d2; Array of SingleResponse </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an Array of SingleResponse for this BasicResponse.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sign-instance_method" title="#basic_response.sign (instance method)">#<strong>basic_response.sign</strong>(cert, key, certs = nil, flags = 0, digest = nil)  &#x21d2; self </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Signs this OCSP response using the <code>cert</code>, <code>key</code> and
optional <code>digest</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#status-instance_method" title="#basic_response.status (instance method)">#<strong>basic_response.status</strong>  &#x21d2; statuses </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an Array of statuses for this response.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_der-instance_method" title="#basic_response.to_der (instance method)">#<strong>basic_response.to_der</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Encodes this basic response into a DER-encoded string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify-instance_method" title="#basic_response.verify (instance method)">#<strong>basic_response.verify</strong>(certificates, store, flags = 0)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Verifies the signature of the response using the given
<code>certificates</code> and <code>store</code>.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(der_string = nil)  &#x21d2; <tt>basic_response</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new BasicResponse. If <code>der_string</code> is given, decodes
<code>der_string</code> as DER.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L693'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 693</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE arg;
    OCSP_BASICRESP *res, *res_new;
    const unsigned char *p;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg);
    if (!NIL_P(arg)) {
	GetOCSPBasicRes(self, res);
	arg = ossl_to_der_if_possible(arg);
	StringValue(arg);
	p = (unsigned char *)RSTRING_PTR(arg);
	res_new = d2i_OCSP_BASICRESP(NULL, &amp;p, RSTRING_LEN(arg));
	if (!res_new)
	    ossl_raise(eOCSPError, &quot;d2i_OCSP_BASICRESP&quot;);
	SetOCSPBasicRes(self, res_new);
	OCSP_BASICRESP_free(res);
    }

    return self;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="add_nonce-instance_method">
  <h3 class='signature first'>
  #<strong>basic_response.add_nonce</strong>(nonce = nil)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds <code>nonce</code> to this response.  If no nonce was provided a
random nonce will be added.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L746'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 746</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_add_nonce(int argc, VALUE *argv, VALUE self)
{
    OCSP_BASICRESP *bs;
    VALUE val;
    int ret;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;val);
    if(NIL_P(val)) {
	GetOCSPBasicRes(self, bs);
	ret = OCSP_basic_add1_nonce(bs, NULL, -1);
    }
    else{
	StringValue(val);
	GetOCSPBasicRes(self, bs);
	ret = OCSP_basic_add1_nonce(bs, (unsigned char *)RSTRING_PTR(val), RSTRING_LENINT(val));
    }
    if(!ret) ossl_raise(eOCSPError, NULL);

    return self;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_status-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.add_status</strong>(certificate_id, status, reason, revocation_time, this_update, next_update, extensions)  &#x21d2; <tt>basic_response</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds a certificate status for <code>certificate_id</code>.
<code>status</code> is the status, and must be one of these:</p>
<ul><li>
<p><a href="../OCSP.html#V_CERTSTATUS_GOOD-constant" title="OpenSSL::OCSP::V_CERTSTATUS_GOOD (constant)">V_CERTSTATUS_GOOD</a></p>
</li><li>
<p><a href="../OCSP.html#V_CERTSTATUS_REVOKED-constant" title="OpenSSL::OCSP::V_CERTSTATUS_REVOKED (constant)">V_CERTSTATUS_REVOKED</a></p>
</li><li>
<p><a href="../OCSP.html#V_CERTSTATUS_UNKNOWN-constant" title="OpenSSL::OCSP::V_CERTSTATUS_UNKNOWN (constant)">V_CERTSTATUS_UNKNOWN</a></p>
</li></ul>

<p><code>reason</code> and <code>revocation_time</code> can be given only when
<code>status</code> is <a href="../OCSP.html#V_CERTSTATUS_REVOKED-constant" title="OpenSSL::OCSP::V_CERTSTATUS_REVOKED (constant)">V_CERTSTATUS_REVOKED</a>.
<code>reason</code> describes the reason for the revocation, and must be
one of <a href="../OCSP.html" title="OpenSSL::OCSP (module)">OpenSSL::OCSP</a>::REVOKED_STATUS_* constants.
<code>revocation_time</code> is the time when the certificate is revoked.</p>

<p><code>this_update</code> and <code>next_update</code> indicate the time at
which ths status is verified to be correct and the time at or before which
newer information will be available, respectively. <code>next_update</code>
is optional.</p>

<p><code>extensions</code> is an Array of <a href="../X509/Extension.html" title="OpenSSL::X509::Extension (class)">X509::Extension</a> to be
included in the SingleResponse. This is also optional.</p>

<p>Note that the times, <code>revocation_time</code>, <code>this_update</code>
and <code>next_update</code> can be specified in either of Integer or Time
object. If they are Integer, it is treated as the relative seconds from the
current time.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L811'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 811</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_add_status(VALUE self, VALUE cid, VALUE status,
			 VALUE reason, VALUE revtime,
			 VALUE thisupd, VALUE nextupd, VALUE ext)
{
    OCSP_BASICRESP *bs;
    OCSP_SINGLERESP *single;
    OCSP_CERTID *id;
    ASN1_TIME *ths = NULL, *nxt = NULL, *rev = NULL;
    int st, rsn = 0, error = 0, rstatus = 0;
    long i;
    VALUE tmp;

    GetOCSPBasicRes(self, bs);
    SafeGetOCSPCertId(cid, id);
    st = NUM2INT(status);
    if (!NIL_P(ext)) { /* All ext&#39;s members must be X509::Extension */
	ext = rb_check_array_type(ext);
	for (i = 0; i &lt; RARRAY_LEN(ext); i++)
	    OSSL_Check_Kind(RARRAY_AREF(ext, i), cX509Ext);
    }

    if (st == V_OCSP_CERTSTATUS_REVOKED) {
	rsn = NUM2INT(reason);
	tmp = rb_protect(add_status_convert_time, revtime, &amp;rstatus);
	if (rstatus) goto err;
	rev = (ASN1_TIME *)tmp;
    }

    tmp = rb_protect(add_status_convert_time, thisupd, &amp;rstatus);
    if (rstatus) goto err;
    ths = (ASN1_TIME *)tmp;

    if (!NIL_P(nextupd)) {
	tmp = rb_protect(add_status_convert_time, nextupd, &amp;rstatus);
	if (rstatus) goto err;
	nxt = (ASN1_TIME *)tmp;
    }

    if(!(single = OCSP_basic_add1_status(bs, id, st, rsn, rev, ths, nxt))){
	error = 1;
	goto err;
    }

    if(!NIL_P(ext)){
	X509_EXTENSION *x509ext;

	for(i = 0; i &lt; RARRAY_LEN(ext); i++){
	    x509ext = DupX509ExtPtr(RARRAY_AREF(ext, i));
	    if(!OCSP_SINGLERESP_add_ext(single, x509ext, -1)){
		X509_EXTENSION_free(x509ext);
		error = 1;
		goto err;
	    }
	    X509_EXTENSION_free(x509ext);
	}
    }

 err:
    ASN1_TIME_free(ths);
    ASN1_TIME_free(nxt);
    ASN1_TIME_free(rev);
    if(error) ossl_raise(eOCSPError, NULL);
    if(rstatus) rb_jump_tag(rstatus);

    return self;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="copy_nonce-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.copy_nonce</strong>(request)  &#x21d2; <tt><a href="../../Integer.html" title="Integer (class)">Integer</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Copies the nonce from <code>request</code> into this response.  Returns 1
on success and 0 on failure.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L724'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


724
725
726
727
728
729
730
731
732
733
734
735
736</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 724</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_copy_nonce(VALUE self, VALUE request)
{
    OCSP_BASICRESP *bs;
    OCSP_REQUEST *req;
    int ret;

    GetOCSPBasicRes(self, bs);
    SafeGetOCSPReq(request, req);
    ret = OCSP_copy_nonce(bs, req);

    return INT2NUM(ret);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="find_response-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.find_response</strong>(certificate_id)  &#x21d2; <tt><a href="SingleResponse.html" title="OpenSSL::OCSP::SingleResponse (class)">SingleResponse</a> | nil</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a SingleResponse whose CertId matches with
<code>certificate_id</code>, or nil if this BasicResponse does not contain
it.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L978'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 978</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_find_response(VALUE self, VALUE target)
{
    OCSP_BASICRESP *bs;
    OCSP_SINGLERESP *sres, *sres_new;
    OCSP_CERTID *id;
    int n;

    SafeGetOCSPCertId(target, id);
    GetOCSPBasicRes(self, bs);

    if ((n = OCSP_resp_find(bs, id, -1)) == -1)
	return Qnil;

    sres = OCSP_resp_get0(bs, n);
    sres_new = ASN1_item_dup(ASN1_ITEM_rptr(OCSP_SINGLERESP), sres);
    if (!sres_new)
	ossl_raise(eOCSPError, &quot;ASN1_item_dup&quot;);

    return ossl_ocspsres_new(sres_new);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="responses-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.responses</strong>  &#x21d2; <tt>Array of <a href="SingleResponse.html" title="OpenSSL::OCSP::SingleResponse (class)">SingleResponse</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an Array of SingleResponse for this BasicResponse.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L945'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 945</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_get_responses(VALUE self)
{
    OCSP_BASICRESP *bs;
    VALUE ret;
    int count, i;

    GetOCSPBasicRes(self, bs);
    count = OCSP_resp_count(bs);
    ret = rb_ary_new2(count);

    for (i = 0; i &lt; count; i++) {
	OCSP_SINGLERESP *sres, *sres_new;

	sres = OCSP_resp_get0(bs, i);
	sres_new = ASN1_item_dup(ASN1_ITEM_rptr(OCSP_SINGLERESP), sres);
	if (!sres_new)
	    ossl_raise(eOCSPError, &quot;ASN1_item_dup&quot;);

	rb_ary_push(ret, ossl_ocspsres_new(sres_new));
    }

    return ret;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sign-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.sign</strong>(cert, key, certs = nil, flags = 0, digest = nil)  &#x21d2; <tt>self</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Signs this OCSP response using the <code>cert</code>, <code>key</code> and
optional <code>digest</code>. This behaves in the similar way as
<a href="../OCSP.html" title="OpenSSL::OCSP (module)">OpenSSL::OCSP</a>::Request#sign.</p>

<p><code>flags</code> can include:</p>
<dl class="rdoc-list note-list"><dt><a href="../OCSP.html#NOCERTS-constant" title="OpenSSL::OCSP::NOCERTS (constant)">NOCERTS</a>
<dd>
<p>don&#39;t include certificates</p>
</dd><dt><a href="../OCSP.html#NOTIME-constant" title="OpenSSL::OCSP::NOTIME (constant)">NOTIME</a>
<dd>
<p>don&#39;t set producedAt</p>
</dd><dt><a href="../OCSP.html#RESPID_KEY-constant" title="OpenSSL::OCSP::RESPID_KEY (constant)">RESPID_KEY</a>
<dd>
<p>use signer&#39;s public key hash as responderID</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L1013'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 1013</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_sign(int argc, VALUE *argv, VALUE self)
{
    VALUE signer_cert, signer_key, certs, flags, digest;
    OCSP_BASICRESP *bs;
    X509 *signer;
    EVP_PKEY *key;
    STACK_OF(X509) *x509s = NULL;
    unsigned long flg = 0;
    const EVP_MD *md;
    int ret;

    rb_scan_args(argc, argv, &quot;23&quot;, &amp;signer_cert, &amp;signer_key, &amp;certs, &amp;flags, &amp;digest);
    GetOCSPBasicRes(self, bs);
    signer = GetX509CertPtr(signer_cert);
    key = GetPrivPKeyPtr(signer_key);
    if (!NIL_P(flags))
	flg = NUM2INT(flags);
    if (NIL_P(digest))
	md = EVP_sha1();
    else
	md = GetDigestPtr(digest);
    if (NIL_P(certs))
	flg |= OCSP_NOCERTS;
    else
	x509s = ossl_x509_ary2sk(certs);

    ret = OCSP_basic_sign(bs, signer, key, md, x509s, flg);
    sk_X509_pop_free(x509s, X509_free);
    if (!ret) ossl_raise(eOCSPError, NULL);

    return self;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="status-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.status</strong>  &#x21d2; <tt>statuses</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an Array of statuses for this response.  Each status contains a
CertificateId, the status (0 for good, 1 for revoked, 2 for unknown), the
reason for the status, the revocation time, the time of this update, the
time for the next update and a list of X509::Extensions.</p>

<p>This should be superseded by <a href="#responses-instance_method" title="OpenSSL::OCSP::BasicResponse#responses (method)">#responses</a> and <a href="#find_response-instance_method" title="OpenSSL::OCSP::BasicResponse#find_response (method)">#find_response</a>
that return SingleResponse.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L891'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 891</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_get_status(VALUE self)
{
    OCSP_BASICRESP *bs;
    OCSP_SINGLERESP *single;
    OCSP_CERTID *cid;
    ASN1_TIME *revtime, *thisupd, *nextupd;
    int status, reason;
    X509_EXTENSION *x509ext;
    VALUE ret, ary, ext;
    int count, ext_count, i, j;

    GetOCSPBasicRes(self, bs);
    ret = rb_ary_new();
    count = OCSP_resp_count(bs);
    for(i = 0; i &lt; count; i++){
	single = OCSP_resp_get0(bs, i);
	if(!single) continue;

	revtime = thisupd = nextupd = NULL;
	status = OCSP_single_get0_status(single, &amp;reason, &amp;revtime,
					 &amp;thisupd, &amp;nextupd);
	if(status &lt; 0) continue;
	if(!(cid = OCSP_CERTID_dup(OCSP_SINGLERESP_get0_id(single))))
	    ossl_raise(eOCSPError, NULL);
	ary = rb_ary_new();
	rb_ary_push(ary, ossl_ocspcertid_new(cid));
	rb_ary_push(ary, INT2NUM(status));
	rb_ary_push(ary, INT2NUM(reason));
	rb_ary_push(ary, revtime ? asn1time_to_time(revtime) : Qnil);
	rb_ary_push(ary, thisupd ? asn1time_to_time(thisupd) : Qnil);
	rb_ary_push(ary, nextupd ? asn1time_to_time(nextupd) : Qnil);
	ext = rb_ary_new();
	ext_count = OCSP_SINGLERESP_get_ext_count(single);
	for(j = 0; j &lt; ext_count; j++){
	    x509ext = OCSP_SINGLERESP_get_ext(single, j);
	    rb_ary_push(ext, ossl_x509ext_new(x509ext));
	}
	rb_ary_push(ary, ext);
	rb_ary_push(ret, ary);
    }

    return ret;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_der-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.to_der</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Encodes this basic response into a DER-encoded string.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L1082'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 1082</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_to_der(VALUE self)
{
    OCSP_BASICRESP *res;
    VALUE str;
    long len;
    unsigned char *p;

    GetOCSPBasicRes(self, res);
    if ((len = i2d_OCSP_BASICRESP(res, NULL)) &lt;= 0)
	ossl_raise(eOCSPError, NULL);
    str = rb_str_new(0, len);
    p = (unsigned char *)RSTRING_PTR(str);
    if (i2d_OCSP_BASICRESP(res, &amp;p) &lt;= 0)
	ossl_raise(eOCSPError, NULL);
    ossl_str_adjust(str, p);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify-instance_method">
  <h3 class='signature'>
  #<strong>basic_response.verify</strong>(certificates, store, flags = 0)  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Verifies the signature of the response using the given
<code>certificates</code> and <code>store</code>. This works in the similar
way as <a href="../OCSP.html" title="OpenSSL::OCSP (module)">OpenSSL::OCSP</a>::Request#verify.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_ocsp.c#L1054'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_ocsp.c', line 1054</span></pre>
<pre class='code cpp'>

static VALUE
ossl_ocspbres_verify(int argc, VALUE *argv, VALUE self)
{
    VALUE certs, store, flags;
    OCSP_BASICRESP *bs;
    STACK_OF(X509) *x509s;
    X509_STORE *x509st;
    int flg, result;

    rb_scan_args(argc, argv, &quot;21&quot;, &amp;certs, &amp;store, &amp;flags);
    GetOCSPBasicRes(self, bs);
    x509st = GetX509StorePtr(store);
    flg = NIL_P(flags) ? 0 : NUM2INT(flags);
    x509s = ossl_x509_ary2sk(certs);
    result = OCSP_basic_verify(bs, x509s, x509st, flg);
    sk_X509_pop_free(x509s, X509_free);
    if (!result)
	ossl_clear_error();

    return result &gt; 0 ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>