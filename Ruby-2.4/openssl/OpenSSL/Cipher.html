<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: OpenSSL::Cipher &mdash; openssl Ruby-2.4.0 d2016-07-21</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "OpenSSL::Cipher",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>openssl</a> &raquo; 
          <a href='../_index.html'>Index (C)</a> &raquo; 
          <a href="../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a> &raquo; 
          <span class='title'>Cipher</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: OpenSSL::Cipher</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>OpenSSL::Cipher</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Cipher/Cipher.html" title="OpenSSL::Cipher::Cipher (class)">Cipher</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="Cipher/CipherError.html" title="OpenSSL::Cipher::CipherError (class)">CipherError</a>
    </td>
  </tr>


  <tr>
    <td class='box_1'>Direct Subclasses:</td>
    <td>
      <a href="Cipher/Cipher.html" title="OpenSSL::Cipher::Cipher (class)">Cipher</a>
    </td>
  </tr>


  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
openssl/ossl_cipher.c<span class='defines'>,<br />openssl/lib/openssl/cipher.rb</span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Provides symmetric algorithms for encryption and decryption. The algorithms
that are available depend on the particular version of OpenSSL that is
installed.</p>

<h5 id="label-Listing+all+supported+algorithms">Listing all supported algorithms</h5>

<p>A list of supported algorithms can be obtained by</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_puts'>puts</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_ciphers'>ciphers</span>
</code></pre>

<h5 id="label-Instantiating+a+Cipher">Instantiating a Cipher</h5>

<p>There are several ways to create a Cipher instance. Generally, a Cipher
algorithm is categorized by its name, the key length in bits and the cipher
mode to be used. The most generic way to create a Cipher is the following</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;name&gt;-&lt;key length&gt;-&lt;mode&gt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p>That is, a string consisting of the hyphenated concatenation of the
individual components name, key length and mode. Either all uppercase or
all lowercase strings may be used, for example:</p>

<pre class="code ruby"><code class="ruby">cipher = {OpenSSL::Cipher}.new(&#39;AES-128-CBC&#39;)</code></pre>

<p>For each algorithm supported, there is a class defined under the Cipher
class that goes by the name of the cipher, e.g. to obtain an instance of
AES, you could also use</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># these are equivalent
</span><span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>128</span><span class='comma'>,</span> <span class='symbol'>:CBC</span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>128</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CBC</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>128-CBC</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p>Finally, due to its wide-spread use, there are also extra classes defined
for the different key sizes of AES</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES128</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:CBC</span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES192</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:CBC</span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:CBC</span><span class='rparen'>)</span>
</code></pre>

<h5 id="label-Choosing+either+encryption+or+decryption+mode">Choosing either encryption or decryption mode</h5>

<p>Encryption and decryption are often very similar operations for symmetric
algorithms, this is reflected by not having to choose different classes for
either operation, both can be done using the same class. Still, after
obtaining a Cipher instance, we need to tell the instance what it is that
we intend to do with it, so we need to call either</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
</code></pre>

<p>on the Cipher instance. This should be the first call after creating the
instance, otherwise configuration that has already been set could get lost
in the process.</p>

<h5 id="label-Choosing+a+key">Choosing a key</h5>

<p>Symmetric encryption requires a key that is the same for the encrypting and
for the decrypting party and after initial key establishment should be kept
as private information. There are a lot of ways to create insecure keys,
the most notable is to simply take a password as the key without processing
the password further. A simple and secure way to create a key for a
particular Cipher is</p>

<pre class="code ruby"><code class="ruby">cipher = {OpenSSL::AES256}.new(:CFB)
cipher.encrypt
key = cipher.random_key # also sets the generated key on the Cipher</code></pre>

<p>If you absolutely need to use passwords as encryption keys, you should use
Password-Based Key Derivation Function 2 (PBKDF2) by generating the key
with the help of the functionality provided by
<a href="PKCS5.html" title="OpenSSL::PKCS5 (module)">PKCS5</a>.pbkdf2_hmac_sha1 or <a href="PKCS5.html" title="OpenSSL::PKCS5 (module)">PKCS5</a>.pbkdf2_hmac.</p>

<p>Although there is <a href="#pkcs5_keyivgen-instance_method" title="OpenSSL::Cipher#pkcs5_keyivgen (method)">#pkcs5_keyivgen</a>, its use is deprecated and it
should only be used in legacy applications because it does not use the
newer <code>PKCS#5</code> v2 algorithms.</p>

<h5 id="label-Choosing+an+IV">Choosing an IV</h5>

<p>The cipher modes CBC, CFB, OFB and CTR all need an “initialization vector”,
or short, IV. ECB mode is the only mode that does not require an IV, but
there is almost no legitimate use case for this mode because of the fact
that it does not sufficiently hide plaintext patterns. Therefore</p>

<p><strong>You should never use ECB mode unless you are absolutely sure that
you absolutely need it</strong></p>

<p>Because of this, you will end up with a mode that explicitly requires an IV
in any case. Note that for backwards compatibility reasons, setting an IV
is not explicitly mandated by the Cipher API. If not set, OpenSSL itself
defaults to an all-zeroes IV (“\0”, not the character). Although the IV can
be seen as public information, i.e. it may be transmitted in public once
generated, it should still stay unpredictable to prevent certain kinds of
attacks. Therefore, ideally</p>

<p><strong>Always create a secure random IV for every encryption of your
Cipher</strong></p>

<p>A new, random IV should be created for every encryption of data. Think of
the IV as a nonce (number used once) - it&#39;s public but random and
unpredictable. A secure random IV can be created as follows</p>

<pre class="code ruby"><code class="ruby">cipher = ...
cipher.encrypt
key = cipher.random_key
iv = cipher.random_iv # also sets the generated IV on the Cipher

Although the key is generally a random value, too, it is a bad choice
as an IV. There are elaborate ways how an attacker can take advantage
of such an IV. As a general rule of thumb, exposing the key directly
or indirectly should be avoided at all cost and exceptions only be
made with good reason.</code></pre>

<h5 id="label-Calling+-7BCipher-23final-7D">Calling <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a></h5>

<p>ECB (which should not be used) and CBC are both block-based modes. This
means that unlike for the other streaming-based modes, they operate on
fixed-size blocks of data, and therefore they require a “finalization” step
to produce or correctly decrypt the last block of data by appropriately
handling some form of padding. Therefore it is essential to add the output
of <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a> to your encryption/decryption buffer or you will
end up with decryption errors or truncated data.</p>

<p>Although this is not really necessary for streaming-mode ciphers, it is
still recommended to apply the same pattern of adding the output of
<a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a> there as well - it also enables you to switch between modes
more easily in the future.</p>

<h5 id="label-Encrypting+and+decrypting+some+data">Encrypting and decrypting some data</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Very, very confidential data</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>128</span><span class='comma'>,</span> <span class='symbol'>:CBC</span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_random_key'>random_key</span>
<span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_random_iv'>random_iv</span>

<span class='id identifier rubyid_encrypted'>encrypted</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
<span class='comment'>#...
</span><span class='id identifier rubyid_decipher'>decipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>128</span><span class='comma'>,</span> <span class='symbol'>:CBC</span><span class='rparen'>)</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_iv'>iv</span>

<span class='id identifier rubyid_plain'>plain</span> <span class='op'>=</span> <span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_encrypted'>encrypted</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>

<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='id identifier rubyid_plain'>plain</span> <span class='comment'>#=&gt; true</span></code></pre>

<h5 id="label-Authenticated+Encryption+and+Associated+Data+-28AEAD-29">Authenticated Encryption and Associated Data (AEAD)</h5>

<p>If the OpenSSL version used supports it, an Authenticated Encryption mode
(such as GCM or CCM) should always be preferred over any unauthenticated
mode. Currently, OpenSSL supports AE only in combination with Associated
Data (AEAD) where additional associated data is included in the encryption
process to compute a tag at the end of the encryption. This tag will also
be used in the decryption process and by verifying its validity, the
authenticity of a given ciphertext is established.</p>

<p>This is superior to unauthenticated modes in that it allows to detect if
somebody effectively changed the ciphertext after it had been encrypted.
This prevents malicious modifications of the ciphertext that could
otherwise be exploited to modify ciphertexts in ways beneficial to
potential attackers.</p>

<p>If no associated data is needed for encryption and later decryption, the
OpenSSL library still requires a value to be set - “” may be used in case
none is available. An example using the GCM (Galois Counter Mode):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-128-gcm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_random_key'>random_key</span>
<span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_random_iv'>random_iv</span>
<span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_auth_data'>auth_data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_encrypted'>encrypted</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
<span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_auth_tag'>auth_tag</span>

<span class='id identifier rubyid_decipher'>decipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-128-gcm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_iv'>iv</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_auth_tag'>auth_tag</span> <span class='op'>=</span> <span class='id identifier rubyid_tag'>tag</span>
<span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_auth_data'>auth_data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_plain'>plain</span> <span class='op'>=</span> <span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_encrypted'>encrypted</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_decipher'>decipher</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>

<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='id identifier rubyid_plain'>plain</span> <span class='comment'>#=&gt; true
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#ciphers-class_method" title="ciphers (class method)">.<strong>ciphers</strong>  &#x21d2; array[string...] </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the names of all available ciphers in an array.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(string)  &#x21d2; cipher </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The string must contain a valid cipher name like “AES-128-CBC” or “3DES”.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#auth_data%3D-instance_method" title="#auth_data= (instance method)">#<strong>auth_data=</strong>(string)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the cipher&#39;s additional authenticated data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#auth_tag-instance_method" title="#auth_tag (instance method)">#<strong>auth_tag</strong>(tag_len = 16)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gets the authentication tag generated by Authenticated Encryption Cipher
modes (GCM for example).</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#auth_tag%3D-instance_method" title="#auth_tag= (instance method)">#<strong>auth_tag=</strong>(string)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the authentication tag to verify the contents of the ciphertext.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#authenticated%3F-instance_method" title="#authenticated? (instance method)">#<strong>authenticated?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Indicated whether this Cipher instance uses an Authenticated Encryption
mode.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#block_size-instance_method" title="#block_size (instance method)">#<strong>block_size</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#decrypt-instance_method" title="#decrypt (instance method)">#<strong>decrypt</strong>  &#x21d2; self </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Initializes the Cipher for decryption.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#encrypt-instance_method" title="#encrypt (instance method)">#<strong>encrypt</strong>  &#x21d2; self </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Initializes the Cipher for encryption.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#final-instance_method" title="#final (instance method)">#<strong>final</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the remaining data held in the cipher object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#iv%3D-instance_method" title="#iv= (instance method)">#<strong>iv=</strong>(string)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the cipher IV.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#iv_len-instance_method" title="#iv_len (instance method)">#<strong>iv_len</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#key%3D-instance_method" title="#key= (instance method)">#<strong>key=</strong>(string)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the cipher key.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#key_len-instance_method" title="#key_len (instance method)">#<strong>key_len</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#key_len%3D-instance_method" title="#key_len= (instance method)">#<strong>key_len=</strong>(integer)  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the key length of the cipher.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the name of the cipher which may differ slightly from the original
name provided.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#padding%3D-instance_method" title="#padding= (instance method)">#<strong>padding=</strong>(integer)  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Enables or disables padding.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#pkcs5_keyivgen-instance_method" title="#pkcs5_keyivgen (instance method)">#<strong>pkcs5_keyivgen</strong>(pass[, salt [, iterations [, digest]]])  &#x21d2; nil </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Generates and sets the key/IV based on a password.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#random_iv-instance_method" title="#random_iv (instance method)">#<strong>random_iv</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Generate, set, and return a random iv.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#random_key-instance_method" title="#random_key (instance method)">#<strong>random_key</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Generate, set, and return a random key.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reset-instance_method" title="#reset (instance method)">#<strong>reset</strong>  &#x21d2; self </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Fully resets the internal state of the Cipher.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(data[, buffer])  &#x21d2; String, buffer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Encrypts data in a streaming fashion.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(string)  &#x21d2; <tt>cipher</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The string must contain a valid cipher name like “AES-128-CBC” or “3DES”.</p>

<p>A list of cipher names is available by calling <a href="" title="OpenSSL::Cipher (class)">OpenSSL::Cipher</a>.ciphers.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 101</span>

static VALUE
ossl_cipher_initialize(VALUE self, VALUE str)
{
    EVP_CIPHER_CTX *ctx;
    const EVP_CIPHER *cipher;
    char *name;
    unsigned char dummy_key[EVP_MAX_KEY_LENGTH] = { 0 };

    name = StringValueCStr(str);
    GetCipherInit(self, ctx);
    if (ctx) {
	ossl_raise(rb_eRuntimeError, &quot;Cipher already inititalized!&quot;);
    }
    AllocCipher(self, ctx);
    if (!(cipher = EVP_get_cipherbyname(name))) {
	ossl_raise(rb_eRuntimeError, &quot;unsupported cipher algorithm (%&quot;PRIsVALUE&quot;)&quot;, str);
    }
    /*
     * EVP_CipherInit_ex() allows to specify NULL to key and IV, however some
     * ciphers don&#39;t handle well (OpenSSL&#39;s bug). [Bug #2768]
     *
     * The EVP which has EVP_CIPH_RAND_KEY flag (such as DES3) allows
     * uninitialized key, but other EVPs (such as AES) does not allow it.
     * Calling EVP_CipherUpdate() without initializing key causes SEGV so we
     * set the data filled with &quot;\0&quot; as the key by default.
     */
    if (EVP_CipherInit_ex(ctx, cipher, NULL, dummy_key, NULL, -1) != 1)
	ossl_raise(eCipherError, NULL);

    return self;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="ciphers-class_method">
  <h3 class='signature first'>
  .<strong>ciphers</strong>  &#x21d2; <tt>array[string...]</tt>  <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the names of all available ciphers in an array.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


165
166
167
168
169
170
171
172
173
174
175
176</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 165</span>

static VALUE
ossl_s_ciphers(VALUE self)
{
    VALUE ary;

    ary = rb_ary_new();
    OBJ_NAME_do_all_sorted(OBJ_NAME_TYPE_CIPHER_METH,
                    (void(*)(const OBJ_NAME*,void*))add_cipher_name_to_ary,
                    (void*)ary);

    return ary;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="auth_data=-instance_method">
  <h3 class='signature first'>
  #<strong>auth_data=</strong>(string)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the cipher&#39;s additional authenticated data. This field must be set
when using AEAD cipher modes such as GCM or CCM. If no associated data
shall be used, this method must <strong>still</strong> be called with a
value of “”. The contents of this field should be non-sensitive data which
will be added to the ciphertext to generate the authentication tag which
validates the contents of the ciphertext.</p>

<p>The AAD must be set prior to encryption or decryption. In encryption mode,
it must be set after calling <a href="#encrypt-instance_method" title="OpenSSL::Cipher#encrypt (method)">#encrypt</a> and setting <a href="#key%3D-instance_method" title="OpenSSL::Cipher#key= (method)">#key=</a> and
<a href="#iv%3D-instance_method" title="OpenSSL::Cipher#iv= (method)">#iv=</a>. When decrypting, the authenticated data must be set after
key, iv and especially <strong>after</strong> the authentication tag has
been set. I.e. set it only after calling <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a>, <a href="#key%3D-instance_method" title="OpenSSL::Cipher#key= (method)">#key=</a>,
<a href="#iv%3D-instance_method" title="OpenSSL::Cipher#iv= (method)">#iv=</a> and <a href="#auth_tag%3D-instance_method" title="OpenSSL::Cipher#auth_tag= (method)">#auth_tag=</a> first.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 536</span>

static VALUE
ossl_cipher_set_auth_data(VALUE self, VALUE data)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *in;
    long in_len, out_len;

    StringValue(data);

    in = (unsigned char *) RSTRING_PTR(data);
    in_len = RSTRING_LEN(data);

    GetCipher(self, ctx);

    if (!ossl_cipher_update_long(ctx, NULL, &amp;out_len, in, in_len))
        ossl_raise(eCipherError, &quot;couldn&#39;t set additional authenticated data&quot;);

    return data;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="auth_tag-instance_method">
  <h3 class='signature'>
  #<strong>auth_tag</strong>(tag_len = 16)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gets the authentication tag generated by Authenticated Encryption Cipher
modes (GCM for example). This tag may be stored along with the ciphertext,
then set on the decryption cipher to authenticate the contents of the
ciphertext against changes. If the optional integer parameter
<code>tag_len</code> is given, the returned tag will be
<code>tag_len</code> bytes long. If the parameter is omitted, the maximum
length of 16 bytes will be returned. For maximum security, the default of
16 bytes should be chosen.</p>

<p>The tag may only be retrieved after calling <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 570</span>

static VALUE
ossl_cipher_get_auth_tag(int argc, VALUE *argv, VALUE self)
{
    VALUE vtag_len, ret;
    EVP_CIPHER_CTX *ctx;
    int tag_len = 16;

    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;vtag_len) == 1)
	tag_len = NUM2INT(vtag_len);

    GetCipher(self, ctx);

    if (!(EVP_CIPHER_CTX_flags(ctx) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
	ossl_raise(eCipherError, &quot;authentication tag not supported by this cipher&quot;);

    ret = rb_str_new(NULL, tag_len);
    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_GET_TAG, tag_len, RSTRING_PTR(ret)))
	ossl_raise(eCipherError, &quot;retrieving the authentication tag failed&quot;);

    return ret;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="auth_tag=-instance_method">
  <h3 class='signature'>
  #<strong>auth_tag=</strong>(string)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the authentication tag to verify the contents of the ciphertext. The
tag must be set after calling <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a>, <a href="#key%3D-instance_method" title="OpenSSL::Cipher#key= (method)">#key=</a> and
<a href="#iv%3D-instance_method" title="OpenSSL::Cipher#iv= (method)">#iv=</a>, but before assigning the associated authenticated data using
<a href="#auth_data%3D-instance_method" title="OpenSSL::Cipher#auth_data= (method)">#auth_data=</a> and of course, before decrypting any of the ciphertext.
After all decryption is performed, the tag is verified automatically in the
call to <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 604</span>

static VALUE
ossl_cipher_set_auth_tag(VALUE self, VALUE vtag)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *tag;
    int tag_len;

    StringValue(vtag);
    tag = (unsigned char *) RSTRING_PTR(vtag);
    tag_len = RSTRING_LENINT(vtag);

    GetCipher(self, ctx);
    if (!(EVP_CIPHER_CTX_flags(ctx) &amp; EVP_CIPH_FLAG_AEAD_CIPHER))
	ossl_raise(eCipherError, &quot;authentication tag not supported by this cipher&quot;);

    if (!EVP_CIPHER_CTX_ctrl(ctx, EVP_CTRL_AEAD_SET_TAG, tag_len, tag))
	ossl_raise(eCipherError, &quot;unable to set AEAD tag&quot;);

    return vtag;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="authenticated?-instance_method">
  <h3 class='signature'>
  #<strong>authenticated?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Indicated whether this Cipher instance uses an Authenticated Encryption
mode.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


632
633
634
635
636
637
638
639
640</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 632</span>

static VALUE
ossl_cipher_is_authenticated(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return (EVP_CIPHER_CTX_flags(ctx) &amp; EVP_CIPH_FLAG_AEAD_CIPHER) ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="block_size-instance_method">
  <h3 class='signature'>
  #<strong>block_size</strong>  
</h3>

</section>
  <section class='method_details' id="decrypt-instance_method">
  <h3 class='signature'>
  #<strong>decrypt</strong>  &#x21d2; <tt>self</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Initializes the Cipher for decryption.</p>

<p>Make sure to call <a href="#encrypt-instance_method" title="OpenSSL::Cipher#encrypt (method)">#encrypt</a> or <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a> before using any of
the following methods:</p>
<ul><li><dl class="rdoc-list label-list"><dt>key=, iv=, random_key, random_iv, pkcs5_keyivgen
<dd></dd></dl>
</li></ul>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, 0).</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


273
274
275
276
277</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 273</span>

static VALUE
ossl_cipher_decrypt(int argc, VALUE *argv, VALUE self)
{
    return ossl_cipher_init(argc, argv, self, 0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="encrypt-instance_method">
  <h3 class='signature'>
  #<strong>encrypt</strong>  &#x21d2; <tt>self</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Initializes the Cipher for encryption.</p>

<p>Make sure to call <a href="#encrypt-instance_method" title="OpenSSL::Cipher#encrypt (method)">#encrypt</a> or <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a> before using any of
the following methods:</p>
<ul><li><dl class="rdoc-list label-list"><dt>key=, iv=, random_key, random_iv, pkcs5_keyivgen
<dd></dd></dl>
</li></ul>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, 1).</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


255
256
257
258
259</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 255</span>

static VALUE
ossl_cipher_encrypt(int argc, VALUE *argv, VALUE self)
{
    return ossl_cipher_init(argc, argv, self, 1);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="final-instance_method">
  <h3 class='signature'>
  #<strong>final</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the remaining data held in the cipher object. Further calls to
<a href="#update-instance_method" title="OpenSSL::Cipher#update (method)">#update</a> or <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a> will return garbage. This call should
always be made as the last call of an encryption or decryption operation,
after after having fed the entire plaintext or ciphertext to the Cipher
instance.</p>

<p>If an authenticated cipher was used, a CipherError is raised if the tag
could not be authenticated successfully. Only call this method after
setting the authentication tag and passing the entire contents of the
ciphertext into the cipher.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 419</span>

static VALUE
ossl_cipher_final(VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    int out_len;
    VALUE str;

    GetCipher(self, ctx);
    str = rb_str_new(0, EVP_CIPHER_CTX_block_size(ctx));
    if (!EVP_CipherFinal_ex(ctx, (unsigned char *)RSTRING_PTR(str), &amp;out_len))
	ossl_raise(eCipherError, NULL);
    assert(out_len &lt;= RSTRING_LEN(str));
    rb_str_set_len(str, out_len);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="iv=-instance_method">
  <h3 class='signature'>
  #<strong>iv=</strong>(string)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the cipher IV. Please note that since you should never be using ECB
mode, an IV is always explicitly required and should be set prior to
encryption. The IV itself can be safely transmitted in public, but it
should be unpredictable to prevent certain kinds of attacks. You may use
<a href="#random_iv-instance_method" title="OpenSSL::Cipher#random_iv (method)">#random_iv</a> to create a secure random IV.</p>

<p>Only call this method after calling <a href="#encrypt-instance_method" title="OpenSSL::Cipher#encrypt (method)">#encrypt</a> or <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a>.</p>

<p>If not explicitly set, the OpenSSL default of an all-zeroes (“\0”) IV is
used.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 498</span>

static VALUE
ossl_cipher_set_iv(VALUE self, VALUE iv)
{
    EVP_CIPHER_CTX *ctx;
    int iv_len;

    StringValue(iv);
    GetCipher(self, ctx);

    iv_len = EVP_CIPHER_CTX_iv_length(ctx);
    if (RSTRING_LEN(iv) != iv_len)
	ossl_raise(rb_eArgError, &quot;iv must be %d bytes&quot;, iv_len);

    if (EVP_CipherInit_ex(ctx, NULL, NULL, NULL, (unsigned char *)RSTRING_PTR(iv), -1) != 1)
	ossl_raise(eCipherError, NULL);

    return iv;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="iv_len-instance_method">
  <h3 class='signature'>
  #<strong>iv_len</strong>  
</h3>

</section>
  <section class='method_details' id="key=-instance_method">
  <h3 class='signature'>
  #<strong>key=</strong>(string)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the cipher key. To generate a key, you should either use a secure
random byte string or, if the key is to be derived from a password, you
should rely on PBKDF2 functionality provided by <a href="PKCS5.html" title="OpenSSL::PKCS5 (module)">PKCS5</a>. To
generate a secure random-based key, <a href="#random_key-instance_method" title="OpenSSL::Cipher#random_key (method)">#random_key</a> may be used.</p>

<p>Only call this method after calling <a href="#encrypt-instance_method" title="OpenSSL::Cipher#encrypt (method)">#encrypt</a> or <a href="#decrypt-instance_method" title="OpenSSL::Cipher#decrypt (method)">#decrypt</a>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 464</span>

static VALUE
ossl_cipher_set_key(VALUE self, VALUE key)
{
    EVP_CIPHER_CTX *ctx;
    int key_len;

    StringValue(key);
    GetCipher(self, ctx);

    key_len = EVP_CIPHER_CTX_key_length(ctx);
    if (RSTRING_LEN(key) != key_len)
	ossl_raise(rb_eArgError, &quot;key must be %d bytes&quot;, key_len);

    if (EVP_CipherInit_ex(ctx, NULL, NULL, (unsigned char *)RSTRING_PTR(key), NULL, -1) != 1)
	ossl_raise(eCipherError, NULL);

    return key;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="key_len-instance_method">
  <h3 class='signature'>
  #<strong>key_len</strong>  
</h3>

</section>
  <section class='method_details' id="key_len=-instance_method">
  <h3 class='signature'>
  #<strong>key_len=</strong>(integer)  &#x21d2; <tt><a href="../Integer.html" title="Integer (class)">Integer</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the key length of the cipher.  If the cipher is a fixed length cipher
then attempting to set the key length to any value other than the fixed
value is an error.</p>

<p>Under normal circumstances you do not need to call this method (and
probably shouldn&#39;t).</p>

<p>See EVP_CIPHER_CTX_set_key_length for further information.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


660
661
662
663
664
665
666
667
668
669
670
671</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 660</span>

static VALUE
ossl_cipher_set_key_length(VALUE self, VALUE key_length)
{
    int len = NUM2INT(key_length);
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (EVP_CIPHER_CTX_set_key_length(ctx, len) != 1)
        ossl_raise(eCipherError, NULL);

    return key_length;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="name-instance_method">
  <h3 class='signature'>
  #<strong>name</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the name of the cipher which may differ slightly from the original
name provided.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


443
444
445
446
447
448
449
450
451</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 443</span>

static VALUE
ossl_cipher_name(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);

    return rb_str_new2(EVP_CIPHER_name(EVP_CIPHER_CTX_cipher(ctx)));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="padding=-instance_method">
  <h3 class='signature'>
  #<strong>padding=</strong>(integer)  &#x21d2; <tt><a href="../Integer.html" title="Integer (class)">Integer</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Enables or disables padding. By default encryption operations are padded
using standard block padding and the padding is checked and removed when
decrypting. If the pad parameter is zero then no padding is performed, the
total amount of data encrypted or decrypted must then be a multiple of the
block size or an error will occur.</p>

<p>See EVP_CIPHER_CTX_set_padding for further information.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


683
684
685
686
687
688
689
690
691
692
693</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 683</span>

static VALUE
ossl_cipher_set_padding(VALUE self, VALUE padding)
{
    EVP_CIPHER_CTX *ctx;
    int pad = NUM2INT(padding);

    GetCipher(self, ctx);
    if (EVP_CIPHER_CTX_set_padding(ctx, pad) != 1)
	ossl_raise(eCipherError, NULL);
    return padding;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="pkcs5_keyivgen-instance_method">
  <h3 class='signature'>
  #<strong>pkcs5_keyivgen</strong>(pass[, salt [, iterations [, digest]]])  &#x21d2; <tt>nil</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Generates and sets the key/IV based on a password.</p>

<p>WARNING: This method is only PKCS5 v1.5 compliant when using RC2, RC4-40,
or DES with MD5 or SHA1. Using anything else (like AES) will generate the
key/iv using an OpenSSL specific method. This method is deprecated and
should no longer be used. Use a PKCS5 v2 key generation method from
<a href="PKCS5.html" title="OpenSSL::PKCS5 (module)">PKCS5</a> instead.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>

<p><code>salt</code> must be an 8 byte string if provided.
<code>iterations</code> is a integer with a default of 2048.
<code>digest</code> is a Digest object that defaults to &#39;MD5&#39;</p>

<p>A minimum of 1000 iterations is recommended.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 299</span>

static VALUE
ossl_cipher_pkcs5_keyivgen(int argc, VALUE *argv, VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    const EVP_MD *digest;
    VALUE vpass, vsalt, viter, vdigest;
    unsigned char key[EVP_MAX_KEY_LENGTH], iv[EVP_MAX_IV_LENGTH], *salt = NULL;
    int iter;

    rb_scan_args(argc, argv, &quot;13&quot;, &amp;vpass, &amp;vsalt, &amp;viter, &amp;vdigest);
    StringValue(vpass);
    if(!NIL_P(vsalt)){
	StringValue(vsalt);
	if(RSTRING_LEN(vsalt) != PKCS5_SALT_LEN)
	    ossl_raise(eCipherError, &quot;salt must be an 8-octet string&quot;);
	salt = (unsigned char *)RSTRING_PTR(vsalt);
    }
    iter = NIL_P(viter) ? 2048 : NUM2INT(viter);
    digest = NIL_P(vdigest) ? EVP_md5() : GetDigestPtr(vdigest);
    GetCipher(self, ctx);
    EVP_BytesToKey(EVP_CIPHER_CTX_cipher(ctx), digest, salt,
		   (unsigned char *)RSTRING_PTR(vpass), RSTRING_LENINT(vpass), iter, key, iv);
    if (EVP_CipherInit_ex(ctx, NULL, NULL, key, iv, -1) != 1)
	ossl_raise(eCipherError, NULL);
    OPENSSL_cleanse(key, sizeof key);
    OPENSSL_cleanse(iv, sizeof iv);

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="random_iv-instance_method">
  <h3 class='signature'>
  #<strong>random_iv</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Generate, set, and return a random iv. You must call cipher.encrypt or
cipher.decrypt before calling this method.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


48
49
50
51
52</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'openssl/lib/openssl/cipher.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_random_iv'>random_iv</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Random</span><span class='period'>.</span><span class='id identifier rubyid_random_bytes'>random_bytes</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_iv_len'>iv_len</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_str'>str</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="random_key-instance_method">
  <h3 class='signature'>
  #<strong>random_key</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Generate, set, and return a random key. You must call cipher.encrypt or
cipher.decrypt before calling this method.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


40
41
42
43
44</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'openssl/lib/openssl/cipher.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_random_key'>random_key</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Random</span><span class='period'>.</span><span class='id identifier rubyid_random_bytes'>random_bytes</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_key_len'>key_len</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_str'>str</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reset-instance_method">
  <h3 class='signature'>
  #<strong>reset</strong>  &#x21d2; <tt>self</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Fully resets the internal state of the Cipher. By using this, the same
Cipher instance may be used several times for encryption or decryption
tasks.</p>

<p>Internally calls EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, -1).</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


187
188
189
190
191
192
193
194
195
196
197</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 187</span>

static VALUE
ossl_cipher_reset(VALUE self)
{
    EVP_CIPHER_CTX *ctx;

    GetCipher(self, ctx);
    if (EVP_CipherInit_ex(ctx, NULL, NULL, NULL, NULL, -1) != 1)
	ossl_raise(eCipherError, NULL);

    return self;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="update-instance_method">
  <h3 class='signature'>
  #<strong>update</strong>(data[, buffer])  &#x21d2; <tt>String</tt>, <tt>buffer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Encrypts data in a streaming fashion. Hand consecutive blocks of data to
the <code>update</code> method in order to encrypt it. Returns the
encrypted data chunk. When done, the output of <a href="#final-instance_method" title="OpenSSL::Cipher#final (method)">#final</a> should be
additionally added to the result.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>

<p><code>data</code> is a nonempty string. <code>buffer</code> is an optional
string to store the result.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'openssl/ossl_cipher.c', line 369</span>

static VALUE
ossl_cipher_update(int argc, VALUE *argv, VALUE self)
{
    EVP_CIPHER_CTX *ctx;
    unsigned char *in;
    long in_len, out_len;
    VALUE data, str;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;data, &amp;str);

    StringValue(data);
    in = (unsigned char *)RSTRING_PTR(data);
    if ((in_len = RSTRING_LEN(data)) == 0)
        ossl_raise(rb_eArgError, &quot;data must not be empty&quot;);
    GetCipher(self, ctx);
    out_len = in_len+EVP_CIPHER_CTX_block_size(ctx);
    if (out_len &lt;= 0) {
	ossl_raise(rb_eRangeError,
		   &quot;data too big to make output buffer: %ld bytes&quot;, in_len);
    }

    if (NIL_P(str)) {
        str = rb_str_new(0, out_len);
    } else {
        StringValue(str);
        rb_str_resize(str, out_len);
    }

    if (!ossl_cipher_update_long(ctx, (unsigned char *)RSTRING_PTR(str), &amp;out_len, in, in_len))
	ossl_raise(eCipherError, NULL);
    assert(out_len &lt; RSTRING_LEN(str));
    rb_str_set_len(str, out_len);

    return str;
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.3 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>