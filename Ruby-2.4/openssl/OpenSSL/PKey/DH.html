<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: OpenSSL::PKey::DH &mdash; openssl Ruby-2.4.0 d2016-08-08</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "OpenSSL::PKey::DH",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../../index.html'>Home</a> &raquo; 
          <a href='../../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../../index.html'>openssl</a> &raquo; 
          <a href='../../_index.html'>Index (D)</a> &raquo; 
          <a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a> &raquo; 
          <a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a> &raquo; 
          <span class='title'>DH</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: OpenSSL::PKey::DH</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="PKey.html" title="OpenSSL::PKey::PKey (class)">PKey</a></span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'><a href="PKey.html" title="OpenSSL::PKey::PKey (class)">PKey</a></li>
        <li class='next'>OpenSSL::PKey::DH</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L574'>ext/openssl/ossl_pkey_dh.c</a><span class='defines'>,<br /><a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/lib/openssl/pkey.rb#L6'>ext/openssl/lib/openssl/pkey.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An implementation of the Diffie-Hellman key exchange protocol based on
discrete logarithms in finite fields, the same basis that DSA is built on.</p>

<h5 id="label-Accessor+methods+for+the+Diffie-Hellman+parameters">Accessor methods for the Diffie-Hellman parameters</h5>
<ul><li>
<p><code>DH#p</code></p>
</li></ul>

<p>The prime (an OpenSSL::BN) of the Diffie-Hellman parameters.</p>
<ul><li>
<p><code>DH#g</code></p>
</li></ul>

<p>The generator (an OpenSSL::BN) g of the Diffie-Hellman parameters.</p>
<ul><li>
<p><code>DH#pub_key</code></p>
</li></ul>

<p>The per-session public key (an OpenSSL::BN) matching the private key. This
needs to be passed to <a href="#compute_key-instance_method" title="OpenSSL::PKey::DH#compute_key (method)">#compute_key</a>.</p>
<ul><li>
<p><code>DH#priv_key</code></p>
</li></ul>

<p>The per-session private key, an <a href="../BN.html" title="OpenSSL::BN (class)">BN</a>.</p>

<h5 id="label-Example+of+a+key+exchange">Example of a key exchange</h5>

<p>dh1 = <a href="" title="OpenSSL::PKey::DH (class)">DH</a>.new(2048) der = dh1.public_key.to_der <code>#you</code> may
send this publicly to the participating party dh2 =
<a href="" title="OpenSSL::PKey::DH (class)">DH</a>.new(der) dh2.generate_key! <code>#generate</code> the per-session
key pair symm_key1 = dh1.compute_key(dh2.pub_key) symm_key2 =
dh2.compute_key(dh1.pub_key)</p>

<p>puts symm_key1 == symm_key2 # =&gt; true</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='DEFAULT_1024-constant'>
      DEFAULT_1024 =
    </dt>
    <dd>
            <pre class='code ruby'><span class='id identifier rubyid_new'>new</span> <span class='heredoc_beg'>&lt;&lt;-_end_of_pem_</span>
<span class='tstring_content'>-----BEGIN DH PARAMETERS-----
MIGHAoGBAJ0lOVy0VIr/JebWn0zDwY2h+rqITFOpdNr6ugsgvkDXuucdcChhYExJ
AV/ZD2AWPbrTqV76mGRgJg4EddgT1zG0jq3rnFdMj2XzkBYx3BVvfR0Arnby0RHR
T4h7KZ/2zmjvV+eF8kBUHBJAojUlzxKj4QeO2x20FP9X5xmNUXeDAgEC
-----END DH PARAMETERS-----
</span><span class='heredoc_end'>_end_of_pem_</span></pre>
    </dd>
    <dt id='DEFAULT_2048-constant'>
      DEFAULT_2048 =
    </dt>
    <dd>
            <pre class='code ruby'><span class='id identifier rubyid_new'>new</span> <span class='heredoc_beg'>&lt;&lt;-_end_of_pem_</span>
<span class='tstring_content'>-----BEGIN DH PARAMETERS-----
MIIBCAKCAQEA7E6kBrYiyvmKAMzQ7i8WvwVk9Y/+f8S7sCTN712KkK3cqd1jhJDY
JbrYeNV3kUIKhPxWHhObHKpD1R84UpLs2b55iMd6GmL7OYmNIT/FccKhTcveab
VBmZT86BZKYyf45hUF9FOuUM9xPzuK3Vd8oJQvfYMCd7LPC0taAEljQLR4Edf8E6
YoaOffgTf5qxiwkjnlVZQc3whgnEt9FpVMvQ9eknyeGB5KHfayAc3+hUAvI3/Cr3
1bNveX5wInh5GDx1FGhKBZs1HaedudCm7sCgRwv8lKWYGiHzObSma8A86KG+MD
7Lo5JquQ3DlBodj3IDyPrxIv96lvRPFtAwIBAg==
-----END DH PARAMETERS-----
</span><span class='heredoc_end'>_end_of_pem_</span></pre>
    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#generate-class_method" title="generate (class method)">.<strong>generate</strong>(size[, generator])  &#x21d2; DH </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new DH instance from scratch by generating the private and public
components alike.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>([size [, generator] | string])  &#x21d2; DH </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Either generates a DH instance from scratch or by reading already existing
DH parameters from <code>string</code>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#compute_key-instance_method" title="#compute_key (instance method)">#<strong>compute_key</strong>(pub_bn)  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a String containing a shared secret computed from the other
party&#39;s public value.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#export-instance_method" title="#export (instance method)">#<strong>export</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#to_s-instance_method" title="OpenSSL::PKey::DH#to_s (method)">#to_s</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#generate_key%21-instance_method" title="#generate_key! (instance method)">#<strong>generate_key!</strong>  &#x21d2; self </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Generates a private and public key unless a private key already exists.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#params-instance_method" title="#params (instance method)">#<strong>params</strong>  &#x21d2; Hash </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Stores all parameters of key to the hash INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don&#39;t use :-)) (I&#39;s up to you)</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#params_ok%3F-instance_method" title="#params_ok? (instance method)">#<strong>params_ok?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Validates the Diffie-Hellman parameters associated with this instance.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#private%3F-instance_method" title="#private? (instance method)">#<strong>private?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Indicates whether this DH instance has a private key associated with it or
not.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#public%3F-instance_method" title="#public? (instance method)">#<strong>public?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Indicates whether this DH instance has a public key associated with it or
not.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#public_key-instance_method" title="#public_key (instance method)">#<strong>public_key</strong>  &#x21d2; DH </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a new DH instance that carries just the public information, i.e.
the prime <code>p</code> and the generator <code>g</code>, but no
public/private key yet.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#set_key-instance_method" title="#set_key (instance method)">#<strong>set_key</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#set_pqg-instance_method" title="#set_pqg (instance method)">#<strong>set_pqg</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_der-instance_method" title="#to_der (instance method)">#<strong>to_der</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Encodes this DH to its DER encoding.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_pem-instance_method" title="#to_pem (instance method)">#<strong>to_pem</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#to_s-instance_method" title="OpenSSL::PKey::DH#to_s (method)">#to_s</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
        (also: #export, #to_pem)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Encodes this DH to its PEM encoding.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_text-instance_method" title="#to_text (instance method)">#<strong>to_text</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Prints all parameters of key to buffer INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don&#39;t use :-)) (I&#39;s up to you)</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <a href="PKey.html" title="OpenSSL::PKey::PKey (class)">PKey</a></h3>
  <p class="inherited"><a href="PKey.html#sign-instance_method" title="OpenSSL::PKey::PKey#sign (method)">#sign</a>, <a href="PKey.html#verify-instance_method" title="OpenSSL::PKey::PKey#verify (method)">#verify</a></p>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>([size [, generator] | string])  &#x21d2; <tt><a href="" title="OpenSSL::PKey::DH (class)">DH</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Either generates a DH instance from scratch or by reading already existing
DH parameters from <code>string</code>. Note that when reading a DH
instance from data that was encoded from a DH instance by using <a href="#to_pem-instance_method" title="OpenSSL::PKey::DH#to_pem (method)">#to_pem</a>
or <a href="#to_der-instance_method" title="OpenSSL::PKey::DH#to_der (method)">#to_der</a> the result will <strong>not</strong> contain a
public/private key pair yet. This needs to be generated using
<a href="#generate_key%21-instance_method" title="OpenSSL::PKey::DH#generate_key! (method)">#generate_key!</a> first.</p>

<h5 id="label-Parameters">Parameters</h5>
<ul><li>
<p><code>size</code> is an integer representing the desired key size. Keys
smaller than 1024 bits should be considered insecure.</p>
</li><li>
<p><code>generator</code> is a small number &gt; 1, typically 2 or 5.</p>
</li><li>
<p><code>string</code> contains the DER or PEM encoded key.</p>
</li></ul>

<h5 id="label-Examples">Examples</h5>

<p><a href="#new-class_method" title="OpenSSL::PKey::DH.new (method)">new</a> # -&gt; dh DH.new(1024) # -&gt; dh DH.new(1024, 5) # -&gt; dh
#Reading DH parameters dh = DH.new(File.read(&#39;parameters.pem&#39;)) #
-&gt; dh, but no public/private key yet dh.generate_key! # -&gt; dh with
public and private key</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L200'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 200</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_initialize(int argc, VALUE *argv, VALUE self)
{
    EVP_PKEY *pkey;
    DH *dh;
    int g = 2;
    BIO *in;
    VALUE arg, gen;

    GetPKey(self, pkey);
    if(rb_scan_args(argc, argv, &quot;02&quot;, &amp;arg, &amp;gen) == 0) {
      dh = DH_new();
    }
    else if (FIXNUM_P(arg)) {
	if (!NIL_P(gen)) {
	    g = NUM2INT(gen);
	}
	if (!(dh = dh_generate(FIX2INT(arg), g))) {
	    ossl_raise(eDHError, NULL);
	}
    }
    else {
	arg = ossl_to_der_if_possible(arg);
	in = ossl_obj2bio(arg);
	dh = PEM_read_bio_DHparams(in, NULL, NULL, NULL);
	if (!dh){
	    OSSL_BIO_reset(in);
	    dh = d2i_DHparams_bio(in, NULL);
	}
	BIO_free(in);
	if (!dh) {
	    ossl_raise(eDHError, NULL);
	}
    }
    if (!EVP_PKEY_assign_DH(pkey, dh)) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }
    return self;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="generate-class_method">
  <h3 class='signature first'>
  .<strong>generate</strong>(size[, generator])  &#x21d2; <tt><a href="" title="OpenSSL::PKey::DH (class)">DH</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new DH instance from scratch by generating the private and public
components alike.</p>

<h5 id="label-Parameters">Parameters</h5>
<ul><li>
<p><code>size</code> is an integer representing the desired key size. Keys
smaller than 1024 bits should be considered insecure.</p>
</li><li>
<p><code>generator</code> is a small number &gt; 1, typically 2 or 5.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L157'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 157</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_s_generate(int argc, VALUE *argv, VALUE klass)
{
    DH *dh ;
    int g = 2;
    VALUE size, gen, obj;

    if (rb_scan_args(argc, argv, &quot;11&quot;, &amp;size, &amp;gen) == 2) {
	g = NUM2INT(gen);
    }
    dh = dh_generate(NUM2INT(size), g);
    obj = dh_instance(klass, dh);
    if (obj == Qfalse) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }

    return obj;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="compute_key-instance_method">
  <h3 class='signature first'>
  #<strong>compute_key</strong>(pub_bn)  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a String containing a shared secret computed from the other
party&#39;s public value. See DH_compute_key() for further information.</p>

<h5 id="label-Parameters">Parameters</h5>
<ul><li>
<p><code>pub_bn</code> is a <a href="../BN.html" title="OpenSSL::BN (class)">BN</a>, <strong>not</strong> the DH
instance returned by</p>
</li></ul>

<p><a href="#public_key-instance_method" title="OpenSSL::PKey::DH#public_key (method)">#public_key</a> as that contains the DH parameters only.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L530'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 530</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_compute_key(VALUE self, VALUE pub)
{
    DH *dh;
    const BIGNUM *pub_key, *dh_p;
    VALUE str;
    int len;

    GetDH(self, dh);
    DH_get0_pqg(dh, &amp;dh_p, NULL, NULL);
    if (!dh_p)
	ossl_raise(eDHError, &quot;incomplete DH&quot;);
    pub_key = GetBNPtr(pub);
    len = DH_size(dh);
    str = rb_str_new(0, len);
    if ((len = DH_compute_key((unsigned char *)RSTRING_PTR(str), pub_key, dh)) &lt; 0) {
	ossl_raise(eDHError, NULL);
    }
    rb_str_set_len(str, len);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="export-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>export</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_pem</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_s</strong>  &#x21d2; <tt>String</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#to_s-instance_method" title="OpenSSL::PKey::DH#to_s (method)">#to_s</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L326'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 326</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_export(VALUE self)
{
    DH *dh;
    BIO *out;
    VALUE str;

    GetDH(self, dh);
    if (!(out = BIO_new(BIO_s_mem()))) {
	ossl_raise(eDHError, NULL);
    }
    if (!PEM_write_bio_DHparams(out, dh)) {
	BIO_free(out);
	ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="generate_key!-instance_method">
  <h3 class='signature'>
  #<strong>generate_key!</strong>  &#x21d2; <tt>self</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Generates a private and public key unless a private key already exists. If
this DH instance was generated from public DH parameters (e.g. by encoding
the result of <a href="#public_key-instance_method" title="OpenSSL::PKey::DH#public_key (method)">#public_key</a>), then this method needs to be called first
in order to generate the per-session keys before performing the actual key
exchange.</p>

<h5 id="label-Example">Example</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_dh'>dh</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'><a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a></span><span class='op'>::</span><span class='const'><a href="" title="OpenSSL::PKey::DH (class)">DH</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="OpenSSL::PKey::DH.new (method)">new</a></span><span class='lparen'>(</span><span class='int'>2048</span><span class='rparen'>)</span>
<span class='id identifier rubyid_public_key'>public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_dh'>dh</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span> <span class='comment'>#contains no private/public key yet
</span><span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_generate_key!'>generate_key!</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_private?'>private?</span> <span class='comment'># =&gt; true
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L508'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


508
509
510
511
512
513
514
515
516
517</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 508</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_generate_key(VALUE self)
{
    DH *dh;

    GetDH(self, dh);
    if (!DH_generate_key(dh))
	ossl_raise(eDHError, &quot;Failed to generate key&quot;);
    return self;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="params-instance_method">
  <h3 class='signature'>
  #<strong>params</strong>  &#x21d2; <tt>Hash</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Stores all parameters of key to the hash INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don&#39;t use :-)) (I&#39;s up to you)</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L383'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 383</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_get_params(VALUE self)
{
    DH *dh;
    VALUE hash;
    const BIGNUM *p, *q, *g, *pub_key, *priv_key;

    GetDH(self, dh);
    DH_get0_pqg(dh, &amp;p, &amp;q, &amp;g);
    DH_get0_key(dh, &amp;pub_key, &amp;priv_key);

    hash = rb_hash_new();
    rb_hash_aset(hash, rb_str_new2(&quot;p&quot;), ossl_bn_new(p));
    rb_hash_aset(hash, rb_str_new2(&quot;q&quot;), ossl_bn_new(q));
    rb_hash_aset(hash, rb_str_new2(&quot;g&quot;), ossl_bn_new(g));
    rb_hash_aset(hash, rb_str_new2(&quot;pub_key&quot;), ossl_bn_new(pub_key));
    rb_hash_aset(hash, rb_str_new2(&quot;priv_key&quot;), ossl_bn_new(priv_key));

    return hash;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="params_ok?-instance_method">
  <h3 class='signature'>
  #<strong>params_ok?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Validates the Diffie-Hellman parameters associated with this instance. It
checks whether a safe prime and a suitable generator are used. If this is
not the case, <code>false</code> is returned.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L478'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


478
479
480
481
482
483
484
485
486
487
488
489
490</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 478</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_check_params(VALUE self)
{
    DH *dh;
    int codes;

    GetDH(self, dh);
    if (!DH_check(dh, &amp;codes)) {
	return Qfalse;
    }

    return codes == 0 ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="private?-instance_method">
  <h3 class='signature'>
  #<strong>private?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Indicates whether this DH instance has a private key associated with it or
not. The private key may be retrieved with <code>DH#priv_key</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L300'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


300
301
302
303
304
305
306
307
308
309
310
311
312
313
314</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 300</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_is_private(VALUE self)
{
    DH *dh;
    const BIGNUM *bn;

    GetDH(self, dh);
    DH_get0_key(dh, NULL, &amp;bn);

#if !defined(OPENSSL_NO_ENGINE)
    return (bn || DH_get0_engine(dh)) ? Qtrue : Qfalse;
#else
    return bn ? Qtrue : Qfalse;
#endif
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="public?-instance_method">
  <h3 class='signature'>
  #<strong>public?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Indicates whether this DH instance has a public key associated with it or
not. The public key may be retrieved with <code>DH#pub_key</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L281'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


281
282
283
284
285
286
287
288
289
290
291</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 281</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_is_public(VALUE self)
{
    DH *dh;
    const BIGNUM *bn;

    GetDH(self, dh);
    DH_get0_key(dh, &amp;bn, NULL);

    return bn ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="public_key-instance_method">
  <h3 class='signature'>
  #<strong>public_key</strong>  &#x21d2; <tt><a href="" title="OpenSSL::PKey::DH (class)">DH</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a new DH instance that carries just the public information, i.e.
the prime <code>p</code> and the generator <code>g</code>, but no
public/private key yet. Such a pair may be generated using
<a href="#generate_key%21-instance_method" title="OpenSSL::PKey::DH#generate_key! (method)">#generate_key!</a>. The “public key” needed for a key exchange with
<a href="#compute_key-instance_method" title="OpenSSL::PKey::DH#compute_key (method)">#compute_key</a> is considered as per-session information and may be
retrieved with <code>DH#pub_key</code> once a key pair has been generated. If the
current instance already contains private information (and thus a valid
public/private key pair), this information will no longer be present in the
new instance generated by <a href="#public_key-instance_method" title="OpenSSL::PKey::DH#public_key (method)">#public_key</a>. This feature is helpful for
publishing the Diffie-Hellman parameters without leaking any of the private
per-session information.</p>

<h5 id="label-Example">Example</h5>

<p>dh = <a href="" title="OpenSSL::PKey::DH (class)">OpenSSL::PKey::DH</a>.new(2048) # has public and private key set
public_key = dh.public_key # contains only prime and generator parameters =
public_key.to_der # it&#39;s safe to publish this</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L453'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 453</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_to_public_key(VALUE self)
{
    DH *orig_dh, *dh;
    VALUE obj;

    GetDH(self, orig_dh);
    dh = DHparams_dup(orig_dh); /* err check perfomed by dh_instance */
    obj = dh_instance(CLASS_OF(self), dh);
    if (obj == Qfalse) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }

    return obj;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="set_key-instance_method">
  <h3 class='signature'>
  #<strong>set_key</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L623'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="set_pqg-instance_method">
  <h3 class='signature'>
  #<strong>set_pqg</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L622'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="to_der-instance_method">
  <h3 class='signature'>
  #<strong>to_der</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Encodes this DH to its DER encoding. Note that any existing per-session
public/private keys will <strong>not</strong> get encoded, just the
Diffie-Hellman parameters will be encoded.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L355'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 355</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_to_der(VALUE self)
{
    DH *dh;
    unsigned char *p;
    long len;
    VALUE str;

    GetDH(self, dh);
    if((len = i2d_DHparams(dh, NULL)) &lt;= 0)
	ossl_raise(eDHError, NULL);
    str = rb_str_new(0, len);
    p = (unsigned char *)RSTRING_PTR(str);
    if(i2d_DHparams(dh, &amp;p) &lt; 0)
	ossl_raise(eDHError, NULL);
    ossl_str_adjust(str, p);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_pem-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>export</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_pem</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_s</strong>  &#x21d2; <tt>String</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#to_s-instance_method" title="OpenSSL::PKey::DH#to_s (method)">#to_s</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="to_s-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>export</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_pem</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_s</strong>  &#x21d2; <tt>String</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>export</span>, <span>to_pem</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Encodes this DH to its PEM encoding. Note that any existing per-session
public/private keys will <strong>not</strong> get encoded, just the
Diffie-Hellman parameters will be encoded.</p>


  </div>
</div>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L326'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 326</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_export(VALUE self)
{
    DH *dh;
    BIO *out;
    VALUE str;

    GetDH(self, dh);
    if (!(out = BIO_new(BIO_s_mem()))) {
	ossl_raise(eDHError, NULL);
    }
    if (!PEM_write_bio_DHparams(out, dh)) {
	BIO_free(out);
	ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_text-instance_method">
  <h3 class='signature'>
  #<strong>to_text</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Prints all parameters of key to buffer INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don&#39;t use :-)) (I&#39;s up to you)</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L412'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey_dh.c', line 412</span></pre>
<pre class='code cpp'>

static VALUE
ossl_dh_to_text(VALUE self)
{
    DH *dh;
    BIO *out;
    VALUE str;

    GetDH(self, dh);
    if (!(out = BIO_new(BIO_s_mem()))) {
	ossl_raise(eDHError, NULL);
    }
    if (!DHparams_print(out, dh)) {
	BIO_free(out);
	ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>