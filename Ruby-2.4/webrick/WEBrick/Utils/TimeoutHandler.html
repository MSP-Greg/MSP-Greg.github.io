<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: WEBrick::Utils::TimeoutHandler &mdash; webrick Ruby-2.4.0 d2016-07-27</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "WEBrick::Utils::TimeoutHandler",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../../index.html'>Home</a> &raquo; 
          <a href='../../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../../index.html'>webrick</a> &raquo; 
          <a href='../../_index.html'>Index (T)</a> &raquo; 
          <a href="../../WEBrick.html" title="WEBrick (module)">WEBrick</a> &raquo; 
          <a href="../Utils.html" title="WEBrick::Utils (module)">Utils</a> &raquo; 
          <span class='title'>TimeoutHandler</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: WEBrick::Utils::TimeoutHandler</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>WEBrick::Utils::TimeoutHandler</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>


  <tr>
    <td class='box_1'>Includes:</td>
    <td>Singleton
    </td>
  </tr>



  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L124'>lib/webrick/utils.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Class used to manage timeout handlers across multiple threads.</p>

<p>Timeout handlers should be managed by using the class methods which are
synchronized.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='const'>TimeoutHandler</span><span class='period'>.</span><span class='id identifier rubyid_register'><a href="#register-class_method" title="WEBrick::Utils::TimeoutHandler.register (method)">register</a></span><span class='lparen'>(</span><span class='int'>10</span><span class='comma'>,</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='rparen'>)</span>
<span class='kw'>begin</span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>20</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>ensure</span>
  <span class='const'>TimeoutHandler</span><span class='period'>.</span><span class='id identifier rubyid_cancel'><a href="#cancel-class_method" title="WEBrick::Utils::TimeoutHandler.cancel (method)">cancel</a></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>will raise <code>Timeout::Error</code></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='const'>TimeoutHandler</span><span class='period'>.</span><span class='id identifier rubyid_register'><a href="#register-class_method" title="WEBrick::Utils::TimeoutHandler.register (method)">register</a></span><span class='lparen'>(</span><span class='int'>10</span><span class='comma'>,</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='rparen'>)</span>
<span class='kw'>begin</span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>5</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>ensure</span>
  <span class='const'>TimeoutHandler</span><span class='period'>.</span><span class='id identifier rubyid_cancel'><a href="#cancel-class_method" title="WEBrick::Utils::TimeoutHandler.cancel (method)">cancel</a></span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>will print &#39;foo&#39;</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='TimeoutMutex-constant'>
      TimeoutMutex =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Mutex used to synchronize access across threads</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span></pre>
    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#cancel-class_method" title=".cancel (class method)">.<strong>cancel</strong>(id)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Cancels the timeout handler <code>id</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; TimeoutHandler </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new TimeoutHandler.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#register-class_method" title=".register (class method)">.<strong>register</strong>(seconds, exception)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Registers a new timeout handler</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#terminate-class_method" title=".terminate (class method)">.<strong>terminate</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#cancel-instance_method" title="#cancel (instance method)">#<strong>cancel</strong>(thread, id)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Cancels the timeout handler <code>id</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#interrupt-instance_method" title="#interrupt (instance method)">#<strong>interrupt</strong>(thread, id, exception)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Interrupts the timeout handler <code>id</code> and raises
<code>exception</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#register-instance_method" title="#register (instance method)">#<strong>register</strong>(thread, time, exception)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Registers a new timeout handler</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#terminate-instance_method" title="#terminate (instance method)">#<strong>terminate</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#watch-instance_method" title="#watch (instance method)">#<strong>watch</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>:nodoc:</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#watcher-instance_method" title="#watcher (instance method)">#<strong>watcher</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>:nodoc:</p>
</div>
      </span>
    </li>
  </ul>



  <h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>  &#x21d2; <tt><a href="" title="WEBrick::Utils::TimeoutHandler (class)">TimeoutHandler</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new TimeoutHandler.  You should use <a href="#register-class_method" title="WEBrick::Utils::TimeoutHandler.register (method)">register</a> and <a href="#cancel-class_method" title="WEBrick::Utils::TimeoutHandler.cancel (method)">cancel</a>
instead of creating the timeout handler directly.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L153'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


153
154
155
156
157
158
159</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='ivar'>@timeout_info</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@queue</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@watcher</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="cancel-class_method">
  <h3 class='signature first'>
  .<strong>cancel</strong>(id)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Cancels the timeout handler <code>id</code></p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L142'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


142
143
144</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 142</span>

<span class='kw'>def</span> <span class='const'><a href="" title="WEBrick::Utils::TimeoutHandler (class)">TimeoutHandler</a></span><span class='period'>.</span><span class='id identifier rubyid_cancel'>cancel</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_cancel'>cancel</span><span class='lparen'>(</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="register-class_method">
  <h3 class='signature'>
  .<strong>register</strong>(seconds, exception)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Registers a new timeout handler</p>
<dl class="rdoc-list note-list"><dt><code>time</code>
<dd>
<p>Timeout in seconds</p>
</dd><dt><code>exception</code>
<dd>
<p>Exception to raise when timeout elapsed</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L136'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


136
137
138</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 136</span>

<span class='kw'>def</span> <span class='const'><a href="" title="WEBrick::Utils::TimeoutHandler (class)">TimeoutHandler</a></span><span class='period'>.</span><span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="terminate-class_method">
  <h3 class='signature'>
  .<strong>terminate</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L146'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


146
147
148</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 146</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_terminate'>terminate</span>
  <span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_terminate'>terminate</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="cancel-instance_method">
  <h3 class='signature first'>
  #<strong>cancel</strong>(thread, id)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Cancels the timeout handler <code>id</code></p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L231'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


231
232
233
234
235
236
237
238
239
240
241
242</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 231</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cancel'>cancel</span><span class='lparen'>(</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='ivar'>@timeout_info</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread'>thread</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_ary'>ary</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ary'>ary</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='ivar'>@timeout_info</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_thread'>thread</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="interrupt-instance_method">
  <h3 class='signature'>
  #<strong>interrupt</strong>(thread, id, exception)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Interrupts the timeout handler <code>id</code> and raises
<code>exception</code></p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L208'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


208
209
210
211
212</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 208</span>

<span class='kw'>def</span> <span class='id identifier rubyid_interrupt'>interrupt</span><span class='lparen'>(</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cancel'>cancel</span><span class='lparen'>(</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_thread'>thread</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>
    <span class='id identifier rubyid_thread'>thread</span><span class='period'>.</span><span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>execution timeout</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="register-instance_method">
  <h3 class='signature'>
  #<strong>register</strong>(thread, time, exception)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Registers a new timeout handler</p>
<dl class="rdoc-list note-list"><dt><code>time</code>
<dd>
<p>Timeout in seconds</p>
</dd><dt><code>exception</code>
<dd>
<p>Exception to raise when timeout elapsed</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L219'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


219
220
221
222
223
224
225
226
227</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='lparen'>(</span><span class='ivar'>@timeout_info</span><span class='lbracket'>[</span><span class='id identifier rubyid_thread'>thread</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@queue</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_watcher'>watcher</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="terminate-instance_method">
  <h3 class='signature'>
  #<strong>terminate</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L245'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


245
246
247
248
249
250</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_terminate'>terminate</span>
  <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='ivar'>@timeout_info</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='ivar'>@watcher</span><span class='op'>&amp;.</span><span class='id identifier rubyid_kill'>kill</span><span class='op'>&amp;.</span><span class='id identifier rubyid_join'>join</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="watch-instance_method">
  <h3 class='signature'>
  #<strong>watch</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L163'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 163</span>

<span class='id identifier rubyid_private'>private</span> \
<span class='kw'>def</span> <span class='id identifier rubyid_watch'>watch</span>
  <span class='id identifier rubyid_to_interrupt'>to_interrupt</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
    <span class='id identifier rubyid_wakeup'>wakeup</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_to_interrupt'>to_interrupt</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
      <span class='ivar'>@timeout_info</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_ary'>ary</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ary'>ary</span>
        <span class='id identifier rubyid_ary'>ary</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span>
          <span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span> <span class='op'>=</span> <span class='op'>*</span><span class='id identifier rubyid_info'>info</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_now'>now</span>
            <span class='id identifier rubyid_to_interrupt'>to_interrupt</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='lbracket'>[</span><span class='id identifier rubyid_thread'>thread</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rbracket'>]</span>
          <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_wakeup'>wakeup</span> <span class='op'>||</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_wakeup'>wakeup</span>
            <span class='id identifier rubyid_wakeup'>wakeup</span> <span class='op'>=</span> <span class='id identifier rubyid_time'>time</span>
          <span class='kw'>end</span>
        <span class='rbrace'>}</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_to_interrupt'>to_interrupt</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span> <span class='id identifier rubyid_interrupt'>interrupt</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_arg'>arg</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_wakeup'>wakeup</span>
      <span class='ivar'>@queue</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
    <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_wakeup'>wakeup</span> <span class='op'>-=</span> <span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='kw'>begin</span>
        <span class='lparen'>(</span><span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='lbrace'>{</span><span class='ivar'>@queue</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_wakeup'>wakeup</span><span class='rparen'>)</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_th'>th</span><span class='op'>&amp;.</span><span class='id identifier rubyid_kill'>kill</span><span class='op'>&amp;.</span><span class='id identifier rubyid_join'>join</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@queue</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="watcher-instance_method">
  <h3 class='signature'>
  #<strong>watcher</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/lib/webrick/utils.rb#L198'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


198
199
200
201
202
203
204
205</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'lib/webrick/utils.rb', line 198</span>

<span class='id identifier rubyid_private'>private</span> \
<span class='kw'>def</span> <span class='id identifier rubyid_watcher'>watcher</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='ivar'>@watcher</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_alive?'>alive?</span> <span class='kw'>and</span> <span class='kw'>return</span> <span class='id identifier rubyid_w'>w</span> <span class='comment'># usual case
</span>  <span class='const'><a href="#TimeoutMutex-constant" title="WEBrick::Utils::TimeoutHandler::TimeoutMutex (constant)">TimeoutMutex</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='ivar'>@watcher</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_alive?'>alive?</span> <span class='kw'>and</span> <span class='kw'>next</span> <span class='id identifier rubyid_w'>w</span> <span class='comment'># pathological check
</span>    <span class='ivar'>@watcher</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:watch</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>