<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: CSV &mdash; csv Ruby-2.4.0 d2016-07-16</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "CSV",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='index.html'>csv</a> &raquo; 
          <a href='_index.html'>Index (C)</a> &raquo; 
          <span class='title'>CSV</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: CSV</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>CSV</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="CSV/FieldInfo.html" title="CSV::FieldInfo (class)">FieldInfo</a>,
    <a href="CSV/Row.html" title="CSV::Row (class)">Row</a>,
    <a href="CSV/Table.html" title="CSV::Table (class)">Table</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="CSV/MalformedCSVError.html" title="CSV::MalformedCSVError (class)">MalformedCSVError</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Extended by:</td>
    <td>Forwardable
    </td>
  </tr>
  <tr>
    <td class='box_1'>Includes:</td>
    <td>Enumerable
    </td>
  </tr>



  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
csv.rb</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class provides a complete interface to CSV files and data.  It offers
tools to enable you to read and write to and from Strings or IO objects, as
needed.</p>

<h3 id="label-Reading">Reading</h3>

<h4 id="label-From+a+File">From a File</h4>

<h5 id="label-A+Line+at+a+Time">A Line at a Time</h5>

<pre class="code ruby"><code class="ruby"><span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># use row here...
</span><span class='kw'>end</span>
</code></pre>

<h5 id="label-All+at+Once">All at Once</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arr_of_arrs'>arr_of_arrs</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<h4 id="label-From+a+String">From a String</h4>

<h5 id="label-A+Line+at+a+Time">A Line at a Time</h5>

<pre class="code ruby"><code class="ruby"><span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,data,String</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># use row here...
</span><span class='kw'>end</span>
</code></pre>

<h5 id="label-All+at+Once">All at Once</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arr_of_arrs'>arr_of_arrs</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,data,String</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<h3 id="label-Writing">Writing</h3>

<h4 id="label-To+a+File">To a File</h4>

<pre class="code ruby"><code class="ruby"><span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>
</code></pre>

<h4 id="label-To+a+String">To a String</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>
</code></pre>

<h3 id="label-Convert+a+Single+Line">Convert a Single Line</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_csv_string'>csv_string</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_csv'>to_csv</span>   <span class='comment'># to CSV
</span><span class='id identifier rubyid_csv_array'>csv_array</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,String</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_parse_csv'>parse_csv</span>   <span class='comment'># from CSV
</span></code></pre>

<h3 id="label-Shortcut+Interface">Shortcut Interface</h3>

<pre class="code ruby"><code class="ruby"><span class='const'>CSV</span>             <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_csv_out'>csv_out</span><span class='op'>|</span> <span class='id identifier rubyid_csv_out'>csv_out</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to $stdout
</span><span class='const'>CSV</span><span class='lparen'>(</span><span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_csv_str'>csv_str</span><span class='op'>|</span> <span class='id identifier rubyid_csv_str'>csv_str</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to a String
</span><span class='const'>CSV</span><span class='lparen'>(</span><span class='gvar'>$stderr</span><span class='rparen'>)</span>    <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_csv_err'>csv_err</span><span class='op'>|</span> <span class='id identifier rubyid_csv_err'>csv_err</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to $stderr
</span><span class='const'>CSV</span><span class='lparen'>(</span><span class='gvar'>$stdin</span><span class='rparen'>)</span>     <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_csv_in'>csv_in</span><span class='op'>|</span>  <span class='id identifier rubyid_csv_in'>csv_in</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_row'>row</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>  <span class='comment'># from $stdin
</span></code></pre>

<h3 id="label-Advanced+Usage">Advanced Usage</h3>

<h4 id="label-Wrap+an+IO+Object">Wrap an IO Object</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='comment'># ... read (with gets() or each()) from and write (with &lt;&lt;) to csv here ...
</span></code></pre>

<h3 id="label-CSV+and+Character+Encodings+-28M17n+or+Multilingualization-29">CSV and Character Encodings (M17n or Multilingualization)</h3>

<p>This new CSV parser is m17n savvy.  The parser works in the Encoding of the
IO or String object being read from or written to.  Your data is never
transcoded (unless you ask Ruby to transcode it for you) and will literally
be parsed in the Encoding it is in.  Thus CSV will return Arrays or Rows of
Strings in the Encoding of your data.  This is accomplished by transcoding
the parser itself into your Encoding.</p>

<p>Some transcoding must take place, of course, to accomplish this
multiencoding support.  For example, <code>:col_sep</code>,
<code>:row_sep</code>, and <code>:quote_char</code> must be transcoded to
match your data.  Hopefully this makes the entire process feel transparent,
since CSV&#39;s defaults should just magically work for your data. 
However, you can set these values manually in the target Encoding to avoid
the translation.</p>

<p>It&#39;s also important to note that while all of CSV&#39;s core parser is
now Encoding agnostic, some features are not.  For example, the built-in
converters will try to transcode data to UTF-8 before making conversions.
Again, you can provide custom converters that are aware of your Encodings
to avoid this translation.  It&#39;s just too hard for me to support native
conversions in all of Ruby&#39;s Encodings.</p>

<p>Anyway, the practical side of this is simple:  make sure IO and String
objects passed into CSV have the proper Encoding set and everything should
just work. CSV methods that allow you to open IO objects (CSV::foreach(),
CSV::open(), CSV::read(), and CSV::readlines()) do allow you to specify the
Encoding.</p>

<p>One minor exception comes when generating CSV into a String with an
Encoding that is not ASCII compatible.  There&#39;s no existing data for
CSV to use to prepare itself and thus you will probably need to manually
specify the desired Encoding for most of those cases.  It will try to guess
using the fields in a row of output though, when using CSV::generate_line()
or <code>Array#to_csv(</code>).</p>

<p>I try to point out any other Encoding issues in the documentation of
methods as they come up.</p>

<p>This has been tested to the best of my ability with all non-“dummy”
Encodings Ruby ships with.  However, it is brave new code and may have some
bugs. Please feel free to <code>report</code>[<a
href="mailto:james@grayproductions.net">james@grayproductions.net</a>] any
issues you find with it.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='ConverterEncoding-constant'>
      ConverterEncoding =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>The encoding used by all converters.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    </dd>
    <dt id='Converters-constant'>
      Converters =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>This Hash holds the built-in converters of CSV that can be accessed by
name. You can select Converters with CSV.convert() or through the
<code>options</code> Hash passed to CSV::new().</p>
<dl class="rdoc-list note-list"><dt><strong><code>:integer</code></strong>
<dd>
<p>Converts any field Integer() accepts.</p>
</dd><dt><strong><code>:float</code></strong>
<dd>
<p>Converts any field Float() accepts.</p>
</dd><dt><strong><code>:numeric</code></strong>
<dd>
<p>A combination of <code>:integer</code> and <code>:float</code>.</p>
</dd><dt><strong><code>:date</code></strong>
<dd>
<p>Converts any field Date::parse() accepts.</p>
</dd><dt><strong><code>:date_time</code></strong>
<dd>
<p>Converts any field DateTime::parse() accepts.</p>
</dd><dt><strong><code>:all</code></strong>
<dd>
<p>All built-in converters.  A combination of <code>:date_time</code> and
<code>:numeric</code>.</p>
</dd></dl>

<p>All built-in converters transcode field data to UTF-8 before attempting a
conversion.  If your data cannot be transcoded to UTF-8 the conversion will
fail and the field will remain unchanged.</p>

<p>This Hash is intentionally left unfrozen and users should feel free to add
values to it that can be accessed by all CSV objects.</p>

<p>To add a combo field, the value should be an Array of names.  Combo fields
can be nested with other combo fields.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='lbrace'>{</span>
  <span class='label'>integer:</span>   <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='id identifier rubyid_f'>f</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>float:</span>     <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='id identifier rubyid_f'>f</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>numeric:</span>   <span class='lbracket'>[</span><span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:float</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='label'>date:</span>      <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=~</span> <span class='const'>DateMatcher</span> <span class='op'>?</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_f'>f</span>
    <span class='kw'>rescue</span>  <span class='comment'># encoding conversion or date parse errors
</span>      <span class='id identifier rubyid_f'>f</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>date_time:</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=~</span> <span class='const'>DateTimeMatcher</span> <span class='op'>?</span> <span class='const'>DateTime</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_f'>f</span>
    <span class='kw'>rescue</span>  <span class='comment'># encoding conversion or date parse errors
</span>      <span class='id identifier rubyid_f'>f</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>all:</span>       <span class='lbracket'>[</span><span class='symbol'>:date_time</span><span class='comma'>,</span> <span class='symbol'>:numeric</span><span class='rbracket'>]</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre>
    </dd>
    <dt id='DateMatcher-constant'>
      DateMatcher =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>A Regexp used to find and convert some common Date formats.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'> \A(?: (\w,?\s)?\w\s\d{1,2},?\s+\d{2,4} |
\d{4}-\d{2}-\d{2} )\z </span><span class='regexp_end'>/x</span></span></pre>
    </dd>
    <dt id='DateTimeMatcher-constant'>
      DateTimeMatcher =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>A Regexp used to find and convert some common DateTime formats.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'> \A(?: (\w,?\s)?\w\s\d{1,2}\s\d{1,2}:\d{1,2}:\d{1,2},?\s\d{2,4} |
\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2} )\z </span><span class='regexp_end'>/x</span></span></pre>
    </dd>
    <dt id='DEFAULT_OPTIONS-constant'>
      DEFAULT_OPTIONS =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>The options used when no overrides are given by calling code.  They are:</p>
<dl class="rdoc-list note-list"><dt><strong><code>:col_sep</code></strong>
<dd>
<p><code>&quot;,&quot;</code></p>
</dd><dt><strong><code>:row_sep</code></strong>
<dd>
<p><code>:auto</code></p>
</dd><dt><strong><code>:quote_char</code></strong>
<dd>
<p><code>&#39;&quot;&#39;</code></p>
</dd><dt><strong><code>:field_size_limit</code></strong>
<dd>
<p><code>nil</code></p>
</dd><dt><strong><code>:converters</code></strong>
<dd>
<p><code>nil</code></p>
</dd><dt><strong><code>:unconverted_fields</code></strong>
<dd>
<p><code>nil</code></p>
</dd><dt><strong><code>:headers</code></strong>
<dd>
<p><code>false</code></p>
</dd><dt><strong><code>:return_headers</code></strong>
<dd>
<p><code>false</code></p>
</dd><dt><strong><code>:header_converters</code></strong>
<dd>
<p><code>nil</code></p>
</dd><dt><strong><code>:skip_blanks</code></strong>
<dd>
<p><code>false</code></p>
</dd><dt><strong><code>:force_quotes</code></strong>
<dd>
<p><code>false</code></p>
</dd><dt><strong><code>:skip_lines</code></strong>
<dd>
<p><code>nil</code></p>
</dd><dt><strong><code>:liberal_parsing</code></strong>
<dd>
<p><code>false</code></p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='lbrace'>{</span>
  <span class='label'>col_sep:</span>            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>row_sep:</span>            <span class='symbol'>:auto</span><span class='comma'>,</span>
  <span class='label'>quote_char:</span>         <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='label'>field_size_limit:</span>   <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>converters:</span>         <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>unconverted_fields:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>headers:</span>            <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>return_headers:</span>     <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>header_converters:</span>  <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>skip_blanks:</span>        <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>force_quotes:</span>       <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>skip_lines:</span>         <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>liberal_parsing:</span>    <span class='kw'>false</span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre>
    </dd>
    <dt id='HeaderConverters-constant'>
      HeaderConverters =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>This Hash holds the built-in header converters of CSV that can be accessed
by name.  You can select HeaderConverters with CSV.header_convert() or
through the <code>options</code> Hash passed to CSV::new().</p>
<dl class="rdoc-list note-list"><dt><strong><code>:downcase</code></strong>
<dd>
<p>Calls downcase() on the header String.</p>
</dd><dt><strong><code>:symbol</code></strong>
<dd>
<p>Leading/trailing spaces are dropped, string is downcased, remaining spaces
are replaced with underscores, non-word characters are dropped, and finally
to_sym() is called.</p>
</dd></dl>

<p>All built-in header converters transcode header data to UTF-8 before
attempting a conversion.  If your data cannot be transcoded to UTF-8 the
conversion will fail and the header will remain unchanged.</p>

<p>This Hash is intentionally left unfrozen and users should feel free to add
values to it that can be accessed by all CSV objects.</p>

<p>To add a combo field, the value should be an Array of names.  Combo fields
can be nested with other combo fields.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='lbrace'>{</span>
  <span class='label'>downcase:</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>symbol:</span>   <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span>
    <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span>
                                               <span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\W+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></pre>
    </dd>
    <dt id='VERSION-constant'>
      VERSION =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>The version of the installed library.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.4.8</span><span class='tstring_end'>&quot;</span></span></pre>
    </dd>
  </dl>



<h2>Instance Attribute Summary <small><a href='#' class='summary_toggle'>collapse</a></small></h2>

  <ul class="summary">
    <li>
      <span class="summary_signature">
        <a href="#col_sep-instance_method" title="#col_sep (instance method)">#<strong>col_sep</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The encoded <code>:col_sep</code> used in parsing and writing.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#encoding-instance_method" title="#encoding (instance method)">#<strong>encoding</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The Encoding CSV is parsing or writing in.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#field_size_limit-instance_method" title="#field_size_limit (instance method)">#<strong>field_size_limit</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The limit for field size, if any.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#lineno-instance_method" title="#lineno (instance method)">#<strong>lineno</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The line number of the last row read from this file.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#quote_char-instance_method" title="#quote_char (instance method)">#<strong>quote_char</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The encoded <code>:quote_char</code> used in parsing and writing.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#row_sep-instance_method" title="#row_sep (instance method)">#<strong>row_sep</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The encoded <code>:row_sep</code> used in parsing and writing.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#skip_lines-instance_method" title="#skip_lines (instance method)">#<strong>skip_lines</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The regex marking a line as a comment.</p>
</div>
      </span>
    </li>
  </ul>


<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#filter-class_method" title="filter (class method)">.<strong>filter</strong>(options = Hash.new) {|row| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is a convenience for building Unix-like filters for CSV data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#foreach-class_method" title=".foreach (class method)">.<strong>foreach</strong>(path, options = Hash.new, &amp;block)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is intended as the primary interface for reading CSV files.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#generate-class_method" title="generate (class method)">.<strong>generate</strong>(str, options = Hash.new) {|csv| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method wraps a String you provide, or an empty default String, in a
CSV object which is passed to the provided block.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#generate_line-class_method" title=".generate_line (class method)">.<strong>generate_line</strong>(row, options = Hash.new)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is a shortcut for converting a single row (Array) into a CSV
String.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#instance-class_method" title=".instance (class method)">.<strong>instance</strong>(data = $stdout, options = Hash.new)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method will return a CSV instance, just like CSV::new(), but the
instance will be cached and returned for all future calls to this method
for the same <code>data</code> object (tested by <code>Object#object_id(</code>)) with
the same <code>options</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(data, options = Hash.new)  &#x21d2; CSV </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This constructor will wrap either a String or IO object passed in
<code>data</code> for reading and/or writing.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#open-class_method" title="open (class method)">.<strong>open</strong>(filename, mode = &quot;rb&quot;, options = Hash.new) {|faster_csv| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method opens an IO object, and wraps that with CSV.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#parse-class_method" title="parse (class method)">.<strong>parse</strong>(str, options = Hash.new) {|row| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method can be used to easily parse CSV out of a String.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#parse_line-class_method" title=".parse_line (class method)">.<strong>parse_line</strong>(line, options = Hash.new)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is a shortcut for converting a single line of a CSV String into
an Array.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#read-class_method" title=".read (class method)">.<strong>read</strong>(path, *options)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Use to slurp a CSV file into an Array of Arrays.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#readlines-class_method" title=".readlines (class method)">.<strong>readlines</strong>(*args)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for CSV::read().</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#table-class_method" title=".table (class method)">.<strong>table</strong>(path, options = Hash.new)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>A shortcut for:</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>(row)  </a>
        (also: #add_row, #puts)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The primary write method for wrapped Strings and IOs, <code>row</code> (an
Array or CSV::Row) is converted to CSV and appended to the data source.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_converter-instance_method" title="#add_converter (instance method)">#<strong>add_converter</strong>(var_name, const, name = nil, &amp;converter)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The actual work method for adding converters, used by both CSV.convert()
and CSV.header_convert().</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_row-instance_method" title="#add_row (instance method)">#<strong>add_row</strong>(row)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%3C%3C-instance_method" title="CSV#&lt;&lt; (method)">#&lt;&lt;</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#add_unconverted_fields-instance_method" title="#add_unconverted_fields (instance method)">#<strong>add_unconverted_fields</strong>(row, fields)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method injects an instance variable <code>unconverted_fields</code>
into <code>row</code> and an accessor method for <code>row</code> called
unconverted_fields().</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#convert-instance_method" title="#convert (instance method)">#<strong>convert</strong>(name)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>You can use this method to install a <a href="#Converters-constant" title="CSV::Converters (constant)">Converters</a> built-in, or provide
a block that handles a custom conversion.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#convert_fields-instance_method" title="#convert_fields (instance method)">#<strong>convert_fields</strong>(fields, headers = false)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Processes <code>fields</code> with <code>@converters</code>, or
<code>@header_converters</code> if <code>headers</code> is passed as
<code>true</code>, returning the converted field set.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#converters-instance_method" title="#converters (instance method)">#<strong>converters</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the current list of converters in effect.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Yields each row of the data source in turn.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#encode_re-instance_method" title="#encode_re (instance method)">#<strong>encode_re</strong>(*chunks)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Builds a regular expression in <code>@encoding</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#encode_str-instance_method" title="#encode_str (instance method)">#<strong>encode_str</strong>(*chunks)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Builds a String in <code>@encoding</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#escape_re-instance_method" title="#escape_re (instance method)">#<strong>escape_re</strong>(str)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is an encoding safe version of Regexp::escape().</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#force_quotes%3F-instance_method" title="#force_quotes? (instance method)">#<strong>force_quotes?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if all output fields are quoted.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#gets-instance_method" title="#gets (instance method)">#<strong>gets</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#shift-instance_method" title="CSV#shift (method)">#shift</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#header_convert-instance_method" title="#header_convert (instance method)">#<strong>header_convert</strong>(name)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Identical to #convert(), but for header rows.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#header_converters-instance_method" title="#header_converters (instance method)">#<strong>header_converters</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the current list of converters in effect for headers.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#header_row%3F-instance_method" title="#header_row? (instance method)">#<strong>header_row?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if the next row read will be a header row.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#headers-instance_method" title="#headers (instance method)">#<strong>headers</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>nil</code> if headers will not be used, <code>true</code> if
they will but have not yet been read, or the actual headers after they have
been read.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#init_comments-instance_method" title="#init_comments (instance method)">#<strong>init_comments</strong>(options)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Stores the pattern of comments to skip from the provided options.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#init_converters-instance_method" title="#init_converters (instance method)">#<strong>init_converters</strong>(options, field_name = :converters)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Loads any converters requested during construction.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#init_headers-instance_method" title="#init_headers (instance method)">#<strong>init_headers</strong>(options)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Stores header row settings and loads header converters, if needed.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#init_parsers-instance_method" title="#init_parsers (instance method)">#<strong>init_parsers</strong>(options)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Pre-compiles parsers and stores them by name for access during reads.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#init_separators-instance_method" title="#init_separators (instance method)">#<strong>init_separators</strong>(options)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Stores the indicated separators for later use.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a simplified description of the key CSV attributes in an ASCII
compatible String.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#liberal_parsing%3F-instance_method" title="#liberal_parsing? (instance method)">#<strong>liberal_parsing?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if illegal input is handled.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#parse_headers-instance_method" title="#parse_headers (instance method)">#<strong>parse_headers</strong>(row = nil)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>This method is used to turn a finished <code>row</code> into a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#puts-instance_method" title="#puts (instance method)">#<strong>puts</strong>(row)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%3C%3C-instance_method" title="CSV#&lt;&lt; (method)">#&lt;&lt;</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#raw_encoding-instance_method" title="#raw_encoding (instance method)">#<strong>raw_encoding</strong>(default = Encoding::ASCII_8BIT)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the encoding of the internal IO object or the <code>default</code>
if the encoding cannot be determined.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#read-instance_method" title="#read (instance method)">#<strong>read</strong>  </a>
        (also: #readlines)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Slurps the remaining rows and returns an Array of Arrays.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#readline-instance_method" title="#readline (instance method)">#<strong>readline</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#shift-instance_method" title="CSV#shift (method)">#shift</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#readlines-instance_method" title="#readlines (instance method)">#<strong>readlines</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#read-instance_method" title="CSV#read (method)">#read</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#return_headers%3F-instance_method" title="#return_headers? (instance method)">#<strong>return_headers?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if headers will be returned as a row of results.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#rewind-instance_method" title="#rewind (instance method)">#<strong>rewind</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Rewinds the underlying IO object and resets CSV&#39;s lineno() counter.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#shift-instance_method" title="#shift (instance method)">#<strong>shift</strong>  </a>
        (also: #gets, #readline)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The primary read method for wrapped Strings and IOs, a single row is pulled
from the data source, parsed and returned as an Array of fields (if header
rows are not used) or a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a> (when header rows are used).</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#skip_blanks%3F-instance_method" title="#skip_blanks? (instance method)">#<strong>skip_blanks?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> blank lines are skipped by the parser.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unconverted_fields%3F-instance_method" title="#unconverted_fields? (instance method)">#<strong>unconverted_fields?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if unconverted_fields() to parsed results.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#write_headers%3F-instance_method" title="#write_headers? (instance method)">#<strong>write_headers?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if headers are written in output.</p>
</div>
      </span>
    </li>
  </ul>



  
  <h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(data, options = Hash.new)  &#x21d2; <tt><a href="" title="CSV (class)">CSV</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This constructor will wrap either a String or IO object passed in
<code>data</code> for reading and/or writing.  In addition to the CSV
instance methods, several IO methods are delegated.  (See CSV::open() for a
complete list.)  If you pass a String for <code>data</code>, you can later
retrieve it (after writing to it, for example) with CSV.string().</p>

<p>Note that a wrapped String will be positioned at the beginning (for
reading).  If you want it at the end (for writing), use CSV::generate(). If
you want any other positioning, pass a preset StringIO object instead.</p>

<p>You may set any reading and/or writing preferences in the
<code>options</code> Hash. Available options are:</p>
<dl class="rdoc-list note-list"><dt><strong><code>:col_sep</code></strong>
<dd>
<p>The String placed between each field. This String will be transcoded into
the data&#39;s Encoding before parsing.</p>
</dd><dt><strong><code>:row_sep</code></strong>
<dd>
<p>The String appended to the end of each row.  This can be set to the special
<code>:auto</code> setting, which requests that CSV automatically discover
this from the data.  Auto-discovery reads ahead in the data looking for the
next <code>&quot;\r\n&quot;</code>, <code>&quot;\n&quot;</code>, or
<code>&quot;\r&quot;</code> sequence.  A sequence will be selected even if
it occurs in a quoted field, assuming that you would have the same line
endings there.  If none of those sequences is found, <code>data</code> is
<code>ARGF</code>, <code>STDIN</code>, <code>STDOUT</code>, or
<code>STDERR</code>, or the stream is only available for output, the
default <code>$INPUT_RECORD_SEPARATOR</code> (<code>$/</code>) is used. 
Obviously, discovery takes a little time.  Set manually if speed is
important.  Also note that IO objects should be opened in binary mode on
Windows if this feature will be used as the line-ending translation can
cause problems with resetting the document position to where it was before
the read ahead. This String will be transcoded into the data&#39;s Encoding
before parsing.</p>
</dd><dt><strong><code>:quote_char</code></strong>
<dd>
<p>The character used to quote fields. This has to be a single character
String.  This is useful for application that incorrectly use
<code>&#39;</code> as the quote character instead of the correct
<code>&quot;</code>. CSV will always consider a double sequence of this
character to be an escaped quote. This String will be transcoded into the
data&#39;s Encoding before parsing.</p>
</dd><dt><strong><code>:field_size_limit</code></strong>
<dd>
<p>This is a maximum size CSV will read ahead looking for the closing quote
for a field.  (In truth, it reads to the first line ending beyond this
size.)  If a quote cannot be found within the limit CSV will raise a
MalformedCSVError, assuming the data is faulty.  You can use this limit to
prevent what are effectively DoS attacks on the parser.  However, this
limit can cause a legitimate parse to fail and thus is set to
<code>nil</code>, or off, by default.</p>
</dd><dt><strong><code>:converters</code></strong>
<dd>
<p>An Array of names from the Converters Hash and/or lambdas that handle
custom conversion.  A single converter doesn&#39;t have to be in an Array. 
All built-in converters try to transcode fields to UTF-8 before converting.
The conversion will fail if the data cannot be transcoded, leaving the
field unchanged.</p>
</dd><dt><strong><code>:unconverted_fields</code></strong>
<dd>
<p>If set to <code>true</code>, an unconverted_fields() method will be added
to all returned rows (Array or CSV::Row) that will return the fields as
they were before conversion.  Note that <code>:headers</code> supplied by
Array or String were not fields of the document and thus will have an empty
Array attached.</p>
</dd><dt><strong><code>:headers</code></strong>
<dd>
<p>If set to <code>:first_row</code> or <code>true</code>, the initial row of
the CSV file will be treated as a row of headers.  If set to an Array, the
contents will be used as the headers. If set to a String, the String is run
through a call of CSV::parse_line() with the same <code>:col_sep</code>,
<code>:row_sep</code>, and <code>:quote_char</code> as this instance to
produce an Array of headers.  This setting causes CSV#shift() to return
rows as CSV::Row objects instead of Arrays and CSV#read() to return
CSV::Table objects instead of an Array of Arrays.</p>
</dd><dt><strong><code>:return_headers</code></strong>
<dd>
<p>When <code>false</code>, header rows are silently swallowed.  If set to
<code>true</code>, header rows are returned in a CSV::Row object with
identical headers and fields (save that the fields do not go through the
converters).</p>
</dd><dt><strong><code>:write_headers</code></strong>
<dd>
<p>When <code>true</code> and <code>:headers</code> is set, a header row will
be added to the output.</p>
</dd><dt><strong><code>:header_converters</code></strong>
<dd>
<p>Identical in functionality to <code>:converters</code> save that the
conversions are only made to header rows.  All built-in converters try to
transcode headers to UTF-8 before converting.  The conversion will fail if
the data cannot be transcoded, leaving the header unchanged.</p>
</dd><dt><strong><code>:skip_blanks</code></strong>
<dd>
<p>When set to a <code>true</code> value, CSV will skip over any empty rows.
Note that this setting will not skip rows that contain column separators,
even if the rows contain no actual data. If you want to skip rows that
contain separators but no content, consider using <code>:skip_lines</code>,
or inspecting fields.compact.empty? on each row.</p>
</dd><dt><strong><code>:force_quotes</code></strong>
<dd>
<p>When set to a <code>true</code> value, CSV will quote all CSV fields it
creates.</p>
</dd><dt><strong><code>:skip_lines</code></strong>
<dd>
<p>When set to an object responding to <code>match</code>, every line matching
it is considered a comment and ignored during parsing. When set to a
String, it is first converted to a Regexp. When set to <code>nil</code> no
line is considered a comment. If the passed object does not respond to
<code>match</code>, <code>ArgumentError</code> is thrown.</p>
</dd><dt><strong><code>:liberal_parsing</code></strong>
<dd>
<p>When set to a <code>true</code> value, CSV will attempt to parse input not
conformant with RFC 4180, such as double quotes in unquoted fields.</p>
</dd></dl>

<p>See <a href="#DEFAULT_OPTIONS-constant" title="CSV::DEFAULT_OPTIONS (constant)">DEFAULT_OPTIONS</a> for the default settings.</p>

<p>Options cannot be overridden in the instance methods for performance
reasons, so be sure to set what you want here.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1515</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot parse nil as CSV</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># build the options for this read/write
</span>  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='comment'># create the IO object we will read from
</span>  <span class='ivar'>@io</span>       <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_data'>data</span>
  <span class='comment'># honor the IO encoding if we can, otherwise default to ASCII-8BIT
</span>  <span class='ivar'>@encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_encoding'>raw_encoding</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='op'>||</span>
              <span class='lparen'>(</span> <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:internal_encoding</span><span class='rparen'>)</span>
                  <span class='kw'>case</span> <span class='id identifier rubyid_encoding'>encoding</span>
                  <span class='kw'>when</span> <span class='const'>Encoding</span><span class='semicolon'>;</span> <span class='id identifier rubyid_encoding'>encoding</span>
                  <span class='kw'>else</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
                  <span class='kw'>end</span>
                <span class='kw'>end</span> <span class='rparen'>)</span> <span class='op'>||</span>
              <span class='lparen'>(</span> <span class='kw'>case</span> <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>
                <span class='kw'>when</span> <span class='const'>Encoding</span><span class='semicolon'>;</span> <span class='id identifier rubyid_encoding'>encoding</span>
                <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A[^:]+</span><span class='regexp_end'>/</span></span><span class='semicolon'>;</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='backref'>$&amp;</span><span class='rparen'>)</span>
                <span class='kw'>end</span> <span class='rparen'>)</span> <span class='op'>||</span>
              <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_default_internal'>default_internal</span> <span class='op'>||</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_default_external'>default_external</span>
  <span class='comment'>#
</span>  <span class='comment'># prepare for building safe regular expressions in the target encoding,
</span>  <span class='comment'># if we can transcode the needed characters
</span>  <span class='comment'>#
</span>  <span class='ivar'>@re_esc</span>   <span class='op'>=</span>   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span> <span class='kw'>rescue</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@re_chars</span> <span class='op'>=</span>   <span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='tstring'><span class='tstring_beg'>%&quot;</span><span class='tstring_content'>[-\\]\\[\\.^$?*+{}()|# \r\n\t\f\v]</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='regexp_end'>/</span></span>

  <span class='id identifier rubyid_init_separators'>init_separators</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_parsers'>init_parsers</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_converters'>init_converters</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_headers'>init_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_comments'>init_comments</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='ivar'>@force_encoding</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:internal_encoding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:external_encoding</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown options:  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># track our own lineno since IO gets confused about line-ends is CSV fields
</span>  <span class='ivar'>@lineno</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Attribute Details</h2>
  <section class='method_details first' id="col_sep-instance_method">
  <h3 class='signature first'>
  #<strong>col_sep</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The encoded <code>:col_sep</code> used in parsing and writing.  See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1566</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1566</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:col_sep</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="encoding-instance_method">
  <h3 class='signature'>
  #<strong>encoding</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The Encoding CSV is parsing or writing in.  This will be the Encoding you
receive parsed data in and/or the Encoding data will be written in.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1639</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1639</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:encoding</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="field_size_limit-instance_method">
  <h3 class='signature'>
  #<strong>field_size_limit</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The limit for field size, if any.  See <a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1578</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1578</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:field_size_limit</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="lineno-instance_method">
  <h3 class='signature'>
  #<strong>lineno</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The line number of the last row read from this file.  Fields with nested
line-end characters will not affect this count.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1645</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1645</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:lineno</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="quote_char-instance_method">
  <h3 class='signature'>
  #<strong>quote_char</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The encoded <code>:quote_char</code> used in parsing and writing.  See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1576</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1576</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:quote_char</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="row_sep-instance_method">
  <h3 class='signature'>
  #<strong>row_sep</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The encoded <code>:row_sep</code> used in parsing and writing.  See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1571</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1571</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:row_sep</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="skip_lines-instance_method">
  <h3 class='signature'>
  #<strong>skip_lines</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The regex marking a line as a comment. See <a href="#new-class_method" title="CSV.new (method)">new</a> for details</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1581</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1581</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:skip_lines</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="filter-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>filter</strong>(options = Hash.new) {|row| ... } </span>
    <span class='overload'>.<strong>filter</strong>(input, options = Hash.new) {|row| ... } </span>
    <span class='overload'>.<strong>filter</strong>(input, output, options = Hash.new) {|row| ... } </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is a convenience for building Unix-like filters for CSV data.
Each row is yielded to the provided block which can alter it as needed.
After the block returns, the row is appended to <code>output</code> altered
or not.</p>

<p>The <code>input</code> and <code>output</code> arguments can be anything
CSV::new() accepts (generally String or IO objects).  If not given, they
default to <code>ARGF</code> and <code>$stdout</code>.</p>

<p>The <code>options</code> parameter is also filtered down to CSV::new()
after some clever key parsing.  Any key beginning with <code>:in_</code> or
<code>:input_</code> will have that leading identifier stripped and will
only be used in the <code>options</code> Hash for the <code>input</code>
object.  Keys starting with <code>:out_</code> or <code>:output_</code>
affect only <code>output</code>.  All other keys are assigned to both
objects.</p>

<p>The <code>:output_row_sep</code> <code>option</code> defaults to
<code>$INPUT_RECORD_SEPARATOR</code> (<code>$/</code>).</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1090</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_filter'>filter</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='comment'># parse options for input, output, or both
</span>  <span class='id identifier rubyid_in_options'>in_options</span><span class='comma'>,</span> <span class='id identifier rubyid_out_options'>out_options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>row_sep:</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span><span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span>
    <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ain(?:put)?_(.+)\Z</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_in_options'>in_options</span><span class='lbracket'>[</span><span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aout(?:put)?_(.+)\Z</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_out_options'>out_options</span><span class='lbracket'>[</span><span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_in_options'>in_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
        <span class='id identifier rubyid_out_options'>out_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'># build input and output wrappers
</span>  <span class='id identifier rubyid_input'>input</span>  <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='op'>||</span> <span class='const'>ARGF</span><span class='comma'>,</span>    <span class='id identifier rubyid_in_options'>in_options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='op'>||</span> <span class='gvar'>$stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_out_options'>out_options</span><span class='rparen'>)</span>

  <span class='comment'># read, yield, write
</span>  <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_row'>row</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="foreach-class_method">
  <h3 class='signature'>
  .<strong>foreach</strong>(path, options = Hash.new, &amp;block)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is intended as the primary interface for reading CSV files. 
You pass a <code>path</code> and any <code>options</code> you wish to set
for the read.  Each row of file will be passed to the provided
<code>block</code> in turn.</p>

<p>The <code>options</code> parameter can be anything CSV::new() understands. 
This method also understands an additional <code>:encoding</code> parameter
that you can use to specify the Encoding of the data in the file to be
read. You must provide this unless your data is in
Encoding::default_external().  CSV will use this to determine how to parse
the data.  You may provide a second Encoding to have the data transcoded as
it is read.  For example, <code>encoding: &quot;UTF-32BE:UTF-8&quot;</code>
would read UTF-32BE data from the file but transcode it to UTF-8 before CSV
parses it.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1131
1132
1133
1134
1135
1136</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1131</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_to_enum'>to_enum</span><span class='lparen'>(</span><span class='id identifier rubyid___method__'>__method__</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>
    <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="generate-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>generate</strong>(str, options = Hash.new) {|csv| ... } </span>
    <span class='overload'>.<strong>generate</strong>(options = Hash.new) {|csv| ... } </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method wraps a String you provide, or an empty default String, in a
CSV object which is passed to the provided block.  You can use the block to
append CSV rows to the String and when the block exits, the final String
will be returned.</p>

<p>Note that a passed String <strong>is</strong> modified by this method. 
Call dup() before passing if you need a new String.</p>

<p>The <code>options</code> parameter can be anything CSV::new() understands. 
This method understands an additional <code>:encoding</code> parameter when
not passed a String to set the base Encoding for the output.  CSV needs
this hint if you plan to output non-ASCII compatible data.</p>


  </div>
</div>
<div class="tags">
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<tt>csv</tt>)</span>
  </li>
</ul>

</div><div class='source_code h'>
  <pre class='lines_num'>


1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1156</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='comment'># add a default empty String, if none was given
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>
    <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_END</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:encoding</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_str'>str</span>      <span class='op'>=</span> <span class='const'>String</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>
    <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>  <span class='comment'># wrap
</span>  <span class='kw'>yield</span> <span class='id identifier rubyid_csv'>csv</span>         <span class='comment'># yield for appending
</span>  <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>        <span class='comment'># return final String
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="generate_line-class_method">
  <h3 class='signature'>
  .<strong>generate_line</strong>(row, options = Hash.new)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is a shortcut for converting a single row (Array) into a CSV
String.</p>

<p>The <code>options</code> parameter can be anything CSV::new() understands. 
This method understands an additional <code>:encoding</code> parameter to
set the base Encoding for the output.  This method will try to guess your
Encoding from the first non-<code>nil</code> field in <code>row</code>, if
possible, but you may need to use this parameter as a backup plan.</p>

<p>The <code>:row_sep</code> <code>option</code> defaults to
<code>$INPUT_RECORD_SEPARATOR</code> (<code>$/</code>) when calling this
method.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1186</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_line'>generate_line</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>row_sep:</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_str'>str</span>      <span class='op'>=</span> <span class='const'>String</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>
    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='kw'>not</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='const'>String</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="instance-class_method">
  <h3 class='signature'>
  .<strong>instance</strong>(data = $stdout, options = Hash.new)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method will return a CSV instance, just like CSV::new(), but the
instance will be cached and returned for all future calls to this method
for the same <code>data</code> object (tested by <code>Object#object_id(</code>)) with
the same <code>options</code>.</p>

<p>If a block is given, the instance is passed to the block and the return
value becomes the return value of the block.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1050</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='gvar'>$stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='comment'># create a _signature_ for this method call, data object and options
</span>  <span class='id identifier rubyid_sig'>sig</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='rbracket'>]</span> <span class='op'>+</span>
        <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_sym'>sym</span><span class='op'>|</span> <span class='id identifier rubyid_sym'>sym</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># fetch or create the instance for this signature
</span>  <span class='cvar'>@@instances</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_instance'>instance</span>    <span class='op'>=</span>   <span class='lparen'>(</span><span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id identifier rubyid_sig'>sig</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_instance'>instance</span>  <span class='comment'># run block, if given, returning result
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_instance'>instance</span>        <span class='comment'># or return the instance
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="open-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>open</strong>(filename, mode = &quot;rb&quot;, options = Hash.new) {|faster_csv| ... } </span>
    <span class='overload'>.<strong>open</strong>(filename, options = Hash.new) {|faster_csv| ... } </span>
    <span class='overload'>.<strong>open</strong>(filename, mode = &quot;rb&quot;, options = Hash.new)  </span>
    <span class='overload'>.<strong>open</strong>(filename, options = Hash.new)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method opens an IO object, and wraps that with CSV.  This is intended
as the primary interface for writing a CSV file.</p>

<p>You must pass a <code>filename</code> and may optionally add a
<code>mode</code> for Ruby&#39;s open().  You may also pass an optional
Hash containing any <code>options</code> CSV::new() understands as the
final argument.</p>

<p>This method works like Ruby&#39;s open() call, in that it will pass a CSV
object to a provided block and close it when the block terminates, or it
will return the CSV object when no block is provided. 
(<strong>Note</strong>: This is different from the Ruby 1.8 CSV library
which passed rows to the block.  Use CSV::foreach() for that behavior.)</p>

<p>You must provide a <code>mode</code> with an embedded Encoding designator
unless your data is in Encoding::default_external().  CSV will check the
Encoding of the underlying IO object (set by the <code>mode</code> you
pass) to determine how to parse the data.   You may provide a second
Encoding to have the data transcoded as it is read just as you can with a
normal call to IO::open().  For example,
<code>&quot;rb:UTF-32BE:UTF-8&quot;</code> would read UTF-32BE data from
the file but transcode it to UTF-8 before CSV parses it.</p>

<p>An opened CSV object will delegate to many IO methods for convenience.  You
may call:</p>
<ul><li>
<p>binmode()</p>
</li><li>
<p>binmode?()</p>
</li><li>
<p>close()</p>
</li><li>
<p>close_read()</p>
</li><li>
<p>close_write()</p>
</li><li>
<p>closed?()</p>
</li><li>
<p>eof()</p>
</li><li>
<p>eof?()</p>
</li><li>
<p>external_encoding()</p>
</li><li>
<p>fcntl()</p>
</li><li>
<p>fileno()</p>
</li><li>
<p>flock()</p>
</li><li>
<p>flush()</p>
</li><li>
<p>fsync()</p>
</li><li>
<p>internal_encoding()</p>
</li><li>
<p>ioctl()</p>
</li><li>
<p>isatty()</p>
</li><li>
<p>path()</p>
</li><li>
<p>pid()</p>
</li><li>
<p>pos()</p>
</li><li>
<p>pos=()</p>
</li><li>
<p>reopen()</p>
</li><li>
<p>seek()</p>
</li><li>
<p>stat()</p>
</li><li>
<p>sync()</p>
</li><li>
<p>sync=()</p>
</li><li>
<p>tell()</p>
</li><li>
<p>to_i()</p>
</li><li>
<p>to_io()</p>
</li><li>
<p>truncate()</p>
</li><li>
<p>tty?()</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1261</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='comment'># find the options Hash
</span>  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span> <span class='kw'>then</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span> <span class='kw'>else</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>end</span>
  <span class='comment'># wrap a File opened with the remaining args with no newline
</span>  <span class='comment'># decorator
</span>  <span class='id identifier rubyid_file_opts'>file_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>universal_newline:</span> <span class='kw'>false</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_file_opts'>file_opts</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>unless</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>needs binmode</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span> <span class='kw'>and</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='id identifier rubyid_args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_file_opts'>file_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>encoding:</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_default_external'>default_external</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_file_opts'>file_opts</span><span class='rparen'>)</span>
    <span class='kw'>retry</span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  <span class='comment'># handle blocks like Ruby&#39;s open(), not like the CSV library
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_csv'>csv</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_csv'>csv</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="parse-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>parse</strong>(str, options = Hash.new) {|row| ... } </span>
    <span class='overload'>.<strong>parse</strong>(str, options = Hash.new)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method can be used to easily parse CSV out of a String.  You may
either provide a <code>block</code> which will be called with each row of
the String in turn, or just use the returned Array of Arrays (when no
<code>block</code> is given).</p>

<p>You pass your <code>str</code> to read from, and an optional
<code>options</code> Hash containing anything CSV::new() understands.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1306</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>  <span class='comment'># slurp contents, if no block is given
</span>    <span class='kw'>begin</span>
      <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>           <span class='comment'># or pass each row to a provided block
</span>    <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="parse_line-class_method">
  <h3 class='signature'>
  .<strong>parse_line</strong>(line, options = Hash.new)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is a shortcut for converting a single line of a CSV String into
an Array.  Note that if <code>line</code> contains multiple rows, anything
beyond the first row is ignored.</p>

<p>The <code>options</code> parameter can be anything CSV::new() understands.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1326
1327
1328</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1326</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_line'>parse_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="read-class_method">
  <h3 class='signature'>
  .<strong>read</strong>(path, *options)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Use to slurp a CSV file into an Array of Arrays.  Pass the
<code>path</code> to the file and any <code>options</code> CSV::new()
understands.  This method also understands an additional
<code>:encoding</code> parameter that you can use to specify the Encoding
of the data in the file to be read. You must provide this unless your data
is in Encoding::default_external().  CSV will use this to determine how to
parse the data.  You may provide a second Encoding to have the data
transcoded as it is read.  For example, <code>encoding:
&quot;UTF-32BE:UTF-8&quot;</code> would read UTF-32BE data from the file
but transcode it to UTF-8 before CSV parses it.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1341
1342
1343</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1341</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="readlines-class_method">
  <h3 class='signature'>
  .<strong>readlines</strong>(*args)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for CSV::read().</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1346
1347
1348</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1346</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_readlines'>readlines</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="table-class_method">
  <h3 class='signature'>
  .<strong>table</strong>(path, options = Hash.new)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>A shortcut for:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>headers:</span>           <span class='kw'>true</span><span class='comma'>,</span>
                  <span class='label'>converters:</span>        <span class='symbol'>:numeric</span><span class='comma'>,</span>
                  <span class='label'>header_converters:</span> <span class='symbol'>:symbol</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1357
1358
1359
1360
1361</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1357</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table'>table</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>headers:</span>           <span class='kw'>true</span><span class='comma'>,</span>
                <span class='label'>converters:</span>        <span class='symbol'>:numeric</span><span class='comma'>,</span>
                <span class='label'>header_converters:</span> <span class='symbol'>:symbol</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="<<-instance_method">
  <h3 class='signature first'>
  #<strong>&lt;&lt;</strong>(row)  
  <span class='aliases'>Also known as: <span class='names'><span>add_row</span>, <span>puts</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The primary write method for wrapped Strings and IOs, <code>row</code> (an
Array or CSV::Row) is converted to CSV and appended to the data source. 
When a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a> is passed, only the row&#39;s fields() are appended to
the output.</p>

<p>The data source must be open for writing.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1674</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='rparen'>)</span>
  <span class='comment'># make sure headers have been assigned
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_header_row?'>header_row?</span> <span class='kw'>and</span> <span class='lbracket'>[</span><span class='const'>Array</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@use_headers</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span>
    <span class='id identifier rubyid_parse_headers'>parse_headers</span>  <span class='comment'># won&#39;t read data for Array or String
</span>    <span class='kw'>self</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@headers</span> <span class='kw'>if</span> <span class='ivar'>@write_headers</span>
  <span class='kw'>end</span>

  <span class='comment'># handle CSV::Row objects and Hashes
</span>  <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_row'>row</span>
        <span class='kw'>when</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>Row</span> <span class='kw'>then</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span>
        <span class='kw'>when</span> <span class='const'>Hash</span>            <span class='kw'>then</span> <span class='ivar'>@headers</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_header'>header</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
        <span class='kw'>else</span>                      <span class='id identifier rubyid_row'>row</span>
        <span class='kw'>end</span>

  <span class='ivar'>@headers</span> <span class='op'>=</span>  <span class='id identifier rubyid_row'>row</span> <span class='kw'>if</span> <span class='id identifier rubyid_header_row?'>header_row?</span>
  <span class='ivar'>@lineno</span>  <span class='op'>+=</span> <span class='int'>1</span>

  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='ivar'>@quote</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@col_sep</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='ivar'>@row_sep</span>  <span class='comment'># quote and separate
</span>  <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>StringIO</span><span class='rparen'>)</span>             <span class='kw'>and</span>
     <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>!=</span> <span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_encoding'>raw_encoding</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@force_encoding</span>
      <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_compatible_encoding'>compatible_encoding</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_compatible?'>compatible?</span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_set_encoding'>set_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_compatible_encoding'>compatible_encoding</span><span class='rparen'>)</span>
      <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_END</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@io</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_output'>output</span>

  <span class='kw'>self</span>  <span class='comment'># for chaining
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_converter-instance_method">
  <h3 class='signature'>
  #<strong>add_converter</strong>(var_name, const, name = nil, &amp;converter)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The actual work method for adding converters, used by both CSV.convert()
and CSV.header_convert().</p>

<p>This method requires the <code>var_name</code> of the instance variable to
place the converters in, the <code>const</code> Hash to lookup named
converters in, and the normal parameters of the CSV.convert() and
CSV.header_convert() methods.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2190
2191
2192
2193
2194
2195
2196
2197
2198
2199
2200
2201
2202
2203
2204</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_converter'>add_converter</span><span class='lparen'>(</span><span class='id identifier rubyid_var_name'>var_name</span><span class='comma'>,</span> <span class='id identifier rubyid_const'>const</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>  <span class='comment'># custom converter
</span>    <span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_name'>var_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_converter'>converter</span>
  <span class='kw'>else</span>          <span class='comment'># named converter
</span>    <span class='id identifier rubyid_combo'>combo</span> <span class='op'>=</span> <span class='id identifier rubyid_const'>const</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_combo'>combo</span>
    <span class='kw'>when</span> <span class='const'>Array</span>  <span class='comment'># combo converter
</span>      <span class='id identifier rubyid_combo'>combo</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_converter_name'>converter_name</span><span class='op'>|</span>
        <span class='id identifier rubyid_add_converter'>add_converter</span><span class='lparen'>(</span><span class='id identifier rubyid_var_name'>var_name</span><span class='comma'>,</span> <span class='id identifier rubyid_const'>const</span><span class='comma'>,</span> <span class='id identifier rubyid_converter_name'>converter_name</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>        <span class='comment'># individual named converter
</span>      <span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_var_name'>var_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_combo'>combo</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="add_row-instance_method">
  <h3 class='signature'>
  #<strong>add_row</strong>(row)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%3C%3C-instance_method" title="CSV#&lt;&lt; (method)">#&lt;&lt;</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="add_unconverted_fields-instance_method">
  <h3 class='signature'>
  #<strong>add_unconverted_fields</strong>(row, fields)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method injects an instance variable <code>unconverted_fields</code>
into <code>row</code> and an accessor method for <code>row</code> called
unconverted_fields().  The variable is set to the contents of
<code>fields</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2277
2278
2279
2280
2281
2282
2283</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='id identifier rubyid_fields'>fields</span><span class='rparen'>)</span>
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span>
    <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:unconverted_fields</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_instance_eval'>instance_eval</span> <span class='lbrace'>{</span> <span class='ivar'>@unconverted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_fields'>fields</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_row'>row</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="convert-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>convert</strong>(name)  </span>
    <span class='overload'>#<strong>convert</strong> {|field| ... } </span>
    <span class='overload'>#<strong>convert</strong> {|field, field_info| ... } </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>You can use this method to install a <a href="#Converters-constant" title="CSV::Converters (constant)">Converters</a> built-in, or provide
a block that handles a custom conversion.</p>

<p>If you provide a block that takes one argument, it will be passed the field
and is expected to return the converted value or the field itself.  If your
block takes two arguments, it will also be passed a <a href="CSV/FieldInfo.html" title="CSV::FieldInfo (class)">FieldInfo</a>
Struct, containing details about the field.  Again, the block should return
a converted field or the field itself.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1723
1724
1725</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1723</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_converter'>add_converter</span><span class='lparen'>(</span><span class='symbol'>:converters</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>Converters</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="convert_fields-instance_method">
  <h3 class='signature'>
  #<strong>convert_fields</strong>(fields, headers = false)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Processes <code>fields</code> with <code>@converters</code>, or
<code>@header_converters</code> if <code>headers</code> is passed as
<code>true</code>, returning the converted field set.  Any converter that
changes the field into something other than a String halts the pipeline of
conversion for that field.  This is primarily an efficiency shortcut.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2213
2214
2215
2216
2217
2218
2219
2220
2221
2222
2223
2224
2225
2226
2227
2228
2229
2230</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert_fields'>convert_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_fields'>fields</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='comment'># see if we are converting headers or fields
</span>  <span class='id identifier rubyid_converters'>converters</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span> <span class='op'>?</span> <span class='ivar'>@header_converters</span> <span class='op'>:</span> <span class='ivar'>@converters</span>

  <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='id identifier rubyid_converters'>converters</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_converter'>converter</span><span class='op'>|</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_converter'>converter</span><span class='period'>.</span><span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>1</span>  <span class='comment'># straight field converter
</span>        <span class='id identifier rubyid_converter'>converter</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>                             <span class='comment'># FieldInfo converter
</span>        <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='ivar'>@use_headers</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_headers'>headers</span> <span class='op'>?</span> <span class='ivar'>@headers</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_converter'>converter</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='const'>FieldInfo</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='id identifier rubyid_header'>header</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
      <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>  <span class='comment'># short-circuit pipeline for speed
</span>    <span class='kw'>end</span>
    <span class='id identifier rubyid_field'>field</span>  <span class='comment'># final state of each field, converted or original
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="converters-instance_method">
  <h3 class='signature'>
  #<strong>converters</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the current list of converters in effect.  See <a href="#new-class_method" title="CSV.new (method)">new</a> for
details. Built-in converters will be returned by name, while others will be
returned as is.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1588
1589
1590
1591
1592
1593</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1588</span>

<span class='kw'>def</span> <span class='id identifier rubyid_converters'>converters</span>
  <span class='ivar'>@converters</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_converter'>converter</span><span class='op'>|</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='const'>Converters</span><span class='period'>.</span><span class='id identifier rubyid_rassoc'>rassoc</span><span class='lparen'>(</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_converter'>converter</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="each-instance_method">
  <h3 class='signature'>
  #<strong>each</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Yields each row of the data source in turn.</p>

<p>Support for Enumerable.</p>

<p>The data source must be open for reading.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1754
1755
1756
1757
1758
1759
1760
1761
1762</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1754</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='id identifier rubyid_shift'>shift</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_row'>row</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_to_enum'>to_enum</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="encode_re-instance_method">
  <h3 class='signature'>
  #<strong>encode_re</strong>(*chunks)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Builds a regular expression in <code>@encoding</code>.  All
<code>chunks</code> will be transcoded to that encoding.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2300
2301
2302</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_chunks'>chunks</span><span class='rparen'>)</span>
  <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_encode_str'>encode_str</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_chunks'>chunks</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="encode_str-instance_method">
  <h3 class='signature'>
  #<strong>encode_str</strong>(*chunks)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Builds a String in <code>@encoding</code>.  All <code>chunks</code> will be
transcoded to that encoding.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2308
2309
2310</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_str'>encode_str</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_chunks'>chunks</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_chunks'>chunks</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="escape_re-instance_method">
  <h3 class='signature'>
  #<strong>escape_re</strong>(str)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is an encoding safe version of Regexp::escape().  It will
escape any characters that would change the meaning of a regular expression
in the encoding of <code>str</code>.  Regular expression characters that
cannot be transcoded to the target encoding will be skipped and no escaping
will be performed if a backslash cannot be transcoded.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2292
2293
2294</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2292</span>

<span class='kw'>def</span> <span class='id identifier rubyid_escape_re'>escape_re</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='ivar'>@re_chars</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='ivar'>@re_esc</span> <span class='op'>+</span> <span class='id identifier rubyid_c'>c</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="force_quotes?-instance_method">
  <h3 class='signature'>
  #<strong>force_quotes?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if all output fields are quoted. See <a href="#new-class_method" title="CSV.new (method)">new</a>
for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1631</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1631</span>

<span class='kw'>def</span> <span class='id identifier rubyid_force_quotes?'>force_quotes?</span><span class='lparen'>(</span><span class='rparen'>)</span>       <span class='ivar'>@force_quotes</span>       <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="gets-instance_method">
  <h3 class='signature'>
  #<strong>gets</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#shift-instance_method" title="CSV#shift (method)">#shift</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="header_convert-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>header_convert</strong>(name)  </span>
    <span class='overload'>#<strong>header_convert</strong> {|field| ... } </span>
    <span class='overload'>#<strong>header_convert</strong> {|field, field_info| ... } </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Identical to #convert(), but for header rows.</p>

<p>Note that this method must be called before header rows are read to have
any effect.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1738
1739
1740
1741
1742
1743</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1738</span>

<span class='kw'>def</span> <span class='id identifier rubyid_header_convert'>header_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_converter'>add_converter</span><span class='lparen'>(</span> <span class='symbol'>:header_converters</span><span class='comma'>,</span>
                 <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>HeaderConverters</span><span class='comma'>,</span>
                 <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
                 <span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span> <span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="header_converters-instance_method">
  <h3 class='signature'>
  #<strong>header_converters</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the current list of converters in effect for headers.  See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.  Built-in converters will be returned by name, while
others will be returned as is.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1619
1620
1621
1622
1623
1624</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1619</span>

<span class='kw'>def</span> <span class='id identifier rubyid_header_converters'>header_converters</span>
  <span class='ivar'>@header_converters</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_converter'>converter</span><span class='op'>|</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='const'>HeaderConverters</span><span class='period'>.</span><span class='id identifier rubyid_rassoc'>rassoc</span><span class='lparen'>(</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='id identifier rubyid_converter'>converter</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="header_row?-instance_method">
  <h3 class='signature'>
  #<strong>header_row?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if the next row read will be a header row.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1780
1781
1782</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1780</span>

<span class='kw'>def</span> <span class='id identifier rubyid_header_row?'>header_row?</span>
  <span class='ivar'>@use_headers</span> <span class='kw'>and</span> <span class='ivar'>@headers</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="headers-instance_method">
  <h3 class='signature'>
  #<strong>headers</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>nil</code> if headers will not be used, <code>true</code> if
they will but have not yet been read, or the actual headers after they have
been read.  See <a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1604
1605
1606</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1604</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headers'>headers</span>
  <span class='ivar'>@headers</span> <span class='op'>||</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="init_comments-instance_method">
  <h3 class='signature'>
  #<strong>init_comments</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Stores the pattern of comments to skip from the provided options.</p>

<p>The pattern must respond to <code>.match</code>, else ArgumentError is
raised. Strings are converted to a Regexp.</p>

<p>See also <a href="#new-class_method" title="CSV.new (method)">new</a></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2175
2176
2177
2178
2179
2180
2181</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_comments'>init_comments</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@skip_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:skip_lines</span><span class='rparen'>)</span>
  <span class='ivar'>@skip_lines</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@skip_lines</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@skip_lines</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>
  <span class='kw'>if</span> <span class='ivar'>@skip_lines</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='ivar'>@skip_lines</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:match</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:skip_lines has to respond to matches</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="init_converters-instance_method">
  <h3 class='signature'>
  #<strong>init_converters</strong>(options, field_name = :converters)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Loads any converters requested during construction.</p>

<p>If <code>field_name</code> is set <code>:converters</code> (the default)
field converters are set.  When <code>field_name</code> is
<code>:header_converters</code> header converters are added instead.</p>

<p>The <code>:unconverted_fields</code> option is also activated for
<code>:converters</code> calls, if requested.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2128
2129
2130
2131
2132
2133
2134
2135
2136
2137
2138
2139
2140
2141
2142
2143
2144
2145
2146
2147
2148
2149
2150
2151
2152
2153
2154
2155</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_converters'>init_converters</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_field_name'>field_name</span> <span class='op'>=</span> <span class='symbol'>:converters</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_field_name'>field_name</span> <span class='op'>==</span> <span class='symbol'>:converters</span>
    <span class='ivar'>@unconverted_fields</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:unconverted_fields</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field_name'>field_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>

  <span class='comment'># find the correct method to add the converters
</span>  <span class='id identifier rubyid_convert'>convert</span> <span class='op'>=</span> <span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>ers\Z</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='comment'># load converters
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='comment'># allow a single converter not wrapped in an Array
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='comment'># load each converter...
</span>    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_converter'>converter</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_converter'>converter</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Proc</span>  <span class='comment'># custom code block
</span>        <span class='id identifier rubyid_convert'>convert</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
      <span class='kw'>else</span>                     <span class='comment'># by name
</span>        <span class='id identifier rubyid_convert'>convert</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_converter'>converter</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_field_name'>field_name</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="init_headers-instance_method">
  <h3 class='signature'>
  #<strong>init_headers</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Stores header row settings and loads header converters, if needed.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2158
2159
2160
2161
2162
2163
2164
2165
2166
2167</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_headers'>init_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@use_headers</span>    <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:headers</span><span class='rparen'>)</span>
  <span class='ivar'>@return_headers</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:return_headers</span><span class='rparen'>)</span>
  <span class='ivar'>@write_headers</span>  <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:write_headers</span><span class='rparen'>)</span>

  <span class='comment'># headers must be delayed until shift(), in case they need a row of content
</span>  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_init_converters'>init_converters</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='symbol'>:header_converters</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="init_parsers-instance_method">
  <h3 class='signature'>
  #<strong>init_parsers</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Pre-compiles parsers and stores them by name for access during reads.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2096
2097
2098
2099
2100
2101
2102
2103
2104
2105
2106
2107
2108
2109
2110
2111
2112
2113
2114
2115
2116</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2096</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_parsers'>init_parsers</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='comment'># store the parser behaviors
</span>  <span class='ivar'>@skip_blanks</span>      <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:skip_blanks</span><span class='rparen'>)</span>
  <span class='ivar'>@field_size_limit</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:field_size_limit</span><span class='rparen'>)</span>
  <span class='ivar'>@liberal_parsing</span>  <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:liberal_parsing</span><span class='rparen'>)</span>

  <span class='comment'># prebuild Regexps for faster parsing
</span>  <span class='id identifier rubyid_esc_row_sep'>esc_row_sep</span> <span class='op'>=</span> <span class='id identifier rubyid_escape_re'>escape_re</span><span class='lparen'>(</span><span class='ivar'>@row_sep</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_esc_quote'>esc_quote</span>   <span class='op'>=</span> <span class='id identifier rubyid_escape_re'>escape_re</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span><span class='rparen'>)</span>
  <span class='ivar'>@parsers</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='comment'># for detecting parse errors
</span>    <span class='label'>quote_or_nl:</span>    <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_esc_quote'>esc_quote</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>nl_or_lf:</span>       <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[\r\n]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>stray_quote:</span>    <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[^</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_esc_quote'>esc_quote</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_esc_quote'>esc_quote</span><span class='comma'>,</span>
                               <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[^</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_esc_quote'>esc_quote</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span><span class='comma'>,</span>
    <span class='comment'># safer than chomp!()
</span>    <span class='label'>line_end:</span>       <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span><span class='id identifier rubyid_esc_row_sep'>esc_row_sep</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\z</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='comment'># illegal unquoted characters
</span>    <span class='label'>return_newline:</span> <span class='id identifier rubyid_encode_str'>encode_str</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="init_separators-instance_method">
  <h3 class='signature'>
  #<strong>init_separators</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Stores the indicated separators for later use.</p>

<p>If auto-discovery was requested for <code>@row_sep</code>, this method will
read ahead in the <code>@io</code> and try to find one.  <code>ARGF</code>, <code>STDIN</code>,
<code>STDOUT</code>, <code>STDERR</code> and any stream open for output only with a default
<code>@row_sep</code> of <code>$INPUT_RECORD_SEPARATOR</code>
(<code>$/</code>).</p>

<p>This method also establishes the quoting rules used for CSV output.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011
2012
2013
2014
2015
2016
2017
2018
2019
2020
2021
2022
2023
2024
2025
2026
2027
2028
2029
2030
2031
2032
2033
2034
2035
2036
2037
2038
2039
2040
2041
2042
2043
2044
2045
2046
2047
2048
2049
2050
2051
2052
2053
2054
2055
2056
2057
2058
2059
2060
2061
2062
2063
2064
2065
2066
2067
2068
2069
2070
2071
2072
2073
2074
2075
2076
2077
2078
2079
2080
2081
2082
2083
2084
2085
2086
2087
2088
2089
2090
2091
2092
2093</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1997</span>

<span class='kw'>def</span> <span class='id identifier rubyid_init_separators'>init_separators</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='comment'># store the selected separators
</span>  <span class='ivar'>@col_sep</span>    <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:col_sep</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span>
  <span class='ivar'>@row_sep</span>    <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:row_sep</span><span class='rparen'>)</span>  <span class='comment'># encode after resolving :auto
</span>  <span class='ivar'>@quote_char</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:quote_char</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='ivar'>@quote_char</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:quote_char has to be a single character String</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#
</span>  <span class='comment'># automatically discover row separator when requested
</span>  <span class='comment'># (not fully encoding safe)
</span>  <span class='comment'>#
</span>  <span class='kw'>if</span> <span class='ivar'>@row_sep</span> <span class='op'>==</span> <span class='symbol'>:auto</span>
    <span class='kw'>if</span> <span class='lbracket'>[</span><span class='const'>ARGF</span><span class='comma'>,</span> <span class='const'>STDIN</span><span class='comma'>,</span> <span class='const'>STDOUT</span><span class='comma'>,</span> <span class='const'>STDERR</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='ivar'>@io</span><span class='rparen'>)</span> <span class='kw'>or</span>
       <span class='lparen'>(</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Zlib</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'>Zlib</span><span class='op'>::</span><span class='const'>GzipWriter</span><span class='rparen'>)</span>
      <span class='ivar'>@row_sep</span> <span class='op'>=</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span>
    <span class='kw'>else</span>
      <span class='kw'>begin</span>
        <span class='comment'>#
</span>        <span class='comment'># remember where we were (pos() will raise an exception if @io is pipe
</span>        <span class='comment'># or not opened for reading)
</span>        <span class='comment'>#
</span>        <span class='id identifier rubyid_saved_pos'>saved_pos</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span>
        <span class='kw'>while</span> <span class='ivar'>@row_sep</span> <span class='op'>==</span> <span class='symbol'>:auto</span>
          <span class='comment'>#
</span>          <span class='comment'># if we run out of data, it&#39;s probably a single line
</span>          <span class='comment'># (ensure will set default value)
</span>          <span class='comment'>#
</span>          <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sample'>sample</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
          <span class='comment'># extend sample if we&#39;re unsure of the line ending
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_sample'>sample</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span> <span class='id identifier rubyid_encode_str'>encode_str</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='id identifier rubyid_sample'>sample</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>

          <span class='comment'># try to find a standard separator
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_sample'>sample</span> <span class='op'>=~</span> <span class='id identifier rubyid_encode_re'>encode_re</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n?|\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='ivar'>@row_sep</span> <span class='op'>=</span> <span class='backref'>$&amp;</span>
            <span class='kw'>break</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># tricky seek() clone to work around GzipReader&#39;s lack of seek()
</span>        <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
        <span class='comment'># reset back to the remembered position
</span>        <span class='kw'>while</span> <span class='id identifier rubyid_saved_pos'>saved_pos</span> <span class='op'>&gt;</span> <span class='int'>1024</span>  <span class='comment'># avoid loading a lot of data into memory
</span>          <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_saved_pos'>saved_pos</span> <span class='op'>-=</span> <span class='int'>1024</span>
        <span class='kw'>end</span>
        <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_saved_pos'>saved_pos</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_saved_pos'>saved_pos</span><span class='period'>.</span><span class='id identifier rubyid_nonzero?'>nonzero?</span>
      <span class='kw'>rescue</span> <span class='const'>IOError</span>         <span class='comment'># not opened for reading
</span>        <span class='comment'># do nothing:  ensure will set default
</span>      <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>   <span class='comment'># Zlib::GzipWriter doesn&#39;t have some IO methods
</span>        <span class='comment'># do nothing:  ensure will set default
</span>      <span class='kw'>rescue</span> <span class='const'>SystemCallError</span> <span class='comment'># pipe
</span>        <span class='comment'># do nothing:  ensure will set default
</span>      <span class='kw'>ensure</span>
        <span class='comment'>#
</span>        <span class='comment'># set default if we failed to detect
</span>        <span class='comment'># (stream not opened for reading, a pipe, or a single line of data)
</span>        <span class='comment'>#
</span>        <span class='ivar'>@row_sep</span> <span class='op'>=</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span> <span class='kw'>if</span> <span class='ivar'>@row_sep</span> <span class='op'>==</span> <span class='symbol'>:auto</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@row_sep</span> <span class='op'>=</span> <span class='ivar'>@row_sep</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span>

  <span class='comment'># establish quoting rules
</span>  <span class='ivar'>@force_quotes</span>   <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:force_quotes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_do_quote'>do_quote</span>        <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
    <span class='id identifier rubyid_field'>field</span>         <span class='op'>=</span> <span class='const'>String</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encoded_quote'>encoded_quote</span> <span class='op'>=</span> <span class='ivar'>@quote_char</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_encoded_quote'>encoded_quote</span>                                <span class='op'>+</span>
    <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_encoded_quote'>encoded_quote</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded_quote'>encoded_quote</span> <span class='op'>*</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>+</span>
    <span class='id identifier rubyid_encoded_quote'>encoded_quote</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_quotable_chars'>quotable_chars</span> <span class='op'>=</span> <span class='id identifier rubyid_encode_str'>encode_str</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@col_sep</span><span class='comma'>,</span> <span class='ivar'>@quote_char</span><span class='rparen'>)</span>
  <span class='ivar'>@quote</span>         <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@force_quotes</span>
    <span class='id identifier rubyid_do_quote'>do_quote</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>  <span class='comment'># represent nil fields as empty unquoted fields
</span>        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='const'>String</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>  <span class='comment'># Stringify fields
</span>        <span class='comment'># represent empty fields as empty quoted fields
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>or</span>
           <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='id identifier rubyid_quotable_chars'>quotable_chars</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nonzero?'>nonzero?</span>
          <span class='id identifier rubyid_do_quote'>do_quote</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_field'>field</span>  <span class='comment'># unquoted field
</span>        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="inspect-instance_method">
  <h3 class='signature'>
  #<strong>inspect</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a simplified description of the key CSV attributes in an ASCII
compatible String.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1950
1951
1952
1953
1954
1955
1956
1957
1958
1959
1960
1961
1962
1963
1964
1965
1966
1967
1968
1969
1970
1971
1972
1973
1974
1975
1976
1977
1978
1979
1980
1981
1982
1983</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1950</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;#</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> io_type:</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='comment'># show type of wrapped IO
</span>  <span class='kw'>if</span>    <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stdout</span> <span class='kw'>then</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stdout</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stdin</span>  <span class='kw'>then</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stdin</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stderr</span> <span class='kw'>then</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stderr</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>                      <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>
  <span class='comment'># show IO.path(), if available
</span>  <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> io_path:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
  <span class='kw'>end</span>
  <span class='comment'># show encoding
</span>  <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> encoding:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@encoding</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='comment'># show other attributes
</span>  <span class='qwords_beg'>%w[ </span><span class='tstring_content'>lineno</span><span class='words_sep'>     </span><span class='tstring_content'>col_sep</span><span class='words_sep'>     </span><span class='tstring_content'>row_sep</span><span class='words_sep'>
</span><span class='tstring_content'>      quote_char</span><span class='words_sep'> </span><span class='tstring_content'>skip_blanks</span><span class='words_sep'> </span><span class='tstring_content'>liberal_parsing</span><span class='words_sep'> ]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_attr_name'>attr_name</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
    <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> headers:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>  <span class='comment'># any encoding error
</span>    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>Converter</span><span class='period'>.</span><span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>?</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_encode'>encode</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ASCII-8BIT</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="liberal_parsing?-instance_method">
  <h3 class='signature'>
  #<strong>liberal_parsing?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if illegal input is handled. See <a href="#new-class_method" title="CSV.new (method)">new</a> for
details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1633</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1633</span>

<span class='kw'>def</span> <span class='id identifier rubyid_liberal_parsing?'>liberal_parsing?</span><span class='lparen'>(</span><span class='rparen'>)</span>    <span class='ivar'>@liberal_parsing</span>    <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="parse_headers-instance_method">
  <h3 class='signature'>
  #<strong>parse_headers</strong>(row = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>This method is used to turn a finished <code>row</code> into a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a>. 
Header rows are also dealt with here, either by returning a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a> with
identical headers and fields (save that the fields do not go through the
converters) or by reading past them to return a field row. Headers are also
saved in <code>@headers</code> for use in future rows.</p>

<p>When <code>nil</code>, <code>row</code> is assumed to be a header row not
based on an actual row of the stream.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2242
2243
2244
2245
2246
2247
2248
2249
2250
2251
2252
2253
2254
2255
2256
2257
2258
2259
2260
2261
2262
2263
2264
2265
2266
2267
2268
2269
2270</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_headers'>parse_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@headers</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>                <span class='comment'># header row
</span>    <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='ivar'>@use_headers</span>  <span class='comment'># save headers
</span>               <span class='comment'># Array of headers
</span>               <span class='kw'>when</span> <span class='const'>Array</span> <span class='kw'>then</span> <span class='ivar'>@use_headers</span>
               <span class='comment'># CSV header String
</span>               <span class='kw'>when</span> <span class='const'>String</span>
                 <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_parse_line'>parse_line</span><span class='lparen'>(</span> <span class='ivar'>@use_headers</span><span class='comma'>,</span>
                                        <span class='label'>col_sep:</span>    <span class='ivar'>@col_sep</span><span class='comma'>,</span>
                                        <span class='label'>row_sep:</span>    <span class='ivar'>@row_sep</span><span class='comma'>,</span>
                                        <span class='label'>quote_char:</span> <span class='ivar'>@quote_char</span> <span class='rparen'>)</span>
               <span class='comment'># first row is headers
</span>               <span class='kw'>else</span>            <span class='id identifier rubyid_row'>row</span>
               <span class='kw'>end</span>

    <span class='comment'># prepare converted and unconverted copies
</span>    <span class='id identifier rubyid_row'>row</span>      <span class='op'>=</span> <span class='ivar'>@headers</span>                       <span class='kw'>if</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='id identifier rubyid_convert_fields'>convert_fields</span><span class='lparen'>(</span><span class='ivar'>@headers</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='ivar'>@headers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span> <span class='kw'>if</span> <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span> <span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='ivar'>@return_headers</span>                                     <span class='comment'># return headers
</span>      <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>Row</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@headers</span><span class='comma'>,</span> <span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='kw'>not</span> <span class='lbracket'>[</span><span class='const'>Array</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@use_headers</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span>  <span class='comment'># skip to field row
</span>      <span class='kw'>return</span> <span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>Row</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@headers</span><span class='comma'>,</span> <span class='id identifier rubyid_convert_fields'>convert_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='rparen'>)</span><span class='rparen'>)</span>  <span class='comment'># field row
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="puts-instance_method">
  <h3 class='signature'>
  #<strong>puts</strong>(row)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%3C%3C-instance_method" title="CSV#&lt;&lt; (method)">#&lt;&lt;</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="raw_encoding-instance_method">
  <h3 class='signature'>
  #<strong>raw_encoding</strong>(default = Encoding::ASCII_8BIT)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the encoding of the internal IO object or the <code>default</code>
if the encoding cannot be determined.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


2318
2319
2320
2321
2322
2323
2324
2325
2326
2327
2328</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 2318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_raw_encoding'>raw_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_default'>default</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:internal_encoding</span>
    <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_internal_encoding'>internal_encoding</span> <span class='op'>||</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_external_encoding'>external_encoding</span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>StringIO</span>
    <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:encoding</span>
    <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_encoding'>encoding</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_default'>default</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="read-instance_method">
  <h3 class='signature'>
  #<strong>read</strong>  
  <span class='aliases'>Also known as: <span class='names'><span>readlines</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Slurps the remaining rows and returns an Array of Arrays.</p>

<p>The data source must be open for reading.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1769
1770
1771
1772
1773
1774
1775
1776</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1769</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read'>read</span>
  <span class='id identifier rubyid_rows'>rows</span> <span class='op'>=</span> <span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
    <span class='const'>Table</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_rows'>rows</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="readline-instance_method">
  <h3 class='signature'>
  #<strong>readline</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#shift-instance_method" title="CSV#shift (method)">#shift</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="readlines-instance_method">
  <h3 class='signature'>
  #<strong>readlines</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#read-instance_method" title="CSV#read (method)">#read</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="return_headers?-instance_method">
  <h3 class='signature'>
  #<strong>return_headers?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if headers will be returned as a row of results.
See <a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1611</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1611</span>

<span class='kw'>def</span> <span class='id identifier rubyid_return_headers?'>return_headers?</span><span class='lparen'>(</span><span class='rparen'>)</span>     <span class='ivar'>@return_headers</span>     <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="rewind-instance_method">
  <h3 class='signature'>
  #<strong>rewind</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Rewinds the underlying IO object and resets CSV&#39;s lineno() counter.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1658
1659
1660
1661
1662
1663</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1658</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rewind'>rewind</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@lineno</span>  <span class='op'>=</span> <span class='int'>0</span>

  <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="shift-instance_method">
  <h3 class='signature'>
  #<strong>shift</strong>  
  <span class='aliases'>Also known as: <span class='names'><span>gets</span>, <span>readline</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The primary read method for wrapped Strings and IOs, a single row is pulled
from the data source, parsed and returned as an Array of fields (if header
rows are not used) or a <a href="CSV/Row.html" title="CSV::Row (class)">Row</a> (when header rows are used).</p>

<p>The data source must be open for reading.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935
1936
1937
1938
1939
1940
1941
1942</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1791</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span>
  <span class='comment'>#########################################################################
</span>  <span class='comment'>### This method is purposefully kept a bit long as simple conditional ###
</span>  <span class='comment'>### checks are faster than numerous (expensive) method calls.         ###
</span>  <span class='comment'>#########################################################################
</span>
  <span class='comment'># handle headers not based on document content
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_header_row?'>header_row?</span> <span class='kw'>and</span> <span class='ivar'>@return_headers</span> <span class='kw'>and</span>
     <span class='lbracket'>[</span><span class='const'>Array</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@use_headers</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span>
    <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_parse_headers'>parse_headers</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_parse_headers'>parse_headers</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#
</span>  <span class='comment'># it can take multiple calls to &lt;tt&gt;@io.gets()&lt;/tt&gt; to get a full line,
</span>  <span class='comment'># because of \r and/or \n characters embedded in quoted fields
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_in_extended_col'>in_extended_col</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_csv'>csv</span>             <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='comment'># add another read to the line
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_parse'>parse</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='lparen'>(</span><span class='ivar'>@row_sep</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_parse'>parse</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:line_end</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'>#
</span>      <span class='comment'># I believe a blank line should be an &lt;tt&gt;Array.new&lt;/tt&gt;, not Ruby 1.8
</span>      <span class='comment'># CSV&#39;s &lt;tt&gt;[nil]&lt;/tt&gt;
</span>      <span class='comment'>#
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_parse'>parse</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='ivar'>@lineno</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>if</span> <span class='ivar'>@skip_blanks</span>
          <span class='kw'>next</span>
        <span class='kw'>elsif</span> <span class='ivar'>@unconverted_fields</span>
          <span class='kw'>return</span> <span class='id identifier rubyid_add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='ivar'>@use_headers</span>
          <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='op'>::</span><span class='const'>Row</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>next</span> <span class='kw'>if</span> <span class='ivar'>@skip_lines</span> <span class='kw'>and</span> <span class='ivar'>@skip_lines</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span> <span class='id identifier rubyid_parse'>parse</span>

    <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span>  <span class='id identifier rubyid_parse'>parse</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='ivar'>@col_sep</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_parts'>parts</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_in_extended_col'>in_extended_col</span>
        <span class='id identifier rubyid_csv'>csv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>   <span class='comment'># will be replaced with a @row_sep after the parts.each loop
</span>      <span class='kw'>else</span>
        <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># This loop is the hot path of csv parsing. Some things may be non-dry
</span>    <span class='comment'># for a reason. Make sure to benchmark when refactoring.
</span>    <span class='id identifier rubyid_parts'>parts</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_part'>part</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_in_extended_col'>in_extended_col</span>
        <span class='comment'># If we are continuing a previous column
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@quote_char</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
          <span class='comment'># extended column ends
</span>          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:stray_quote</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span>
                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing or stray quote in line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@quote_char</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_in_extended_col'>in_extended_col</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span>
          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>
        <span class='kw'>end</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@quote_char</span>
        <span class='comment'># If we are starting a new quoted column
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
          <span class='comment'># start an extended column
</span>          <span class='id identifier rubyid_csv'>csv</span>             <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>        <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>
          <span class='id identifier rubyid_in_extended_col'>in_extended_col</span> <span class='op'>=</span>  <span class='kw'>true</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@quote_char</span>
          <span class='comment'># regular quoted column
</span>          <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:stray_quote</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span>
                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing or stray quote in line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@quote_char</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='ivar'>@liberal_parsing</span>
          <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing or stray quote in line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_part'>part</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:quote_or_nl</span><span class='rbracket'>]</span>
        <span class='comment'># Unquoted field with bad characters.
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:nl_or_lf</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unquoted fields do not allow </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\r or \\n (line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
          <span class='kw'>if</span> <span class='ivar'>@liberal_parsing</span>
            <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Illegal quoting in line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='comment'># Regular ole unquoted field.
</span>        <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_part'>part</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Replace tacked on @col_sep with @row_sep if we are still in an extended
</span>    <span class='comment'># column.
</span>    <span class='id identifier rubyid_csv'>csv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@row_sep</span> <span class='kw'>if</span> <span class='id identifier rubyid_in_extended_col'>in_extended_col</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_in_extended_col'>in_extended_col</span>
      <span class='comment'># if we&#39;re at eof?(), a quoted field wasn&#39;t closed...
</span>      <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unclosed quoted field on line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>elsif</span> <span class='ivar'>@field_size_limit</span> <span class='kw'>and</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;=</span> <span class='ivar'>@field_size_limit</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Field size exceeded on line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='comment'># otherwise, we need to loop and pull some more data to complete the row
</span>    <span class='kw'>else</span>
      <span class='ivar'>@lineno</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='comment'># save fields unconverted fields, if needed...
</span>      <span class='id identifier rubyid_unconverted'>unconverted</span> <span class='op'>=</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span> <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span>

      <span class='comment'># convert fields, if needed...
</span>      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_convert_fields'>convert_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_csv'>csv</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@use_headers</span> <span class='kw'>or</span> <span class='ivar'>@converters</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'># parse out header rows and handle CSV::Row conversions...
</span>      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_headers'>parse_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_csv'>csv</span><span class='rparen'>)</span>  <span class='kw'>if</span>     <span class='ivar'>@use_headers</span>

      <span class='comment'># inject unconverted fields and accessor, if requested...
</span>      <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_csv'>csv</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:unconverted_fields</span>
        <span class='id identifier rubyid_add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_csv'>csv</span><span class='comma'>,</span> <span class='id identifier rubyid_unconverted'>unconverted</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># return the results
</span>      <span class='kw'>break</span> <span class='id identifier rubyid_csv'>csv</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="skip_blanks?-instance_method">
  <h3 class='signature'>
  #<strong>skip_blanks?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> blank lines are skipped by the parser. See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1629</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1629</span>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_blanks?'>skip_blanks?</span><span class='lparen'>(</span><span class='rparen'>)</span>        <span class='ivar'>@skip_blanks</span>        <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unconverted_fields?-instance_method">
  <h3 class='signature'>
  #<strong>unconverted_fields?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if unconverted_fields() to parsed results.  See
<a href="#new-class_method" title="CSV.new (method)">new</a> for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1598</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1598</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unconverted_fields?'>unconverted_fields?</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='ivar'>@unconverted_fields</span> <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="write_headers?-instance_method">
  <h3 class='signature'>
  #<strong>write_headers?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if headers are written in output. See <a href="#new-class_method" title="CSV.new (method)">new</a>
for details.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


1613</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'csv.rb', line 1613</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_headers?'>write_headers?</span><span class='lparen'>(</span><span class='rparen'>)</span>      <span class='ivar'>@write_headers</span>      <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.0 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>