<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: PTY &mdash; pty Ruby-2.4.0 d2016-07-21</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "PTY",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='index.html'>pty</a> &raquo; 
          <a href='_index.html'>Index (P)</a> &raquo; 
          <span class='title'>PTY</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: PTY</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>

  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">ChildExited</a>
    </td>
  </tr>




  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
pty/pty.c</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Creates and managed pseudo terminals (PTYs).  See also <a
href="http://en.wikipedia.org/wiki/Pseudo_terminal">en.wikipedia.org/wiki/Pseudo_terminal</a></p>

<p>PTY allows you to allocate new terminals using <a href="#open-class_method" title="PTY.open (method)">PTY.open</a> or <a href="#spawn-class_method" title="PTY.spawn (method)">PTY.spawn</a> a new
terminal with a specific command.</p>

<h4 id="label-Example">Example</h4>

<p>In this example we will change the buffering type in the
<code>factor</code> command, assuming that factor uses stdio for stdout
buffering.</p>

<p>If <code>IO.pipe</code> is used instead of <a href="#open-class_method" title="PTY.open (method)">PTY.open</a>, this code deadlocks because
factor&#39;s stdout is fully buffered.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># start by requiring the standard library PTY
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pty</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_master'>master</span><span class='comma'>,</span> <span class='id identifier rubyid_slave'>slave</span> <span class='op'>=</span> <span class='const'>PTY</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span>
<span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='id identifier rubyid_write'>write</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
<span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>factor</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='id identifier rubyid_slave'>slave</span><span class='rparen'>)</span>
<span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>        <span class='comment'># we dont need the read
</span><span class='id identifier rubyid_slave'>slave</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>    <span class='comment'># or the slave
</span>
<span class='comment'># pipe &quot;42&quot; to the factor command
</span><span class='id identifier rubyid_write'>write</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>42</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># output the response from factor
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_master'>master</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'>#=&gt; &quot;42: 2 3 7\n&quot;
</span>
<span class='comment'># pipe &quot;144&quot; to factor and print out the response
</span><span class='id identifier rubyid_write'>write</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>144</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_master'>master</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'>#=&gt; &quot;144: 2 2 2 2 3 3\n&quot;
</span><span class='id identifier rubyid_write'>write</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='comment'># close the pipe
</span>
<span class='comment'># The result of read operation when pty slave is closed is platform
</span><span class='comment'># dependent.
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='kw'>begin</span>
        <span class='id identifier rubyid_master'>master</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>     <span class='comment'># FreeBSD returns nil.
</span>      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EIO</span> <span class='comment'># GNU/Linux raises EIO.
</span>        <span class='kw'>nil</span>
      <span class='kw'>end</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ret'>ret</span> <span class='comment'>#=&gt; nil
</span></code></pre>

<h4 id="label-License">License</h4>

<pre class="code ruby"><code class="ruby">C) Copyright 1998 by Akinori Ito.

This software may be redistributed freely for this purpose, in full
or in part, provided that this entire copyright notice is included
on any copies of this software and applications and derivations thereof.

This software is provided on an &quot;as is&quot; basis, without warranty of any
kind, either expressed or implied, as to any matter including, but not
limited to warranty of fitness of purpose, or merchantability, or
results obtained from use of this software.</code></pre>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#check-class_method" title="check (class method)">.<strong>check</strong>(pid, raise = false)  &#x21d2; Process::Status<sup>?</sup> </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checks the status of the child process specified by <code>pid</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getpty-class_method" title="spawn (class method)">.<strong>spawn</strong>(command_line) {|r, w, pid| ... } </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#spawn-class_method" title="PTY.spawn (method)">PTY.spawn</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#open-class_method" title="open (class method)">.<strong>open</strong>  &#x21d2; Array, slave_file </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Allocates a pty (pseudo-terminal).</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#spawn-class_method" title="spawn (class method)">.<strong>spawn</strong>(command_line) {|r, w, pid| ... } </a>
        (also: .getpty)
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Spawns the specified command on a newly allocated pty.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="check-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>check</strong>(pid, raise = false)  &#x21d2; <tt>Process::Status</tt><sup>?</sup> </span>
    <span class='overload'>.<strong>check</strong>(pid, true)  &#x21d2; <tt>nil</tt>, <tt>raises <a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">PTY::ChildExited</a></tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checks the status of the child process specified by <code>pid</code>.
Returns <code>nil</code> if the process is still alive.</p>

<p>If the process is not alive, and <code>raise</code> was true, a
<a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">ChildExited</a> exception will be raised. Otherwise it will return a
<code>Process::Status</code> instance.</p>
<dl class="rdoc-list note-list"><dt><code>pid</code>
<dd>
<p>The process id of the process to check</p>
</dd><dt><code>raise</code>
<dd>
<p>If <code>true</code> and the process identified by <code>pid</code> is no
longer</p>
</dd></dl>

<pre class="code ruby"><code class="ruby">alive a PTY::ChildExited is raised.</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'pty/pty.c', line 673</span>

static VALUE
pty_check(int argc, VALUE *argv, VALUE self)
{
    VALUE pid, exc;
    rb_pid_t cpid;
    int status;
    const int flag =
#ifdef WNOHANG
	WNOHANG|
#endif
#ifdef WUNTRACED
	WUNTRACED|
#endif
	0;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;pid, &amp;exc);
    cpid = rb_waitpid(NUM2PIDT(pid), &amp;status, flag);
    if (cpid == -1 || cpid == 0) return Qnil;

    if (!RTEST(exc)) return rb_last_status_get();
    raise_from_check(cpid, status);

    UNREACHABLE;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getpty-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>spawn</strong>(command_line) {|r, w, pid| ... }  <span class="extras">(mod_func)</span></span>
    <span class='overload'>.<strong>spawn</strong>(command_line)  &#x21d2; <tt>Array</tt>, ... </span>
    <span class='overload'>.<strong>spawn</strong>(command, arguments, ...) {|r, w, pid| ... } </span>
    <span class='overload'>.<strong>spawn</strong>(command, arguments, ...)  &#x21d2; <tt>Array</tt>, ... </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#spawn-class_method" title="PTY.spawn (method)">spawn</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="open-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>open</strong>  &#x21d2; <tt>Array</tt>, <tt>slave_file</tt> </span>
    <span class='overload'>.<strong>open</strong> {|master_io, slave_file| ... } &#x21d2; <tt>block value</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Allocates a pty (pseudo-terminal).</p>

<p>In the block form, yields two arguments <code>master_io, slave_file</code>
and the value of the block is returned from <code>open</code>.</p>

<p>The IO and File are both closed after the block completes if they
haven&#39;t been already closed.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>PTY</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_master'>master</span><span class='comma'>,</span> <span class='id identifier rubyid_slave'>slave</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_master'>master</span>      <span class='comment'>#=&gt; #&lt;IO:masterpty:/dev/pts/1&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_slave'>slave</span>      <span class='comment'>#=&gt; #&lt;File:/dev/pts/1&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_slave'>slave</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='comment'>#=&gt; &quot;/dev/pts/1&quot;
</span><span class='rbrace'>}</span>
</code></pre>

<p>In the non-block form, returns a two element array, <code>[master_io,
slave_file]</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_master'>master</span><span class='comma'>,</span> <span class='id identifier rubyid_slave'>slave</span> <span class='op'>=</span> <span class='const'>PTY</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span>
<span class='comment'># do something with master for IO, or the slave file
</span></code></pre>

<p>The arguments in both forms are:</p>
<dl class="rdoc-list note-list"><dt><code>master_io</code>
<dd>
<p>the master of the pty, as an IO.</p>
</dd><dt><code>slave_file</code>
<dd>
<p>the slave of the pty, as a File.  The path to the</p>
</dd></dl>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_terminal'>terminal</span> <span class='id identifier rubyid_device'>device</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_available'>available</span> <span class='id identifier rubyid_via'>via</span> <span class='id identifier rubyid_slave_file'>slave_file</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span></code></pre>

<p><code>IO#raw!</code> is usable to disable newline conversions:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>io/console</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>PTY</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_raw!'>raw!</span>
  <span class='comment'>#...
</span><span class='rbrace'>}</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'pty/pty.c', line 519</span>

static VALUE
pty_open(VALUE klass)
{
    int master_fd, slave_fd;
    char slavename[DEVICELEN];
    VALUE master_io, slave_file;
    rb_io_t *master_fptr, *slave_fptr;
    VALUE assoc;

    getDevice(&amp;master_fd, &amp;slave_fd, slavename, 1);

    master_io = rb_obj_alloc(rb_cIO);
    MakeOpenFile(master_io, master_fptr);
    master_fptr-&gt;mode = FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX;
    master_fptr-&gt;fd = master_fd;
    master_fptr-&gt;pathv = rb_obj_freeze(rb_sprintf(&quot;masterpty:%s&quot;, slavename));

    slave_file = rb_obj_alloc(rb_cFile);
    MakeOpenFile(slave_file, slave_fptr);
    slave_fptr-&gt;mode = FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX | FMODE_TTY;
    slave_fptr-&gt;fd = slave_fd;
    slave_fptr-&gt;pathv = rb_obj_freeze(rb_str_new_cstr(slavename));

    assoc = rb_assoc_new(master_io, slave_file);
    if (rb_block_given_p()) {
	return rb_ensure(rb_yield, assoc, pty_close_pty, assoc);
    }
    return assoc;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="spawn-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>spawn</strong>(command_line) {|r, w, pid| ... }  <span class="extras">(mod_func)</span></span>
    <span class='overload'>.<strong>spawn</strong>(command_line)  &#x21d2; <tt>Array</tt>, ... </span>
    <span class='overload'>.<strong>spawn</strong>(command, arguments, ...) {|r, w, pid| ... } </span>
    <span class='overload'>.<strong>spawn</strong>(command, arguments, ...)  &#x21d2; <tt>Array</tt>, ... </span>
  <span class='aliases'>Also known as: <span class='names'><span>getpty</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Spawns the specified command on a newly allocated pty. You can also use the
alias <a href="#getpty-class_method" title="PTY.getpty (method)">getpty</a>.</p>

<p>The command&#39;s controlling tty is set to the slave device of the pty and
its standard input/output/error is redirected to the slave device.</p>

<p><code>command</code> and <code>command_line</code> are the full commands to
run, given a String. Any additional <code>arguments</code> will be passed
to the command.</p>

<h4 id="label-Return+values">Return values</h4>

<p>In the non-block form this returns an array of size three, <code>[r, w,
pid]</code>.</p>

<p>In the block form these same values will be yielded to the block:</p>
<dl class="rdoc-list note-list"><dt><code>r</code>
<dd>
<p>A readable IO that contains the command&#39;s</p>
</dd></dl>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_standard'>standard</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>and</span> <span class='id identifier rubyid_standard'>standard</span> <span class='id identifier rubyid_error'>error</span>
</code></pre>
<dl class="rdoc-list note-list"><dt><code>w</code>
<dd>
<p>A writable IO that is the command&#39;s standard input</p>
</dd><dt><code>pid</code>
<dd>
<p>The process identifier for the command.</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'pty/pty.c', line 589</span>

static VALUE
pty_getpty(int argc, VALUE *argv, VALUE self)
{
    VALUE res;
    struct pty_info info;
    rb_io_t *wfptr,*rfptr;
    VALUE rport = rb_obj_alloc(rb_cFile);
    VALUE wport = rb_obj_alloc(rb_cFile);
    char SlaveName[DEVICELEN];

    MakeOpenFile(rport, rfptr);
    MakeOpenFile(wport, wfptr);

    establishShell(argc, argv, &amp;info, SlaveName);

    rfptr-&gt;mode = rb_io_modestr_fmode(&quot;r&quot;);
    rfptr-&gt;fd = info.fd;
    rfptr-&gt;pathv = rb_obj_freeze(rb_str_new_cstr(SlaveName));

    wfptr-&gt;mode = rb_io_modestr_fmode(&quot;w&quot;) | FMODE_SYNC;
    wfptr-&gt;fd = rb_cloexec_dup(info.fd);
    if (wfptr-&gt;fd == -1)
        rb_sys_fail(&quot;dup()&quot;);
    rb_update_max_fd(wfptr-&gt;fd);
    wfptr-&gt;pathv = rfptr-&gt;pathv;

    res = rb_ary_new2(3);
    rb_ary_store(res,0,(VALUE)rport);
    rb_ary_store(res,1,(VALUE)wport);
    rb_ary_store(res,2,PIDT2NUM(info.child_pid));

    if (rb_block_given_p()) {
	rb_ensure(rb_yield, res, pty_detach_process, (VALUE)&amp;info);
	return Qnil;
    }
    return res;
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.4 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>