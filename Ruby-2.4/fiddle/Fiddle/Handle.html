<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Fiddle::Handle &mdash; fiddle Ruby-2.4.0 d2016-08-04</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Fiddle::Handle",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>fiddle</a> &raquo; 
          <a href='../_index.html'>Index (H)</a> &raquo; 
          <a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a> &raquo; 
          <span class='title'>Handle</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Fiddle::Handle</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>Fiddle::Handle</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L380'>ext/fiddle/handle.c</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The <a href="" title="Fiddle::Handle (class)">Handle</a> is the manner to access the dynamic library</p>

<h4 id="label-Example">Example</h4>

<h5 id="label-Setup">Setup</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_libc_so'>libc_so</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/lib64/libc.so.6</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'>#=&gt; &quot;/lib64/libc.so.6&quot;
</span><span class='ivar'>@handle</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'>Handle</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Fiddle::Handle.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_libc_so'>libc_so</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Fiddle::Handle:0x00000000d69ef8&gt;</span></code></pre>

<h5 id="label-Setup-2C+with+flags">Setup, with flags</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_libc_so'>libc_so</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/lib64/libc.so.6</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'>#=&gt; &quot;/lib64/libc.so.6&quot;
</span><span class='ivar'>@handle</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'>Handle</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Fiddle::Handle.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_libc_so'>libc_so</span><span class='comma'>,</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'><a href="../Fiddle.html#RTLD_LAZY-constant" title="Fiddle::RTLD_LAZY (constant)">RTLD_LAZY</a></span> <span class='op'>|</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'><a href="../Fiddle.html#RTLD_GLOBAL-constant" title="Fiddle::RTLD_GLOBAL (constant)">RTLD_GLOBAL</a></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Fiddle::Handle:0x00000000d69ef8&gt;</span></code></pre>

<p>See RTLD_LAZY and RTLD_GLOBAL</p>

<h5 id="label-Addresses+to+symbols">Addresses to symbols</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_strcpy_addr'>strcpy_addr</span> <span class='op'>=</span> <span class='ivar'>@handle</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>strcpy</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='comment'>#=&gt; 140062278451968</span></code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_strcpy_addr'>strcpy_addr</span> <span class='op'>=</span> <span class='ivar'>@handle</span><span class='period'>.</span><span class='id identifier rubyid_sym'>sym</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>strcpy</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; 140062278451968</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='DEFAULT-constant'>
      DEFAULT
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>A predefined pseudo-handle of RTLD_DEFAULT</p>

<p>Which will find the first occurrence of the desired symbol using the
default library search order</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='NEXT-constant'>
      NEXT
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>A predefined pseudo-handle of RTLD_NEXT</p>

<p>Which will find the next occurrence of a function in the search order after
the current library.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='RTLD_GLOBAL-constant'>
      RTLD_GLOBAL
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>:Handle flag.</p>

<p>The symbols defined by this library will be made available for symbol
resolution of subsequently loaded libraries.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='RTLD_LAZY-constant'>
      RTLD_LAZY
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>:Handle flag.</p>

<p>Perform lazy binding.  Only resolve symbols as the code that references
them is executed.  If the  symbol is never referenced, then it is never
resolved.  (Lazy binding is only performed for function references;
references to variables are always immediately bound when the library is
loaded.)</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='RTLD_NOW-constant'>
      RTLD_NOW
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>:Handle flag.</p>

<p>If this value is specified or the environment variable LD_BIND_NOW is set
to a nonempty string, all undefined symbols in the library are resolved
before <a href="../Fiddle.html#dlopen-class_method" title="Fiddle.dlopen (method)">Fiddle.dlopen</a> returns.  If this cannot be done an error is
returned.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-class_method" title="[] (class method)">.<strong>[]</strong>(name)  </a>
        (also: .sym)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Get the address as an Integer for the function named <code>name</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(library = nil, flags = Fiddle.RTLD_LAZY|Fiddle::RTLD_GLOBAL)  </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Create a new handler that opens <code>library</code> with
<code>flags</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sym-class_method" title="sym (class method)">.<strong>sym</strong>(name)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%5B%5D-class_method" title="Fiddle::Handle.[] (method)">Handle.[]</a>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-instance_method" title="#[] (instance method)">#<strong>[]</strong>(name)  </a>
        (also: #sym)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Get the address as an Integer for the function named <code>name</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Close this handle.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#close_enabled%3F-instance_method" title="#close_enabled? (instance method)">#<strong>close_enabled?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if dlclose() will be called when this handle is
garbage collected.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#disable_close-instance_method" title="#disable_close (instance method)">#<strong>disable_close</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Disable a call to dlclose() when this handle is garbage collected.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#enable_close-instance_method" title="#enable_close (instance method)">#<strong>enable_close</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Enable a call to dlclose() when this handle is garbage collected.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sym-instance_method" title="#sym (instance method)">#<strong>sym</strong>(name)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%5B%5D-instance_method" title="Fiddle::Handle#[] (method)">#[]</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_i-instance_method" title="#to_i (instance method)">#<strong>to_i</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the memory address for this handle.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(library = nil, flags = Fiddle.RTLD_LAZY|Fiddle::RTLD_GLOBAL)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new handler that opens <code>library</code> with
<code>flags</code>.</p>

<p>If no <code>library</code> is specified or <code>nil</code> is given,
DEFAULT is used, which is the equivalent to RTLD_DEFAULT. See <code>man 3
dlopen</code> for more.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_lib'>lib</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'><a href="" title="Fiddle::Handle (class)">Handle</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
</code></pre>

<p>The default is dependent on OS, and provide a handle for all libraries
already loaded. For example, in most cases you can use this to access
<code>libc</code> functions, or ruby functions like
<code>rb_str_new</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L132'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 132</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_initialize(int argc, VALUE argv[], VALUE self)
{
    void *ptr;
    struct dl_handle *fiddle_handle;
    VALUE lib, flag;
    char  *clib;
    int   cflag;
    const char *err;

    switch( rb_scan_args(argc, argv, &quot;02&quot;, &amp;lib, &amp;flag) ){
      case 0:
	clib = NULL;
	cflag = RTLD_LAZY | RTLD_GLOBAL;
	break;
      case 1:
	clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);
	cflag = RTLD_LAZY | RTLD_GLOBAL;
	break;
      case 2:
	clib = NIL_P(lib) ? NULL : SafeStringValueCStr(lib);
	cflag = NUM2INT(flag);
	break;
      default:
	rb_bug(&quot;rb_fiddle_handle_new&quot;);
    }

#if defined(_WIN32)
    if( !clib ){
	HANDLE rb_libruby_handle(void);
	ptr = rb_libruby_handle();
    }
    else if( STRCASECMP(clib, &quot;libc&quot;) == 0
# ifdef RUBY_COREDLL
	     || STRCASECMP(clib, RUBY_COREDLL) == 0
	     || STRCASECMP(clib, RUBY_COREDLL&quot;.dll&quot;) == 0
# endif
	){
# ifdef _WIN32_WCE
	ptr = dlopen(&quot;coredll.dll&quot;, cflag);
# else
	(void)cflag;
	ptr = w32_coredll();
# endif
    }
    else
#endif
	ptr = dlopen(clib, cflag);
#if defined(HAVE_DLERROR)
    if( !ptr &amp;&amp; (err = dlerror()) ){
	rb_raise(rb_eFiddleError, &quot;%s&quot;, err);
    }
#else
    if( !ptr ){
	err = dlerror();
	rb_raise(rb_eFiddleError, &quot;%s&quot;, err);
    }
#endif
    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if( fiddle_handle-&gt;ptr &amp;&amp; fiddle_handle-&gt;open &amp;&amp; fiddle_handle-&gt;enable_close ){
	dlclose(fiddle_handle-&gt;ptr);
    }
    fiddle_handle-&gt;ptr = ptr;
    fiddle_handle-&gt;open = 1;
    fiddle_handle-&gt;enable_close = 0;

    if( rb_block_given_p() ){
	rb_ensure(rb_yield, self, rb_fiddle_handle_close, self);
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="[]-class_method">
  <h3 class='signature first'>
  .<strong>[]</strong>(name)  
  <span class='aliases'>Also known as: <span class='names'><span>sym</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Get the address as an Integer for the function named <code>name</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L306'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


306
307
308
309
310</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 306</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_s_sym(VALUE self, VALUE sym)
{
    return fiddle_handle_sym(RTLD_NEXT, sym);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sym-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>[]</strong>(name)  </span>
    <span class='overload'>.<strong>sym</strong>(name)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%5B%5D-class_method" title="Fiddle::Handle.[] (method)">[]</a>.</p>


  </div>
</div>

</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="[]-instance_method">
  <h3 class='signature first'>
  #<strong>[]</strong>(name)  
  <span class='aliases'>Also known as: <span class='names'><span>sym</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Get the address as an Integer for the function named <code>name</code>. 
The function is searched via dlsym on RTLD_NEXT.</p>

<p>See man(3) dlsym() for more info.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L276'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


276
277
278
279
280
281
282
283
284
285
286
287</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 276</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_sym(VALUE self, VALUE sym)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if( ! fiddle_handle-&gt;open ){
	rb_raise(rb_eFiddleError, &quot;closed handle&quot;);
    }

    return fiddle_handle_sym(fiddle_handle-&gt;ptr, sym);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="close-instance_method">
  <h3 class='signature'>
  #<strong>close</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Close this handle.</p>

<p>Calling close more than once will raise a <a href="DLError.html" title="Fiddle::DLError (class)">DLError</a> exception.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L66'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 66</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if(fiddle_handle-&gt;open) {
	int ret = dlclose(fiddle_handle-&gt;ptr);
	fiddle_handle-&gt;open = 0;

	/* Check dlclose for successful return value */
	if(ret) {
#if defined(HAVE_DLERROR)
	    rb_raise(rb_eFiddleError, &quot;%s&quot;, dlerror());
#else
	    rb_raise(rb_eFiddleError, &quot;could not close handle&quot;);
#endif
	}
	return INT2NUM(ret);
    }
    rb_raise(rb_eFiddleError, &quot;dlclose() called too many times&quot;);

    UNREACHABLE;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="close_enabled?-instance_method">
  <h3 class='signature'>
  #<strong>close_enabled?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if dlclose() will be called when this handle is
garbage collected.</p>

<p>See man(3) dlclose() for more info.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L242'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


242
243
244
245
246
247
248
249
250
251</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 242</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_close_enabled_p(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);

    if(fiddle_handle-&gt;enable_close) return Qtrue;
    return Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="disable_close-instance_method">
  <h3 class='signature'>
  #<strong>disable_close</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Disable a call to dlclose() when this handle is garbage collected.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L225'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


225
226
227
228
229
230
231
232
233</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 225</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_disable_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    fiddle_handle-&gt;enable_close = 0;
    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="enable_close-instance_method">
  <h3 class='signature'>
  #<strong>enable_close</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Enable a call to dlclose() when this handle is garbage collected.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L210'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


210
211
212
213
214
215
216
217
218</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 210</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_enable_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    fiddle_handle-&gt;enable_close = 1;
    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sym-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>[]</strong>(name)  </span>
    <span class='overload'>#<strong>sym</strong>(name)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%5B%5D-instance_method" title="Fiddle::Handle#[] (method)">#[]</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="to_i-instance_method">
  <h3 class='signature'>
  #<strong>to_i</strong>  &#x21d2; <tt>Integer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the memory address for this handle.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/fiddle/handle.c#L258'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


258
259
260
261
262
263
264
265</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 258</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_to_i(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    return PTR2NUM(fiddle_handle);
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>