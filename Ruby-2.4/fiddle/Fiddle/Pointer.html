<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Fiddle::Pointer &mdash; fiddle Ruby-2.4.0 d2016-07-21</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Fiddle::Pointer",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>fiddle</a> &raquo; 
          <a href='../_index.html'>Index (P)</a> &raquo; 
          <a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a> &raquo; 
          <span class='title'>Pointer</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Fiddle::Pointer</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>Fiddle::Pointer</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>



  <tr>
    <td class='box_1'>Direct Subclasses:</td>
    <td>
      <a href="CStructEntity.html" title="Fiddle::CStructEntity (class)">CStructEntity</a>
    </td>
  </tr>


  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
fiddle/pointer.c</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p><a href="" title="Fiddle::Pointer (class)">Pointer</a> is a class to handle C pointers</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-class_method" title="[] (class method)">.<strong>[]</strong>(val)  &#x21d2; cptr </a>
        (also: .to_ptr)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Get the underlying pointer for ruby object <code>val</code> and return it
as a <a href="" title="Fiddle::Pointer (class)">Pointer</a> object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(address)  &#x21d2; fiddle_cptr </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Create a new pointer to <code>address</code> with an optional
<code>size</code> and <code>freefunc</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_ptr-class_method" title="to_ptr (class method)">.<strong>to_ptr</strong>(val)  &#x21d2; cptr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%5B%5D-class_method" title="Fiddle::Pointer.[] (method)">Pointer.[]</a>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%2B-instance_method" title="#+ (instance method)">#<strong>+</strong>(n)  &#x21d2; new cptr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a new pointer instance that has been advanced <code>n</code> bytes.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%2B%40-instance_method" title="#+@ (instance method)">#<strong>+@</strong>  </a>
        (also: #ptr)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a new <a href="" title="Fiddle::Pointer (class)">Pointer</a> instance that is a dereferenced pointer for
this pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#--instance_method" title="#- (instance method)">#<strong>-</strong>(n)  &#x21d2; new cptr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a new pointer instance that has been moved back <code>n</code>
bytes.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#-%40-instance_method" title="#-@ (instance method)">#<strong>-@</strong>  </a>
        (also: #ref)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a new <a href="" title="Fiddle::Pointer (class)">Pointer</a> instance that is a reference pointer for
this pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%3C%3D%3E-instance_method" title="#&lt;=&gt; (instance method)">#<strong>&lt;=&gt;</strong>(other)  &#x21d2; -1, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns -1 if less than, 0 if equal to, 1 if greater than
<code>other</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%3D%3D-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; Boolean </a>
        (also: #eql?)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns true if <code>other</code> wraps the same pointer, otherwise
returns false.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-instance_method" title="#[] (instance method)">#<strong>[]</strong>(index)  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns integer stored at <em>index</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(a, s)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Set the value at <code>index</code> to <code>int</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#eql%3F-instance_method" title="#eql? (instance method)">#<strong>eql?</strong>(other)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%3D%3D-instance_method" title="Fiddle::Pointer#== (method)">#==</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#free-instance_method" title="#free (instance method)">#<strong>free</strong>  &#x21d2; Fiddle::Function </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Get the free function for this pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#free%3D-instance_method" title="#free= (instance method)">#<strong>free=</strong>(function)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Set the free function for this pointer to <code>function</code> in the
given <a href="Function.html" title="Fiddle::Function (class)">Function</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a string formatted with an easily readable representation of the
internal state of the pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#null%3F-instance_method" title="#null? (instance method)">#<strong>null?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <code>true</code> if this is a null pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ptr-instance_method" title="#ptr (instance method)">#<strong>ptr</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#%2B%40-instance_method" title="Fiddle::Pointer#+@ (method)">#+@</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ref-instance_method" title="#ref (instance method)">#<strong>ref</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#-%40-instance_method" title="Fiddle::Pointer#-@ (method)">#-@</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Get the size of this pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#size%3D-instance_method" title="#size= (instance method)">#<strong>size=</strong>(size)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Set the size of this pointer to <code>size</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_int-instance_method" title="#to_i (instance method)">#<strong>to_i</strong>  &#x21d2; Integer </a>
        (also: #to_int)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the integer memory location of this pointer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_int-instance_method" title="#to_int (instance method)">#<strong>to_int</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#to_i-instance_method" title="Fiddle::Pointer#to_i (method)">#to_i</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the pointer contents as a string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_str-instance_method" title="#to_str (instance method)">#<strong>to_str</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the pointer contents as a string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#to_value-instance_method" title="#to_value (instance method)">#<strong>to_value</strong>  &#x21d2; ? </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Cast this pointer to a ruby object.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>new</strong>(address)  &#x21d2; <tt>fiddle_cptr</tt> </span>
    <span class='overload'>.<strong>new</strong>(address, size)  &#x21d2; <tt>fiddle_cptr</tt> </span>
    <span class='overload'>.<strong>new</strong>(address, size, freefunc)  &#x21d2; <tt>fiddle_cptr</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new pointer to <code>address</code> with an optional
<code>size</code> and <code>freefunc</code>.</p>

<p><code>freefunc</code> will be called when the instance is garbage
collected.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 158</span>

static VALUE
rb_fiddle_ptr_initialize(int argc, VALUE argv[], VALUE self)
{
    VALUE ptr, sym, size, wrap = 0, funcwrap = 0;
    struct ptr_data *data;
    void *p = NULL;
    freefunc_t f = NULL;
    long s = 0;

    if (rb_scan_args(argc, argv, &quot;12&quot;, &amp;ptr, &amp;size, &amp;sym) &gt;= 1) {
	VALUE addrnum = rb_Integer(ptr);
	if (addrnum != ptr) wrap = ptr;
	p = NUM2PTR(addrnum);
    }
    if (argc &gt;= 2) {
	s = NUM2LONG(size);
    }
    if (argc &gt;= 3) {
	f = get_freefunc(sym, &amp;funcwrap);
    }

    if (p) {
	TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
	if (data-&gt;ptr &amp;&amp; data-&gt;free) {
	    /* Free previous memory. Use of inappropriate initialize may cause SEGV. */
	    (*(data-&gt;free))(data-&gt;ptr);
	}
	data-&gt;wrap[0] = wrap;
	data-&gt;wrap[1] = funcwrap;
	data-&gt;ptr  = p;
	data-&gt;size = s;
	data-&gt;free = f;
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="[]-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>[]</strong>(val)  &#x21d2; <tt>cptr</tt> </span>
    <span class='overload'>.<strong>to_ptr</strong>(val)  &#x21d2; <tt>cptr</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>to_ptr</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Get the underlying pointer for ruby object <code>val</code> and return it
as a <a href="" title="Fiddle::Pointer (class)">Fiddle::Pointer</a> object.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 642</span>

static VALUE
rb_fiddle_ptr_s_to_ptr(VALUE self, VALUE val)
{
    VALUE ptr, wrap = val, vptr;

    if (RTEST(rb_obj_is_kind_of(val, rb_cIO))){
	rb_io_t *fptr;
	FILE *fp;
	GetOpenFile(val, fptr);
	fp = rb_io_stdio_file(fptr);
	ptr = rb_fiddle_ptr_new(fp, 0, NULL);
    }
    else if (RTEST(rb_obj_is_kind_of(val, rb_cString))){
	char *str = StringValuePtr(val);
	ptr = rb_fiddle_ptr_new(str, RSTRING_LEN(val), NULL);
    }
    else if ((vptr = rb_check_funcall(val, id_to_ptr, 0, 0)) != Qundef){
	if (rb_obj_is_kind_of(vptr, rb_cPointer)){
	    ptr = vptr;
	    wrap = 0;
	}
	else{
	    rb_raise(rb_eFiddleError, &quot;to_ptr should return a Fiddle::Pointer object&quot;);
	}
    }
    else{
	VALUE num = rb_Integer(val);
	if (num == val) wrap = 0;
	ptr = rb_fiddle_ptr_new(NUM2PTR(num), 0, NULL);
    }
    OBJ_INFECT(ptr, val);
    if (wrap) RPTR_DATA(ptr)-&gt;wrap[0] = wrap;
    return ptr;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_ptr-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>[]</strong>(val)  &#x21d2; <tt>cptr</tt> </span>
    <span class='overload'>.<strong>to_ptr</strong>(val)  &#x21d2; <tt>cptr</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%5B%5D-class_method" title="Fiddle::Pointer.[] (method)">[]</a>.</p>


  </div>
</div>

</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="+-instance_method">
  <h3 class='signature first'>
  #<strong>+</strong>(n)  &#x21d2; <tt><a href="#new-class_method" title="Fiddle::Pointer.new (method)">new</a> cptr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a new pointer instance that has been advanced <code>n</code> bytes.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


496
497
498
499
500
501
502
503
504
505
506</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 496</span>

static VALUE
rb_fiddle_ptr_plus(VALUE self, VALUE other)
{
    void *ptr;
    long num, size;

    ptr = rb_fiddle_ptr2cptr(self);
    size = RPTR_DATA(self)-&gt;size;
    num = NUM2LONG(other);
    return rb_fiddle_ptr_new((char *)ptr + num, size - num, 0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="+@-instance_method">
  <h3 class='signature'>
  #<strong>+@</strong>  
  <span class='aliases'>Also known as: <span class='names'><span>ptr</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a new <a href="" title="Fiddle::Pointer (class)">Fiddle::Pointer</a> instance that is a dereferenced pointer for
this pointer.</p>

<p>Analogous to the star operator in C.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


267
268
269
270
271
272
273
274</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 267</span>

static VALUE
rb_fiddle_ptr_ptr(VALUE self)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return rb_fiddle_ptr_new(*((void**)(data-&gt;ptr)),0,0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="--instance_method">
  <h3 class='signature'>
  #<strong>-</strong>(n)  &#x21d2; <tt><a href="#new-class_method" title="Fiddle::Pointer.new (method)">new</a> cptr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a new pointer instance that has been moved back <code>n</code>
bytes.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


514
515
516
517
518
519
520
521
522
523
524</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 514</span>

static VALUE
rb_fiddle_ptr_minus(VALUE self, VALUE other)
{
    void *ptr;
    long num, size;

    ptr = rb_fiddle_ptr2cptr(self);
    size = RPTR_DATA(self)-&gt;size;
    num = NUM2LONG(other);
    return rb_fiddle_ptr_new((char *)ptr - num, size + num, 0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="-@-instance_method">
  <h3 class='signature'>
  #<strong>-@</strong>  
  <span class='aliases'>Also known as: <span class='names'><span>ref</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a new <a href="" title="Fiddle::Pointer (class)">Fiddle::Pointer</a> instance that is a reference pointer for
this pointer.</p>

<p>Analogous to the ampersand operator in C.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


284
285
286
287
288
289
290
291</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 284</span>

static VALUE
rb_fiddle_ptr_ref(VALUE self)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return rb_fiddle_ptr_new(&amp;(data-&gt;ptr),0,0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="<=>-instance_method">
  <h3 class='signature'>
  #<strong>&lt;=&gt;</strong>(other)  &#x21d2; <tt>-1</tt>, ... 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns -1 if less than, 0 if equal to, 1 if greater than
<code>other</code>.</p>

<p>Returns nil if <code>ptr</code> cannot be compared to <code>other</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


475
476
477
478
479
480
481
482
483
484
485
486
487
488</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 475</span>

static VALUE
rb_fiddle_ptr_cmp(VALUE self, VALUE other)
{
    void *ptr1, *ptr2;
    SIGNED_VALUE diff;

    if(!rb_obj_is_kind_of(other, rb_cPointer)) return Qnil;

    ptr1 = rb_fiddle_ptr2cptr(self);
    ptr2 = rb_fiddle_ptr2cptr(other);
    diff = (SIGNED_VALUE)ptr1 - (SIGNED_VALUE)ptr2;
    if (!diff) return INT2FIX(0);
    return diff &gt; 0 ? INT2NUM(1) : INT2NUM(-1);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="==-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>==</strong>(other)  &#x21d2; <tt>Boolean</tt> </span>
    <span class='overload'>#<strong>eql?</strong>(other)  &#x21d2; <tt>Boolean</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>eql?</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns true if <code>other</code> wraps the same pointer, otherwise
returns false.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


454
455
456
457
458
459
460
461
462
463
464
465</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 454</span>

static VALUE
rb_fiddle_ptr_eql(VALUE self, VALUE other)
{
    void *ptr1, *ptr2;

    if(!rb_obj_is_kind_of(other, rb_cPointer)) return Qfalse;

    ptr1 = rb_fiddle_ptr2cptr(self);
    ptr2 = rb_fiddle_ptr2cptr(other);

    return ptr1 == ptr2 ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="[]-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>[]</strong>(index)  &#x21d2; <tt>Integer</tt> </span>
    <span class='overload'>#<strong>[]</strong>(start, length)  &#x21d2; <tt>String</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns integer stored at <em>index</em>.</p>

<p>If <em>start</em> and <em>length</em> are given, a string containing the
bytes from <em>start</em> of <em>length</em> will be returned.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 536</span>

static VALUE
rb_fiddle_ptr_aref(int argc, VALUE argv[], VALUE self)
{
    VALUE arg0, arg1;
    VALUE retval = Qnil;
    size_t offset, len;
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    if (!data-&gt;ptr) rb_raise(rb_eFiddleError, &quot;NULL pointer dereference&quot;);
    switch( rb_scan_args(argc, argv, &quot;11&quot;, &amp;arg0, &amp;arg1) ){
      case 1:
	offset = NUM2ULONG(arg0);
	retval = INT2NUM(*((char *)data-&gt;ptr + offset));
	break;
      case 2:
	offset = NUM2ULONG(arg0);
	len    = NUM2ULONG(arg1);
	retval = rb_tainted_str_new((char *)data-&gt;ptr + offset, len);
	break;
      default:
	rb_bug(&quot;rb_fiddle_ptr_aref()&quot;);
    }
    return retval;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="[]=-instance_method">
  <h3 class='signature'>
  #<strong>[]=</strong>(a, s)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Set the value at <code>index</code> to <code>int</code>.</p>

<p>Or, set the memory at <code>start</code> until <code>length</code> with the
contents of <code>string</code>, the memory from <code>dl_cptr</code>, or
the memory pointed at by the memory address <code>addr</code>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 573</span>

static VALUE
rb_fiddle_ptr_aset(int argc, VALUE argv[], VALUE self)
{
    VALUE arg0, arg1, arg2;
    VALUE retval = Qnil;
    size_t offset, len;
    void *mem;
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    if (!data-&gt;ptr) rb_raise(rb_eFiddleError, &quot;NULL pointer dereference&quot;);
    switch( rb_scan_args(argc, argv, &quot;21&quot;, &amp;arg0, &amp;arg1, &amp;arg2) ){
      case 2:
	offset = NUM2ULONG(arg0);
	((char*)data-&gt;ptr)[offset] = NUM2UINT(arg1);
	retval = arg1;
	break;
      case 3:
	offset = NUM2ULONG(arg0);
	len    = NUM2ULONG(arg1);
	if (RB_TYPE_P(arg2, T_STRING)) {
	    mem = StringValuePtr(arg2);
	}
	else if( rb_obj_is_kind_of(arg2, rb_cPointer) ){
	    mem = rb_fiddle_ptr2cptr(arg2);
	}
	else{
	    mem    = NUM2PTR(arg2);
	}
	memcpy((char *)data-&gt;ptr + offset, mem, len);
	retval = arg2;
	break;
      default:
	rb_bug(&quot;rb_fiddle_ptr_aset()&quot;);
    }
    return retval;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="eql?-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>==</strong>(other)  &#x21d2; <tt>Boolean</tt> </span>
    <span class='overload'>#<strong>eql?</strong>(other)  &#x21d2; <tt>Boolean</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%3D%3D-instance_method" title="Fiddle::Pointer#== (method)">#==</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="free-instance_method">
  <h3 class='signature'>
  #<strong>free</strong>  &#x21d2; <tt><a href="Function.html" title="Fiddle::Function (class)">Fiddle::Function</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Get the free function for this pointer.</p>

<p>Returns a new instance of <a href="Function.html" title="Fiddle::Function (class)">Function</a>.</p>

<p>See <a href="Function.html" title="Fiddle::Function (class)">Function</a>.new</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 333</span>

static VALUE
rb_fiddle_ptr_free_get(VALUE self)
{
    struct ptr_data *pdata;
    VALUE address;
    VALUE arg_types;
    VALUE ret_type;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, pdata);

    if (!pdata-&gt;free)
	return Qnil;

    address = PTR2NUM(pdata-&gt;free);
    ret_type = INT2NUM(TYPE_VOID);
    arg_types = rb_ary_new();
    rb_ary_push(arg_types, INT2NUM(TYPE_VOIDP));

    return rb_fiddle_new_function(address, arg_types, ret_type);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="free=-instance_method">
  <h3 class='signature'>
  #<strong>free=</strong>(function)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Set the free function for this pointer to <code>function</code> in the
given <a href="Function.html" title="Fiddle::Function (class)">Function</a>.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


313
314
315
316
317
318
319
320
321
322</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 313</span>

static VALUE
rb_fiddle_ptr_free_set(VALUE self, VALUE val)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    data-&gt;free = get_freefunc(val, &amp;data-&gt;wrap[1]);

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="inspect-instance_method">
  <h3 class='signature'>
  #<strong>inspect</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a string formatted with an easily readable representation of the
internal state of the pointer.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


436
437
438
439
440
441
442
443
444</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 436</span>

static VALUE
rb_fiddle_ptr_inspect(VALUE self)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return rb_sprintf(&quot;#&lt;%&quot;PRIsVALUE&quot;:%p ptr=%p size=%ld free=%p&gt;&quot;,
		      RB_OBJ_CLASSNAME(self), data, data-&gt;ptr, data-&gt;size, data-&gt;free);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="null?-instance_method">
  <h3 class='signature'>
  #<strong>null?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <code>true</code> if this is a null pointer.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


298
299
300
301
302
303
304
305</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 298</span>

static VALUE
rb_fiddle_ptr_null_p(VALUE self)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return data-&gt;ptr ? Qfalse : Qtrue;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ptr-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>+@</strong>  </span>
    <span class='overload'>#<strong>ptr</strong>  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#%2B%40-instance_method" title="Fiddle::Pointer#+@ (method)">#+@</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="ref-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>-@</strong>  </span>
    <span class='overload'>#<strong>ref</strong>  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#-%40-instance_method" title="Fiddle::Pointer#-@ (method)">#-@</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="size-instance_method">
  <h3 class='signature'>
  #<strong>size</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Get the size of this pointer.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


628
629
630
631
632</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 628</span>

static VALUE
rb_fiddle_ptr_size_get(VALUE self)
{
    return LONG2NUM(RPTR_DATA(self)-&gt;size);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="size=-instance_method">
  <h3 class='signature'>
  #<strong>size=</strong>(size)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Set the size of this pointer to <code>size</code></p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


616
617
618
619
620
621</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 616</span>

static VALUE
rb_fiddle_ptr_size_set(VALUE self, VALUE size)
{
    RPTR_DATA(self)-&gt;size = NUM2LONG(size);
    return size;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_i-instance_method">
  <h3 class='signature'>
  #<strong>to_i</strong>  &#x21d2; <tt>Integer</tt> 
  <span class='aliases'>Also known as: <span class='names'><span>to_int</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the integer memory location of this pointer.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


237
238
239
240
241
242
243
244</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 237</span>

static VALUE
rb_fiddle_ptr_to_i(VALUE self)
{
    struct ptr_data *data;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return PTR2NUM(data-&gt;ptr);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_int-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>to_i</strong>  &#x21d2; <tt>Integer</tt> </span>
    <span class='overload'>#<strong>to_int</strong>  &#x21d2; <tt>Integer</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#to_i-instance_method" title="Fiddle::Pointer#to_i (method)">#to_i</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="to_s-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>to_s</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_s</strong>(len)  &#x21d2; <tt>String</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the pointer contents as a string.</p>

<p>When called with no arguments, this method will return the contents until
the first NULL byte.</p>

<p>When called with <code>len</code>, a string of <code>len</code> bytes will
be returned.</p>

<p>See to_str</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 369</span>

static VALUE
rb_fiddle_ptr_to_s(int argc, VALUE argv[], VALUE self)
{
    struct ptr_data *data;
    VALUE arg1, val;
    int len;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    switch (rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg1)) {
      case 0:
	val = rb_tainted_str_new2((char*)(data-&gt;ptr));
	break;
      case 1:
	len = NUM2INT(arg1);
	val = rb_tainted_str_new((char*)(data-&gt;ptr), len);
	break;
      default:
	rb_bug(&quot;rb_fiddle_ptr_to_s&quot;);
    }

    return val;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_str-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>to_str</strong>  &#x21d2; <tt>String</tt> </span>
    <span class='overload'>#<strong>to_str</strong>(len)  &#x21d2; <tt>String</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the pointer contents as a string.</p>

<p>When called with no arguments, this method will return the contents with
the length of this pointer&#39;s <code>size</code>.</p>

<p>When called with <code>len</code>, a string of <code>len</code> bytes will
be returned.</p>

<p>See to_s</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 407</span>

static VALUE
rb_fiddle_ptr_to_str(int argc, VALUE argv[], VALUE self)
{
    struct ptr_data *data;
    VALUE arg1, val;
    int len;

    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    switch (rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg1)) {
      case 0:
	val = rb_tainted_str_new((char*)(data-&gt;ptr),data-&gt;size);
	break;
      case 1:
	len = NUM2INT(arg1);
	val = rb_tainted_str_new((char*)(data-&gt;ptr), len);
	break;
      default:
	rb_bug(&quot;rb_fiddle_ptr_to_str&quot;);
    }

    return val;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="to_value-instance_method">
  <h3 class='signature'>
  #<strong>to_value</strong>  &#x21d2; <tt>?</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Cast this pointer to a ruby object.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


251
252
253
254
255
256
257</pre>
  <div class='lines_code'>
<pre class='code cpp'
<span class='info file'># File 'fiddle/pointer.c', line 251</span>

static VALUE
rb_fiddle_ptr_to_value(VALUE self)
{
    struct ptr_data *data;
    TypedData_Get_Struct(self, struct ptr_data, &amp;fiddle_ptr_data_type, data);
    return (VALUE)(data-&gt;ptr);
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.3 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>