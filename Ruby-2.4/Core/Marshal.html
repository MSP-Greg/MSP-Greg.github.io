<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Marshal &mdash; Core Ruby-2.4.0 d2016-08-01</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Marshal",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='index.html'>Core</a> &raquo; 
          <a href='_index.html'>Index (M)</a> &raquo; 
          <span class='title'>Marshal</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: Marshal</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>





  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/marshal.c#L2192'>marshal.c</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The marshaling library converts collections of Ruby objects into a byte
stream, allowing them to be stored outside the currently active script.
This data may subsequently be read and the original objects reconstituted.</p>

<p>Marshaled data has major and minor version numbers stored along with the
object information. In normal use, marshaling can only load data written
with the same major version number and an equal or lower minor version
number. If Ruby&#39;s “verbose&#39;&#39; flag is set (normally using -d,
-v, -w, or –verbose) the major and minor numbers must match exactly.
Marshal versioning is independent of Ruby&#39;s version numbers. You can
extract the version by reading the first two bytes of marshaled data.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_dump'><a href="#dump-class_method" title="Marshal.dump (method)">dump</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>thing</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='const'><a href="top-level-namespace.html#RUBY_VERSION-constant" title="RUBY_VERSION (constant)">RUBY_VERSION</a></span>   <span class='comment'>#=&gt; &quot;1.9.0&quot;
</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>     <span class='comment'>#=&gt; 4
</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span>     <span class='comment'>#=&gt; 8
</span></code></pre>

<p>Some objects cannot be dumped: if the objects to be dumped include
bindings, procedure or method objects, instances of class IO, or singleton
objects, a TypeError will be raised.</p>

<p>If your class has special serialization needs (for example, if you want to
serialize in some specific format), or if it contains objects that would
otherwise not be serializable, you can implement your own serialization
strategy.</p>

<p>There are two methods of doing this, your object can define either
marshal_dump and marshal_load or _dump and _load.  marshal_dump will take
precedence over _dump if both are defined.  marshal_dump may result in
smaller Marshal strings.</p>

<h4 id="label-Security+considerations">Security considerations</h4>

<p>By design, <a href="#load-class_method" title="Marshal.load (method)">Marshal.load</a> can deserialize almost any class loaded into the
Ruby process. In many cases this can lead to remote code execution if the
Marshal data is loaded from an untrusted source.</p>

<p>As a result, <a href="#load-class_method" title="Marshal.load (method)">Marshal.load</a> is not suitable as a general purpose
serialization format and you should never unmarshal user supplied input or
other untrusted data.</p>

<p>If you need to deserialize untrusted data, use JSON or another
serialization format that is only able to load simple, &#39;primitive&#39;
types such as String, Array, Hash, etc. Never allow user input to specify
arbitrary types to deserialize into.</p>

<h4 id="label-marshal_dump+and+marshal_load">marshal_dump and marshal_load</h4>

<p>When dumping an object the method marshal_dump will be called. marshal_dump
must return a result containing the information necessary for marshal_load
to reconstitute the object.  The result can be any object.</p>

<p>When loading an object dumped using marshal_dump the object is first
allocated then marshal_load is called with the result from marshal_dump.
marshal_load must recreate the object from the information in the result.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyObj</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>
    <span class='ivar'>@name</span>    <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
    <span class='ivar'>@version</span> <span class='op'>=</span> <span class='id identifier rubyid_version'>version</span>
    <span class='ivar'>@data</span>    <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_marshal_dump'>marshal_dump</span>
    <span class='lbracket'>[</span><span class='ivar'>@name</span><span class='comma'>,</span> <span class='ivar'>@version</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_marshal_load'>marshal_load</span> <span class='id identifier rubyid_array'>array</span>
    <span class='ivar'>@name</span><span class='comma'>,</span> <span class='ivar'>@version</span> <span class='op'>=</span> <span class='id identifier rubyid_array'>array</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-_dump+and+_load">_dump and _load</h4>

<p>Use _dump and _load when you need to allocate the object you&#39;re
restoring yourself.</p>

<p>When dumping an object the instance method _dump is called with an Integer
which indicates the maximum depth of objects to dump (a value of -1 implies
that you should disable depth checking).  _dump must return a String
containing the information necessary to reconstitute the object.</p>

<p>The class method _load should take a String and use it to return an object
of the same class.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyObj</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>
    <span class='ivar'>@name</span>    <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
    <span class='ivar'>@version</span> <span class='op'>=</span> <span class='id identifier rubyid_version'>version</span>
    <span class='ivar'>@data</span>    <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid__dump'>_dump</span> <span class='id identifier rubyid_level'>level</span>
    <span class='lbracket'>[</span><span class='ivar'>@name</span><span class='comma'>,</span> <span class='ivar'>@version</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid__load'>_load</span> <span class='id identifier rubyid_args'>args</span>
    <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Since <a href="#dump-class_method" title="Marshal.dump (method)">Marshal.dump</a> outputs a string you can have _dump return a Marshal
string which is loaded in _load for complex objects.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='MAJOR_VERSION-constant'>
      MAJOR_VERSION
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>major version</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='MINOR_VERSION-constant'>
      MINOR_VERSION
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>minor version</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#dump-class_method" title="dump (class method)">.<strong>dump</strong>(obj[, anIO], limit = -1)  &#x21d2; anIO </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Serializes obj and all descendant objects.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#load-class_method" title="load (class method)">.<strong>load</strong>(source[, proc])  &#x21d2; Object </a>
        (also: .restore)
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the result of converting the serialized data in source into a Ruby
object (possibly with associated subordinate objects).</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#restore-class_method" title="restore (class method)">.<strong>restore</strong>(source[, proc])  &#x21d2; Object </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#load-class_method" title="Marshal.load (method)">Marshal.load</a>.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="dump-class_method">
  <h3 class='signature first'>
  .<strong>dump</strong>(obj[, anIO], limit = -1)  &#x21d2; <tt>anIO</tt>  <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Serializes obj and all descendant objects. If anIO is specified, the
serialized data will be written to it, otherwise the data will be returned
as a String. If limit is specified, the traversal of subobjects will be
limited to that depth. If limit is negative, no checking of depth will be
performed.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Klass</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
    <span class='ivar'>@str</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_say_hello'>say_hello</span>
    <span class='ivar'>@str</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>(produces no output)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_o'>o</span> <span class='op'>=</span> <span class='const'>Klass</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'><a href="" title="Marshal (module)">Marshal</a></span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_o'>o</span><span class='rparen'>)</span>
<span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'><a href="" title="Marshal (module)">Marshal</a></span><span class='period'>.</span><span class='id identifier rubyid_load'><a href="#load-class_method" title="Marshal.load (method)">load</a></span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
<span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_say_hello'>say_hello</span>  <span class='comment'>#=&gt; &quot;hello\n&quot;
</span></code></pre>

<p>Marshal can&#39;t dump following objects:</p>
<ul><li>
<p>anonymous Class/Module.</p>
</li><li>
<p>objects which are related to system (ex: Dir, <a href="File/Stat.html" title="File::Stat (class)">File::Stat</a>, IO, File,
Socket and so on)</p>
</li><li>
<p>an instance of MatchData, Data, Method, UnboundMethod, Proc, Thread,
ThreadGroup, Continuation</p>
</li><li>
<p>objects which define singleton methods</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/marshal.c#L986'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'marshal.c', line 986</span></pre>
<pre class='code cpp'>

static VALUE
marshal_dump(int argc, VALUE *argv)
{
    VALUE obj, port, a1, a2;
    int limit = -1;

    port = Qnil;
    rb_scan_args(argc, argv, &quot;12&quot;, &amp;obj, &amp;a1, &amp;a2);
    if (argc == 3) {
	if (!NIL_P(a2)) limit = NUM2INT(a2);
	if (NIL_P(a1)) io_needed();
	port = a1;
    }
    else if (argc == 2) {
	if (FIXNUM_P(a1)) limit = FIX2INT(a1);
	else if (NIL_P(a1)) io_needed();
	else port = a1;
    }
    return rb_marshal_dump_limited(obj, port, limit);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="load-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>load</strong>(source[, proc])  &#x21d2; <tt><a href="Object.html" title="Object (class)">Object</a></tt>  <span class="extras">(mod_func)</span></span>
    <span class='overload'>.<strong>restore</strong>(source[, proc])  &#x21d2; <tt><a href="Object.html" title="Object (class)">Object</a></tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>restore</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the result of converting the serialized data in source into a Ruby
object (possibly with associated subordinate objects). source may be either
an instance of IO or an object that responds to to_str. If proc is
specified, each object will be passed to the proc, as the object is being
deserialized.</p>

<p>Never pass untrusted data (including user supplied input) to this method.
Please see the overview for further details.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/marshal.c#L2009'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2009
2010
2011
2012
2013
2014
2015
2016
2017
2018</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'marshal.c', line 2009</span></pre>
<pre class='code cpp'>

static VALUE
marshal_load(int argc, VALUE *argv)
{
    VALUE port, proc;

    rb_check_arity(argc, 1, 2);
    port = argv[0];
    proc = argc &gt; 1 ? argv[1] : Qnil;
    return rb_marshal_load_with_proc(port, proc);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="restore-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>load</strong>(source[, proc])  &#x21d2; <tt><a href="Object.html" title="Object (class)">Object</a></tt>  <span class="extras">(mod_func)</span></span>
    <span class='overload'>.<strong>restore</strong>(source[, proc])  &#x21d2; <tt><a href="Object.html" title="Object (class)">Object</a></tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#load-class_method" title="Marshal.load (method)">load</a>.</p>


  </div>
</div>

</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>