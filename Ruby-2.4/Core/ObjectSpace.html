<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ObjectSpace &mdash; Core Ruby-2.4.0 d2016-08-01</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ObjectSpace",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='index.html'>Core</a> &raquo; 
          <a href='_index.html'>Index (O)</a> &raquo; 
          <span class='title'>ObjectSpace</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ObjectSpace</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <div class='box_max'>
        <a href="ObjectSpace/WeakMap.html" title="ObjectSpace::WeakMap (class)">WeakMap</a>
      </div>
    </td>
  </tr>




  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L9536'>gc.c</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The ObjectSpace module contains a number of routines that interact with the
garbage collection facility and allow you to traverse all living objects
with an iterator.</p>

<p>ObjectSpace also provides support for object finalizers, procs that will be
called when a specific object is about to be destroyed by garbage
collection.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>objspace</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>ObjectSpace</span><span class='period'>.</span><span class='id identifier rubyid_define_finalizer'><a href="#define_finalizer-class_method" title="ObjectSpace.define_finalizer (method)">define_finalizer</a></span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Finalizer one on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='const'>ObjectSpace</span><span class='period'>.</span><span class='id identifier rubyid_define_finalizer'><a href="#define_finalizer-class_method" title="ObjectSpace.define_finalizer (method)">define_finalizer</a></span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Finalizer two on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<p><em>produces:</em></p>

<pre class="code ruby"><code class="ruby"><span class='const'>Finalizer</span> <span class='id identifier rubyid_two'>two</span> <span class='id identifier rubyid_on'>on</span> <span class='int'>537763470</span>
<span class='const'>Finalizer</span> <span class='id identifier rubyid_one'>one</span> <span class='id identifier rubyid_on'>on</span> <span class='int'>537763480</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#_id2ref-class_method" title="_id2ref (class method)">.<strong>_id2ref</strong>(object_id)  &#x21d2; Object </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Converts an object id to a reference to the object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#count_objects-class_method" title="count_objects (class method)">.<strong>count_objects</strong>([result_hash])  &#x21d2; Hash </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Counts all objects grouped by type.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#define_finalizer-class_method" title="define_finalizer (class method)">.<strong>define_finalizer</strong>(obj, aProc = proc())  </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Adds <em>aProc</em> as a finalizer, to be called after <em>obj</em> was
destroyed.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#each_object-class_method" title="each_object (class method)">.<strong>each_object</strong>([) {|obj| ... } &#x21d2; Fixnum </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Calls the block once for each living, nonimmediate object in this Ruby
process.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#garbage_collect-class_method" title="GC.start (class method)"><strong>GC.start</strong>  &#x21d2; nil </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Initiates garbage collection, unless manually disabled.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#undefine_finalizer-class_method" title="undefine_finalizer (class method)">.<strong>undefine_finalizer</strong>(obj)  </a>
      </span>
      <span class='mod_func note title'>mod_func</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Removes all finalizers for <em>obj</em>.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="_id2ref-class_method">
  <h3 class='signature first'>
  .<strong>_id2ref</strong>(object_id)  &#x21d2; <tt><a href="Object.html" title="Object (class)">Object</a></tt>  <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Converts an object id to a reference to the object. May not be called on an
object id passed as a parameter to a finalizer.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am a string</span><span class='tstring_end'>&quot;</span></span>                    <span class='comment'>#=&gt; &quot;I am a string&quot;
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'><a href="" title="ObjectSpace (module)">ObjectSpace</a></span><span class='period'>.</span><span class='id identifier rubyid__id2ref'>_id2ref</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; &quot;I am a string&quot;
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>==</span> <span class='id identifier rubyid_s'>s</span>                                 <span class='comment'>#=&gt; true
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L3014'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3014
3015
3016
3017
3018
3019
3020
3021
3022
3023
3024
3025
3026
3027
3028
3029
3030
3031
3032
3033
3034
3035
3036
3037
3038
3039
3040
3041
3042
3043
3044
3045
3046
3047
3048
3049
3050
3051
3052
3053</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 3014</span></pre>
<pre class='code cpp'>

static VALUE
id2ref(VALUE obj, VALUE objid)
{
#if SIZEOF_LONG == SIZEOF_VOIDP
#define NUM2PTR(x) NUM2ULONG(x)
#elif SIZEOF_LONG_LONG == SIZEOF_VOIDP
#define NUM2PTR(x) NUM2ULL(x)
#endif
    rb_objspace_t *objspace = &amp;rb_objspace;
    VALUE ptr;
    void *p0;

    ptr = NUM2PTR(objid);
    p0 = (void *)ptr;

    if (ptr == Qtrue) return Qtrue;
    if (ptr == Qfalse) return Qfalse;
    if (ptr == Qnil) return Qnil;
    if (FIXNUM_P(ptr)) return (VALUE)ptr;
    if (FLONUM_P(ptr)) return (VALUE)ptr;
    ptr = obj_id_to_ref(objid);

    if ((ptr % sizeof(RVALUE)) == (4 &lt;&lt; 2)) {
        ID symid = ptr / sizeof(RVALUE);
        if (rb_id2str(symid) == 0)
	    rb_raise(rb_eRangeError, &quot;%p is not symbol id value&quot;, p0);
	return ID2SYM(symid);
    }

    if (!is_id_value(objspace, ptr)) {
	rb_raise(rb_eRangeError, &quot;%p is not id value&quot;, p0);
    }
    if (!is_live_object(objspace, ptr)) {
	rb_raise(rb_eRangeError, &quot;%p is recycled object&quot;, p0);
    }
    if (RBASIC(ptr)-&gt;klass == 0) {
	rb_raise(rb_eRangeError, &quot;%p is internal object&quot;, p0);
    }
    return (VALUE)ptr;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="count_objects-class_method">
  <h3 class='signature'>
  .<strong>count_objects</strong>([result_hash])  &#x21d2; <tt><a href="Hash.html" title="Hash (class)">Hash</a></tt>  <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Counts all objects grouped by type.</p>

<p>It returns a hash, such as:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='symbol'>:TOTAL</span><span class='op'>=&gt;</span><span class='int'>10000</span><span class='comma'>,</span>
  <span class='symbol'>:FREE</span><span class='op'>=&gt;</span><span class='int'>3011</span><span class='comma'>,</span>
  <span class='symbol'>:T_OBJECT</span><span class='op'>=&gt;</span><span class='int'>6</span><span class='comma'>,</span>
  <span class='symbol'>:T_CLASS</span><span class='op'>=&gt;</span><span class='int'>404</span><span class='comma'>,</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span>
</code></pre>

<p>The contents of the returned hash are implementation specific. It may be
changed in future.</p>

<p>The keys starting with <code>:T_</code> means live objects. For example,
<code>:T_ARRAY</code> is the number of arrays. <code>:FREE</code> means
object slots which is not used now. <code>:TOTAL</code> means sum of above.</p>

<p>If the optional argument <code>result_hash</code> is given, it is
overwritten and returned. This is intended to avoid probe effect.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='const'><a href="" title="ObjectSpace (module)">ObjectSpace</a></span><span class='period'>.</span><span class='id identifier rubyid_count_objects'>count_objects</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_h'>h</span>
<span class='comment'># =&gt; { :TOTAL=&gt;10000, :T_CLASS=&gt;158280, :T_MODULE=&gt;20672, :T_STRING=&gt;527249 }
</span></code></pre>

<p>This method is only expected to work on C Ruby.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L3296'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3296
3297
3298
3299
3300
3301
3302
3303
3304
3305
3306
3307
3308
3309
3310
3311
3312
3313
3314
3315
3316
3317
3318
3319
3320
3321
3322
3323
3324
3325
3326
3327
3328
3329
3330
3331
3332
3333
3334
3335
3336
3337
3338
3339
3340
3341
3342
3343
3344
3345
3346
3347
3348
3349
3350
3351
3352
3353
3354
3355
3356
3357
3358
3359
3360
3361
3362
3363
3364
3365
3366
3367
3368
3369
3370
3371
3372
3373
3374
3375
3376
3377
3378</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 3296</span></pre>
<pre class='code cpp'>

static VALUE
count_objects(int argc, VALUE *argv, VALUE os)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    size_t counts[T_MASK+1];
    size_t freed = 0;
    size_t total = 0;
    size_t i;
    VALUE hash;

    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;hash) == 1) {
        if (!RB_TYPE_P(hash, T_HASH))
            rb_raise(rb_eTypeError, &quot;non-hash given&quot;);
    }

    for (i = 0; i &lt;= T_MASK; i++) {
        counts[i] = 0;
    }

    for (i = 0; i &lt; heap_allocated_pages; i++) {
	struct heap_page *page = heap_pages_sorted[i];
	RVALUE *p, *pend;

	p = page-&gt;start; pend = p + page-&gt;total_slots;
	for (;p &lt; pend; p++) {
	    if (p-&gt;as.basic.flags) {
		counts[BUILTIN_TYPE(p)]++;
	    }
	    else {
		freed++;
	    }
	}
	total += page-&gt;total_slots;
    }

    if (hash == Qnil) {
        hash = rb_hash_new();
    }
    else if (!RHASH_EMPTY_P(hash)) {
        st_foreach(RHASH_TBL_RAW(hash), set_zero, hash);
    }
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;TOTAL&quot;)), SIZET2NUM(total));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;FREE&quot;)), SIZET2NUM(freed));

    for (i = 0; i &lt;= T_MASK; i++) {
        VALUE type;
        switch (i) {
#define COUNT_TYPE(t) case (t): type = ID2SYM(rb_intern(#t)); break;
	    COUNT_TYPE(T_NONE);
	    COUNT_TYPE(T_OBJECT);
	    COUNT_TYPE(T_CLASS);
	    COUNT_TYPE(T_MODULE);
	    COUNT_TYPE(T_FLOAT);
	    COUNT_TYPE(T_STRING);
	    COUNT_TYPE(T_REGEXP);
	    COUNT_TYPE(T_ARRAY);
	    COUNT_TYPE(T_HASH);
	    COUNT_TYPE(T_STRUCT);
	    COUNT_TYPE(T_BIGNUM);
	    COUNT_TYPE(T_FILE);
	    COUNT_TYPE(T_DATA);
	    COUNT_TYPE(T_MATCH);
	    COUNT_TYPE(T_COMPLEX);
	    COUNT_TYPE(T_RATIONAL);
	    COUNT_TYPE(T_NIL);
	    COUNT_TYPE(T_TRUE);
	    COUNT_TYPE(T_FALSE);
	    COUNT_TYPE(T_SYMBOL);
	    COUNT_TYPE(T_FIXNUM);
	    COUNT_TYPE(T_IMEMO);
	    COUNT_TYPE(T_UNDEF);
	    COUNT_TYPE(T_NODE);
	    COUNT_TYPE(T_ICLASS);
	    COUNT_TYPE(T_ZOMBIE);
#undef COUNT_TYPE
          default:              type = INT2NUM(i); break;
        }
        if (counts[i])
            rb_hash_aset(hash, type, SIZET2NUM(counts[i]));
    }

    return hash;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="define_finalizer-class_method">
  <h3 class='signature'>
  .<strong>define_finalizer</strong>(obj, aProc = proc())   <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Adds <em>aProc</em> as a finalizer, to be called after <em>obj</em> was
destroyed. The object ID of the <em>obj</em> will be passed as an argument
to <em>aProc</em>. If <em>aProc</em> is a lambda or method, make sure it
can be called with a single argument.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L2618'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2618
2619
2620
2621
2622
2623
2624
2625
2626
2627
2628
2629
2630
2631
2632
2633</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 2618</span></pre>
<pre class='code cpp'>

static VALUE
define_final(int argc, VALUE *argv, VALUE os)
{
    VALUE obj, block;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;obj, &amp;block);
    should_be_finalizable(obj);
    if (argc == 1) {
	block = rb_block_proc();
    }
    else {
	should_be_callable(block);
    }

    return define_final0(obj, block);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="each_object-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>each_object</strong>([) {|obj| ... } &#x21d2; <tt>Fixnum</tt>  <span class="extras">(mod_func)</span></span>
    <span class='overload'>.<strong>each_object</strong>([)  &#x21d2; <tt><a href="Enumerator.html" title="Enumerator (class)">Enumerator</a></tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Calls the block once for each living, nonimmediate object in this Ruby
process. If <em>module</em> is specified, calls the block for only those
classes or modules that match (or are a subclass of) <em>module</em>.
Returns the number of objects found. Immediate objects (<code>Fixnum</code>s,
<a href="Symbol.html" title="Symbol (class)">Symbol</a>s <code>true</code>, <code>false</code>, and <code>nil</code>) are
never returned. In the example below, <code>each_object</code> returns both
the numbers we defined and several constants defined in the <a href="Math.html" title="Math (module)">Math</a> module.</p>

<p>If no block is given, an enumerator is returned instead.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='float'>102.7</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='int'>95</span>       <span class='comment'># Won&#39;t be returned
</span><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='int'>12345678987654321</span>
<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='const'><a href="" title="ObjectSpace (module)">ObjectSpace</a></span><span class='period'>.</span><span class='id identifier rubyid_each_object'>each_object</span><span class='lparen'>(</span><span class='const'><a href="Numeric.html" title="Numeric (class)">Numeric</a></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_x'>x</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Total count: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p><em>produces:</em></p>

<pre class="code ruby"><code class="ruby"><span class='int'>12345678987654321</span>
<span class='float'>102.7</span>
<span class='float'>2.71828182845905</span>
<span class='float'>3.14159265358979</span>
<span class='float'>2.22044604925031e-16</span>
<span class='float'>1.7976931348623157e+308</span>
<span class='float'>2.2250738585072e-308</span>
<span class='const'>Total</span> <span class='label'>count:</span> <span class='int'>7</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L2549'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2549
2550
2551
2552
2553
2554
2555
2556
2557
2558
2559
2560
2561
2562</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 2549</span></pre>
<pre class='code cpp'>

static VALUE
os_each_obj(int argc, VALUE *argv, VALUE os)
{
    VALUE of;

    if (argc == 0) {
	of = 0;
    }
    else {
	rb_scan_args(argc, argv, &quot;01&quot;, &amp;of);
    }
    RETURN_ENUMERATOR(os, 1, &amp;of);
    return os_obj_of(of);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="garbage_collect-class_method">
  <h3 class='signature'>
  <span class='overload'><strong>GC.start</strong>  &#x21d2; <tt>nil</tt>  <span class="extras">(mod_func)</span></span>
    <span class='overload'><strong>GC.garbage_collect</strong>  &#x21d2; <tt>nil</tt> </span>
    <span class='overload'><strong>GC.start</strong>(full_mark:true, immediate_sweep:true)  &#x21d2; <tt>nil</tt> </span>
    <span class='overload'><strong>GC.garbage_collect</strong>(full_mark:true, immediate_sweep:true)  &#x21d2; <tt>nil</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Initiates garbage collection, unless manually disabled.</p>

<p>This method is defined with keyword arguments that default to true:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='const'><a href="GC.html" title="GC (module)">GC</a></span><span class='period'>.</span><span class='id identifier rubyid_start'><a href="GC.html#start-class_method" title="GC.start (method)">start</a></span><span class='lparen'>(</span><span class='label'>full_mark:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>immediate_sweep:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='kw'>end</span>
</code></pre>

<p>Use full_mark: false to perform a minor GC. Use immediate_sweep: false to
defer sweeping (use lazy sweep).</p>

<p>Note: These keyword arguments are implementation and version dependent.
They are not guaranteed to be future-compatible, and may be ignored if the
underlying implementation does not support them.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L6595'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


6595
6596
6597
6598
6599
6600
6601
6602
6603
6604
6605
6606
6607
6608
6609
6610
6611
6612
6613
6614
6615
6616
6617
6618
6619
6620
6621
6622
6623
6624
6625</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 6595</span></pre>
<pre class='code cpp'>

static VALUE
gc_start_internal(int argc, VALUE *argv, VALUE self)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    int full_mark = TRUE, immediate_mark = TRUE, immediate_sweep = TRUE;
    VALUE opt = Qnil;
    static ID keyword_ids[3];

    rb_scan_args(argc, argv, &quot;0:&quot;, &amp;opt);

    if (!NIL_P(opt)) {
	VALUE kwvals[3];

	if (!keyword_ids[0]) {
	    keyword_ids[0] = rb_intern(&quot;full_mark&quot;);
	    keyword_ids[1] = rb_intern(&quot;immediate_mark&quot;);
	    keyword_ids[2] = rb_intern(&quot;immediate_sweep&quot;);
	}

	rb_get_kwargs(opt, keyword_ids, 0, 3, kwvals);

	if (kwvals[0] != Qundef) full_mark = RTEST(kwvals[0]);
	if (kwvals[1] != Qundef) immediate_mark = RTEST(kwvals[1]);
	if (kwvals[2] != Qundef) immediate_sweep = RTEST(kwvals[2]);
    }

    garbage_collect(objspace, full_mark, immediate_mark, immediate_sweep, GPR_FLAG_METHOD);
    gc_finalize_deferred(objspace);

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="undefine_finalizer-class_method">
  <h3 class='signature'>
  .<strong>undefine_finalizer</strong>(obj)   <span class="extras">(mod_func)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Removes all finalizers for <em>obj</em>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/gc.c#L2572'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2572
2573
2574
2575
2576</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'gc.c', line 2572</span></pre>
<pre class='code cpp'>

static VALUE
undefine_final(VALUE os, VALUE obj)
{
    return rb_undefine_finalizer(obj);
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>