<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Encoding::Converter &mdash; Core Ruby-2.4.0 d2016-08-01</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Encoding::Converter",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>Core</a> &raquo; 
          <a href='../_index.html'>Index (C)</a> &raquo; 
          <a href="../Encoding.html" title="Encoding (class)">Encoding</a> &raquo; 
          <span class='title'>Converter</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Encoding::Converter</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="../Data.html" title="Data (class)">Data</a></span>
      <ul class='fullTree'>
        <li><a href="../Object.html" title="Object (class)">Object</a></li>
        <li class='next'><a href="../Data.html" title="Data (class)">Data</a></li>
        <li class='next'>Encoding::Converter</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>





  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4457'>transcode.c</a></div>  </td>
  </tr>
</table>

<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='AFTER_OUTPUT-constant'>
      AFTER_OUTPUT
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Stop converting after some output is complete but before all of the input
was consumed.  See primitive_convert for an example.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='CR_NEWLINE_DECORATOR-constant'>
      CR_NEWLINE_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Decorator for converting LF to CR</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='CRLF_NEWLINE_DECORATOR-constant'>
      CRLF_NEWLINE_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Decorator for converting LF to CRLF</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='INVALID_MASK-constant'>
      INVALID_MASK
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Mask for invalid byte sequences</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='INVALID_REPLACE-constant'>
      INVALID_REPLACE
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Replace invalid byte sequences</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='PARTIAL_INPUT-constant'>
      PARTIAL_INPUT
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Indicates the source may be part of a larger string.  See primitive_convert
for an example.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='UNDEF_HEX_CHARREF-constant'>
      UNDEF_HEX_CHARREF
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Replace byte sequences that are undefined in the destination encoding with
an XML hexadecimal character reference.  This is valid for XML conversion.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='UNDEF_MASK-constant'>
      UNDEF_MASK
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Mask for a valid character in the source encoding but no related
character(s) in destination encoding.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='UNDEF_REPLACE-constant'>
      UNDEF_REPLACE
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Replace byte sequences that are undefined in the destination encoding.</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='UNIVERSAL_NEWLINE_DECORATOR-constant'>
      UNIVERSAL_NEWLINE_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Decorator for converting CRLF and CR to LF</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='XML_ATTR_CONTENT_DECORATOR-constant'>
      XML_ATTR_CONTENT_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Escape as XML AttValue</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='XML_ATTR_QUOTE_DECORATOR-constant'>
      XML_ATTR_QUOTE_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Escape as XML AttValue</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
    <dt id='XML_TEXT_DECORATOR-constant'>
      XML_TEXT_DECORATOR
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Escape as XML CharData</p>


  </div>
</div>
<div class="tags">
  
</div>    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#asciicompat_encoding-class_method" title="asciicompat_encoding (class method)">.<strong>asciicompat_encoding</strong>(string)  &#x21d2; Encoding<sup>?</sup> </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the corresponding ASCII compatible encoding.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(source_encoding, destination_encoding)  </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>possible options elements:</p>

<pre class="code ruby"><code class="ruby">hash form:
  :invalid =&gt; nil            # raise error on invalid byte sequence (default)
  :invalid =&gt; :replace       # replace invalid byte sequence
  :undef =&gt; nil              # raise error on undefined conversion (default)
  :undef =&gt; :replace         # replace undefined conversion
  :replace =&gt; string         # replacement string (&quot;?&quot; or &quot;\uFFFD&quot; if not specified)
  :newline =&gt; :universal     # decorator for converting CRLF and CR to LF
  :newline =&gt; :crlf          # decorator for converting LF to CRLF
  :newline =&gt; :cr            # decorator for converting LF to CR
  :universal_newline =&gt; true # decorator for converting CRLF and CR to LF
  :crlf_newline =&gt; true      # decorator for converting LF to CRLF
  :cr_newline =&gt; true        # decorator for converting LF to CR
  :xml =&gt; :text              # escape as XML CharData.</code></pre>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#search_convpath-class_method" title="search_convpath (class method)">.<strong>search_convpath</strong>(source_encoding, destination_encoding)  &#x21d2; Array </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a conversion path.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%3D%3D-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#convert-instance_method" title="#convert (instance method)">#<strong>convert</strong>(source_string)  &#x21d2; destination_string </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Convert source_string and return destination_string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#convpath-instance_method" title="#convpath (instance method)">#<strong>convpath</strong>  &#x21d2; Array </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the conversion path of ec.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#destination_encoding-instance_method" title="#destination_encoding (instance method)">#<strong>destination_encoding</strong>  &#x21d2; Encoding </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the destination encoding as an Encoding object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#finish-instance_method" title="#finish (instance method)">#<strong>finish</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Finishes the converter.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#insert_output-instance_method" title="#insert_output (instance method)">#<strong>insert_output</strong>(string)  &#x21d2; nil </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Inserts string into the encoding converter.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#last_error-instance_method" title="#last_error (instance method)">#<strong>last_error</strong>  &#x21d2; Exception<sup>?</sup> </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an exception object for the last conversion.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#primitive_convert-instance_method" title="#primitive_convert (instance method)">#<strong>primitive_convert</strong>(source_buffer, destination_buffer)  &#x21d2; symbol </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>possible opt elements:</p>

<pre class="code ruby"><code class="ruby">hash form:
  :partial_input =&gt; true           # source buffer may be part of larger source
  :after_output =&gt; true            # stop conversion after output before input
integer form:
  Encoding::Converter::PARTIAL_INPUT
  Encoding::Converter::AFTER_OUTPUT</code></pre>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#primitive_errinfo-instance_method" title="#primitive_errinfo (instance method)">#<strong>primitive_errinfo</strong>  &#x21d2; Array </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>primitive_errinfo returns important information regarding the last error as
a 5-element array:</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#putback-instance_method" title="#putback (instance method)">#<strong>putback</strong>(*args)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>call-seq</p>

<pre class="code ruby"><code class="ruby">ec.putback                    -&gt; string
ec.putback(max_numbytes)      -&gt; string</code></pre>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#replacement-instance_method" title="#replacement (instance method)">#<strong>replacement</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the replacement string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#replacement%3D-instance_method" title="#replacement= (instance method)">#<strong>replacement=</strong>(string)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the replacement string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source_encoding-instance_method" title="#source_encoding (instance method)">#<strong>source_encoding</strong>  &#x21d2; Encoding </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the source encoding as an Encoding object.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  <h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>new</strong>(source_encoding, destination_encoding)  </span>
    <span class='overload'>.<strong>new</strong>(source_encoding, destination_encoding, opt)  </span>
    <span class='overload'>.<strong>new</strong>(convpath)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>possible options elements:</p>

<pre class="code ruby"><code class="ruby">hash form:
  :invalid =&gt; nil            # raise error on invalid byte sequence (default)
  :invalid =&gt; :replace       # replace invalid byte sequence
  :undef =&gt; nil              # raise error on undefined conversion (default)
  :undef =&gt; :replace         # replace undefined conversion
  :replace =&gt; string         # replacement string (&quot;?&quot; or &quot;\uFFFD&quot; if not specified)
  :newline =&gt; :universal     # decorator for converting CRLF and CR to LF
  :newline =&gt; :crlf          # decorator for converting LF to CRLF
  :newline =&gt; :cr            # decorator for converting LF to CR
  :universal_newline =&gt; true # decorator for converting CRLF and CR to LF
  :crlf_newline =&gt; true      # decorator for converting LF to CRLF
  :cr_newline =&gt; true        # decorator for converting LF to CR
  :xml =&gt; :text              # escape as XML CharData.
  :xml =&gt; :attr              # escape as XML AttValue
integer form:
  Encoding::Converter::INVALID_REPLACE
  Encoding::Converter::UNDEF_REPLACE
  Encoding::Converter::UNDEF_HEX_CHARREF
  Encoding::Converter::UNIVERSAL_NEWLINE_DECORATOR
  Encoding::Converter::CRLF_NEWLINE_DECORATOR
  Encoding::Converter::CR_NEWLINE_DECORATOR
  Encoding::Converter::XML_TEXT_DECORATOR
  Encoding::Converter::XML_ATTR_CONTENT_DECORATOR
  Encoding::Converter::XML_ATTR_QUOTE_DECORATOR</code></pre>

<p><a href="" title="Encoding::Converter (class)">Encoding::Converter</a>.new creates an instance of <a href="" title="Encoding::Converter (class)">Encoding::Converter</a>.</p>

<p>Source_encoding and destination_encoding should be a string or Encoding
object.</p>

<p>opt should be nil, a hash or an integer.</p>

<p>convpath should be an array. convpath may contain</p>
<ul><li>
<p>two-element arrays which contain encodings or encoding names, or</p>
</li><li>
<p>strings representing decorator names.</p>
</li></ul>

<p><a href="" title="Encoding::Converter (class)">Encoding::Converter</a>.new optionally takes an option. The option should be
a hash or an integer. The option hash can contain :invalid =&gt; nil, etc.
The option integer should be logical-or of constants such as
<a href="#INVALID_REPLACE-constant" title="Encoding::Converter::INVALID_REPLACE (constant)">INVALID_REPLACE</a>, etc.</p>
<dl class="rdoc-list label-list"><dt>:invalid =&gt; nil
<dd>
<p>Raise error on invalid byte sequence.  This is a default behavior.</p>
</dd><dt>:invalid =&gt; :replace
<dd>
<p>Replace invalid byte sequence by replacement string.</p>
</dd><dt>:undef =&gt; nil
<dd>
<p>Raise an error if a character in source_encoding is not defined in
destination_encoding. This is a default behavior.</p>
</dd><dt>:undef =&gt; :replace
<dd>
<p>Replace undefined character in destination_encoding with replacement
string.</p>
</dd><dt>:replace =&gt; string
<dd>
<p>Specify the replacement string. If not specified, “uFFFD” is used for
Unicode encodings and “?” for others.</p>
</dd><dt>:universal_newline =&gt; true
<dd>
<p>Convert CRLF and CR to LF.</p>
</dd><dt>:crlf_newline =&gt; true
<dd>
<p>Convert LF to CRLF.</p>
</dd><dt>:cr_newline =&gt; true
<dd>
<p>Convert LF to CR.</p>
</dd><dt>:xml =&gt; :text
<dd>
<p>Escape as XML CharData. This form can be used as a HTML 4.0 #PCDATA.</p>
<ul><li>
<p>&#39;&amp;&#39; -&gt; &#39;&amp;amp;&#39;</p>
</li><li>
<p>&#39;&lt;&#39; -&gt; &#39;&amp;lt;&#39;</p>
</li><li>
<p>&#39;&gt;&#39; -&gt; &#39;&amp;gt;&#39;</p>
</li><li>
<p>undefined characters in destination_encoding -&gt; hexadecimal CharRef such
as &amp;#xHH;</p>
</li></ul>
</dd><dt>:xml =&gt; :attr
<dd>
<p>Escape as XML AttValue. The converted result is quoted as “…”. This form
can be used as a HTML 4.0 attribute value.</p>
<ul><li>
<p>&#39;&amp;&#39; -&gt; &#39;&amp;amp;&#39;</p>
</li><li>
<p>&#39;&lt;&#39; -&gt; &#39;&amp;lt;&#39;</p>
</li><li>
<p>&#39;&gt;&#39; -&gt; &#39;&amp;gt;&#39;</p>
</li><li>
<p>&#39;“&#39; -&gt; &#39;&amp;quot;&#39;</p>
</li><li>
<p>undefined characters in destination_encoding -&gt; hexadecimal CharRef such
as &amp;#xHH;</p>
</li></ul>
</dd></dl>

<p>Examples:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># UTF-16BE to UTF-8
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># Usually, decorators such as newline conversion are inserted last.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:universal_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convpath'>convpath</span> <span class='comment'>#=&gt; [[#&lt;Encoding:UTF-16BE&gt;, #&lt;Encoding:UTF-8&gt;],
</span>              <span class='comment'>#    &quot;universal_newline&quot;]
</span>
<span class='comment'># But, if the last encoding is ASCII incompatible,
</span><span class='comment'># decorators are inserted before the last conversion.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:crlf_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convpath'>convpath</span> <span class='comment'>#=&gt; [&quot;crlf_newline&quot;,
</span>              <span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:UTF-16BE&gt;]]
</span>
<span class='comment'># Conversion path can be specified directly.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>universal_newline</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convpath'>convpath</span> <span class='comment'>#=&gt; [&quot;universal_newline&quot;,
</span>              <span class='comment'>#    [#&lt;Encoding:EUC-JP&gt;, #&lt;Encoding:UTF-8&gt;],
</span>              <span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:UTF-16BE&gt;]]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3383'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3383
3384
3385
3386
3387
3388
3389
3390
3391
3392
3393
3394
3395
3396
3397
3398
3399
3400
3401
3402
3403
3404
3405
3406
3407
3408
3409
3410
3411
3412
3413
3414
3415
3416
3417
3418
3419
3420
3421
3422
3423
3424
3425
3426
3427
3428
3429
3430</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3383</span></pre>
<pre class='code cpp'>

static VALUE
econv_init(int argc, VALUE *argv, VALUE self)
{
    VALUE ecopts;
    VALUE snamev, dnamev;
    const char *sname, *dname;
    rb_encoding *senc, *denc;
    rb_econv_t *ec;
    int ecflags;
    VALUE convpath;

    if (rb_check_typeddata(self, &amp;econv_data_type)) {
        rb_raise(rb_eTypeError, &quot;already initialized&quot;);
    }

    if (argc == 1 &amp;&amp; !NIL_P(convpath = rb_check_array_type(argv[0]))) {
        ec = rb_econv_init_by_convpath(self, convpath, &amp;sname, &amp;dname, &amp;senc, &amp;denc);
        ecflags = 0;
        ecopts = Qnil;
    }
    else {
        econv_args(argc, argv, &amp;snamev, &amp;dnamev, &amp;sname, &amp;dname, &amp;senc, &amp;denc, &amp;ecflags, &amp;ecopts);
        ec = rb_econv_open_opts(sname, dname, ecflags, ecopts);
    }

    if (!ec) {
	VALUE exc = rb_econv_open_exc(sname, dname, ecflags);
	RB_GC_GUARD(snamev);
	RB_GC_GUARD(dnamev);
	rb_exc_raise(exc);
    }

    if (!DECORATOR_P(sname, dname)) {
        if (!senc)
            senc = make_dummy_encoding(sname);
        if (!denc)
            denc = make_dummy_encoding(dname);
	RB_GC_GUARD(snamev);
	RB_GC_GUARD(dnamev);
    }

    ec-&gt;source_encoding = senc;
    ec-&gt;destination_encoding = denc;

    DATA_PTR(self) = ec;

    return self;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="asciicompat_encoding-class_method">
  <h3 class='signature first'>
  <span class='overload'>.<strong>asciicompat_encoding</strong>(string)  &#x21d2; <tt><a href="../Encoding.html" title="Encoding (class)">Encoding</a></tt><sup>?</sup> </span>
    <span class='overload'>.<strong>asciicompat_encoding</strong>(encoding)  &#x21d2; <tt><a href="../Encoding.html" title="Encoding (class)">Encoding</a></tt><sup>?</sup> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the corresponding ASCII compatible encoding.</p>

<p>Returns nil if the argument is an ASCII compatible encoding.</p>

<p>“corresponding ASCII compatible encoding” is an ASCII compatible encoding
which can represents exactly the same characters as the given ASCII
incompatible encoding. So, no conversion undefined error occurs when
converting between the two encodings.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-2022-JP</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; #&lt;Encoding:stateless-ISO-2022-JP&gt;
</span><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; #&lt;Encoding:UTF-8&gt;
</span><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; nil
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L2977'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2977
2978
2979
2980
2981
2982
2983
2984
2985
2986
2987
2988
2989
2990
2991
2992
2993</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 2977</span></pre>
<pre class='code cpp'>

static VALUE
econv_s_asciicompat_encoding(VALUE klass, VALUE arg)
{
    const char *arg_name, *result_name;
    rb_encoding *arg_enc, *result_enc;

    enc_arg(&amp;arg, &amp;arg_name, &amp;arg_enc);

    result_name = rb_econv_asciicompat_encoding(arg_name);

    if (result_name == NULL)
        return Qnil;

    result_enc = make_encoding(result_name);

    return rb_enc_from_encoding(result_enc);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="search_convpath-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>search_convpath</strong>(source_encoding, destination_encoding)  &#x21d2; <tt><a href="../Array.html" title="Array (class)">Array</a></tt> </span>
    <span class='overload'>.<strong>search_convpath</strong>(source_encoding, destination_encoding, opt)  &#x21d2; <tt><a href="../Array.html" title="Array (class)">Array</a></tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a conversion path.</p>

<pre class="code ruby"><code class="ruby">p {Encoding::Converter}.search_convpath(&quot;ISO-8859-1&quot;, &quot;EUC-JP&quot;)
#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, {#&lt;}Encoding:UTF-8&gt;],
#    [#&lt;Encoding:UTF-8&gt;, {#&lt;}Encoding:EUC-JP&gt;]]

p {Encoding::Converter}.search_convpath(&quot;ISO-8859-1&quot;, &quot;EUC-JP&quot;, universal_newline: true)
or
p {Encoding::Converter}.search_convpath(&quot;ISO-8859-1&quot;, &quot;EUC-JP&quot;, newline: :universal)
#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, {#&lt;}Encoding:UTF-8&gt;],
#    [#&lt;Encoding:UTF-8&gt;, {#&lt;}Encoding:EUC-JP&gt;],
#    &quot;universal_newline&quot;]

p {Encoding::Converter}.search_convpath(&quot;ISO-8859-1&quot;, &quot;UTF-32BE&quot;, universal_newline: true)
or
p {Encoding::Converter}.search_convpath(&quot;ISO-8859-1&quot;, &quot;UTF-32BE&quot;, newline: :universal)
#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, {#&lt;}Encoding:UTF-8&gt;],
#    &quot;universal_newline&quot;,
#    [#&lt;Encoding:UTF-8&gt;, {#&lt;}Encoding:UTF-32BE&gt;]]</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3138'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3138
3139
3140
3141
3142
3143
3144
3145
3146
3147
3148
3149
3150
3151
3152
3153
3154
3155
3156
3157
3158
3159
3160
3161
3162
3163
3164</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3138</span></pre>
<pre class='code cpp'>

static VALUE
econv_s_search_convpath(int argc, VALUE *argv, VALUE klass)
{
    VALUE snamev, dnamev;
    const char *sname, *dname;
    rb_encoding *senc, *denc;
    int ecflags;
    VALUE ecopts;
    VALUE convpath;

    econv_args(argc, argv, &amp;snamev, &amp;dnamev, &amp;sname, &amp;dname, &amp;senc, &amp;denc, &amp;ecflags, &amp;ecopts);

    convpath = Qnil;
    transcode_search_path(sname, dname, search_convpath_i, &amp;convpath);

    if (NIL_P(convpath))
        rb_exc_raise(rb_econv_open_exc(sname, dname, ecflags));

    if (decorate_convpath(convpath, ecflags) == -1) {
	VALUE exc = rb_econv_open_exc(sname, dname, ecflags);
	RB_GC_GUARD(snamev);
	RB_GC_GUARD(dnamev);
	rb_exc_raise(exc);
    }

    return convpath;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="==-instance_method">
  <h3 class='signature first'>
  #<strong>==</strong>(other)  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3550'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3550
3551
3552
3553
3554
3555
3556
3557
3558
3559
3560
3561
3562
3563
3564
3565
3566
3567
3568
3569
3570
3571
3572
3573
3574
3575
3576
3577
3578
3579
3580
3581
3582
3583</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3550</span></pre>
<pre class='code cpp'>

static VALUE
econv_equal(VALUE self, VALUE other)
{
    rb_econv_t *ec1 = check_econv(self);
    rb_econv_t *ec2;
    int i;

    if (!rb_typeddata_is_kind_of(other, &amp;econv_data_type)) {
	return Qnil;
    }
    ec2 = DATA_PTR(other);
    if (!ec2) return Qfalse;
    if (ec1-&gt;source_encoding_name != ec2-&gt;source_encoding_name &amp;&amp;
	strcmp(ec1-&gt;source_encoding_name, ec2-&gt;source_encoding_name))
	return Qfalse;
    if (ec1-&gt;destination_encoding_name != ec2-&gt;destination_encoding_name &amp;&amp;
	strcmp(ec1-&gt;destination_encoding_name, ec2-&gt;destination_encoding_name))
	return Qfalse;
    if (ec1-&gt;flags != ec2-&gt;flags) return Qfalse;
    if (ec1-&gt;replacement_enc != ec2-&gt;replacement_enc &amp;&amp;
	strcmp(ec1-&gt;replacement_enc, ec2-&gt;replacement_enc))
	return Qfalse;
    if (ec1-&gt;replacement_len != ec2-&gt;replacement_len) return Qfalse;
    if (ec1-&gt;replacement_str != ec2-&gt;replacement_str &amp;&amp;
	memcmp(ec1-&gt;replacement_str, ec2-&gt;replacement_str, ec2-&gt;replacement_len))
	return Qfalse;

    if (ec1-&gt;num_trans != ec2-&gt;num_trans) return Qfalse;
    for (i = 0; i &lt; ec1-&gt;num_trans; i++) {
        if (ec1-&gt;elems[i].tc-&gt;transcoder != ec2-&gt;elems[i].tc-&gt;transcoder)
	    return Qfalse;
    }
    return Qtrue;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="convert-instance_method">
  <h3 class='signature'>
  #<strong>convert</strong>(source_string)  &#x21d2; <tt>destination_string</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Convert source_string and return destination_string.</p>

<p>source_string is assumed as a part of source. i.e.  :partial_input=&gt;true
is specified internally. finish method should be used last.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u3042</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>     <span class='comment'>#=&gt; &quot;\xA4\xA2&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;&quot;
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xA4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xA2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;\xE3\x81\x82&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;&quot;
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-2022-jp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE3</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x81</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x82</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;\e$B$\&quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;\e(B&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span></code></pre>

<p>If a conversion error occur, <a href="UndefinedConversionError.html" title="Encoding::UndefinedConversionError (class)">UndefinedConversionError</a> or
<a href="InvalidByteSequenceError.html" title="Encoding::InvalidByteSequenceError (class)">InvalidByteSequenceError</a> is raised.
<a href="#convert-instance_method" title="Encoding::Converter#convert (method)">#convert</a> doesn&#39;t supply methods to recover or
restart from these exceptions. When you want to handle these conversion
errors, use <a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">#primitive_convert</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3840'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3840
3841
3842
3843
3844
3845
3846
3847
3848
3849
3850
3851
3852
3853
3854
3855
3856
3857
3858
3859
3860
3861
3862
3863
3864
3865
3866
3867
3868
3869
3870
3871
3872
3873
3874
3875
3876
3877</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3840</span></pre>
<pre class='code cpp'>

static VALUE
econv_convert(VALUE self, VALUE source_string)
{
    VALUE ret, dst;
    VALUE av[5];
    int ac;
    rb_econv_t *ec = check_econv(self);

    StringValue(source_string);

    dst = rb_str_new(NULL, 0);

    av[0] = rb_str_dup(source_string);
    av[1] = dst;
    av[2] = Qnil;
    av[3] = Qnil;
    av[4] = INT2NUM(ECONV_PARTIAL_INPUT);
    ac = 5;

    ret = econv_primitive_convert(ac, av, self);

    if (ret == sym_invalid_byte_sequence ||
        ret == sym_undefined_conversion ||
        ret == sym_incomplete_input) {
        VALUE exc = make_econv_exception(ec);
        rb_exc_raise(exc);
    }

    if (ret == sym_finished) {
        rb_raise(rb_eArgError, &quot;converter already finished&quot;);
    }

    if (ret != sym_source_buffer_empty) {
        rb_bug(&quot;unexpected result of econv_primitive_convert&quot;);
    }

    return dst;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="convpath-instance_method">
  <h3 class='signature'>
  #<strong>convpath</strong>  &#x21d2; <tt><a href="../Array.html" title="Array (class)">Array</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the conversion path of ec.</p>

<p>The result is an array of conversions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>crlf_newline:</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convpath'>convpath</span>
<span class='comment'>#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, #&lt;Encoding:UTF-8&gt;],
</span><span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:EUC-JP&gt;],
</span><span class='comment'>#    &quot;crlf_newline&quot;]
</span></code></pre>

<p>Each element of the array is a pair of encodings or a string. A pair means
an encoding conversion. A string means a decorator.</p>

<p>In the above example, [#&lt;Encoding:ISO-8859-1&gt;,
#&lt;Encoding:UTF-8&gt;] means a converter from ISO-8859-1 to UTF-8.
“crlf_newline” means newline converter from LF to CRLF.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3526'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3526
3527
3528
3529
3530
3531
3532
3533
3534
3535
3536
3537
3538
3539
3540
3541
3542
3543
3544</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3526</span></pre>
<pre class='code cpp'>

static VALUE
econv_convpath(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    VALUE result;
    int i;

    result = rb_ary_new();
    for (i = 0; i &lt; ec-&gt;num_trans; i++) {
        const rb_transcoder *tr = ec-&gt;elems[i].tc-&gt;transcoder;
        VALUE v;
        if (DECORATOR_P(tr-&gt;src_encoding, tr-&gt;dst_encoding))
            v = rb_str_new_cstr(tr-&gt;dst_encoding);
        else
            v = rb_assoc_new(make_encobj(tr-&gt;src_encoding), make_encobj(tr-&gt;dst_encoding));
        rb_ary_push(result, v);
    }
    return result;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="destination_encoding-instance_method">
  <h3 class='signature'>
  #<strong>destination_encoding</strong>  &#x21d2; <tt><a href="../Encoding.html" title="Encoding (class)">Encoding</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the destination encoding as an Encoding object.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3495'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3495
3496
3497
3498
3499
3500
3501
3502</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3495</span></pre>
<pre class='code cpp'>

static VALUE
econv_destination_encoding(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    if (!ec-&gt;destination_encoding)
        return Qnil;
    return rb_enc_from_encoding(ec-&gt;destination_encoding);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="finish-instance_method">
  <h3 class='signature'>
  #<strong>finish</strong>  &#x21d2; <tt><a href="../String.html" title="String (class)">String</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Finishes the converter. It returns the last part of the converted string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-2022-jp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u3042</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; &quot;\e$B$\&quot;&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span>                <span class='comment'>#=&gt; &quot;\e(B&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3890'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3890
3891
3892
3893
3894
3895
3896
3897
3898
3899
3900
3901
3902
3903
3904
3905
3906
3907
3908
3909
3910
3911
3912
3913
3914
3915
3916
3917
3918
3919
3920
3921</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3890</span></pre>
<pre class='code cpp'>

static VALUE
econv_finish(VALUE self)
{
    VALUE ret, dst;
    VALUE av[5];
    int ac;
    rb_econv_t *ec = check_econv(self);

    dst = rb_str_new(NULL, 0);

    av[0] = Qnil;
    av[1] = dst;
    av[2] = Qnil;
    av[3] = Qnil;
    av[4] = INT2FIX(0);
    ac = 5;

    ret = econv_primitive_convert(ac, av, self);

    if (ret == sym_invalid_byte_sequence ||
        ret == sym_undefined_conversion ||
        ret == sym_incomplete_input) {
        VALUE exc = make_econv_exception(ec);
        rb_exc_raise(exc);
    }

    if (ret != sym_finished) {
        rb_bug(&quot;unexpected result of econv_primitive_convert&quot;);
    }

    return dst;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="insert_output-instance_method">
  <h3 class='signature'>
  #<strong>insert_output</strong>(string)  &#x21d2; <tt>nil</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Inserts string into the encoding converter. The string will be converted to
the destination encoding and output on later conversions.</p>

<p>If the destination encoding is stateful, string is converted according to
the state and the state is updated.</p>

<p>This method should be used only when a conversion error occurs.</p>

<pre class="code ruby"><code class="ruby">ec = {Encoding::Converter}.new(&quot;utf-8&quot;, &quot;iso-8859-1&quot;)
src = &quot;HIRAGANA LETTER A is \u{3042}.&quot;
dst = &quot;&quot;
p ec.primitive_convert(src, dst)    #=&gt; :undefined_conversion
puts &quot;[#{dst.dump}, #{src.dump}]&quot;   #=&gt; [&quot;HIRAGANA LETTER A is &quot;, &quot;.&quot;]
ec.insert_output(&quot;&lt;err&gt;&quot;)
p ec.primitive_convert(src, dst)    #=&gt; :finished
puts &quot;[#{dst.dump}, #{src.dump}]&quot;   #=&gt; [&quot;HIRAGANA LETTER A is &lt;err&gt;.&quot;, &quot;&quot;]

ec = {Encoding::Converter}.new(&quot;utf-8&quot;, &quot;iso-2022-jp&quot;)
src = &quot;\u{306F 3041 3068 2661 3002}&quot; # U+2661 is not representable in iso-2022-jp
dst = &quot;&quot;
p ec.primitive_convert(src, dst)    #=&gt; :undefined_conversion
puts &quot;[#{dst.dump}, #{src.dump}]&quot;   #=&gt; [&quot;\e$B$O$!$H&quot;.force_encoding(&quot;ISO-2022-JP&quot;), &quot;\xE3\x80\x82&quot;]
ec.insert_output &quot;?&quot;                # state change required to output &quot;?&quot;.
p ec.primitive_convert(src, dst)    #=&gt; :finished
puts &quot;[#{dst.dump}, #{src.dump}]&quot;   #=&gt; [&quot;\e$B$O$!$H\e(B?\e$B!#\e(B&quot;.force_encoding(&quot;ISO-2022-JP&quot;), &quot;&quot;]</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4056'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4056
4057
4058
4059
4060
4061
4062
4063
4064
4065
4066
4067
4068
4069
4070
4071
4072
4073
4074
4075</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4056</span></pre>
<pre class='code cpp'>

static VALUE
econv_insert_output(VALUE self, VALUE string)
{
    const char *insert_enc;

    int ret;

    rb_econv_t *ec = check_econv(self);

    StringValue(string);
    insert_enc = rb_econv_encoding_to_insert_output(ec);
    string = rb_str_encode(string, rb_enc_from_encoding(rb_enc_find(insert_enc)), 0, Qnil);

    ret = rb_econv_insert_output(ec, (const unsigned char *)RSTRING_PTR(string), RSTRING_LEN(string), insert_enc);
    if (ret == -1) {
	rb_raise(rb_eArgError, &quot;too big string&quot;);
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="last_error-instance_method">
  <h3 class='signature'>
  #<strong>last_error</strong>  &#x21d2; <tt><a href="../Exception.html" title="Exception (class)">Exception</a></tt><sup>?</sup> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an exception object for the last conversion. Returns nil if the
last conversion did not produce an error.</p>

<p>“error” means that <a href="InvalidByteSequenceError.html" title="Encoding::InvalidByteSequenceError (class)">InvalidByteSequenceError</a> and
<a href="UndefinedConversionError.html" title="Encoding::UndefinedConversionError (class)">UndefinedConversionError</a> for <a href="#convert-instance_method" title="Encoding::Converter#convert (method)">#convert</a> and
:invalid_byte_sequence, :incomplete_input and :undefined_conversion for
<a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">#primitive_convert</a>.</p>

<pre class="code ruby"><code class="ruby">ec = {Encoding::Converter}.new(&quot;utf-8&quot;, &quot;iso-8859-1&quot;)
p ec.primitive_convert(src=&quot;\xf1abcd&quot;, dst=&quot;&quot;)       #=&gt; :invalid_byte_sequence
p ec.last_error      #=&gt; {#&lt;}Encoding::InvalidByteSequenceError: &quot;\xF1&quot; followed by &quot;a&quot; on UTF-8&gt;
p ec.primitive_convert(src, dst, nil, 1)             #=&gt; :destination_buffer_full
p ec.last_error      #=&gt; nil</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4150'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4150
4151
4152
4153
4154
4155
4156
4157
4158
4159
4160</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4150</span></pre>
<pre class='code cpp'>

static VALUE
econv_last_error(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    VALUE exc;

    exc = make_econv_exception(ec);
    if (NIL_P(exc))
        return Qnil;
    return exc;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="primitive_convert-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer)  &#x21d2; <tt>symbol</tt> </span>
    <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset)  &#x21d2; <tt>symbol</tt> </span>
    <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset, destination_bytesize)  &#x21d2; <tt>symbol</tt> </span>
    <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset, destination_bytesize, opt)  &#x21d2; <tt>symbol</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>possible opt elements:</p>

<pre class="code ruby"><code class="ruby">hash form:
  :partial_input =&gt; true           # source buffer may be part of larger source
  :after_output =&gt; true            # stop conversion after output before input
integer form:
  Encoding::Converter::PARTIAL_INPUT
  Encoding::Converter::AFTER_OUTPUT</code></pre>

<p>possible results:</p>

<pre class="code ruby"><code class="ruby"><span class='symbol'>:invalid_byte_sequence</span>
<span class='symbol'>:incomplete_input</span>
<span class='symbol'>:undefined_conversion</span>
<span class='symbol'>:after_output</span>
<span class='symbol'>:destination_buffer_full</span>
<span class='symbol'>:source_buffer_empty</span>
<span class='symbol'>:finished</span>
</code></pre>

<p>primitive_convert converts source_buffer into destination_buffer.</p>

<p>source_buffer should be a string or nil. nil means an empty string.</p>

<p>destination_buffer should be a string.</p>

<p>destination_byteoffset should be an integer or nil. nil means the end of
destination_buffer. If it is omitted, nil is assumed.</p>

<p>destination_bytesize should be an integer or nil. nil means unlimited. If
it is omitted, nil is assumed.</p>

<p>opt should be nil, a hash or an integer. nil means no flags. If it is
omitted, nil is assumed.</p>

<p>primitive_convert converts the content of source_buffer from beginning and
store the result into destination_buffer.</p>

<p>destination_byteoffset and destination_bytesize specify the region which
the converted result is stored. destination_byteoffset specifies the start
position in destination_buffer in bytes. If destination_byteoffset is nil,
destination_buffer.bytesize is used for appending the result.
destination_bytesize specifies maximum number of bytes. If
destination_bytesize is nil, destination size is unlimited. After
conversion, destination_buffer is resized to destination_byteoffset +
actually produced number of bytes. Also destination_buffer&#39;s encoding
is set to destination_encoding.</p>

<p>primitive_convert drops the converted part of source_buffer. the dropped
part is converted in destination_buffer or buffered in
<a href="" title="Encoding::Converter (class)">Encoding::Converter</a> object.</p>

<p>primitive_convert stops conversion when one of following condition met.</p>
<ul><li>
<p>invalid byte sequence found in source buffer (:invalid_byte_sequence)
<code>primitive_errinfo</code> and <code>last_error</code> methods returns
the detail of the error.</p>
</li><li>
<p>unexpected end of source buffer (:incomplete_input) this occur only when
:partial_input is not specified. <code>primitive_errinfo</code> and
<code>last_error</code> methods returns the detail of the error.</p>
</li><li>
<p>character not representable in output encoding (:undefined_conversion)
<code>primitive_errinfo</code> and <code>last_error</code> methods returns
the detail of the error.</p>
</li><li>
<p>after some output is generated, before input is done (:after_output) this
occur only when :after_output is specified.</p>
</li><li>
<p>destination buffer is full (:destination_buffer_full) this occur only when
destination_bytesize is non-nil.</p>
</li><li>
<p>source buffer is empty (:source_buffer_empty) this occur only when
:partial_input is specified.</p>
</li><li>
<p>conversion is finished (:finished)</p>
</li></ul>

<p>example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>100</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [:finished, &quot;&quot;, &quot;\x00p\x00i&quot;]
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [:destination_buffer_full, &quot;i&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [:destination_buffer_full, &quot;&quot;, &quot;p&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [:destination_buffer_full, &quot;&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [:finished, &quot;&quot;, &quot;i&quot;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3694'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3694
3695
3696
3697
3698
3699
3700
3701
3702
3703
3704
3705
3706
3707
3708
3709
3710
3711
3712
3713
3714
3715
3716
3717
3718
3719
3720
3721
3722
3723
3724
3725
3726
3727
3728
3729
3730
3731
3732
3733
3734
3735
3736
3737
3738
3739
3740
3741
3742
3743
3744
3745
3746
3747
3748
3749
3750
3751
3752
3753
3754
3755
3756
3757
3758
3759
3760
3761
3762
3763
3764
3765
3766
3767
3768
3769
3770
3771
3772
3773
3774
3775
3776
3777
3778
3779
3780
3781
3782
3783
3784
3785
3786
3787
3788
3789
3790
3791
3792
3793
3794
3795
3796
3797
3798
3799
3800
3801
3802
3803
3804</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3694</span></pre>
<pre class='code cpp'>

static VALUE
econv_primitive_convert(int argc, VALUE *argv, VALUE self)
{
    VALUE input, output, output_byteoffset_v, output_bytesize_v, opt, flags_v;
    rb_econv_t *ec = check_econv(self);
    rb_econv_result_t res;
    const unsigned char *ip, *is;
    unsigned char *op, *os;
    long output_byteoffset, output_bytesize;
    unsigned long output_byteend;
    int flags;

    argc = rb_scan_args(argc, argv, &quot;23:&quot;, &amp;input, &amp;output, &amp;output_byteoffset_v, &amp;output_bytesize_v, &amp;flags_v, &amp;opt);

    if (NIL_P(output_byteoffset_v))
        output_byteoffset = 0; /* dummy */
    else
        output_byteoffset = NUM2LONG(output_byteoffset_v);

    if (NIL_P(output_bytesize_v))
        output_bytesize = 0; /* dummy */
    else
        output_bytesize = NUM2LONG(output_bytesize_v);

    if (!NIL_P(flags_v)) {
	if (!NIL_P(opt)) {
	    rb_error_arity(argc + 1, 2, 5);
	}
	flags = NUM2INT(rb_to_int(flags_v));
    }
    else if (!NIL_P(opt)) {
        VALUE v;
        flags = 0;
        v = rb_hash_aref(opt, sym_partial_input);
        if (RTEST(v))
            flags |= ECONV_PARTIAL_INPUT;
        v = rb_hash_aref(opt, sym_after_output);
        if (RTEST(v))
            flags |= ECONV_AFTER_OUTPUT;
    }
    else {
        flags = 0;
    }

    StringValue(output);
    if (!NIL_P(input))
        StringValue(input);
    rb_str_modify(output);

    if (NIL_P(output_bytesize_v)) {
        output_bytesize = RSTRING_EMBED_LEN_MAX;
        if (!NIL_P(input) &amp;&amp; output_bytesize &lt; RSTRING_LEN(input))
            output_bytesize = RSTRING_LEN(input);
    }

  retry:

    if (NIL_P(output_byteoffset_v))
        output_byteoffset = RSTRING_LEN(output);

    if (output_byteoffset &lt; 0)
        rb_raise(rb_eArgError, &quot;negative output_byteoffset&quot;);

    if (RSTRING_LEN(output) &lt; output_byteoffset)
        rb_raise(rb_eArgError, &quot;output_byteoffset too big&quot;);

    if (output_bytesize &lt; 0)
        rb_raise(rb_eArgError, &quot;negative output_bytesize&quot;);

    output_byteend = (unsigned long)output_byteoffset +
                     (unsigned long)output_bytesize;

    if (output_byteend &lt; (unsigned long)output_byteoffset ||
        LONG_MAX &lt; output_byteend)
        rb_raise(rb_eArgError, &quot;output_byteoffset+output_bytesize too big&quot;);

    if (rb_str_capacity(output) &lt; output_byteend)
        rb_str_resize(output, output_byteend);

    if (NIL_P(input)) {
        ip = is = NULL;
    }
    else {
        ip = (const unsigned char *)RSTRING_PTR(input);
        is = ip + RSTRING_LEN(input);
    }

    op = (unsigned char *)RSTRING_PTR(output) + output_byteoffset;
    os = op + output_bytesize;

    res = rb_econv_convert(ec, &amp;ip, is, &amp;op, os, flags);
    rb_str_set_len(output, op-(unsigned char *)RSTRING_PTR(output));
    if (!NIL_P(input)) {
        OBJ_INFECT_RAW(output, input);
        rb_str_drop_bytes(input, ip - (unsigned char *)RSTRING_PTR(input));
    }

    if (NIL_P(output_bytesize_v) &amp;&amp; res == econv_destination_buffer_full) {
        if (LONG_MAX / 2 &lt; output_bytesize)
            rb_raise(rb_eArgError, &quot;too long conversion result&quot;);
        output_bytesize *= 2;
        output_byteoffset_v = Qnil;
        goto retry;
    }

    if (ec-&gt;destination_encoding) {
        rb_enc_associate(output, ec-&gt;destination_encoding);
    }

    return econv_result_to_symbol(res);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="primitive_errinfo-instance_method">
  <h3 class='signature'>
  #<strong>primitive_errinfo</strong>  &#x21d2; <tt><a href="../Array.html" title="Array (class)">Array</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>primitive_errinfo returns important information regarding the last error as
a 5-element array:</p>

<pre class="code ruby"><code class="ruby"><span class='lbracket'>[</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_enc1'>enc1</span><span class='comma'>,</span> <span class='id identifier rubyid_enc2'>enc2</span><span class='comma'>,</span> <span class='id identifier rubyid_error_bytes'>error_bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_readagain_bytes'>readagain_bytes</span><span class='rbracket'>]</span>
</code></pre>

<p>result is the last result of primitive_convert.</p>

<p>Other elements are only meaningful when result is :invalid_byte_sequence,
:incomplete_input or :undefined_conversion.</p>

<p>enc1 and enc2 indicate a conversion step as a pair of strings. For example,
a converter from EUC-JP to ISO-8859-1 converts a string as follows: EUC-JP
-&gt; UTF-8 -&gt; ISO-8859-1. So [enc1, enc2] is either [“EUC-JP”, “UTF-8”]
or [“UTF-8”, “ISO-8859-1”].</p>

<p>error_bytes and readagain_bytes indicate the byte sequences which caused
the error. error_bytes is discarded portion. readagain_bytes is buffered
portion which is read again on next conversion.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># \xff is invalid as EUC-JP.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Shift_JIS</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xff</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;EUC-JP&quot;, &quot;UTF-8&quot;, &quot;\xFF&quot;, &quot;&quot;]
</span>
<span class='comment'># HIRAGANA LETTER A (\xa4\xa2 in EUC-JP) is not representable in ISO-8859-1.
</span><span class='comment'># Since this error is occur in UTF-8 to ISO-8859-1 conversion,
</span><span class='comment'># error_bytes is HIRAGANA LETTER A in UTF-8 (\xE3\x81\x82).
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4\xa2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:undefined_conversion, &quot;UTF-8&quot;, &quot;ISO-8859-1&quot;, &quot;\xE3\x81\x82&quot;, &quot;&quot;]
</span>
<span class='comment'># partial character is invalid
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:incomplete_input, &quot;EUC-JP&quot;, &quot;UTF-8&quot;, &quot;\xA4&quot;, &quot;&quot;]
</span>
<span class='comment'># Encoding::Converter::PARTIAL_INPUT prevents invalid errors by
</span><span class='comment'># partial characters.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='op'>::</span><span class='const'><a href="#PARTIAL_INPUT-constant" title="Encoding::Converter::PARTIAL_INPUT (constant)">PARTIAL_INPUT</a></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:source_buffer_empty, nil, nil, nil, nil]
</span>
<span class='comment'># \xd8\x00\x00@ is invalid as UTF-16BE because
</span><span class='comment'># no low surrogate after high surrogate (\xd8\x00).
</span><span class='comment'># It is detected by 3rd byte (\00) which is part of next character.
</span><span class='comment'># So the high surrogate (\xd8\x00) is discarded and
</span><span class='comment'># the 3rd byte is read again later.
</span><span class='comment'># Since the byte is buffered in ec, it is dropped from src.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xd8\x00\x00@</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16BE&quot;, &quot;UTF-8&quot;, &quot;\xD8\x00&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_src'>src</span>
<span class='comment'>#=&gt; &quot;@&quot;
</span>
<span class='comment'># Similar to UTF-16BE, \x00\xd8@\x00 is invalid as UTF-16LE.
</span><span class='comment'># The problem is detected by 4th byte.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16LE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00\xd8@\x00</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16LE&quot;, &quot;UTF-8&quot;, &quot;\x00\xD8&quot;, &quot;@\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_src'>src</span>
<span class='comment'>#=&gt; &quot;&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3998'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3998
3999
4000
4001
4002
4003
4004
4005
4006
4007
4008
4009
4010
4011
4012
4013
4014
4015
4016
4017
4018
4019
4020
4021
4022</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3998</span></pre>
<pre class='code cpp'>

static VALUE
econv_primitive_errinfo(VALUE self)
{
    rb_econv_t *ec = check_econv(self);

    VALUE ary;

    ary = rb_ary_new2(5);

    rb_ary_store(ary, 0, econv_result_to_symbol(ec-&gt;last_error.result));
    rb_ary_store(ary, 4, Qnil);

    if (ec-&gt;last_error.source_encoding)
        rb_ary_store(ary, 1, rb_str_new2(ec-&gt;last_error.source_encoding));

    if (ec-&gt;last_error.destination_encoding)
        rb_ary_store(ary, 2, rb_str_new2(ec-&gt;last_error.destination_encoding));

    if (ec-&gt;last_error.error_bytes_start) {
        rb_ary_store(ary, 3, rb_str_new((const char *)ec-&gt;last_error.error_bytes_start, ec-&gt;last_error.error_bytes_len));
        rb_ary_store(ary, 4, rb_str_new((const char *)ec-&gt;last_error.error_bytes_start + ec-&gt;last_error.error_bytes_len, ec-&gt;last_error.readagain_len));
    }

    return ary;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="putback-instance_method">
  <h3 class='signature'>
  #<strong>putback</strong>(*args)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>call-seq</p>

<pre class="code ruby"><code class="ruby">ec.putback                    -&gt; string
ec.putback(max_numbytes)      -&gt; string</code></pre>

<p>Put back the bytes which will be converted.</p>

<p>The bytes are caused by invalid_byte_sequence error. When
invalid_byte_sequence error, some bytes are discarded and some bytes are
buffered to be converted later. The latter bytes can be put back. It can be
observed by <a href="InvalidByteSequenceError.html#readagain_bytes-instance_method" title="Encoding::InvalidByteSequenceError#readagain_bytes (method)">InvalidByteSequenceError#readagain_bytes</a> and
<a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">#primitive_errinfo</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'><a href="" title="Encoding::Converter (class)">Converter</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-16le</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00\xd8\x61\x00</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_convert'>primitive_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; :invalid_byte_sequence
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>     <span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16LE&quot;, &quot;UTF-8&quot;, &quot;\x00\xD8&quot;, &quot;a\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_putback'>putback</span>               <span class='comment'>#=&gt; &quot;a\x00&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span><span class='period'>.</span><span class='id identifier rubyid_putback'>putback</span>               <span class='comment'>#=&gt; &quot;&quot;          # no more bytes to put back
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4101'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4101
4102
4103
4104
4105
4106
4107
4108
4109
4110
4111
4112
4113
4114
4115
4116
4117
4118
4119
4120
4121
4122
4123
4124
4125
4126
4127
4128</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4101</span></pre>
<pre class='code cpp'>

static VALUE
econv_putback(int argc, VALUE *argv, VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    int n;
    int putbackable;
    VALUE str, max;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;max);

    if (NIL_P(max))
        n = rb_econv_putbackable(ec);
    else {
        n = NUM2INT(max);
        putbackable = rb_econv_putbackable(ec);
        if (putbackable &lt; n)
            n = putbackable;
    }

    str = rb_str_new(NULL, n);
    rb_econv_putback(ec, (unsigned char *)RSTRING_PTR(str), n);

    if (ec-&gt;source_encoding) {
        rb_enc_associate(str, ec-&gt;source_encoding);
    }

    return str;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="replacement-instance_method">
  <h3 class='signature'>
  #<strong>replacement</strong>  &#x21d2; <tt><a href="../String.html" title="String (class)">String</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the replacement string.</p>

<pre class="code ruby"><code class="ruby">ec = {Encoding::Converter}.new(&quot;euc-jp&quot;, &quot;us-ascii&quot;)
p ec.replacement    #=&gt; &quot;?&quot;

ec = {Encoding::Converter}.new(&quot;euc-jp&quot;, &quot;utf-8&quot;)
p ec.replacement    #=&gt; &quot;\uFFFD&quot;</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4174'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4174
4175
4176
4177
4178
4179
4180
4181
4182
4183
4184
4185
4186
4187
4188</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4174</span></pre>
<pre class='code cpp'>

static VALUE
econv_get_replacement(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    int ret;
    rb_encoding *enc;

    ret = make_replacement(ec);
    if (ret == -1) {
        rb_raise(rb_eUndefinedConversionError, &quot;replacement character setup failed&quot;);
    }

    enc = rb_enc_find(ec-&gt;replacement_enc);
    return rb_enc_str_new((const char *)ec-&gt;replacement_str, (long)ec-&gt;replacement_len, enc);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="replacement=-instance_method">
  <h3 class='signature'>
  #<strong>replacement=</strong>(string)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the replacement string.</p>

<pre class="code ruby"><code class="ruby">ec = {Encoding::Converter}.new(&quot;utf-8&quot;, &quot;us-ascii&quot;, :undef =&gt; :replace)
ec.replacement = &quot;&lt;undef&gt;&quot;
p ec.convert(&quot;a \u3042 b&quot;)      #=&gt; &quot;a &lt;undef&gt; b&quot;</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L4200'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4200
4201
4202
4203
4204
4205
4206
4207
4208
4209
4210
4211
4212
4213
4214
4215
4216
4217
4218
4219
4220
4221
4222</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4200</span></pre>
<pre class='code cpp'>

static VALUE
econv_set_replacement(VALUE self, VALUE arg)
{
    rb_econv_t *ec = check_econv(self);
    VALUE string = arg;
    int ret;
    rb_encoding *enc;

    StringValue(string);
    enc = rb_enc_get(string);

    ret = rb_econv_set_replacement(ec,
            (const unsigned char *)RSTRING_PTR(string),
            RSTRING_LEN(string),
            rb_enc_name(enc));

    if (ret == -1) {
        /* xxx: rb_eInvalidByteSequenceError? */
        rb_raise(rb_eUndefinedConversionError, &quot;replacement character setup failed&quot;);
    }

    return arg;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="source_encoding-instance_method">
  <h3 class='signature'>
  #<strong>source_encoding</strong>  &#x21d2; <tt><a href="../Encoding.html" title="Encoding (class)">Encoding</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the source encoding as an Encoding object.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/transcode.c#L3480'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3480
3481
3482
3483
3484
3485
3486
3487</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3480</span></pre>
<pre class='code cpp'>

static VALUE
econv_source_encoding(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    if (!ec-&gt;source_encoding)
        return Qnil;
    return rb_enc_from_encoding(ec-&gt;source_encoding);
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>