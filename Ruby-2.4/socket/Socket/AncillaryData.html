<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Socket::AncillaryData &mdash; socket Ruby-2.4.0 d2016-08-04</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Socket::AncillaryData",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='../index.html'>socket</a> &raquo; 
          <a href='../_index.html'>Index (A)</a> &raquo; 
          <a href="../Socket.html" title="Socket (class)">Socket</a> &raquo; 
          <span class='title'>AncillaryData</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Socket::AncillaryData</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>Object</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>Socket::AncillaryData</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1696'>ext/socket/ancdata.c</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p><a href="" title="Socket::AncillaryData (class)">AncillaryData</a> represents the ancillary data (control information)
used by sendmsg and recvmsg system call.  It contains socket <a href="#family-instance_method" title="Socket::AncillaryData#family (method)">#family</a>,
control message (cmsg) <a href="#level-instance_method" title="Socket::AncillaryData#level (method)">#level</a>, cmsg <a href="#type-instance_method" title="Socket::AncillaryData#type (method)">#type</a> and cmsg <a href="#data-instance_method" title="Socket::AncillaryData#data (method)">#data</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#int-class_method" title="int (class method)">.<strong>int</strong>(family, cmsg_level, cmsg_type, integer)  &#x21d2; AncillaryData </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new <a href="" title="Socket::AncillaryData (class)">AncillaryData</a> object which contains a int as data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ip_pktinfo-class_method" title="ip_pktinfo (class method)">.<strong>ip_pktinfo</strong>(addr, ifindex)  &#x21d2; ancdata </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns new ancillary data for IP_PKTINFO.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ipv6_pktinfo-class_method" title="ipv6_pktinfo (class method)">.<strong>ipv6_pktinfo</strong>(addr, ifindex)  &#x21d2; ancdata </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns new ancillary data for IPV6_PKTINFO.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(family, cmsg_level, cmsg_type, cmsg_data)  &#x21d2; AncillaryData </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p><em>family</em> should be an integer, a string or a symbol.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix_rights-class_method" title="unix_rights (class method)">.<strong>unix_rights</strong>(io1, io2, ...)  &#x21d2; AncillaryData </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new <a href="" title="Socket::AncillaryData (class)">AncillaryData</a> object which contains file
descriptors as data.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#cmsg_is%3F-instance_method" title="#cmsg_is? (instance method)">#<strong>cmsg_is?</strong>(level, type)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>tests the level and type of <em>ancillarydata</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#data-instance_method" title="#data (instance method)">#<strong>data</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the cmsg data as a string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#family-instance_method" title="#family (instance method)">#<strong>family</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the socket family as an integer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns a string which shows ancillarydata in human-readable form.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#int-instance_method" title="#int (instance method)">#<strong>int</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the data in <em>ancillarydata</em> as an int.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ip_pktinfo-instance_method" title="#ip_pktinfo (instance method)">#<strong>ip_pktinfo</strong>  &#x21d2; Array, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts addr, ifindex and spec_dst from IP_PKTINFO ancillary data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ipv6_pktinfo-instance_method" title="#ipv6_pktinfo (instance method)">#<strong>ipv6_pktinfo</strong>  &#x21d2; Array, ifindex </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts addr and ifindex from IPV6_PKTINFO ancillary data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ipv6_pktinfo_addr-instance_method" title="#ipv6_pktinfo_addr (instance method)">#<strong>ipv6_pktinfo_addr</strong>  &#x21d2; addr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts addr from IPV6_PKTINFO ancillary data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ipv6_pktinfo_ifindex-instance_method" title="#ipv6_pktinfo_ifindex (instance method)">#<strong>ipv6_pktinfo_ifindex</strong>  &#x21d2; addr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts ifindex from IPV6_PKTINFO ancillary data.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#level-instance_method" title="#level (instance method)">#<strong>level</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the cmsg level as an integer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#timestamp-instance_method" title="#timestamp (instance method)">#<strong>timestamp</strong>  &#x21d2; Time </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the timestamp as a time object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#type-instance_method" title="#type (instance method)">#<strong>type</strong>  &#x21d2; Integer </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the cmsg type as an integer.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix_rights-instance_method" title="#unix_rights (instance method)">#<strong>unix_rights</strong>  &#x21d2; array-of-IOs<sup>?</sup> </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>returns the array of IO objects for SCM_RIGHTS control message in UNIX
domain socket.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(family, cmsg_level, cmsg_type, cmsg_data)  &#x21d2; <tt><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p><em>family</em> should be an integer, a string or a symbol.</p>
<ul><li>
<p><code>Socket::AF_INET</code>, “AF_INET”, “INET”, :AF_INET, :INET</p>
</li><li>
<p><code>Socket::AF_UNIX</code>, “AF_UNIX”, “UNIX”, :AF_UNIX, :UNIX</p>
</li><li>
<p>etc.</p>
</li></ul>

<p><em>cmsg_level</em> should be an integer, a string or a symbol.</p>
<ul><li>
<p>SOL_SOCKET, “SOL_SOCKET”, “SOCKET”, :SOL_SOCKET and :SOCKET</p>
</li><li>
<p>IPPROTO_IP, “IP” and :IP</p>
</li><li>
<p>IPPROTO_IPV6, “IPV6” and :IPV6</p>
</li><li>
<p>IPPROTO_TCP, “TCP” and :TCP</p>
</li><li>
<p>etc.</p>
</li></ul>

<p><em>cmsg_type</em> should be an integer, a string or a symbol. If a
string/symbol is specified, it is interpreted depend on
<em>cmsg_level</em>.</p>
<ul><li>
<p>SCM_RIGHTS, “SCM_RIGHTS”, “RIGHTS”, :SCM_RIGHTS, :RIGHTS for
SOL_SOCKET</p>
</li><li>
<p>IP_RECVTTL, “RECVTTL” and :RECVTTL for IPPROTO_IP</p>
</li><li>
<p>IPV6_PKTINFO, “PKTINFO” and :PKTINFO for IPPROTO_IPV6</p>
</li><li>
<p>etc.</p>
</li></ul>

<p><em>cmsg_data</em> should be a string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:TCP</span><span class='comma'>,</span> <span class='symbol'>:NODELAY</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: INET TCP NODELAY &quot;&quot;&gt;
</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: INET6 IPV6 PKTINFO &quot;&quot;&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L75'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 75</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_initialize(VALUE self, VALUE vfamily, VALUE vlevel, VALUE vtype, VALUE data)
{
    int family = rsock_family_arg(vfamily);
    int level = rsock_level_arg(family, vlevel);
    int type = rsock_cmsg_type_arg(family, level, vtype);
    StringValue(data);
    rb_ivar_set(self, rb_intern(&quot;family&quot;), INT2NUM(family));
    rb_ivar_set(self, rb_intern(&quot;level&quot;), INT2NUM(level));
    rb_ivar_set(self, rb_intern(&quot;type&quot;), INT2NUM(type));
    rb_ivar_set(self, rb_intern(&quot;data&quot;), data);
    return self;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="int-class_method">
  <h3 class='signature first'>
  .<strong>int</strong>(family, cmsg_level, cmsg_type, integer)  &#x21d2; <tt><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new <a href="" title="Socket::AncillaryData (class)">Socket::AncillaryData</a> object which contains a int as data.</p>

<p>The size and endian is dependent on the host.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_int'>int</span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='comma'>,</span> <span class='const'>STDERR</span><span class='period'>.</span><span class='id identifier rubyid_fileno'>fileno</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 2&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L366'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


366
367
368
369
370
371
372
373
374</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 366</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_s_int(VALUE klass, VALUE vfamily, VALUE vlevel, VALUE vtype, VALUE integer)
{
    int family = rsock_family_arg(vfamily);
    int level = rsock_level_arg(family, vlevel);
    int type = rsock_cmsg_type_arg(family, level, vtype);
    int i = NUM2INT(integer);
    return ancdata_new(family, level, type, rb_str_new((char*)&amp;i, sizeof(i)));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ip_pktinfo-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>ip_pktinfo</strong>(addr, ifindex)  &#x21d2; <tt>ancdata</tt> </span>
    <span class='overload'>.<strong>ip_pktinfo</strong>(addr, ifindex, spec_dst)  &#x21d2; <tt>ancdata</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns new ancillary data for IP_PKTINFO.</p>

<p>If spec_dst is not given, addr is used.</p>

<p>IP_PKTINFO is not standard.</p>

<p>Supported platform: GNU/Linux</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_spec_dst'>spec_dst</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ip_pktinfo'>ip_pktinfo</span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='comma'>,</span> <span class='id identifier rubyid_spec_dst'>spec_dst</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: INET IP PKTINFO 127.0.0.1 ifindex:0 spec_dst:127.0.0.1&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L420'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 420</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_s_ip_pktinfo(int argc, VALUE *argv, VALUE self)
{
    VALUE v_addr, v_ifindex, v_spec_dst;
    unsigned int ifindex;
    struct sockaddr_in sa;
    struct in_pktinfo pktinfo;

    rb_scan_args(argc, argv, &quot;21&quot;, &amp;v_addr, &amp;v_ifindex, &amp;v_spec_dst);

    SockAddrStringValue(v_addr);
    ifindex = NUM2UINT(v_ifindex);
    if (NIL_P(v_spec_dst))
        v_spec_dst = v_addr;
    else
        SockAddrStringValue(v_spec_dst);

    memset(&amp;pktinfo, 0, sizeof(pktinfo));

    memset(&amp;sa, 0, sizeof(sa));
    if (RSTRING_LEN(v_addr) != sizeof(sa))
        rb_raise(rb_eArgError, &quot;addr size different to AF_INET sockaddr&quot;);
    memcpy(&amp;sa, RSTRING_PTR(v_addr), sizeof(sa));
    if (sa.sin_family != AF_INET)
        rb_raise(rb_eArgError, &quot;addr is not AF_INET sockaddr&quot;);
    memcpy(&amp;pktinfo.ipi_addr, &amp;sa.sin_addr, sizeof(pktinfo.ipi_addr));

    pktinfo.ipi_ifindex = ifindex;

    memset(&amp;sa, 0, sizeof(sa));
    if (RSTRING_LEN(v_spec_dst) != sizeof(sa))
        rb_raise(rb_eArgError, &quot;spec_dat size different to AF_INET sockaddr&quot;);
    memcpy(&amp;sa, RSTRING_PTR(v_spec_dst), sizeof(sa));
    if (sa.sin_family != AF_INET)
        rb_raise(rb_eArgError, &quot;spec_dst is not AF_INET sockaddr&quot;);
    memcpy(&amp;pktinfo.ipi_spec_dst, &amp;sa.sin_addr, sizeof(pktinfo.ipi_spec_dst));

    return ancdata_new(AF_INET, IPPROTO_IP, IP_PKTINFO, rb_str_new((char *)&amp;pktinfo, sizeof(pktinfo)));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ipv6_pktinfo-class_method">
  <h3 class='signature'>
  .<strong>ipv6_pktinfo</strong>(addr, ifindex)  &#x21d2; <tt>ancdata</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns new ancillary data for IPV6_PKTINFO.</p>

<p>IPV6_PKTINFO is defined by RFC 3542.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo'>ipv6_pktinfo</span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: INET6 IPV6 PKTINFO ::1 ifindex:0&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L533'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 533</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_s_ipv6_pktinfo(VALUE self, VALUE v_addr, VALUE v_ifindex)
{
    unsigned int ifindex;
    struct sockaddr_in6 sa;
    struct in6_pktinfo pktinfo;

    SockAddrStringValue(v_addr);
    ifindex = NUM2UINT(v_ifindex);

    memset(&amp;pktinfo, 0, sizeof(pktinfo));

    memset(&amp;sa, 0, sizeof(sa));
    if (RSTRING_LEN(v_addr) != sizeof(sa))
        rb_raise(rb_eArgError, &quot;addr size different to AF_INET6 sockaddr&quot;);
    memcpy(&amp;sa, RSTRING_PTR(v_addr), sizeof(sa));
    if (sa.sin6_family != AF_INET6)
        rb_raise(rb_eArgError, &quot;addr is not AF_INET6 sockaddr&quot;);
    memcpy(&amp;pktinfo.ipi6_addr, &amp;sa.sin6_addr, sizeof(pktinfo.ipi6_addr));

    pktinfo.ipi6_ifindex = ifindex;

    return ancdata_new(AF_INET6, IPPROTO_IPV6, IPV6_PKTINFO, rb_str_new((char *)&amp;pktinfo, sizeof(pktinfo)));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix_rights-class_method">
  <h3 class='signature'>
  .<strong>unix_rights</strong>(io1, io2, ...)  &#x21d2; <tt><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new <a href="" title="Socket::AncillaryData (class)">Socket::AncillaryData</a> object which contains file
descriptors as data.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span><span class='lparen'>(</span><span class='const'>STDERR</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 2&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L191'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 191</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_s_unix_rights(int argc, VALUE *argv, VALUE klass)
{
    VALUE result, str, ary;
    int i;

    ary = rb_ary_new();

    for (i = 0 ; i &lt; argc; i++) {
        VALUE obj = argv[i];
        if (!RB_TYPE_P(obj, T_FILE)) {
            rb_raise(rb_eTypeError, &quot;IO expected&quot;);
        }
        rb_ary_push(ary, obj);
    }

    str = rb_str_buf_new(sizeof(int) * argc);

    for (i = 0 ; i &lt; argc; i++) {
        VALUE obj = RARRAY_AREF(ary, i);
        rb_io_t *fptr;
        int fd;
        GetOpenFile(obj, fptr);
        fd = fptr-&gt;fd;
        rb_str_buf_cat(str, (char *)&amp;fd, sizeof(int));
    }

    result = ancdata_new(AF_UNIX, SOL_SOCKET, SCM_RIGHTS, str);
    rb_ivar_set(result, rb_intern(&quot;unix_rights&quot;), ary);
    return result;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="cmsg_is?-instance_method">
  <h3 class='signature first'>
  #<strong>cmsg_is?</strong>(level, type)  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>tests the level and type of <em>ancillarydata</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPPROTO_IPV6</span><span class='comma'>,</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_PKTINFO</span><span class='rparen'>)</span> <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='rparen'>)</span>       <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='symbol'>:IP</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='rparen'>)</span>         <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='rparen'>)</span>      <span class='comment'>#=&gt; false
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1090'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1090</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_cmsg_is_p(VALUE self, VALUE vlevel, VALUE vtype)
{
    int family = ancillary_family(self);
    int level = rsock_level_arg(family, vlevel);
    int type = rsock_cmsg_type_arg(family, level, vtype);

    if (ancillary_level(self) == level &amp;&amp;
        ancillary_type(self) == type)
        return Qtrue;
    else
        return Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="data-instance_method">
  <h3 class='signature'>
  #<strong>data</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the cmsg data as a string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span>
<span class='comment'>#=&gt; &quot;&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L173'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


173
174
175
176
177
178
179</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 173</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_data(VALUE self)
{
    VALUE v = rb_attr_get(self, rb_intern(&quot;data&quot;));
    StringValue(v);
    return v;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="family-instance_method">
  <h3 class='signature'>
  #<strong>family</strong>  &#x21d2; <tt>Integer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the socket family as an integer.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span>
<span class='comment'>#=&gt; 10
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L114'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


114
115
116
117
118</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 114</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_family_m(VALUE self)
{
    return INT2NUM(ancillary_family(self));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="inspect-instance_method">
  <h3 class='signature'>
  #<strong>inspect</strong>  &#x21d2; <tt>String</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns a string which shows ancillarydata in human-readable form.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
<span class='comment'>#=&gt; &quot;#&lt;Socket::AncillaryData: INET6 IPV6 PKTINFO \&quot;\&quot;&gt;&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L952'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 952</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_inspect(VALUE self)
{
    VALUE ret;
    int family, level, type;
    VALUE data;
    ID family_id, level_id, type_id;
    VALUE vtype;
    int inspected;

    family = ancillary_family(self);
    level = ancillary_level(self);
    type = ancillary_type(self);
    data = ancillary_data(self);

    ret = rb_sprintf(&quot;#&lt;%s:&quot;, rb_obj_classname(self));

    family_id = rsock_intern_family_noprefix(family);
    if (family_id)
        rb_str_catf(ret, &quot; %s&quot;, rb_id2name(family_id));
    else
        rb_str_catf(ret, &quot; family:%d&quot;, family);

    if (level == SOL_SOCKET) {
        rb_str_cat2(ret, &quot; SOCKET&quot;);

        type_id = rsock_intern_scm_optname(type);
        if (type_id)
            rb_str_catf(ret, &quot; %s&quot;, rb_id2name(type_id));
        else
            rb_str_catf(ret, &quot; cmsg_type:%d&quot;, type);
    }
    else if (IS_IP_FAMILY(family)) {
        level_id = rsock_intern_iplevel(level);
        if (level_id)
            rb_str_catf(ret, &quot; %s&quot;, rb_id2name(level_id));
        else
            rb_str_catf(ret, &quot; cmsg_level:%d&quot;, level);

        vtype = ip_cmsg_type_to_sym(level, type);
        if (SYMBOL_P(vtype))
            rb_str_catf(ret, &quot; %&quot;PRIsVALUE, rb_sym2str(vtype));
        else
            rb_str_catf(ret, &quot; cmsg_type:%d&quot;, type);
    }
    else {
        rb_str_catf(ret, &quot; cmsg_level:%d&quot;, level);
        rb_str_catf(ret, &quot; cmsg_type:%d&quot;, type);
    }

    inspected = 0;

    if (level == SOL_SOCKET)
        family = AF_UNSPEC;

    switch (family) {
      case AF_UNSPEC:
        switch (level) {
#        if defined(SOL_SOCKET)
          case SOL_SOCKET:
            switch (type) {
#            if defined(SCM_TIMESTAMP) /* GNU/Linux, FreeBSD, NetBSD, OpenBSD, MacOS X, Solaris */
              case SCM_TIMESTAMP: inspected = inspect_timeval_as_abstime(level, type, data, ret); break;
#            endif
#            if defined(SCM_TIMESTAMPNS) /* GNU/Linux */
              case SCM_TIMESTAMPNS: inspected = inspect_timespec_as_abstime(level, type, data, ret); break;
#            endif
#            if defined(SCM_BINTIME) /* FreeBSD */
              case SCM_BINTIME: inspected = inspect_bintime_as_abstime(level, type, data, ret); break;
#            endif
#            if defined(SCM_RIGHTS) /* 4.4BSD */
              case SCM_RIGHTS: inspected = anc_inspect_socket_rights(level, type, data, ret); break;
#            endif
#            if defined(SCM_CREDENTIALS) /* GNU/Linux */
              case SCM_CREDENTIALS: inspected = anc_inspect_passcred_credentials(level, type, data, ret); break;
#            endif
#            if defined(INSPECT_SCM_CREDS) /* NetBSD */
              case SCM_CREDS: inspected = anc_inspect_socket_creds(level, type, data, ret); break;
#            endif
            }
            break;
#        endif
        }
        break;

      case AF_INET:
#ifdef INET6
      case AF_INET6:
#endif
        switch (level) {
#        if defined(IPPROTO_IP)
          case IPPROTO_IP:
            switch (type) {
#            if defined(IP_RECVDSTADDR) /* 4.4BSD */
              case IP_RECVDSTADDR: inspected = anc_inspect_ip_recvdstaddr(level, type, data, ret); break;
#            endif
#            if defined(IP_PKTINFO) &amp;&amp; defined(HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST) /* GNU/Linux */
              case IP_PKTINFO: inspected = anc_inspect_ip_pktinfo(level, type, data, ret); break;
#            endif
            }
            break;
#        endif

#        if defined(IPPROTO_IPV6)
          case IPPROTO_IPV6:
            switch (type) {
#            if defined(IPV6_PKTINFO) &amp;&amp; defined(HAVE_TYPE_STRUCT_IN6_PKTINFO) /* RFC 3542 */
              case IPV6_PKTINFO: inspected = anc_inspect_ipv6_pktinfo(level, type, data, ret); break;
#            endif
            }
            break;
#        endif
        }
        break;
    }

    if (!inspected) {
        rb_str_cat2(ret, &quot; &quot;);
        rb_str_append(ret, rb_str_dump(data));
    }

    rb_str_cat2(ret, &quot;&gt;&quot;);

    return ret;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="int-instance_method">
  <h3 class='signature'>
  #<strong>int</strong>  &#x21d2; <tt>Integer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the data in <em>ancillarydata</em> as an int.</p>

<p>The size and endian is dependent on the host.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_int'><a href="#int-class_method" title="Socket::AncillaryData.int (method)">int</a></span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='comma'>,</span> <span class='const'>STDERR</span><span class='period'>.</span><span class='id identifier rubyid_fileno'>fileno</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_int'>int</span> <span class='comment'>#=&gt; 2
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L387'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


387
388
389
390
391
392
393
394
395
396
397</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 387</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_int(VALUE self)
{
    VALUE data;
    int i;
    data = ancillary_data(self);
    if (RSTRING_LEN(data) != sizeof(int))
        rb_raise(rb_eTypeError, &quot;size differ.  expected as sizeof(int)=%d but %ld&quot;, (int)sizeof(int), (long)RSTRING_LEN(data));
    memcpy((char*)&amp;i, RSTRING_PTR(data), sizeof(int));
    return INT2NUM(i);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ip_pktinfo-instance_method">
  <h3 class='signature'>
  #<strong>ip_pktinfo</strong>  &#x21d2; <tt>Array</tt>, ... 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts addr, ifindex and spec_dst from IP_PKTINFO ancillary data.</p>

<p>IP_PKTINFO is not standard.</p>

<p>Supported platform: GNU/Linux</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_spec_dest'>spec_dest</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ip_pktinfo'><a href="#ip_pktinfo-class_method" title="Socket::AncillaryData.ip_pktinfo (method)">ip_pktinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='comma'>,</span> <span class='id identifier rubyid_spec_dest'>spec_dest</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_ip_pktinfo'>ip_pktinfo</span>
<span class='comment'>#=&gt; [#&lt;Addrinfo: 127.0.0.1&gt;, 0, #&lt;Addrinfo: 127.0.0.1&gt;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L483'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 483</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_ip_pktinfo(VALUE self)
{
    int level, type;
    VALUE data;
    struct in_pktinfo pktinfo;
    struct sockaddr_in sa;
    VALUE v_spec_dst, v_addr;

    level = ancillary_level(self);
    type = ancillary_type(self);
    data = ancillary_data(self);

    if (level != IPPROTO_IP || type != IP_PKTINFO ||
        RSTRING_LEN(data) != sizeof(struct in_pktinfo)) {
        rb_raise(rb_eTypeError, &quot;IP_PKTINFO ancillary data expected&quot;);
    }

    memcpy(&amp;pktinfo, RSTRING_PTR(data), sizeof(struct in_pktinfo));
    memset(&amp;sa, 0, sizeof(sa));

    sa.sin_family = AF_INET;
    memcpy(&amp;sa.sin_addr, &amp;pktinfo.ipi_addr, sizeof(sa.sin_addr));
    v_addr = rsock_addrinfo_new((struct sockaddr *)&amp;sa, sizeof(sa), PF_INET, 0, 0, Qnil, Qnil);

    sa.sin_family = AF_INET;
    memcpy(&amp;sa.sin_addr, &amp;pktinfo.ipi_spec_dst, sizeof(sa.sin_addr));
    v_spec_dst = rsock_addrinfo_new((struct sockaddr *)&amp;sa, sizeof(sa), PF_INET, 0, 0, Qnil, Qnil);

    return rb_ary_new3(3, v_addr, UINT2NUM(pktinfo.ipi_ifindex), v_spec_dst);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ipv6_pktinfo-instance_method">
  <h3 class='signature'>
  #<strong>ipv6_pktinfo</strong>  &#x21d2; <tt>Array</tt>, <tt>ifindex</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts addr and ifindex from IPV6_PKTINFO ancillary data.</p>

<p>IPV6_PKTINFO is defined by RFC 3542.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo'><a href="#ipv6_pktinfo-class_method" title="Socket::AncillaryData.ipv6_pktinfo (method)">ipv6_pktinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo'>ipv6_pktinfo</span> <span class='comment'>#=&gt; [#&lt;Addrinfo: ::1&gt;, 0]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L601'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


601
602
603
604
605
606
607
608
609
610
611</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 601</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_ipv6_pktinfo(VALUE self)
{
    struct in6_pktinfo pktinfo;
    struct sockaddr_in6 sa;
    VALUE v_addr;

    extract_ipv6_pktinfo(self, &amp;pktinfo, &amp;sa);
    v_addr = rsock_addrinfo_new((struct sockaddr *)&amp;sa, (socklen_t)sizeof(sa), PF_INET6, 0, 0, Qnil, Qnil);
    return rb_ary_new3(2, v_addr, UINT2NUM(pktinfo.ipi6_ifindex));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ipv6_pktinfo_addr-instance_method">
  <h3 class='signature'>
  #<strong>ipv6_pktinfo_addr</strong>  &#x21d2; <tt>addr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts addr from IPV6_PKTINFO ancillary data.</p>

<p>IPV6_PKTINFO is defined by RFC 3542.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo'><a href="#ipv6_pktinfo-class_method" title="Socket::AncillaryData.ipv6_pktinfo (method)">ipv6_pktinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo_addr'>ipv6_pktinfo_addr</span> <span class='comment'>#=&gt; #&lt;Addrinfo: ::1&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L631'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


631
632
633
634
635
636
637
638</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 631</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_ipv6_pktinfo_addr(VALUE self)
{
    struct in6_pktinfo pktinfo;
    struct sockaddr_in6 sa;
    extract_ipv6_pktinfo(self, &amp;pktinfo, &amp;sa);
    return rsock_addrinfo_new((struct sockaddr *)&amp;sa, (socklen_t)sizeof(sa), PF_INET6, 0, 0, Qnil, Qnil);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ipv6_pktinfo_ifindex-instance_method">
  <h3 class='signature'>
  #<strong>ipv6_pktinfo_ifindex</strong>  &#x21d2; <tt>addr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts ifindex from IPV6_PKTINFO ancillary data.</p>

<p>IPV6_PKTINFO is defined by RFC 3542.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_ip'><a href="../Addrinfo.html#ip-class_method" title="Addrinfo.ip (method)">ip</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ifindex'>ifindex</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo'><a href="#ipv6_pktinfo-class_method" title="Socket::AncillaryData.ipv6_pktinfo (method)">ipv6_pktinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_ifindex'>ifindex</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo_ifindex'>ipv6_pktinfo_ifindex</span> <span class='comment'>#=&gt; 0
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L658'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


658
659
660
661
662
663
664
665</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 658</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_ipv6_pktinfo_ifindex(VALUE self)
{
    struct in6_pktinfo pktinfo;
    struct sockaddr_in6 sa;
    extract_ipv6_pktinfo(self, &amp;pktinfo, &amp;sa);
    return UINT2NUM(pktinfo.ipi6_ifindex);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="level-instance_method">
  <h3 class='signature'>
  #<strong>level</strong>  &#x21d2; <tt>Integer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the cmsg level as an integer.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span>
<span class='comment'>#=&gt; 41
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L136'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


136
137
138
139
140</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 136</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_level_m(VALUE self)
{
    return INT2NUM(ancillary_level(self));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="timestamp-instance_method">
  <h3 class='signature'>
  #<strong>timestamp</strong>  &#x21d2; <tt>Time</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the timestamp as a time object.</p>

<p><em>ancillarydata</em> should be one of following type:</p>
<ul><li>
<p>SOL_SOCKET/SCM_TIMESTAMP (microsecond) GNU/Linux, FreeBSD, NetBSD, OpenBSD,
Solaris, MacOS X</p>
</li><li>
<p>SOL_SOCKET/SCM_TIMESTAMPNS (nanosecond) GNU/Linux</p>
</li><li>
<p>SOL_SOCKET/SCM_BINTIME (2**(-64) second) FreeBSD</p>

<p>Addrinfo.udp(“127.0.0.1”, 0).bind {|s1|</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_udp'><a href="../Addrinfo.html#udp-class_method" title="Addrinfo.udp (method)">udp</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_bind'><a href="../Addrinfo.html#bind-instance_method" title="Addrinfo#bind (method)">bind</a></span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s2'>s2</span><span class='op'>|</span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:TIMESTAMP</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span>
  <span class='id identifier rubyid_ctl'>ctl</span> <span class='op'>=</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_recvmsg'>recvmsg</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ctl'>ctl</span>    <span class='comment'>#=&gt; #&lt;Socket::AncillaryData: INET SOCKET TIMESTAMP 2009-02-24 17:35:46.775581&gt;
</span>  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_ctl'>ctl</span><span class='period'>.</span><span class='id identifier rubyid_timestamp'>timestamp</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span>      <span class='comment'>#=&gt; 2009-02-24 17:35:46 +0900
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_usec'>usec</span> <span class='comment'>#=&gt; 775581
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_nsec'>nsec</span> <span class='comment'>#=&gt; 775581000
</span><span class='rbrace'>}</span>
</code></pre>

<p>}</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L300'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 300</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_timestamp(VALUE self)
{
    int level, type;
    VALUE data;
    VALUE result = Qnil;

    level = ancillary_level(self);
    type = ancillary_type(self);
    data = ancillary_data(self);

# ifdef SCM_TIMESTAMP
    if (level == SOL_SOCKET &amp;&amp; type == SCM_TIMESTAMP &amp;&amp;
        RSTRING_LEN(data) == sizeof(struct timeval)) {
        struct timeval tv;
        memcpy((char*)&amp;tv, RSTRING_PTR(data), sizeof(tv));
        result = rb_time_new(tv.tv_sec, tv.tv_usec);
    }
# endif

# ifdef SCM_TIMESTAMPNS
    if (level == SOL_SOCKET &amp;&amp; type == SCM_TIMESTAMPNS &amp;&amp;
        RSTRING_LEN(data) == sizeof(struct timespec)) {
        struct timespec ts;
        memcpy((char*)&amp;ts, RSTRING_PTR(data), sizeof(ts));
        result = rb_time_nano_new(ts.tv_sec, ts.tv_nsec);
    }
# endif

#define add(x,y) (rb_funcall((x), &#39;+&#39;, 1, (y)))
#define mul(x,y) (rb_funcall((x), &#39;*&#39;, 1, (y)))
#define quo(x,y) (rb_funcall((x), rb_intern(&quot;quo&quot;), 1, (y)))

# ifdef SCM_BINTIME
    if (level == SOL_SOCKET &amp;&amp; type == SCM_BINTIME &amp;&amp;
        RSTRING_LEN(data) == sizeof(struct bintime)) {
        struct bintime bt;
	VALUE d, timev;
        memcpy((char*)&amp;bt, RSTRING_PTR(data), sizeof(bt));
	d = ULL2NUM(0x100000000ULL);
	d = mul(d,d);
	timev = add(TIMET2NUM(bt.sec), quo(ULL2NUM(bt.frac), d));
        result = rb_time_num_new(timev, Qnil);
    }
# endif

    if (result == Qnil)
        rb_raise(rb_eTypeError, &quot;timestamp ancillary data expected&quot;);

    return result;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="type-instance_method">
  <h3 class='signature'>
  #<strong>type</strong>  &#x21d2; <tt>Integer</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the cmsg type as an integer.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket::AncillaryData.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
<span class='comment'>#=&gt; 2
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L158'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


158
159
160
161
162</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 158</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_type_m(VALUE self)
{
    return INT2NUM(ancillary_type(self));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix_rights-instance_method">
  <h3 class='signature'>
  #<strong>unix_rights</strong>  &#x21d2; <tt>array-of-IOs</tt><sup>?</sup> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>returns the array of IO objects for SCM_RIGHTS control message in UNIX
domain socket.</p>

<p>The class of the IO objects in the array is IO or Socket.</p>

<p>The array is attached to <em>ancillarydata</em> when it is instantiated.
For example, <a href="../BasicSocket.html#recvmsg-instance_method" title="BasicSocket#recvmsg (method)">BasicSocket#recvmsg</a> attach the array when receives a
SCM_RIGHTS control message and :scm_rights=&gt;true option is given.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># recvmsg needs :scm_rights=&gt;true for unix_rights
</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="../UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'><a href="../UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span>                                         <span class='comment'>#=&gt; #&lt;UNIXSocket:fd 3&gt;
</span><span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_sendmsg'>sendmsg</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stdin and a socket</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'><a href="#unix_rights-class_method" title="Socket::AncillaryData.unix_rights (method)">unix_rights</a></span><span class='lparen'>(</span><span class='const'>STDIN</span><span class='comma'>,</span> <span class='id identifier rubyid_s1'>s1</span><span class='rparen'>)</span>
<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_ctl'>ctl</span> <span class='op'>=</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recvmsg'>recvmsg</span><span class='lparen'>(</span><span class='symbol'>:scm_rights</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ctl'>ctl</span>                                        <span class='comment'>#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 6 7&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ctl'>ctl</span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span>                            <span class='comment'>#=&gt; [#&lt;IO:fd 6&gt;, #&lt;Socket:fd 7&gt;]
</span><span class='id identifier rubyid_p'>p</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_identical?'>identical?</span><span class='lparen'>(</span><span class='const'>STDIN</span><span class='comma'>,</span> <span class='id identifier rubyid_ctl'>ctl</span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_p'>p</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_identical?'>identical?</span><span class='lparen'>(</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_ctl'>ctl</span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; true
</span>
<span class='comment'># If :scm_rights=&gt;true is not given, unix_rights returns nil
</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="../UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'><a href="../UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_sendmsg'>sendmsg</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stdin and a socket</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="../Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'><a href="#unix_rights-class_method" title="Socket::AncillaryData.unix_rights (method)">unix_rights</a></span><span class='lparen'>(</span><span class='const'>STDIN</span><span class='comma'>,</span> <span class='id identifier rubyid_s1'>s1</span><span class='rparen'>)</span>
<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_ctl'>ctl</span> <span class='op'>=</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recvmsg'>recvmsg</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ctl'>ctl</span> <span class='comment'>#=&gt; #&lt;Socket::AncillaryData: UNIX SOCKET RIGHTS 6 7&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ctl'>ctl</span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span> <span class='comment'>#=&gt; nil
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L257'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


257
258
259
260
261
262
263
264
265
266
267
268
269</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 257</span></pre>
<pre class='code cpp'>

static VALUE
ancillary_unix_rights(VALUE self)
{
    int level, type;

    level = ancillary_level(self);
    type = ancillary_type(self);

    if (level != SOL_SOCKET || type != SCM_RIGHTS)
        rb_raise(rb_eTypeError, &quot;SCM_RIGHTS ancillary data expected&quot;);

    return rb_attr_get(self, rb_intern(&quot;unix_rights&quot;));
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>