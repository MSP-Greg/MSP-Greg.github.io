<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: BasicSocket &mdash; socket Ruby-2.4.0 d2016-08-03</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "BasicSocket",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.4.0</a> &raquo; 
          <a href='index.html'>socket</a> &raquo; 
          <a href='_index.html'>Index (B)</a> &raquo; 
          <span class='title'>BasicSocket</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: BasicSocket</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'>IO</span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>IO</li>
        <li class='next'>BasicSocket</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Direct Subclasses:</td>
    <td>
      <a href="IPSocket.html" title="IPSocket (class)">IPSocket</a>, <a href="Socket.html" title="Socket (class)">Socket</a>, <a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L689'>ext/socket/basicsocket.c</a><span class='defines'>,<br /><a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1302'>ext/socket/ancdata.c</a>,<br/> <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L235'>ext/socket/lib/socket.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>BasicSocket is the super class for all the Socket classes.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#do_not_reverse_lookup-class_method" title="do_not_reverse_lookup (class method)">.<strong>do_not_reverse_lookup</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gets the global do_not_reverse_lookup flag.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#do_not_reverse_lookup%3D-class_method" title="do_not_reverse_lookup= (class method)">.<strong>do_not_reverse_lookup=</strong>(bool)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the global do_not_reverse_lookup flag.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#for_fd-class_method" title="for_fd (class method)">.<strong>for_fd</strong>(fd)  &#x21d2; BasicSocket </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a socket object which contains the file descriptor, <em>fd</em>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#__recvmsg-instance_method" title="#__recvmsg (instance method)">#<strong>__recvmsg</strong>(d, f, c, s)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#__recvmsg_nonblock-instance_method" title="#__recvmsg_nonblock (instance method)">#<strong>__recvmsg_nonblock</strong>(d, f, c, s, e)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#__sendmsg-instance_method" title="#__sendmsg (instance method)">#<strong>__sendmsg</strong>(d, f, d, c)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#__sendmsg_nonblock-instance_method" title="#__sendmsg_nonblock (instance method)">#<strong>__sendmsg_nonblock</strong>(d, f, d, c, e)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#close_read-instance_method" title="#close_read (instance method)">#<strong>close_read</strong>  &#x21d2; nil </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Disallows further read using shutdown system call.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#close_write-instance_method" title="#close_write (instance method)">#<strong>close_write</strong>  &#x21d2; nil </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Disallows further write using shutdown system call.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#connect_address-instance_method" title="#connect_address (instance method)">#<strong>connect_address</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an address of the socket suitable for connect in the local machine.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#do_not_reverse_lookup-instance_method" title="#do_not_reverse_lookup (instance method)">#<strong>do_not_reverse_lookup</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#do_not_reverse_lookup%3D-instance_method" title="#do_not_reverse_lookup= (instance method)">#<strong>do_not_reverse_lookup=</strong>(bool)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getpeereid-instance_method" title="#getpeereid (instance method)">#<strong>getpeereid</strong>  &#x21d2; Array, egid </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the user and group on the peer of the UNIX socket.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getpeername-instance_method" title="#getpeername (instance method)">#<strong>getpeername</strong>  &#x21d2; sockaddr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the remote address of the socket as a sockaddr string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getsockname-instance_method" title="#getsockname (instance method)">#<strong>getsockname</strong>  &#x21d2; sockaddr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the local address of the socket as a sockaddr string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getsockopt-instance_method" title="#getsockopt (instance method)">#<strong>getsockopt</strong>(level, optname)  &#x21d2; socketoption </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gets a socket option.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#local_address-instance_method" title="#local_address (instance method)">#<strong>local_address</strong>  &#x21d2; addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an Addrinfo object for local address obtained by getsockname.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recv-instance_method" title="#recv (instance method)">#<strong>recv</strong>(maxlen[, flags[, outbuf]])  &#x21d2; mesg </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Receives a message.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recv_nonblock-instance_method" title="#recv_nonblock (instance method)">#<strong>recv_nonblock</strong>(maxlen[, flags [, buf [, options ]]])  &#x21d2; mesg </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using
recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recvmsg-instance_method" title="#recvmsg (instance method)">#<strong>recvmsg</strong>(maxmesglen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; Array, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>recvmsg receives a message using recvmsg(2) system call in blocking manner.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recvmsg_nonblock-instance_method" title="#recvmsg_nonblock (instance method)">#<strong>recvmsg_nonblock</strong>(maxdatalen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; Array, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>recvmsg receives a message using recvmsg(2) system call in non-blocking
manner.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#remote_address-instance_method" title="#remote_address (instance method)">#<strong>remote_address</strong>  &#x21d2; addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an Addrinfo object for remote address obtained by getpeername.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(mesg, flags[, dest_sockaddr])  &#x21d2; numbytes_sent </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>send <em>mesg</em> via <em>basicsocket</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sendmsg-instance_method" title="#sendmsg (instance method)">#<strong>sendmsg</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls)  &#x21d2; numbytes_sent </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>sendmsg sends a message using sendmsg(2) system call in blocking manner.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sendmsg_nonblock-instance_method" title="#sendmsg_nonblock (instance method)">#<strong>sendmsg_nonblock</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls, opts = {})  &#x21d2; numbytes_sent </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>sendmsg_nonblock sends a message using sendmsg(2) system call in
non-blocking manner.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#setsockopt-instance_method" title="#setsockopt (instance method)">#<strong>setsockopt</strong>(level, optname, optval)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets a socket option.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>([how])  &#x21d2; 0 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Calls shutdown(2) system call.</p>
</div>
      </span>
    </li>
  </ul>



  <h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="do_not_reverse_lookup-class_method">
  <h3 class='signature first'>
  .<strong>do_not_reverse_lookup</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gets the global do_not_reverse_lookup flag.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="BasicSocket (class)">BasicSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>  <span class='comment'>#=&gt; false
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L657'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


657
658
659
660
661</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 657</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_rev_lookup(void)
{
    return rsock_do_not_reverse_lookup?Qtrue:Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="do_not_reverse_lookup=-class_method">
  <h3 class='signature'>
  .<strong>do_not_reverse_lookup=</strong>(bool)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the global do_not_reverse_lookup flag.</p>

<p>The flag is used for initial value of do_not_reverse_lookup for each
socket.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>                 <span class='comment'>#=&gt; true
</span><span class='const'><a href="" title="BasicSocket (class)">BasicSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>                 <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>                 <span class='comment'>#=&gt; true
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L679'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


679
680
681
682
683
684</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 679</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_rev_lookup_set(VALUE self, VALUE val)
{
    rsock_do_not_reverse_lookup = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="for_fd-class_method">
  <h3 class='signature'>
  .<strong>for_fd</strong>(fd)  &#x21d2; <tt><a href="" title="BasicSocket (class)">BasicSocket</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a socket object which contains the file descriptor, <em>fd</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># If invoked by inetd, STDIN/STDOUT/STDERR is a socket.
</span><span class='const'>STDIN_SOCK</span> <span class='op'>=</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_for_fd'>for_fd</span><span class='lparen'>(</span><span class='const'>STDIN</span><span class='period'>.</span><span class='id identifier rubyid_fileno'>fileno</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'>STDIN_SOCK</span><span class='period'>.</span><span class='id identifier rubyid_remote_address'>remote_address</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L24'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


24
25
26
27
28
29
30
31
32
33</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 24</span></pre>
<pre class='code cpp'>

static VALUE
bsock_s_for_fd(VALUE klass, VALUE fd)
{
    rb_io_t *fptr;
    VALUE sock = rsock_init_sock(rb_obj_alloc(klass), NUM2INT(fd));

    GetOpenFile(sock, fptr);

    return sock;
}
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="__recvmsg-instance_method">
  <h3 class='signature first'>
  #<strong>__recvmsg</strong>(d, f, c, s)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1674'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1674
1675
1676
1677
1678
1679
1680</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1674</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_recvmsg(VALUE sock, VALUE dlen, VALUE flags, VALUE clen,
		    VALUE scm_rights)
{
    VALUE ex = Qtrue;
    return bsock_recvmsg_internal(sock, dlen, flags, clen, scm_rights, ex, 0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="__recvmsg_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>__recvmsg_nonblock</strong>(d, f, c, s, e)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1684'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1684
1685
1686
1687
1688
1689</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1684</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_recvmsg_nonblock(VALUE sock, VALUE dlen, VALUE flags, VALUE clen,
			     VALUE scm_rights, VALUE ex)
{
    return bsock_recvmsg_internal(sock, dlen, flags, clen, scm_rights, ex, 1);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="__sendmsg-instance_method">
  <h3 class='signature'>
  #<strong>__sendmsg</strong>(d, f, d, c)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1302'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1302
1303
1304
1305
1306
1307
1308</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1302</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_sendmsg(VALUE sock, VALUE data, VALUE flags, VALUE dest_sockaddr,
		    VALUE controls)
{
    return bsock_sendmsg_internal(sock, data, flags, dest_sockaddr, controls,
				  Qtrue, 0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="__sendmsg_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>__sendmsg_nonblock</strong>(d, f, d, c, e)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/ancdata.c#L1312'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1312
1313
1314
1315
1316
1317
1318</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/ancdata.c', line 1312</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_sendmsg_nonblock(VALUE sock, VALUE data, VALUE flags,
			     VALUE dest_sockaddr, VALUE controls, VALUE ex)
{
    return bsock_sendmsg_internal(sock, data, flags, dest_sockaddr,
				  controls, ex, 1);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="close_read-instance_method">
  <h3 class='signature'>
  #<strong>close_read</strong>  &#x21d2; <tt>nil</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Disallows further read using shutdown system call.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_close_read'>close_read</span>
<span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='comment'>#=&gt; Broken pipe (Errno::EPIPE)
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L95'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


95
96
97
98
99
100
101
102
103
104
105
106
107
108</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 95</span></pre>
<pre class='code cpp'>

static VALUE
bsock_close_read(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    shutdown(fptr-&gt;fd, 0);
    if (!(fptr-&gt;mode &amp; FMODE_WRITABLE)) {
	return rb_io_close(sock);
    }
    fptr-&gt;mode &amp;= ~FMODE_READABLE;

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="close_write-instance_method">
  <h3 class='signature'>
  #<strong>close_write</strong>  &#x21d2; <tt>nil</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Disallows further write using shutdown system call.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='op'>|</span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ping</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_close_write'>close_write</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>        <span class='comment'>#=&gt; &quot;ping&quot;
</span>  <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pong</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>        <span class='comment'>#=&gt; &quot;pong&quot;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L125'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 125</span></pre>
<pre class='code cpp'>

static VALUE
bsock_close_write(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (!(fptr-&gt;mode &amp; FMODE_READABLE)) {
	return rb_io_close(sock);
    }
    shutdown(fptr-&gt;fd, 1);
    fptr-&gt;mode &amp;= ~FMODE_WRITABLE;

    return Qnil;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="connect_address-instance_method">
  <h3 class='signature'>
  #<strong>connect_address</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an address of the socket suitable for connect in the local machine.</p>

<p>This method returns <em>self</em>.local_address, except following
condition.</p>
<ul><li>
<p>IPv4 unspecified address (0.0.0.0) is replaced by IPv4 loopback address
(127.0.0.1).</p>
</li><li>
<p>IPv6 unspecified address (::) is replaced by IPv6 loopback address (::1).</p>
</li></ul>

<p>If the local address is not suitable for connect, SocketError is raised.
IPv4 and IPv6 address which port is 0 is not suitable for connect. Unix
domain socket which has no path is not suitable for connect.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp'><a href="Addrinfo.html#tcp-class_method" title="Addrinfo.tcp (method)">tcp</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_listen'><a href="Addrinfo.html#listen-instance_method" title="Addrinfo#listen (method)">listen</a></span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_connect_address'>connect_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:53660 TCP&gt;
</span>  <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_connect_address'>connect_address</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
    <span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [#&lt;Socket:fd 4&gt;, #&lt;Socket:fd 6&gt;]
</span>  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L255'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_address'>connect_address</span>
  <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_local_address'>local_address</span>
  <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>=</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_afamily'>afamily</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_INET</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound IPv4 socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_INET6</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_INET6</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound IPv6 socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># MacOS X 10.4 returns &quot;a.b.c.d&quot; for IPv4-mapped IPv6 address.
</span>      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::ffff:0.0.0.0</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># MacOS X 10.6 returns &quot;::ffff:a.b.c.d&quot; for IPv4-mapped IPv6 address.
</span>      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET6</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_UNIX</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_UNIX</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unbound Unix socket</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_unix_path'>unix_path</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_addr'>addr</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="do_not_reverse_lookup-instance_method">
  <h3 class='signature'>
  #<strong>do_not_reverse_lookup</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="BasicSocket (class)">BasicSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>      <span class='comment'>#=&gt; false
</span><span class='rbrace'>}</span>
<span class='const'><a href="" title="BasicSocket (class)">BasicSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'><a href="#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">do_not_reverse_lookup</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>      <span class='comment'>#=&gt; true
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L577'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


577
578
579
580
581
582
583
584</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 577</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_reverse_lookup(VALUE sock)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    return (fptr-&gt;mode &amp; FMODE_NOREVLOOKUP) ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="do_not_reverse_lookup=-instance_method">
  <h3 class='signature'>
  #<strong>do_not_reverse_lookup=</strong>(bool)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the do_not_reverse_lookup flag of <em>basicsocket</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span>       <span class='comment'>#=&gt; true
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_peeraddr'>peeraddr</span>                    <span class='comment'>#=&gt; [&quot;AF_INET&quot;, 80, &quot;221.186.184.68&quot;, &quot;221.186.184.68&quot;]
</span>  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_peeraddr'>peeraddr</span>                    <span class='comment'>#=&gt; [&quot;AF_INET&quot;, 80, &quot;carbon.ruby-lang.org&quot;, &quot;54.163.249.195&quot;]
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L600'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


600
601
602
603
604
605
606
607
608
609
610
611
612
613</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 600</span></pre>
<pre class='code cpp'>

static VALUE
bsock_do_not_reverse_lookup_set(VALUE sock, VALUE state)
{
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (RTEST(state)) {
	fptr-&gt;mode |= FMODE_NOREVLOOKUP;
    }
    else {
	fptr-&gt;mode &amp;= ~FMODE_NOREVLOOKUP;
    }
    return sock;
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getpeereid-instance_method">
  <h3 class='signature'>
  #<strong>getpeereid</strong>  &#x21d2; <tt>Array</tt>, <tt>egid</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the user and group on the peer of the UNIX socket. The result is a
two element array which contains the effective uid and the effective gid.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_server_loop'><a href="Socket.html#unix_server_loop-class_method" title="Socket.unix_server_loop (method)">unix_server_loop</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_euid'>euid</span><span class='comma'>,</span> <span class='id identifier rubyid_egid'>egid</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_getpeereid'>getpeereid</span>

    <span class='comment'># Check the connected client is myself or not.
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_euid'>euid</span> <span class='op'>!=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>

    <span class='comment'># do something about my resource.
</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L409'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 409</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getpeereid(VALUE self)
{
#if defined(HAVE_GETPEEREID)
    rb_io_t *fptr;
    uid_t euid;
    gid_t egid;
    GetOpenFile(self, fptr);
    if (getpeereid(fptr-&gt;fd, &amp;euid, &amp;egid) == -1)
	rb_sys_fail(&quot;getpeereid(3)&quot;);
    return rb_assoc_new(UIDT2NUM(euid), GIDT2NUM(egid));
#elif defined(SO_PEERCRED) /* GNU/Linux */
    rb_io_t *fptr;
    struct ucred cred;
    socklen_t len = sizeof(cred);
    GetOpenFile(self, fptr);
    if (getsockopt(fptr-&gt;fd, SOL_SOCKET, SO_PEERCRED, &amp;cred, &amp;len) == -1)
	rb_sys_fail(&quot;getsockopt(SO_PEERCRED)&quot;);
    return rb_assoc_new(UIDT2NUM(cred.uid), GIDT2NUM(cred.gid));
#elif defined(HAVE_GETPEERUCRED) /* Solaris */
    rb_io_t *fptr;
    ucred_t *uc = NULL;
    VALUE ret;
    GetOpenFile(self, fptr);
    if (getpeerucred(fptr-&gt;fd, &amp;uc) == -1)
	rb_sys_fail(&quot;getpeerucred(3C)&quot;);
    ret = rb_assoc_new(UIDT2NUM(ucred_geteuid(uc)), GIDT2NUM(ucred_getegid(uc)));
    ucred_free(uc);
    return ret;
#endif
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getpeername-instance_method">
  <h3 class='signature'>
  #<strong>getpeername</strong>  &#x21d2; <tt>sockaddr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the remote address of the socket as a sockaddr string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1440</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1440</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_getpeername'>getpeername</span> <span class='comment'>#=&gt; &quot;\x02\x00\x82u\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span><span class='rbrace'>}</span>
</code></pre>

<p>If Addrinfo object is preferred over the binary string, use
<a href="#remote_address-instance_method" title="BasicSocket#remote_address (method)">#remote_address</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L371'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


371
372
373
374
375
376
377
378
379
380
381
382
383
384</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 371</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getpeername(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getpeername(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getpeername(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rb_str_new((char*)&amp;buf, len);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getsockname-instance_method">
  <h3 class='signature'>
  #<strong>getsockname</strong>  &#x21d2; <tt>sockaddr</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the local address of the socket as a sockaddr string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>15120</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_getsockname'>getsockname</span> <span class='comment'>#=&gt; &quot;\x02\x00;\x10\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span><span class='rbrace'>}</span>
</code></pre>

<p>If Addrinfo object is preferred over the binary string, use
<a href="#local_address-instance_method" title="BasicSocket#local_address (method)">#local_address</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L340'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


340
341
342
343
344
345
346
347
348
349
350
351
352
353</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 340</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getsockname(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getsockname(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getsockname(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rb_str_new((char*)&amp;buf, len);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getsockopt-instance_method">
  <h3 class='signature'>
  #<strong>getsockopt</strong>(level, optname)  &#x21d2; <tt>socketoption</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gets a socket option. These are protocol and system specific, see your
local system documentation for details. The option is returned as a
<a href="Socket/Option.html" title="Socket::Option (class)">Socket::Option</a> object.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>level</code> is an integer, usually one of the SOL_ constants such as
Socket::SOL_SOCKET, or a protocol level. A string or symbol of the name,
possibly without prefix, is also accepted.</p>
</li><li>
<p><code>optname</code> is an integer, usually one of the SO_ constants, such
as Socket::SO_REUSEADDR. A string or symbol of the name, possibly without
prefix, is also accepted.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<p>Some socket options are integers with boolean values, in this case
<a href="#getsockopt-instance_method" title="BasicSocket#getsockopt (method)">#getsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_reuseaddr'>reuseaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:REUSEADDR</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_bool'>bool</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SOL_SOCKET</span><span class='comma'>,</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SO_REUSEADDR</span><span class='rparen'>)</span>
<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_reuseaddr'>reuseaddr</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='kw'>true</span>
</code></pre>

<p>Some socket options are integers with numeric values, in this case
<a href="#getsockopt-instance_method" title="BasicSocket#getsockopt (method)">#getsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ipttl'>ipttl</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='symbol'>:IP</span><span class='comma'>,</span> <span class='symbol'>:TTL</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_int'>int</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPPROTO_IP</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IP_TTL</span><span class='rparen'>)</span>
<span class='id identifier rubyid_ipttl'>ipttl</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
</code></pre>

<p>Option values may be structs. Decoding them can be complex as it involves
examining your system headers to determine the correct definition. An
example is a <tt>struct linger</tt>, which may be defined in your system headers
as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_struct'>struct</span> <span class='id identifier rubyid_linger'>linger</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_int'>int</span> <span class='id identifier rubyid_l_onoff'>l_onoff</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_int'>int</span> <span class='id identifier rubyid_l_linger'>l_linger</span><span class='semicolon'>;</span>
<span class='rbrace'>}</span><span class='semicolon'>;</span>
</code></pre>

<p>In this case <a href="#getsockopt-instance_method" title="BasicSocket#getsockopt (method)">#getsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Socket::Option knows linger structure.
</span><span class='id identifier rubyid_onoff'>onoff</span><span class='comma'>,</span> <span class='id identifier rubyid_linger'>linger</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:LINGER</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_linger'>linger</span>

<span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span>  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_getsockopt'>getsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SOL_SOCKET</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SO_LINGER</span><span class='rparen'>)</span>
<span class='id identifier rubyid_onoff'>onoff</span><span class='comma'>,</span> <span class='id identifier rubyid_linger'>linger</span> <span class='op'>=</span> <span class='id identifier rubyid_optval'>optval</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ii</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_onoff'>onoff</span> <span class='op'>=</span> <span class='id identifier rubyid_onoff'>onoff</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='kw'>true</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L303'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 303</span></pre>
<pre class='code cpp'>

static VALUE
bsock_getsockopt(VALUE sock, VALUE lev, VALUE optname)
{
    int level, option;
    socklen_t len;
    char *buf;
    rb_io_t *fptr;
    int family;

    GetOpenFile(sock, fptr);
    family = rsock_getfamily(fptr);
    level = rsock_level_arg(family, lev);
    option = rsock_optname_arg(family, level, optname);
    len = 256;
    buf = ALLOCA_N(char,len);

    rb_io_check_closed(fptr);

    if (getsockopt(fptr-&gt;fd, level, option, buf, &amp;len) &lt; 0)
	rsock_sys_fail_path(&quot;getsockopt(2)&quot;, fptr-&gt;pathv);

    return rsock_sockopt_new(family, level, option, rb_str_new(buf, len));
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="local_address-instance_method">
  <h3 class='signature'>
  #<strong>local_address</strong>  &#x21d2; <tt>addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an Addrinfo object for local address obtained by getsockname.</p>

<p>Note that addrinfo.protocol is filled by 0.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 192.168.0.129:36873 TCP&gt;
</span><span class='rbrace'>}</span>

<span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1512</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:1512 TCP&gt;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L461'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 461</span></pre>
<pre class='code cpp'>

static VALUE
bsock_local_address(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getsockname(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getsockname(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rsock_fd_socket_addrinfo(fptr-&gt;fd, &amp;buf.addr, len);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="recv-instance_method">
  <h3 class='signature'>
  #<strong>recv</strong>(maxlen[, flags[, outbuf]])  &#x21d2; <tt>mesg</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Receives a message.</p>

<p><em>maxlen</em> is the maximum number of bytes to receive.</p>

<p><em>flags</em> should be a bitwise OR of Socket::MSG_* constants.</p>

<p><em>outbuf</em> will contain only the received data after the method call
even if it is not empty at the beginning.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="UNIXSocket.html" title="UNIXSocket (class)">UNIXSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'><a href="UNIXSocket.html#pair-class_method" title="UNIXSocket.pair (method)">pair</a></span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='op'>|</span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span>                     <span class='comment'>#=&gt; &quot;Hell&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>4</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>MSG_PEEK</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; &quot;o Wo&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span>                     <span class='comment'>#=&gt; &quot;o Wo&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>                    <span class='comment'>#=&gt; &quot;rld\n&quot;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L636'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


636
637
638
639
640</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 636</span></pre>
<pre class='code cpp'>

static VALUE
bsock_recv(int argc, VALUE *argv, VALUE sock)
{
    return rsock_s_recvfrom(sock, argc, argv, RECV_RECV);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="recv_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>recv_nonblock</strong>(maxlen[, flags [, buf [, options ]]])  &#x21d2; <tt>mesg</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using
recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.
<em>flags</em> is zero or more of the <code>MSG_</code> options. The
result, <em>mesg</em>, is the data received.</p>

<p>When recvfrom(2) returns 0, <a href="#recv_nonblock-instance_method" title="BasicSocket#recv_nonblock (method)">#recv_nonblock</a> returns an empty string
as data. The meaning depends on the socket: EOF on TCP, empty packet on
UDP, etc.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>maxlen</code> - the number of bytes to receive from the socket</p>
</li><li>
<p><code>flags</code> - zero or more of the <code>MSG_</code> options</p>
</li><li>
<p><code>options</code> - keyword hash, supporting <tt>exception: false</tt></p>
</li></ul>

<h3 id="label-Example">Example</h3>

<p>serv = TCPServer.new(127.0.0.1, 0) 	af, port, host, addr = serv.addr 	c
= TCPSocket.new(addr, port) 	s = serv.accept 	c.send aaa, 0 	begin #
emulate blocking recv. 	  p s.recv_nonblock(10) #=&gt; aaa 	rescue
<code>IO::WaitReadable</code> 	  <a href="s">IO.select(</a>) 	  retry 	end</p>

<p>Refer to <a href="Socket.html#recvfrom-instance_method" title="Socket#recvfrom (method)">Socket#recvfrom</a> for the exceptions that may be thrown if the
call to <em>recv_nonblock</em> fails.</p>

<p><a href="#recv_nonblock-instance_method" title="BasicSocket#recv_nonblock (method)">#recv_nonblock</a> may raise any error corresponding to
recvfrom(2) failure, including <code>Errno::EWOULDBLOCK</code>.</p>

<p>If the exception is <code>Errno::EWOULDBLOCK</code> or <code>Errno::EAGAIN</code>, it is extended
by <code>IO::WaitReadable</code>. So <code>IO::WaitReadable</code> can be used to rescue the
exceptions for retrying recv_nonblock.</p>

<p>By specifying <tt>exception: false</tt>, the options hash allows you to indicate
that recv_nonblock should not raise an <code>IO::WaitWritable</code> exception, but
return the symbol :wait_writable instead.</p>

<h3 id="label-See">See</h3>
<ul><li>
<p><a href="Socket.html#recvfrom-instance_method" title="Socket#recvfrom (method)">Socket#recvfrom</a></p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L374'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


374
375
376</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recv_nonblock'>recv_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___recv_nonblock'>__recv_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="recvmsg-instance_method">
  <h3 class='signature'>
  #<strong>recvmsg</strong>(maxmesglen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; <tt>Array</tt>, ... 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>recvmsg receives a message using recvmsg(2) system call in blocking manner.</p>

<p><em>maxmesglen</em> is the maximum length of mesg to receive.</p>

<p><em>flags</em> is bitwise OR of MSG_* constants such as <code>Socket::MSG_PEEK</code>.</p>

<p><em>maxcontrollen</em> is the maximum length of controls (ancillary data)
to receive.</p>

<p><em>opts</em> is option hash. Currently :scm_rights=&gt;bool is the only
option.</p>

<p>:scm_rights option specifies that application expects SCM_RIGHTS control
message. If the value is nil or false, application don&#39;t expects
SCM_RIGHTS control message. In this case, recvmsg closes the passed file
descriptors immediately. This is the default behavior.</p>

<p>If :scm_rights value is neither nil nor false, application expects
SCM_RIGHTS control message. In this case, recvmsg creates IO objects for
each file descriptors for <a href="Socket/AncillaryData.html#unix_rights-instance_method" title="Socket::AncillaryData#unix_rights (method)">Socket::AncillaryData#unix_rights</a> method.</p>

<p>The return value is 4-elements array.</p>

<p><em>mesg</em> is a string of the received message.</p>

<p><em>sender_addrinfo</em> is a sender socket address for connection-less
socket. It is an Addrinfo object. For connection-oriented socket such as
TCP, sender_addrinfo is platform dependent.</p>

<p><em>rflags</em> is a flags on the received message which is bitwise OR of
MSG_* constants such as <code>Socket::MSG_TRUNC</code>. It will be nil if the system
uses 4.3BSD style old recvmsg system call.</p>

<p><em>controls</em> is ancillary data which is an array of
<a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">Socket::AncillaryData</a> objects such as:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Socket::AncillaryData: AF_UNIX SOCKET RIGHTS 7&gt;
</span></code></pre>

<p><em>maxmesglen</em> and <em>maxcontrollen</em> can be nil. In that case,
the buffer will be grown until the message is not truncated. Internally,
MSG_PEEK is used. Buffer full and MSG_CTRUNC are checked for truncation.</p>

<p>recvmsg can be used to implement recv_io as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_sender_sockaddr'>sender_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_rflags'>rflags</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_recvmsg'>recvmsg</span><span class='lparen'>(</span><span class='symbol'>:scm_rights</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_controls'>controls</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ancdata'>ancdata</span><span class='op'>|</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='period'>.</span><span class='id identifier rubyid_unix_rights'>unix_rights</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L429'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


429
430
431</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 429</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recvmsg'>recvmsg</span><span class='lparen'>(</span><span class='id identifier rubyid_dlen'>dlen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>scm_rights:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___recvmsg'>__recvmsg</span><span class='lparen'>(</span><span class='id identifier rubyid_dlen'>dlen</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span><span class='comma'>,</span> <span class='id identifier rubyid_scm_rights'>scm_rights</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="recvmsg_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>recvmsg_nonblock</strong>(maxdatalen = nil, flags = 0, maxcontrollen = nil, opts = {})  &#x21d2; <tt>Array</tt>, ... 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>recvmsg receives a message using recvmsg(2) system call in non-blocking
manner.</p>

<p>It is similar to <a href="#recvmsg-instance_method" title="BasicSocket#recvmsg (method)">#recvmsg</a> but non-blocking flag is set before
the system call and it doesn&#39;t retry the system call.</p>

<p>By specifying <tt>exception: false</tt>, the <em>opts</em> hash allows you to
indicate that recvmsg_nonblock should not raise an <code>IO::WaitWritable</code>
exception, but return the symbol :wait_writable instead.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L445'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


445
446
447
448</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 445</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recvmsg_nonblock'>recvmsg_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_dlen'>dlen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span>
                     <span class='label'>scm_rights:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___recvmsg_nonblock'>__recvmsg_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_dlen'>dlen</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_clen'>clen</span><span class='comma'>,</span> <span class='id identifier rubyid_scm_rights'>scm_rights</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="remote_address-instance_method">
  <h3 class='signature'>
  #<strong>remote_address</strong>  &#x21d2; <tt>addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an Addrinfo object for remote address obtained by getpeername.</p>

<p>Note that addrinfo.protocol is filled by 0.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_remote_address'>remote_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 221.186.184.68:80 TCP&gt;
</span><span class='rbrace'>}</span>

<span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1728</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1728</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_remote_address'>remote_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:36504 TCP&gt;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L495'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


495
496
497
498
499
500
501
502
503
504
505
506
507
508</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 495</span></pre>
<pre class='code cpp'>

static VALUE
bsock_remote_address(VALUE sock)
{
    union_sockaddr buf;
    socklen_t len = (socklen_t)sizeof buf;
    socklen_t len0 = len;
    rb_io_t *fptr;

    GetOpenFile(sock, fptr);
    if (getpeername(fptr-&gt;fd, &amp;buf.addr, &amp;len) &lt; 0)
	rb_sys_fail(&quot;getpeername(2)&quot;);
    if (len0 &lt; len) len = len0;
    return rsock_fd_socket_addrinfo(fptr-&gt;fd, &amp;buf.addr, len);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="send-instance_method">
  <h3 class='signature'>
  #<strong>send</strong>(mesg, flags[, dest_sockaddr])  &#x21d2; <tt>numbytes_sent</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>send <em>mesg</em> via <em>basicsocket</em>.</p>

<p><em>mesg</em> should be a string.</p>

<p><em>flags</em> should be a bitwise OR of Socket::MSG_* constants.</p>

<p><em>dest_sockaddr</em> should be a packed sockaddr string or an addrinfo.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\n\r\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L527'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 527</span></pre>
<pre class='code cpp'>

VALUE
rsock_bsock_send(int argc, VALUE *argv, VALUE sock)
{
    struct rsock_send_arg arg;
    VALUE flags, to;
    rb_io_t *fptr;
    int n;
    rb_blocking_function_t *func;

    rb_scan_args(argc, argv, &quot;21&quot;, &amp;arg.mesg, &amp;flags, &amp;to);

    StringValue(arg.mesg);
    if (!NIL_P(to)) {
	SockAddrStringValue(to);
	to = rb_str_new4(to);
	arg.to = (struct sockaddr *)RSTRING_PTR(to);
	arg.tolen = RSTRING_SOCKLEN(to);
	func = rsock_sendto_blocking;
    }
    else {
	func = rsock_send_blocking;
    }
    GetOpenFile(sock, fptr);
    arg.fd = fptr-&gt;fd;
    arg.flags = NUM2INT(flags);
    while (rsock_maybe_fd_writable(arg.fd),
	   (n = (int)BLOCKING_REGION_FD(func, &amp;arg)) &lt; 0) {
	if (rb_io_wait_writable(arg.fd)) {
	    continue;
	}
	rb_sys_fail(&quot;send(2)&quot;);
    }
    return INT2FIX(n);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sendmsg-instance_method">
  <h3 class='signature'>
  #<strong>sendmsg</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls)  &#x21d2; <tt>numbytes_sent</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>sendmsg sends a message using sendmsg(2) system call in blocking manner.</p>

<p><em>mesg</em> is a string to send.</p>

<p><em>flags</em> is bitwise OR of MSG_* constants such as <code>Socket::MSG_OOB</code>.</p>

<p><em>dest_sockaddr</em> is a destination socket address for connection-less
socket. It should be a sockaddr such as a result of <a href="Socket.html#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">Socket.sockaddr_in</a>.
An Addrinfo object can be used too.</p>

<p><em>controls</em> is a list of ancillary data. The element of
<em>controls</em> should be <a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">Socket::AncillaryData</a> or 3-elements array.
The 3-element array should contains cmsg_level, cmsg_type and data.</p>

<p>The return value, <em>numbytes_sent</em> is an integer which is the number
of bytes sent.</p>

<p>sendmsg can be used to implement send_io as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># use Socket::AncillaryData.
</span><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">AncillaryData</a></span><span class='period'>.</span><span class='id identifier rubyid_int'><a href="Socket/AncillaryData.html#int-class_method" title="Socket::AncillaryData.int (method)">int</a></span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_fileno'>fileno</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_sendmsg'>sendmsg</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='rparen'>)</span>

<span class='comment'># use 3-element array.
</span><span class='id identifier rubyid_ancdata'>ancdata</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:RIGHTS</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_fileno'>fileno</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>i!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_sendmsg'>sendmsg</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_ancdata'>ancdata</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L307'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


307
308
309</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 307</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sendmsg'>sendmsg</span><span class='lparen'>(</span><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___sendmsg'>__sendmsg</span><span class='lparen'>(</span><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_controls'>controls</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sendmsg_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>sendmsg_nonblock</strong>(mesg, flags = 0, dest_sockaddr = nil, *controls, opts = {})  &#x21d2; <tt>numbytes_sent</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>sendmsg_nonblock sends a message using sendmsg(2) system call in
non-blocking manner.</p>

<p>It is similar to <a href="#sendmsg-instance_method" title="BasicSocket#sendmsg (method)">#sendmsg</a> but the non-blocking flag is set
before the system call and it doesn&#39;t retry the system call.</p>

<p>By specifying <tt>exception: false</tt>, the <em>opts</em> hash allows you to
indicate that sendmsg_nonblock should not raise an <code>IO::WaitWritable</code>
exception, but return the symbol :wait_writable instead.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/lib/socket.rb#L323'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


323
324
325
326</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/lib/socket.rb', line 323</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sendmsg_nonblock'>sendmsg_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span><span class='comma'>,</span>
                     <span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___sendmsg_nonblock'>__sendmsg_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_mesg'>mesg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sockaddr'>dest_sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_controls'>controls</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="setsockopt-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>setsockopt</strong>(level, optname, optval)  </span>
    <span class='overload'>#<strong>setsockopt</strong>(socketoption)  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets a socket option. These are protocol and system specific, see your
local system documentation for details.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>level</code> is an integer, usually one of the SOL_ constants such as
Socket::SOL_SOCKET, or a protocol level. A string or symbol of the name,
possibly without prefix, is also accepted.</p>
</li><li>
<p><code>optname</code> is an integer, usually one of the SO_ constants, such
as Socket::SO_REUSEADDR. A string or symbol of the name, possibly without
prefix, is also accepted.</p>
</li><li>
<p><code>optval</code> is the value of the option, it is passed to the
underlying setsockopt() as a pointer to a certain number of bytes. How this
is done depends on the type:</p>
<ul><li>
<p>Fixnum: value is assigned to an int, and a pointer to the int is passed,
with length of sizeof(int).</p>
</li><li>
<p>true or false: 1 or 0 (respectively) is assigned to an int, and the int is
passed as for a Fixnum. Note that <code>false</code> must be passed, not
<code>nil</code>.</p>
</li><li>
<p>String: the string&#39;s data and length is passed to the socket.</p>
</li></ul>
</li><li>
<p><code>socketoption</code> is an instance of <a href="Socket/Option.html" title="Socket::Option (class)">Socket::Option</a></p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<p>Some socket options are integers with boolean values, in this case
<a href="#setsockopt-instance_method" title="BasicSocket#setsockopt (method)">#setsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SOL_SOCKET</span><span class='comma'>,</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SO_REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/Option.html" title="Socket::Option (class)">Option</a></span><span class='period'>.</span><span class='id identifier rubyid_bool'><a href="Socket/Option.html#bool-class_method" title="Socket::Option.bool (method)">bool</a></span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span>
</code></pre>

<p>Some socket options are integers with numeric values, in this case
<a href="#setsockopt-instance_method" title="BasicSocket#setsockopt (method)">#setsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:IP</span><span class='comma'>,</span> <span class='symbol'>:TTL</span><span class='comma'>,</span> <span class='int'>255</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPPROTO_IP</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IP_TTL</span><span class='comma'>,</span> <span class='int'>255</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/Option.html" title="Socket::Option (class)">Option</a></span><span class='period'>.</span><span class='id identifier rubyid_int'><a href="Socket/Option.html#int-class_method" title="Socket::Option.int (method)">int</a></span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:IP</span><span class='comma'>,</span> <span class='symbol'>:TTL</span><span class='comma'>,</span> <span class='int'>255</span><span class='rparen'>)</span><span class='rparen'>)</span>
</code></pre>

<p>Option values may be structs. Passing them can be complex as it involves
examining your system headers to determine the correct definition. An
example is an <code>ip_mreq</code>, which may be defined in your system
headers as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_struct'>struct</span> <span class='id identifier rubyid_ip_mreq'>ip_mreq</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_struct'>struct</span>  <span class='id identifier rubyid_in_addr'>in_addr</span> <span class='id identifier rubyid_imr_multiaddr'>imr_multiaddr</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_struct'>struct</span>  <span class='id identifier rubyid_in_addr'>in_addr</span> <span class='id identifier rubyid_imr_interface'>imr_interface</span><span class='semicolon'>;</span>
<span class='rbrace'>}</span><span class='semicolon'>;</span>
</code></pre>

<p>In this case <a href="#setsockopt-instance_method" title="BasicSocket#setsockopt (method)">#setsockopt</a> could be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_optval'>optval</span> <span class='op'>=</span> <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>224.0.0.251</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hton'>hton</span> <span class='op'>+</span>
         <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>INADDR_ANY</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AF_INET</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hton'>hton</span>
<span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPPROTO_IP</span><span class='comma'>,</span> <span class='const'><a href="Socket.html" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IP_ADD_MEMBERSHIP</span><span class='comma'>,</span> <span class='id identifier rubyid_optval'>optval</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L197'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 197</span></pre>
<pre class='code cpp'>

static VALUE
bsock_setsockopt(int argc, VALUE *argv, VALUE sock)
{
    VALUE lev, optname, val;
    int family, level, option;
    rb_io_t *fptr;
    int i;
    char *v;
    int vlen;

    if (argc == 1) {
        lev = rb_funcall(argv[0], rb_intern(&quot;level&quot;), 0);
        optname = rb_funcall(argv[0], rb_intern(&quot;optname&quot;), 0);
        val = rb_funcall(argv[0], rb_intern(&quot;data&quot;), 0);
    }
    else {
        rb_scan_args(argc, argv, &quot;30&quot;, &amp;lev, &amp;optname, &amp;val);
    }

    GetOpenFile(sock, fptr);
    family = rsock_getfamily(fptr);
    level = rsock_level_arg(family, lev);
    option = rsock_optname_arg(family, level, optname);

    switch (TYPE(val)) {
      case T_FIXNUM:
	i = FIX2INT(val);
	goto numval;
      case T_FALSE:
	i = 0;
	goto numval;
      case T_TRUE:
	i = 1;
      numval:
	v = (char*)&amp;i; vlen = (int)sizeof(i);
	break;
      default:
	StringValue(val);
	v = RSTRING_PTR(val);
	vlen = RSTRING_SOCKLEN(val);
	break;
    }

    rb_io_check_closed(fptr);
    if (setsockopt(fptr-&gt;fd, level, option, v, vlen) &lt; 0)
        rsock_sys_fail_path(&quot;setsockopt(2)&quot;, fptr-&gt;pathv);

    return INT2FIX(0);
}
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="shutdown-instance_method">
  <h3 class='signature'>
  #<strong>shutdown</strong>([how])  &#x21d2; <tt>0</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Calls shutdown(2) system call.</p>

<p>s.shutdown(Socket::SHUT_RD) disallows further read.</p>

<p>s.shutdown(Socket::SHUT_WR) disallows further write.</p>

<p>s.shutdown(Socket::SHUT_RDWR) disallows further read and write.</p>

<p><em>how</em> can be symbol or string:</p>
<ul><li>
<p>:RD, :SHUT_RD, RD and SHUT_RD are accepted as <code>Socket::SHUT_RD</code>.</p>
</li><li>
<p>:WR, :SHUT_WR, WR and SHUT_WR are accepted as <code>Socket::SHUT_WR</code>.</p>
</li><li>
<p>:RDWR, :SHUT_RDWR, RDWR and SHUT_RDWR are accepted as
<code>Socket::SHUT_RDWR</code>.</p>

<p>UNIXSocket.pair {|s1, s2|</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ping</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span><span class='lparen'>(</span><span class='symbol'>:WR</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>          <span class='comment'>#=&gt; &quot;ping\n&quot;
</span><span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pong</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>          <span class='comment'>#=&gt; &quot;pong\n&quot;
</span></code></pre>

<p>}</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/trunk/ext/socket/basicsocket.c#L62'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/socket/basicsocket.c', line 62</span></pre>
<pre class='code cpp'>

static VALUE
bsock_shutdown(int argc, VALUE *argv, VALUE sock)
{
    VALUE howto;
    int how;
    rb_io_t *fptr;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;howto);
    if (howto == Qnil)
	how = SHUT_RDWR;
    else {
	how = rsock_shutdown_how_arg(howto);
        if (how != SHUT_WR &amp;&amp; how != SHUT_RD &amp;&amp; how != SHUT_RDWR) {
	    rb_raise(rb_eArgError, &quot;`how&#39; should be either :SHUT_RD, :SHUT_WR, :SHUT_RDWR&quot;);
	}
    }
    GetOpenFile(sock, fptr);
    if (shutdown(fptr-&gt;fd, how) == -1)
	rb_sys_fail(&quot;shutdown(2)&quot;);

    return INT2FIX(0);
}
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>